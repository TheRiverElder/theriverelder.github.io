(this["webpackJsonpmind-node-2"]=this["webpackJsonpmind-node-2"]||[]).push([[0],{19:function(e,t,n){},20:function(e,t,n){},22:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var o=n(5),i=n.n(o),r=n(14),s=n.n(r),a=(n(19),n(7)),c=n(6),u=n(1),l=n(2),d=n(12),h=n(4),v=n(3),f=(n(20),n(0)),p="MindNodeData--",j=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={key:""},o}return Object(l.a)(n,[{key:"load",value:function(){var e=this;return new Promise((function(t,n){var o=e.state.key;if(o){var i=p+o,r=localStorage.getItem(i);r?t(r):n(new Error("No data in this key: "+o))}else n(new Error("No key specified!"))}))}},{key:"save",value:function(e){var t=this;return new Promise((function(n,o){var i=t.state.key;if(i){var r=p+i;localStorage.setItem(r,e),n(!0)}else o(new Error("No key specified!"))}))}},{key:"render",value:function(){var e=this;return Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{children:"\u952e\u540d\uff1a"}),Object(f.jsx)("span",{children:p}),Object(f.jsx)("input",{value:this.state.key,onChange:function(t){return e.setState((function(){return{key:t.target.value}}))}})]})}}]),n}(o.Component);n(22);function b(e){var t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=e[n];"string"===typeof o?t.push(o):o&&t.push(n)}return t.join(" ")}function O(e){return e.filter((function(e){return e||null!==e&&void 0!==e}))}var y=function(){};function g(e){var t,n=null===(t=e.current)||void 0===t?void 0:t.getBoundingClientRect();return{x:(null===n||void 0===n?void 0:n.x)||0,y:(null===n||void 0===n?void 0:n.y)||0,width:(null===n||void 0===n?void 0:n.width)||0,height:(null===n||void 0===n?void 0:n.height)||0}}var m=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).selfRef=i.a.createRef(),e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.props.onRectUpdate(this.props.node.uid,g(this.selfRef))}},{key:"componentDidUpdate",value:function(){this.props.onRectUpdate(this.props.node.uid,g(this.selfRef))}},{key:"render",value:function(){var e=this,t=this.props,n=t.node,o=n.uid,i=Object(c.a)(n.position,2),r=i[0],s=i[1],a=n.text,u=n.background,l=n.color,d=Object(c.a)(t.anchor,2),h=d[0],v=d[1],p=t.linking,j=t.choosen,O=r+h,y=s+v;return Object(f.jsxs)("div",{className:b({MindNodeCard:!0,linking:p,choosen:j}),ref:this.selfRef,style:{left:"".concat(O,"px"),top:"".concat(y,"px")},onClick:function(t){return e.props.onClick(t,o)},onMouseDown:function(t){return e.props.onMouseDown(t,o)},onMouseMove:function(t){return e.props.onMouseMove(t,o)},onMouseUp:function(t){return e.props.onMouseUp(t,o)},children:[Object(f.jsx)("div",{className:"frame"}),Object(f.jsx)("div",{className:"static",style:{background:u},children:Object(f.jsx)("div",{className:"wrapper",children:Object(f.jsx)("div",{className:"text",style:{color:l},children:a.split("\n").map((function(e,t){return Object(f.jsx)("p",{children:e},t)}))})})})]})}}]),n}(o.Component),N=m,k=(n(23),function(e){return e.stopPropagation()});function x(e){return function(t){return t.stopPropagation(),e(t)}}var P={onMouseDown:k,onMouseMove:k,onMouseUp:k},w=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).getBrief=function(e){var t=o.props.nodes.get(e);return t?"#"+e+"\uff1a"+t.text:"#"+e},o.state={inputingBackground:e.node.background,inputingColor:e.node.color,inputingText:e.node.text},o}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props.node,n=t.uid,o=t.position,i=t.outPorts,r=t.inPorts;return Object(f.jsxs)("div",{className:"MindNodeInfo",onMouseDown:k,onMouseMove:k,onMouseUp:k,children:[Object(f.jsx)("div",{className:"top-bar"}),Object(f.jsxs)("div",{className:"content",children:[Object(f.jsxs)("p",{children:[Object(f.jsx)("span",{className:"title",children:"UID\uff1a"}),Object(f.jsxs)("span",{className:"text",children:["#",n]})]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("span",{className:"title",children:"\u4f4d\u7f6e\uff1a"}),Object(f.jsxs)("span",{className:"text",children:["(",o.map((function(e){return e.toFixed(1)})).join(", "),")"]})]}),Object(f.jsxs)("p",{className:"field-color",children:[Object(f.jsx)("span",{className:"title",children:"\u80cc\u666f\u6837\u5f0f\uff1a"}),Object(f.jsx)("input",{className:"color-input",value:this.state.inputingBackground,onChange:function(t){return e.setBackground(t.target.value)}}),Object(f.jsx)("div",{className:"color-input-preview",style:{background:this.state.inputingBackground}})]}),Object(f.jsxs)("p",{className:"field-color",children:[Object(f.jsx)("span",{className:"title",children:"\u6587\u5b57\u6837\u5f0f\uff1a"}),Object(f.jsx)("input",{className:"color-input",value:this.state.inputingColor,onChange:function(t){return e.setColor(t.target.value)}}),Object(f.jsx)("div",{className:"color-input-preview",style:{background:this.state.inputingColor}})]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("span",{className:"title",children:"\u5185\u5bb9\uff1a"}),Object(f.jsx)("textarea",{className:"text-input",value:this.state.inputingText,onChange:function(t){return e.setText(t.target.value)}})]}),Object(f.jsxs)("p",{className:"title",children:["\u51fa\u7ebf\uff08",i.length,"\u4e2a\uff09\uff1a"]}),Object(f.jsx)("ol",{className:"text",children:i.map((function(t){return Object(f.jsx)("li",{className:"snapshot",children:e.getBrief(t)},t)}))}),Object(f.jsxs)("p",{className:"title",children:["\u5165\u7ebf\uff08",r.length,"\u4e2a\uff09\uff1a"]}),Object(f.jsx)("ol",{className:"text",children:r.map((function(t){return Object(f.jsx)("li",{className:"snapshot",children:e.getBrief(t)},t)}))})]})]})}},{key:"setText",value:function(e){this.setState((function(){return{inputingText:e}}));var t=Object(a.a)(Object(a.a)({},this.props.node),{},{text:e});this.props.onUpdate(t)}},{key:"setBackground",value:function(e){this.setState((function(){return{inputingBackground:e}}));var t=Object(a.a)(Object(a.a)({},this.props.node),{},{background:e});this.props.onUpdate(t)}},{key:"setColor",value:function(e){this.setState((function(){return{inputingColor:e}}));var t=Object(a.a)(Object(a.a)({},this.props.node),{},{color:e});this.props.onUpdate(t)}}]),n}(o.Component),M=function(){function e(t){Object(u.a)(this,e),this.baseUrl=void 0,this.baseUrl=t}return Object(l.a)(e,[{key:"constructUrl",value:function(e,t,n){var o=Array.from(this.baseUrl.searchParams.entries());return o.push(["action",e]),"string"===typeof t&&o.push(["path",t]),"string"===typeof n&&o.push(["target",n]),this.baseUrl.origin+this.baseUrl.pathname+"?"+o.map((function(e){var t=Object(c.a)(e,2),n=t[0],o=t[1];return n+"="+encodeURIComponent(o)})).join("&")}},{key:"constructPromise",value:function(e,t){return new Promise((function(n,o){return fetch(e,{method:t,mode:"no-cors"}).then((function(e){return e.json().then((function(e){return n(e)})).catch((function(e){return o(e)}))})).catch((function(e){return o(e)}))}))}},{key:"getInformation",value:function(t){return this.constructPromise(this.constructUrl(e.ACTION_GET_INFORMATION,t),e.METHOD_GET)}},{key:"getChildren",value:function(t){return this.constructPromise(this.constructUrl(e.ACTION_GET_CHILDREN,t),e.METHOD_GET)}},{key:"getText",value:function(t){var n=this;return new Promise((function(o,i){return fetch(n.constructUrl(e.ACTION_GET,t),{method:e.METHOD_GET,headers:[["Content-Type","text/plain"]]}).then((function(e){e.text().then((function(e){return o(e)})).catch((function(e){return i(e)}))})).catch((function(e){return i(e)}))}))}},{key:"add",value:function(t,n){var o=this.constructUrl(e.ACTION_ADD,n);return console.log("add",o),new Promise((function(n,i){return fetch(o,{method:e.METHOD_POST,body:t}).then((function(e){return e.json().then((function(e){return n(e)})).catch((function(e){return i(e)}))})).catch((function(e){return i(e)}))}))}},{key:"delete",value:function(t){return this.constructPromise(this.constructUrl(e.ACTION_DELETE,t),e.METHOD_POST)}},{key:"recycle",value:function(t){return this.constructPromise(this.constructUrl(e.ACTION_RECYCLE,t),e.METHOD_POST)}},{key:"rename",value:function(t,n){return this.constructPromise(this.constructUrl(e.ACTION_RENAME,t,n),e.METHOD_POST)}}]),e}();M.METHOD_GET="GET",M.METHOD_POST="POST",M.ACTION_GET="get",M.ACTION_GET_INFORMATION="get-information",M.ACTION_GET_CHILDREN="get-children",M.ACTION_ADD="add",M.ACTION_DELETE="delete",M.ACTION_RECYCLE="recycle",M.ACTION_RENAME="rename";var C=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).client=null,o.toggleConfirmed=function(){o.setState((function(e){var t=!e.locked;return o.client=t?new M(new URL("http://".concat(o.state.host,"/?path=").concat(encodeURIComponent(o.state.path)))):null,{locked:t}}))},o.state={host:"localhost:8888",path:"C:/",locked:!1},o}return Object(l.a)(n,[{key:"load",value:function(){if(!this.state.locked)return new Promise((function(e,t){return t(new Error("\u672a\u9501\u5b9a\uff01"))}));var e=this.client;return e?e.getText(this.state.path):new Promise((function(e,t){return t(new Error("\u672a\u77e5\u9519\u8bef\uff01"))}))}},{key:"save",value:function(e){var t=this;if(!this.state.locked)return new Promise((function(e,t){return t(new Error("\u672a\u9501\u5b9a\uff01"))}));var n=this.client;return new Promise(n?function(o,i){return n.add(e,t.state.path).then((function(e){return o(e.succeeded)})).catch(i)}:function(e,t){return t(new Error("\u672a\u77e5\u9519\u8bef\uff01"))})}},{key:"render",value:function(){var e=this;return Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:this.toggleConfirmed,children:this.state.locked?"\u53d6\u6d88\u9501\u5b9a":"\u9501\u5b9a"}),Object(f.jsx)("span",{children:"\u670d\u52a1\u5668\uff1a"}),Object(f.jsx)("input",{disabled:this.state.locked,value:this.state.host,onChange:function(t){return e.setState((function(){return{host:t.target.value}}))}}),Object(f.jsx)("span",{children:"\u6587\u4ef6\u8def\u5f84\uff1a"}),Object(f.jsx)("input",{disabled:this.state.locked,value:this.state.path,onChange:function(t){return e.setState((function(){return{path:t.target.value.replace(/\\/g,"/")}}))}})]})}}]),n}(o.Component),T=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).copy=function(){window.navigator.clipboard.writeText(o.state.dataText)},o.paste=function(){window.navigator.clipboard.readText().then((function(e){return o.setState((function(){return{dataText:e}}))}))},o.state={dataText:""},o}return Object(l.a)(n,[{key:"load",value:function(){var e=this;return new Promise((function(t){return t(e.state.dataText)}))}},{key:"save",value:function(e){var t=this;return new Promise((function(n){t.setState((function(){return{dataText:e}})),n(!0)}))}},{key:"render",value:function(){var e=this;return Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{children:"\u6587\u672c\u6570\u636e\uff08JSON\uff09\uff1a"}),Object(f.jsx)("textarea",{value:this.state.dataText,onChange:function(t){return e.setState((function(){return{dataText:t.target.value.replace(/\\/g,"/")}}))}}),Object(f.jsx)("button",{onClick:this.copy,children:"\u590d\u5236"}),Object(f.jsx)("button",{onClick:this.paste,children:"\u7c98\u8d34"})]})}}]),n}(o.Component),U=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={file:null,outputFileName:""},o}return Object(l.a)(n,[{key:"load",value:function(){var e=this;return new Promise((function(t,n){var o=e.state.file;if(o){var i=new FileReader;i.onload=function(){return t(i.result)},i.onerror=i.onabort=function(){return n(new Error("Error encountered while reading "+o.name))},i.readAsText(o,"utf-8")}else n(new Error("No file selected!"))}))}},{key:"save",value:function(e){var t=this;return new Promise((function(n,o){var i=t.state.outputFileName;if(i.length<=0)o(new Error("No output file name!"));else{var r=document.createElement("a");r.href=URL.createObjectURL(new Blob([e],{type:"plain/text"})),r.download=i,r.click(),n(!0)}}))}},{key:"setFile",value:function(e){if(e&&!(e.length<=0)){var t=e[0];this.setState((function(e){return{file:t,outputFileName:e.outputFileName||t.name}}))}}},{key:"render",value:function(){var e=this;return Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{children:"\u9009\u62e9\u6587\u4ef6\uff1a"}),Object(f.jsx)("input",{type:"file",onChange:function(t){return e.setFile(t.target.files)}}),Object(f.jsx)("span",{children:"\u4fdd\u5b58\u6587\u4ef6\u540d\u79f0\uff1a"}),Object(f.jsx)("input",{value:this.state.outputFileName,onChange:function(t){return e.setState((function(){return{outputFileName:t.target.value}}))}})]})}}]),n}(o.Component);function S(e){var t=e.uid;return{uid:t,position:e.position,text:"#".concat(t),background:"#223344",color:"#ffffff",outPorts:[],inPorts:[]}}function E(e,t){if(e&&t){var n=new Set(e.outPorts),o=new Set(t.inPorts);n.has(t.uid)&&n.delete(t.uid),o.has(e.uid)&&o.delete(e.uid),e.outPorts=Array.from(n),t.inPorts=Array.from(o)}}var A=n(8),R=n(9);var D=function(){return[0,0]},I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Number.isNaN(e)?[0,0]:[Math.cos(e)*t,Math.sin(e)*t]},L=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return[t.reduce((function(e,t){return e+t[0]}),0),t.reduce((function(e,t){return e+t[1]}),0)]},_=function(e,t){return[e[0]-t[0],e[1]-t[1]]},F=function(e){if(0===e[0]&&0===e[1])return[0,0];var t=Math.atan2(e[1],e[0]);return[Math.cos(t),Math.sin(t)]},B=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},G=function(e){return Math.atan2(e[1],e[0])},H=function(e,t){return[e[0]*t,e[1]*t]};function K(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(n.length<=1)return[n[0],0];for(var i=n;i.length>2;){for(var r=[],s=1;s<i.length;s++){var a=Object(c.a)(i[s-1],2),u=a[0],l=a[1],d=Object(c.a)(i[s],2),h=d[0],v=d[1];r.push([u+(h-u)*e,l+(v-l)*e])}i=r}var f=Object(c.a)(i[0],2),p=f[0],j=f[1],b=Object(c.a)(i[1],2),O=b[0],y=b[1],g=O-p,m=y-j,N=[p+g*e,j+m*e],k=Math.atan2(m,g);return[N,k]}var V=function(){function e(t){Object(u.a)(this,e),this.env=void 0,this.env=t}return Object(l.a)(e,[{key:"paint",value:function(e){var t=e.getContext("2d");if(t){var n=this.env;t.clearRect(0,0,e.width,e.height);var o=n.getPoolFix(),i=new Map;this.drawLinks(t,function(e){var t=i.get(e);if(t)return t;if(-1===e){var r=_(n.virtualDstPos||[0,0],o);return i.set(e,r),r}var s=n.getNodeRect(e);if(s){var a=L(_([s.x,s.y],o),[s.width/2,s.height/2]);return i.set(e,a),a}return[0,0]}.bind(this))}else console.log("Invalid canvas")}},{key:"drawArrow",value:function(e,t,n){e.beginPath(),e.moveTo.apply(e,Object(A.a)(L(t,I(n,3*e.lineWidth)))),e.lineTo.apply(e,Object(A.a)(L(t,I(n+.8*Math.PI,3*e.lineWidth)))),e.lineTo.apply(e,Object(A.a)(L(t,I(n-.8*Math.PI,3*e.lineWidth)))),e.fill()}}]),e}(),W=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"drawLinks",value:function(e,t){var n=this.env,o=n.nodes,i=new Map;function r(e){if(i.has(e))return i.get(e)||NaN;var r=t(e);if(-1===e){for(var s=[0,0],a=0,c=Array.from(n.selectedNodeUids.values());a<c.length;a++){var u=c[a];s=L(s,F(_(r,t(u))))}s=F(s);var l=Math.atan2(s[1],s[0]);return i.set(e,l),l}var d=o.get(e);if(!d)return NaN;var h,v=[0,0],f=Object(R.a)(d.inPorts);try{for(f.s();!(h=f.n()).done;){var p=h.value;v=L(v,F(_(r,t(p))))}}catch(N){f.e(N)}finally{f.f()}v=F(v);var j,b=[0,0],O=Object(R.a)(d.outPorts);try{for(O.s();!(j=O.n()).done;){var y=j.value;b=L(b,F(_(t(y),r)))}}catch(N){O.e(N)}finally{O.f()}n.selectedNodeUids.has(d.uid)&&n.virtualDstPos&&(b=L(b,F(_(n.virtualDstPos,r)))),b=F(b);var g=L(v,b),m=Math.atan2(g[1],g[0]);return i.set(d.uid,m),m}e.strokeStyle="#808080",e.fillStyle="#808080",e.lineWidth=1.5;for(var s=0,a=Array.from(n.nodes.values());s<a.length;s++){var u=a[s],l=t(u.uid),d=u.outPorts.slice();n.selectedNodeUids.has(u.uid)&&n.virtualDstPos&&d.push(-1);var h,v=Object(R.a)(d);try{for(v.s();!(h=v.n()).done;){var f=h.value,p=t(f),j=r(u.uid),b=r(f);if(!isNaN(j)&&!isNaN(b)){var O=B(_(p,l))/3,y=L(l,I(j,O)),g=_(p,I(b,O)),m=[l,y,g,p],N=K.apply(void 0,[.55].concat(m)),k=Object(c.a)(N,2),x=k[0],P=k[1];e.beginPath(),e.moveTo.apply(e,Object(A.a)(l)),e.bezierCurveTo.apply(e,Object(A.a)(y).concat(Object(A.a)(g),Object(A.a)(p))),e.stroke(),this.drawArrow(e,x,P)}}}catch(w){v.e(w)}finally{v.f()}}}}]),n}(V),z=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"drawLinks",value:function(e,t){var n=this.env;e.strokeStyle="#808080",e.fillStyle="#808080",e.lineWidth=1.5;for(var o=0,i=Array.from(n.nodes.values());o<i.length;o++){var r=i[o],s=t(r.uid),a=r.outPorts.slice();n.selectedNodeUids.has(r.uid)&&n.virtualDstPos&&a.push(-1);var c,u=Object(R.a)(a);try{for(u.s();!(c=u.n()).done;){var l=t(c.value);e.beginPath(),e.moveTo.apply(e,Object(A.a)(s)),e.lineTo.apply(e,Object(A.a)(l)),e.stroke();var d=_(l,s);this.drawArrow(e,L(s,H(d,.55)),G(d))}}catch(h){u.e(h)}finally{u.f()}}}}]),n}(V),J=function e(t){Object(u.a)(this,e),this.env=void 0,this.env=t},q=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).actived=!1,e.startMousePosition=D(),e.startNodePositions=new Map,e}return Object(l.a)(n,[{key:"onStart",value:function(e){var t=this,n=e.mousePosition,o=e.node;this.startNodePositions.clear(),this.startMousePosition=n,this.actived=!0;var i=Array.from(this.env.selectedNodeUids.values());o&&!this.env.selectedNodeUids.has(o.uid)&&(i=[o.uid],this.env.selectedNodeUids=new Set(i));var r=O(Array.from(i.values()).map((function(e){return t.env.nodes.get(e)}))).map((function(e){return function(e,t){var n=t.uid,o=t.position;return Object(a.a)(Object(a.a)({},e),{},{uid:n,position:o,inPorts:[],outPorts:[]})}(e,{uid:t.env.genUid(),position:(n=e.position,Object(A.a)(n))});var n}));console.log("copiedNodes",r),this.env.selectedNodeUids.clear(),r.forEach((function(e){t.env.nodes.set(e.uid,e),t.env.selectedNodeUids.add(e.uid)})),this.startNodePositions.clear();var s,c=Object(R.a)(r);try{for(c.s();!(s=c.n()).done;){var u=s.value;u&&this.startNodePositions.set(u.uid,u.position)}}catch(l){c.e(l)}finally{c.f()}}},{key:"onMove",value:function(e){var t=this,n=e.mousePosition;if(this.actived){var o=_(n,this.startMousePosition);this.startNodePositions.forEach((function(e,n){var i=t.env.nodes.get(n);i&&(i.position=L(e,o))}))}}},{key:"onEnd",value:function(){this.actived&&(this.startNodePositions.clear(),this.startMousePosition=D(),this.actived=!1)}}]),n}(J),Y=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"onStart",value:function(){}},{key:"onMove",value:function(){}},{key:"onEnd",value:function(e){var t=e.mousePosition,n=this.env.pixel2pool(t),o=this.env.genUid(),i=S({uid:o,position:n});this.env.nodes.set(o,i)}}]),n}(J),X=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).actived=!1,e.startMousePosition=D(),e.startNodePositions=new Map,e}return Object(l.a)(n,[{key:"onStart",value:function(e){var t=e.mousePosition,n=e.node;this.startNodePositions.clear(),this.startMousePosition=t,this.actived=!0;var o=Array.from(this.env.selectedNodeUids.values());n&&!this.env.selectedNodeUids.has(n.uid)&&(o=[n.uid],this.env.selectedNodeUids=new Set(o)),this.startNodePositions.clear();var i,r=Object(R.a)(o);try{for(r.s();!(i=r.n()).done;){var s=i.value,a=this.env.nodes.get(s);a&&this.startNodePositions.set(s,a.position)}}catch(c){r.e(c)}finally{r.f()}}},{key:"onMove",value:function(e){var t=this,n=e.mousePosition;if(this.actived){var o=_(n,this.startMousePosition);this.startNodePositions.forEach((function(e,n){var i=t.env.nodes.get(n);i&&(i.position=L(e,o))}))}}},{key:"onEnd",value:function(){this.actived&&(this.startNodePositions.clear(),this.startMousePosition=D(),this.actived=!1)}}]),n}(J),Q=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).actived=!1,e.startPoolOffset=D(),e.startMousePosition=D(),e}return Object(l.a)(n,[{key:"onStart",value:function(e){var t=e.mousePosition;this.startPoolOffset=this.env.offset,this.startMousePosition=t,this.actived=!0}},{key:"onMove",value:function(e){var t=e.mousePosition;this.actived&&(this.env.offset=L(this.startPoolOffset,_(t,this.startMousePosition)))}},{key:"onEnd",value:function(){this.actived&&(this.startPoolOffset=D(),this.startMousePosition=D(),this.actived=!1)}}]),n}(J),Z=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).actived=!1,e}return Object(l.a)(n,[{key:"onStart",value:function(e){var t=e.node;t&&(this.actived=!0,t&&!this.env.selectedNodeUids.has(t.uid)&&(this.env.selectedNodeUids=new Set([t.uid])))}},{key:"onMove",value:function(e){var t=e.mousePosition;this.actived&&(this.env.virtualDstPos=t)}},{key:"onEnd",value:function(e){var t=this,n=e.node;if(this.actived){if(this.env.virtualDstPos=null,n){var o=n;this.env.selectedNodeUids.forEach((function(e){var n=t.env.nodes.get(e);n&&function(e,t){if(e&&t&&e.uid!==t.uid){var n=new Set(e.outPorts),o=new Set(t.inPorts);return n.has(t.uid)?(n.delete(t.uid),o.delete(e.uid)):(n.add(t.uid),o.add(e.uid)),e.outPorts=Array.from(n),t.inPorts=Array.from(o),!0}}(n,o)}))}this.actived=!1}}}]),n}(J),$=function(e,t){return e-t},ee=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).actived=!1,e.startMousePosition=D(),e}return Object(l.a)(n,[{key:"onStart",value:function(e){var t=e.mousePosition;this.startMousePosition=t,this.actived=!0}},{key:"onMove",value:function(e){var t=e.mousePosition;if(this.actived){var n=_(t,this.startMousePosition),o=Object(c.a)(n,2),i=o[0],r=o[1];this.env.selectionArea={x:this.startMousePosition[0],y:this.startMousePosition[1],width:i,height:r}}}},{key:"onEnd",value:function(e){var t=this,n=e.mousePosition,o=e.node,i=e.nativeEvent;if(this.actived){var r=[];if(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(this.startMousePosition,n))o&&(r=[o.uid]);else{var s=[this.startMousePosition[0],n[0]].sort($),a=Object(c.a)(s,2),u=a[0],l=a[1],d=[this.startMousePosition[1],n[1]].sort($),h=Object(c.a)(d,2),v=h[0],f=h[1];r=Array.from(this.env.nodes.values()).filter((function(e){return t.isNodeInRange(e,u,l,v,f)})).map((function(e){return e.uid}))}i.ctrlKey?r.forEach((function(e){return t.env.selectedNodeUids.add(e)})):this.env.selectedNodeUids=new Set(r),this.startMousePosition=D(),this.env.selectionArea=null,this.actived=!1}}},{key:"isNodeInRange",value:function(e,t,n,o,i){var r=this.env.getNodeRect(e.uid);if(!r)return!1;var s=r.x,a=r.y,c=r.width,u=r.height;return s>=t&&a>=o&&s+c<n&&a+u<i}}]),n}(J),te=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(u.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).tool=null,e}return Object(l.a)(n,[{key:"onStart",value:function(e){var t=e.node,n=e.nativeEvent;1===n.button?this.tool=new Q(this.env):2===n.button?this.tool=new Z(this.env):n.ctrlKey?this.tool=new ee(this.env):n.shiftKey?(this.tool=new Y(this.env),n.preventDefault()):n.altKey?this.tool=new q(this.env):this.tool=t?new X(this.env):new ee(this.env),this.tool.onStart(e)}},{key:"onMove",value:function(e){var t;null===(t=this.tool)||void 0===t||t.onMove(e)}},{key:"onEnd",value:function(e){var t;null===(t=this.tool)||void 0===t||t.onEnd(e),this.tool=new ee(this.env)}}]),n}(J),ne=["createNode","linkNode","copyNode","dragNode","dragPool","select","auto"],oe={createNode:"\u589e\u52a0",linkNode:"\u94fe\u63a5",copyNode:"\u590d\u5236",dragNode:"\u79fb\u52a8",dragPool:"\u62d6\u52a8",select:"\u9009\u62e9",auto:"\u81ea\u52a8"},ie=function(e){Object(h.a)(n,e);var t=Object(v.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).persistences=[{name:"SSSP",id:"sssp",value:C},{name:"\u6587\u672c",id:"text",value:T},{name:"\u4f20\u7edf",id:"tranditional",value:U},{name:"\u6d4f\u89c8\u5668\u5b58\u50a8",id:"local_storage",value:j}],o.linkPainters=[{name:"\u76f4\u7ebf",id:"straight_line",value:new z(Object(d.a)(o))},{name:"\u8d1d\u585e\u5c14\u66f2\u7ebf",id:"bezier_curve",value:new W(Object(d.a)(o))}],o.persistenceRef=i.a.createRef(),o.mounted=!1,o.onGlobalKeyDown=function(e){"s"===e.key&&e.ctrlKey&&(e.preventDefault(),e.stopPropagation(),o.save())},o.onGlobalKeyUp=function(e){"Delete"===e.key&&o.deleteSelectedNodes()},o.poolRef=i.a.createRef(),o.canvasRef=i.a.createRef(),o.virtualDstPos=null,o.hideNodeInfoView=function(){return o.setState((function(){return{editingNodeUid:null}}))},o.nodeCardRects=new Map,o.selectedNodeUids=new Set,o.tool=null,o.origin=[0,0],o.resetView=function(){var e,t=null===(e=o.poolRef.current)||void 0===e?void 0:e.getBoundingClientRect();if(t){o.origin=[t.width/2,t.height/2];var n=o.canvasRef.current;n&&(n.width=t.width,n.height=t.height),o.notifyUpdate()}},o.dirty=!0,o.update=function(){o.mounted&&(o.dirty&&(o.updateStateNodes(),o.drawLines(),o.dirty=!1),requestAnimationFrame(o.update))},o.nodes=new Map,o.uidCounter=0,o.createAndAddNode=function(){var e=S({uid:o.genUid(),position:_([0,0],o.state.offset)});o.addNode(e)},o.onClickNode=function(e,t){o.setState((function(){return{editingNodeUid:t}}))},o.pointerMoving=!1,o.onMouseDown=function(e,t){var n;o.pointerMoving=!1,null===(n=o.tool)||void 0===n||n.onStart(o.getToolEvent(e,t)),o.notifyUpdate()},o.onMouseMove=function(e,t){var n;o.pointerMoving=!0,null===(n=o.tool)||void 0===n||n.onMove(o.getToolEvent(e,t)),o.notifyUpdate()},o.onMouseUp=function(e,t){var n,i,r=o.getToolEvent(e,t);o.pointerMoving&&(null===(i=o.tool)||void 0===i||i.onMove(r));null===(n=o.tool)||void 0===n||n.onEnd(r),o.notifyUpdate()},o.onMouseLeave=function(e,t){o.onMouseUp(e,t)},o.load=function(){var e=o.persistenceRef.current;e?e.load().then((function(e){console.log("Load succeeded."),o.resolveTextDataString(e)})).catch((function(e){alert("\u83b7\u53d6\u6570\u636e\u5931\u8d25\uff01"),console.error("Load data failed",e)})):console.log("Persistence does not exist")},o.save=function(){var e=o.persistenceRef.current;if(e){var t=o.buildPool(),n=new Date,i=JSON.stringify(t);e.save(i).then((function(e){e?(console.log("Save succeeded."),o.setState((function(){return{lastSavedTime:n}}))):console.error("Save failed.")})).catch((function(e){console.error("Save failed:",e)}))}else console.log("Persistence does not exist")},o.setNodeChoosen=function(e,t){t?o.selectedNodeUids.add(e):o.selectedNodeUids.delete(e),o.notifyUpdate()},o.unchooseAllNodes=function(){o.selectedNodeUids.clear(),o.notifyUpdate()},o.deleteSelectedNodes=function(){o.selectedNodeUids.forEach((function(e){o.nodeCardRects.delete(e);var t=o.nodes.get(e);o.nodes.delete(e),t&&(O(t.outPorts.map((function(e){return o.nodes.get(e)}))).forEach((function(e){return E(t,e)})),O(t.inPorts.map((function(e){return o.nodes.get(e)}))).forEach((function(e){return E(e,t)})))})),o.selectedNodeUids.clear(),o.notifyUpdate()},o.state={uidCounter:0,nodes:[],offset:[0,0],scale:1,editingNodeUid:null,toolFlag:null,selectionArea:null,lastSavedTime:null,persistence:o.persistences[0],linkPainter:o.linkPainters[0]},o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.mounted=!0,this.updateStateNodes(),this.drawLines(),window.addEventListener("resize",this.resetView),document.addEventListener("keydown",this.onGlobalKeyDown),window.addEventListener("keyup",this.onGlobalKeyUp),this.resetView(),this.setTool("auto"),requestAnimationFrame(this.update)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resetView),document.removeEventListener("keydown",this.onGlobalKeyDown),window.removeEventListener("keyup",this.onGlobalKeyUp),this.mounted=!1}},{key:"componentDidUpdate",value:function(e,t,n){this.drawLines()}},{key:"render",value:function(){var e=this;return Object(f.jsxs)("div",{className:"App",onContextMenu:function(e){return e.preventDefault()},children:[this.renderTopBar(),Object(f.jsxs)("div",{className:"node-pool",ref:this.poolRef,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseLeave,children:[Object(f.jsx)("canvas",{ref:this.canvasRef}),this.state.nodes.map((function(t){return Object(f.jsx)(N,{anchor:e.getAnchor(),node:t,linking:!1,choosen:e.selectedNodeUids.has(t.uid),onClick:e.onClickNode,onMouseDown:e.onMouseDown,onMouseMove:e.onMouseMove,onMouseUp:e.onMouseUp,onRectUpdate:function(t,n){return e.setNodeRect(t,n)},onClickLinkButton:y,onClickChooseButton:y},t.uid)})),this.renderSelectionArea(),this.renderNodeInfo(),this.renderToolButtons()]}),this.renderBottomBar()]})}},{key:"drawLines",value:function(){var e=function(e){var t=e.current;if(!t)return null;var n=t.getContext("2d");return n?[t,n]:null}(this.canvasRef);if(e){var t=Object(c.a)(e,1)[0];this.state.linkPainter.value.paint(t)}else console.log("Invalid canvas")}},{key:"renderTopBar",value:function(){var e=this;return Object(f.jsxs)("div",{className:"top-bar",children:[Object(f.jsx)("button",{onClick:this.save,children:"\u4fdd\u5b58"}),Object(f.jsx)("button",{onClick:this.load,children:"\u8f7d\u5165"}),Object(f.jsx)("span",{children:"\u4fdd\u5b58\u65b9\u5f0f\uff1a"}),Object(f.jsx)("select",{onChange:function(t){return e.setState((function(){return{persistence:e.persistences.find((function(e){return e.id===t.target.value}))||e.persistences[0]}}))},children:this.persistences.map((function(e){return Object(f.jsx)("option",{value:e.id,children:e.name})}))}),Object(f.jsx)("span",{children:"\u8fde\u7ebf\u65b9\u5f0f\uff1a"}),Object(f.jsx)("select",{onChange:function(t){return e.setState((function(){return{linkPainter:e.linkPainters.find((function(e){return e.id===t.target.value}))||e.linkPainters[0]}}))},children:this.linkPainters.map((function(e){return Object(f.jsx)("option",{value:e.id,children:e.name})}))}),this.renderPersistence()]})}},{key:"renderPersistence",value:function(){var e=this.state.persistence.value;return Object(f.jsx)(e,{ref:this.persistenceRef})}},{key:"renderToolButtons",value:function(){var e=this;return Object(f.jsxs)("div",{className:"tool-bar",children:[ne.map((function(t){return Object(f.jsx)("button",Object(a.a)(Object(a.a)({},P),{},{onClick:x(e.setTool.bind(e,t)),disabled:e.state.toolFlag===t,children:oe[t]}),t)})),Object(f.jsx)("span",{children:"|"}),Object(f.jsx)("button",Object(a.a)(Object(a.a)({},P),{},{onClick:x(this.createAndAddNode),children:"\u65b0\u589e"})),Object(f.jsx)("button",Object(a.a)(Object(a.a)({},P),{},{onClick:x(this.unchooseAllNodes),children:"\u53d6\u6d88\u9009\u62e9"})),Object(f.jsx)("button",Object(a.a)(Object(a.a)({},P),{},{onClick:x(this.deleteSelectedNodes),children:"\u5220\u9664\u6240\u9009"}))]})}},{key:"renderBottomBar",value:function(){var e;return Object(f.jsxs)("div",{className:"bottom-bar",children:[Object(f.jsxs)("span",{className:"piece",children:["\u603b\u8282\u70b9\u6570\uff1a",this.state.nodes.length]}),Object(f.jsxs)("span",{className:"piece",children:["\u9009\u4e2d\u8282\u70b9\u6570\uff1a",this.selectedNodeUids.size]}),Object(f.jsxs)("span",{className:"piece",children:["\u6700\u8fd1\u4fdd\u5b58\u4e8e\uff1a",(null===(e=this.state.lastSavedTime)||void 0===e?void 0:e.toLocaleString())||"\u672a\u4fdd\u5b58"]})]})}},{key:"renderNodeInfo",value:function(){var e=this,t=null!==this.state.editingNodeUid?this.nodes.get(this.state.editingNodeUid):null;return t?Object(f.jsxs)("div",{className:"node-info",children:[Object(f.jsx)("button",{className:"icon",onClick:this.hideNodeInfoView,children:">"}),Object(f.jsx)(w,{node:t,nodes:this.nodes,onUpdate:function(t){return e.updateNode(t)}},t.uid)]}):null}},{key:"renderSelectionArea",value:function(){var e=this.state.selectionArea;if(!e)return null;var t=e.x,n=e.y,o=e.width,i=e.height,r=_([t,n],this.getPoolFix()),s=Object(c.a)(r,2),a=s[0],u=s[1];return o<0&&(a-=o=-o),i<0&&(u-=i=-i),Object(f.jsx)("div",{className:"section",style:{left:a+"px",top:u+"px",width:o+"px",height:i+"px"}})}},{key:"offset",get:function(){return this.state.offset},set:function(e){this.setState((function(){return{offset:e}}))}},{key:"scale",get:function(){return this.state.scale},set:function(e){this.setState((function(){return{scale:e}}))}},{key:"selectionArea",get:function(){return this.state.selectionArea},set:function(e){this.setState((function(){return{selectionArea:e}}))}},{key:"getNodeRect",value:function(e){return this.nodeCardRects.get(e)||null}},{key:"setNodeRect",value:function(e,t){this.nodeCardRects.set(e,t)}},{key:"setTool",value:function(e){switch(e){case"createNode":this.tool=new Y(this);break;case"linkNode":this.tool=new Z(this);break;case"copyNode":this.tool=new q(this);break;case"dragNode":this.tool=new X(this);break;case"dragPool":this.tool=new Q(this);break;case"select":this.tool=new ee(this);break;case"auto":this.tool=new te(this);break;default:this.tool=null}this.setState((function(){return{toolFlag:e}}))}},{key:"getAnchor",value:function(){return L(this.origin,this.state.offset)}},{key:"getPoolFix",value:function(){return[(null===(e=g(this.poolRef))||void 0===e?void 0:e.x)||0,(null===e||void 0===e?void 0:e.y)||0];var e}},{key:"notifyUpdate",value:function(){this.dirty=!0}},{key:"genUid",value:function(){var e=this,t=this.uidCounter++;return this.setState((function(){return{uidCounter:e.uidCounter}})),t}},{key:"addNode",value:function(e){this.nodes.set(e.uid,e),this.updateStateNodes()}},{key:"updateNode",value:function(e){this.nodes.set(e.uid,e),this.updateStateNodes()}},{key:"removeNode",value:function(e){this.nodes.delete(e),this.nodeCardRects.delete(e),this.selectedNodeUids.delete(e),this.updateStateNodes()}},{key:"updateStateNodes",value:function(){var e=this;this.setState((function(){return{nodes:Array.from(e.nodes.values())}}))}},{key:"getToolEvent",value:function(e,t){"number"===typeof t&&e.stopPropagation();var n="number"===typeof t&&this.nodes.get(t)||null;return{mousePosition:[e.clientX,e.clientY],node:n,nativeEvent:e}}},{key:"pool2pixel",value:function(e){return L(e,this.getAnchor())}},{key:"pixel2pool",value:function(e){return _(_(e,this.getAnchor()),this.getPoolFix())}},{key:"buildPool",value:function(){return{uidCounter:this.state.uidCounter,offset:this.state.offset,scale:this.state.scale,nodes:Array.from(this.nodes.values())}}},{key:"resolveTextDataString",value:function(e){var t=this;try{var n=function(e){return{uidCounter:e.uidCounter||0,offset:e.offset||[0,0],scale:e.scale||1,nodes:e.nodes?e.nodes.map((function(e){return Object.assign(S(e),e)})):[]}}(JSON.parse(e));this.nodes.clear(),this.nodeCardRects.clear(),this.selectedNodeUids.clear(),n.nodes.forEach((function(e){return t.nodes.set(e.uid,e)})),this.setState((function(){return{uidCounter:n.uidCounter,offset:n.offset,nodes:n.nodes,scale:n.scale}})),this.uidCounter=n.uidCounter}catch(o){alert("\u89e3\u6790\u6570\u636e\u5931\u8d25\uff01")}}}]),n}(o.Component),re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,25)).then((function(t){var n=t.getCLS,o=t.getFID,i=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),o(e),i(e),r(e),s(e)}))};s.a.render(Object(f.jsx)(i.a.StrictMode,{children:Object(f.jsx)(ie,{})}),document.getElementById("root")),re()}},[[24,1,2]]]);
//# sourceMappingURL=main.56fb7616.chunk.js.map
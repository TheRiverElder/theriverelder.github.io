(function(t){function e(e){for(var n,r,o=e[0],l=e[1],c=e[2],d=0,v=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&v.push(s[r][0]),s[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(v.length)v.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(i.splice(e--,1),t=r(r.s=a[0]))}return t}var n={},s={app:0},i=[];function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/pl-editor/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("85ec"),s=a.n(n);s.a},"0fa5":function(t,e,a){},"1a7b":function(t,e,a){},"281c":function(t,e,a){},"29b3":function(t,e,a){},"2c33":function(t,e,a){"use strict";var n=a("7af6"),s=a.n(n);s.a},5485:function(t,e,a){"use strict";var n=a("736b"),s=a.n(n);s.a},5644:function(t,e,a){"use strict";var n=a("0fa5"),s=a.n(n);s.a},"56d7":function(t,e,a){"use strict";a.r(e);a("4de4"),a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"app"}},[a("v-app-bar",{attrs:{app:"",color:"primary",height:"32","clipped-left":""}},[a("MenuBar"),a("v-spacer"),a("v-subheader",{staticClass:"white--text"},[t._v("v2.6.1")])],1),t.showNav?a("v-navigation-drawer",{attrs:{app:"",permanent:"",clipped:""}},[a("v-list",[a("v-list-item",{on:{click:function(e){return t.open("base-info","base-info"+t.id)}}},[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-information-outline")])],1),a("v-list-item-title",[t._v("基础信息")])],1),a("v-list-item",{on:{click:function(e){return t.open("res-manager","res-manager"+t.id)}}},[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-folder-outline")])],1),a("v-list-item-title",[t._v("资源管理器")])],1),a("v-list-group",{scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-account-outline")])],1),a("v-list-item-subtitle",[t._v("角色")])]},proxy:!0}],null,!1,3000131414)},[t._l(t.roles,(function(e){return a("v-list-item",{key:e,on:{click:function(a){return t.open("role",e)}}},[a("v-list-item-avatar",{attrs:{color:"grey lighten-2"}},[a("v-img",{attrs:{src:t.data[t.data[e].avatar]}})],1),a("v-list-item-title",[t._v(t._s(t.data[e].name))])],1)})),a("v-list-item",[a("v-btn",{staticClass:"mx-auto",attrs:{text:"",color:"primary"},on:{click:t.createNewRole}},[t._v("新建角色")])],1)],2),a("v-list-group",{scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-text")])],1),a("v-list-item-subtitle",[t._v("台词段")])]},proxy:!0}],null,!1,2461098671)},[t._l(t.chunks,(function(e){return a("v-list-item",{key:e,on:{click:function(a){return t.open("chunk",e)}}},[a("v-list-item-title",[t._v(t._s(t.data[e].title))])],1)})),a("v-list-item",[a("v-btn",{staticClass:"mx-auto",attrs:{text:"",color:"primary"},on:{click:t.createNewChunk}},[t._v("新建文本段")])],1)],2)],1)],1):t._e(),a("v-main",{staticClass:"fill-y"},[a("div",{staticClass:"fill-y flex-grow-1 d-flex flex-column"},[a("v-tabs",{staticClass:"flex-grow-0",attrs:{height:"2em"},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},t._l(t.panels,(function(e,n){return a("v-tab",{key:e.id,attrs:{size:"small"}},[a("v-icon",{attrs:{small:""}},[t._v(t._s(e.icon))]),a("span",{staticClass:"mx-1"},[t._v(t._s(e.title))]),a("v-btn",{attrs:{"x-small":"",icon:""},on:{click:function(e){return t.closePanel({index:n})}}},[a("v-icon",{attrs:{"x-small":""}},[t._v(t._s(e.dirty?"mdi-circle":"mdi-close"))])],1)],1)})),1),a("v-divider"),a("v-tabs-items",{staticClass:"fill-y inner-fill-y overflow-hidden inner-overflow-auto grey lighten-4 flex-grow-1",attrs:{"active-class":""},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},t._l(t.panels,(function(e,n){return a("v-tab-item",{key:e.id,staticClass:"fill-y grey lighten-4"},[a(e.component,{ref:"panels",refInFor:!0,tag:"component",staticClass:"edit-area",attrs:{id:e.id},on:{mutate:function(t){e.dirty=!0},delete:function(e){return t.close(n)}}})],1)})),1)],1)]),a("v-footer",{staticClass:"py-0",attrs:{app:"",dark:"",height:"24"}},[t.messages.length?a("span",{staticClass:"font-weight-light"},[t._v(t._s(t._f("localizeDate")(t.lastMessage.time))+" ： "+t._s(t.lastMessage.text))]):t._e()]),a("v-dialog",{attrs:{value:t.dialog}},[t.dialog?a(t.dialog.component,{tag:"component"}):t._e()],1)],1)},i=[],r=a("5530"),o=a("2f62"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("文件")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:"",disabled:!t.panels.length},on:{click:t.savePanel}},[a("v-list-item-title",[t._v("保存当前项目")])],1),a("v-list-item",{attrs:{dense:"",disabled:!t.panels.length},on:{click:t.saveAllPanels}},[a("v-list-item-title",[t._v("保存所有项目")])],1),a("v-divider"),a("v-list-item",{attrs:{dense:""},on:{click:t.downloadProject}},[a("v-list-item-title",[t._v("下载工程")])],1),a("v-list-item",{attrs:{dense:"",disabled:!t.script},on:{click:t.downloadScript}},[a("v-list-item-title",[t._v("下载脚本")])],1),a("v-list-item",{attrs:{dense:""},on:{click:t.cacheState}},[a("v-list-item-title",[t._v("缓存至浏览器")])],1),a("v-divider"),a("v-list-item",{attrs:{dense:""},on:{click:t.loadProjectFromCache}},[a("v-list-item-title",[t._v("从浏览器缓存载入工程")])],1),a("v-list-item",{attrs:{dense:""}},[a("v-list-item-title",{staticClass:"p-relative"},[t._v(" 从文件载入工程 "),a("input",{staticClass:"invisible-overlay",attrs:{type:"file"},on:{change:function(e){return t.loadProjectFromFile(e.target.files[0])}}})])],1),a("v-divider"),a("v-list-item",{attrs:{dense:""},on:{click:function(e){return t.openDialog("export-to-text")}}},[a("v-list-item-title",[t._v("导出为纯文本")])],1),a("v-list-item",{attrs:{dense:""},on:{click:function(e){return t.openDialog("import-from-text")}}},[a("v-list-item-title",[t._v("从纯文本导入")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("工程")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:function(e){return t.compile("development")}}},[a("v-list-item-title",[t._v("编译为测试版")])],1),a("v-list-item",{attrs:{dense:"",disabled:""},on:{click:function(e){return t.compile("production")}}},[a("v-list-item-title",[t._v("编译为发行版")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("脚本")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:"",disabled:!t.script},on:{click:function(e){return t.open("demo")}}},[a("v-list-item-title",[t._v("开始测试")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("窗口")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:function(e){t.app.showNav=!t.app.showNav}}},[a("v-list-item-title",[t._v("开关导航栏")])],1),a("v-list-item",{attrs:{dense:""},on:{click:t.closeAllPanels}},[a("v-list-item-title",[t._v("关闭所有标签")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("帮助")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:function(e){return t.open("doc")}}},[a("v-list-item-title",[t._v("帮助文档")])],1)],1)],1)],1)},c=[],u={name:"MenuBar",computed:Object(r["a"])({},Object(o["c"])(["id","tabIndex","panels","script","app"])),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["openPanel","savePanel","saveAllPanels","closeAllPanels","updateData","cacheState","downloadProject","downloadScript","compile","loadProjectFromFile","loadProjectFromCache","openDialog"])),{},{open:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.openPanel({type:t,id:e})}})},d=u,v=a("2877"),p=a("6544"),h=a.n(p),f=a("8336"),m=a("ce7e"),b=a("8860"),g=a("da13"),_=a("5d23"),x=a("e449"),k=Object(v["a"])(d,l,c,!1,null,null,null),w=k.exports;h()(k,{VBtn:f["a"],VDivider:m["a"],VList:b["a"],VListItem:g["a"],VListItemTitle:_["c"],VMenu:x["a"]});var y={name:"App",components:{MenuBar:w},data:function(){return{showNav:!0}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["id","panels","resources","roles","chunks","data","messages","dialog"])),{},{tabIndex:{get:function(){return this.$store.state.tabIndex},set:function(t){this.setTabIndex(t)}},lastMessage:function(){return this.messages[this.messages.length-1]}}),watch:{id:function(t){this.closeAllPanels(),this.openPanel({type:"base-info",id:"base-info"+t})}},methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["openPanel","closePanel","closeAllPanels","setTabIndex","setApp","createRole","createChunk","savePanel","saveAllPanels"])),{},{createNewRole:function(){var t=this;this.createRole({cb:function(e){return t.open("role",e.id)}})},createNewChunk:function(){var t=this;this.createChunk({cb:function(e){return t.open("chunk",e.id)}})},open:function(t,e){this.openPanel({type:t,id:e})}}),created:function(){var t=this;window.addEventListener("keydown",(function(e){"S"!==e.key&&"s"!==e.key||!e.ctrlKey||(e.preventDefault(),e.stopPropagation(),e.shiftKey?t.saveAllPanels():t.savePanel(t.tabIndex),t.$forceUpdate())})),this.openPanel({type:"base-info",id:"base-info"+this.id}),this.setApp(this)}},C=y,S=(a("034f"),a("7496")),j=a("40dc"),O=a("169a"),T=a("553a"),V=a("132d"),I=a("adda"),D=a("56b0"),$=a("8270"),P=a("f6c4"),N=a("f774"),R=a("2fa4"),E=a("e0c7"),A=a("71a3"),M=a("c671"),B=a("fe57"),L=a("aac8"),F=Object(v["a"])(C,s,i,!1,null,null,null),U=F.exports;h()(F,{VApp:S["a"],VAppBar:j["a"],VBtn:f["a"],VDialog:O["a"],VDivider:m["a"],VFooter:T["a"],VIcon:V["a"],VImg:I["a"],VList:b["a"],VListGroup:D["a"],VListItem:g["a"],VListItemAvatar:$["a"],VListItemSubtitle:_["b"],VListItemTitle:_["c"],VMain:P["a"],VNavigationDrawer:N["a"],VSpacer:R["a"],VSubheader:E["a"],VTab:A["a"],VTabItem:M["a"],VTabs:B["a"],VTabsItems:L["a"]});var z=a("f309");n["a"].use(z["a"]);var q=new z["a"]({}),J=(a("b0c0"),a("99af"),a("0481"),a("4160"),a("a15b"),a("d81d"),a("13d5"),a("fb6a"),a("a434"),a("4069"),a("ac1f"),a("1276"),a("498a"),a("159b"),a("b85c")),K=a("2909"),G=a("aeb1"),H=a.n(G),X=a("ec26"),Q=10;function W(t,e){t.messages.push({time:Date.now(),text:e}),t.messages.length>Q&&t.messages.splice(0,t.messages.length-Q)}a("c740");function Y(t,e,a,n){var s=Object(r["a"])({id:Object(X["a"])()},a);return t.data[s.id]=s,t[e].push(s.id),n&&n(s),s.id}function Z(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.name,n=void 0===a?"未命名资源":a,s=e.src,i=void 0===s?null:s,r=e.mine,o=void 0===r?"image/*":r,l=e.cb;return Y(t,"resources",{name:n,src:i,mine:o,type:"resource"},l)}function tt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.name,n=void 0===a?"未命名角色":a,s=e.avatar,i=void 0===s?null:s,r=e.pic,o=void 0===r?null:r,l=e.noPic,c=void 0!==l&&l,u=e.cb;return Y(t,"roles",{name:n,avatar:i,pic:o,noPic:c,type:"role"},u)}function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.title,n=void 0===a?"未命名文本段":a,s=e.subtitle,i=void 0===s?"":s,r=e.background,o=void 0===r?null:r,l=e.sections,c=void 0===l?[{speaker:null,text:""}]:l,u=e.exits,d=void 0===u?[]:u,v=e.cb;return Y(t,"chunks",{title:n,subtitle:i,background:o,sections:c,exits:d,type:"chunk"},v)}function at(t,e,a){delete t.data[a];var n=t[e],s=n.findIndex((function(t){return t===a}));s>=0&&n.splice(s,1)}function nt(t,e){at(t,"resources",e)}function st(t,e){at(t,"roles",e)}function it(t,e){at(t,"chunks",e)}function rt(t,e){var a=t.data[e.id];a?Object.assign(a,e):t.data[e.id]=e}var ot="pl-editor-project";function lt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"development",a="development"===e,n={},s=a?{resourceNames:t.resources.map((function(e){return t.data[e].name})),chunkTitles:{}}:null,i=t.resources.map((function(e){return t.data[e].src}));t.resources.forEach((function(t,e){return n[t]=e}));var r=t.roles.map((function(e){var a=t.data[e];return{name:a.name,avatar:n[a.avatar],pic:n[a.pic]}}));t.roles.forEach((function(t,e){return n[t]=e}));var o=[];t.chunks.forEach((function(e){var i=t.data[e];n[e]=o.length,a&&(s.chunkTitles[o.length]=i.title),o.push.apply(o,[["bg",n[i.background]]].concat(Object(K["a"])(i.sections.reduce((function(t,e){return t.push.apply(t,Object(K["a"])(e.text.split("\n").filter((function(t){return!/^\s*$/.test(t)})).map((function(t){return["line",t,n[e.speaker]]})))),t}),[])),Object(K["a"])(i.exits.map((function(t){return["option",t.text,t.target]})))))})),o.forEach((function(t){"option"===t[0]&&(t[2]=n[t[2]])}));var l={name:t.name,version:t.verion,authors:t.authors,instructions:o,resources:i,roles:r};a&&(l.map=s),t.script=l,W(t,"剧本编译完成：".concat(t.name,"，ID：").concat(t.id))}function ct(t){t.lastModified=Date.now(),localStorage.setItem(ot,JSON.stringify({id:t.id,lastModified:t.lastModified,name:t.name,version:t.version,authors:t.authors,entry:t.entry,data:t.data,resources:t.resources,roles:t.roles,chunks:t.chunks})),W(t,"缓存完成：".concat(t.name,"，ID：").concat(t.id))}function ut(t){var e={id:t.id,lastModified:t.lastModified,name:t.name,version:t.version,authors:t.authors,entry:t.entry,data:t.data,resources:t.resources,roles:t.roles,chunks:t.chunks};H()(JSON.stringify(e),e.name+".proj.json","application/json")}function dt(t){var e=localStorage.getItem(ot);e&&ht(t,JSON.parse(e))}function vt(t,e){var a=new FileReader;a.onload=function(){ht(t,JSON.parse(a.result))},a.readAsText(e)}function pt(t){var e=t.script;e&&H()(JSON.stringify(e),(e.name||"未命名")+".json","application/json")}function ht(t,e){Object.assign(t,{id:Object(X["a"])(),lastModified:Date.now(),name:"未命名",version:"1.0.0",authors:[],data:{},resources:[],roles:[],chunks:[],script:null},e),W(t,"载入剧本完成：".concat(e.name,"，ID：").concat(e.id))}function ft(t,e){var a=e.selectedChunks,n=e.withName,s=e.reduceName,i=e.withTitle,r=e.quotedTitle,o=e.withSubtitle,l=a.map((function(e){return t.data[e]})).filter((function(t){return!!t})).reduce((function(e,a){i&&e.push(r?"【".concat(a.title,"】"):a.title),o&&e.push(a.subtitle),e.push("");var l=a.sections.map((function(t){return t.text.split("\n").filter((function(t){return!/^\s*$/.test(t)})).map((function(e){return[t.speaker,e]}))})).flat();if(l.length){if(n){var c,u=null,d=Object(J["a"])(l);try{for(d.s();!(c=d.n()).done;){var v=c.value;if(s&&v[0]===u)e.push("    "+v[1]);else{var p=t.data[v[0]];e.push("".concat(p?p.name:"无名氏",": ").concat(v[1]))}u=v[0]}}catch(h){d.e(h)}finally{d.f()}}else e.push.apply(e,Object(K["a"])(l.map((function(t){return t[1]}))));e.push("")}return e}),[]).join("\n"),c=t.name+".txt";H()(l,c,"text/plain"),W(t,"开始导出纯文本："+c)}function mt(t,e){var a=e.appendToNewChunk,n=e.targetChunk,s=e.targetSection,i=e.autoDetectSpeaker,o=e.primarySpeaker,l=e.secondarySpeaker,c=e.text,u=c.split("\n").filter((function(t){return!/^\s*$/.test(t)})).map((function(t){return{speaker:null,text:t}}));if(i){var d=t.roles.map((function(e){return t.data[e]})).reduce((function(t,e){return t[e.name]=e.id,t}),{});u.forEach((function(t){var e=/:|：/.exec(t.text);if(e&&e.index>0){var a=t.text.slice(0,e.index).trim();t.text=t.text.slice(e.index+1).trim,t.speaker=d[a]||null}}))}else u.forEach((function(t,e){return t.speaker=e%2?l:o}));var v,p=a?{sections:u}:t.data[n];p&&(s=s||p.sections.length,(v=p.sections).splice.apply(v,[s,0].concat(Object(K["a"])(u))));a&&et(t,Object(r["a"])(Object(r["a"])({},p),{},{cb:function(e){return W(t,"导入".concat(u.length,"行纯文本到：【").concat(e.title,"】"))}}))}var bt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[a("h3",[t._v("基础信息")]),a("v-subheader",[t._v("剧本ID："+t._s(t.$store.state.id))]),a("v-subheader",[t._v("最后修改时间："+t._s(t._f("localizeDate")(t.lastModified)))]),a("v-text-field",{attrs:{label:"剧本名称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("v-text-field",{attrs:{label:"版本"},model:{value:t.version,callback:function(e){t.version=e},expression:"version"}}),a("v-combobox",{attrs:{chips:"",multiple:"","deletable-chips":"",label:"作者"},model:{value:t.authors,callback:function(e){t.authors=e},expression:"authors"}})],1)},gt=[];function _t(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];return a.reduce((function(e,a){return e[a]=function(e,n){t&&(this[t][a]=e),e!==n&&this.$emit("mutate")},e}),{})}var xt={name:"BaseInfo",props:{id:String},data:function(){return{name:this.$store.state.name,version:this.$store.state.version,authors:this.$store.state.authors,entry:this.$store.state.entry}},computed:Object(r["a"])({},Object(o["c"])(["lastModified"])),watch:Object(r["a"])({},_t(null,"name","version","authors","entry")),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateBaseInfo"])),{},{save:function(){this.updateBaseInfo({name:this.name,version:this.version,authors:this.authors,entry:this.entry})},update:function(){this.name=this.$store.state.name,this.version=this.$store.state.version,this.authors=this.$store.state.authors,this.entry=this.$store.state.entry}}),created:function(){this.$store.commit("bindEl",{id:this.id,el:this})}},kt=xt,wt=a("2b5d"),yt=a("a523"),Ct=a("8654"),St=Object(v["a"])(kt,bt,gt,!1,null,null,null),jt=St.exports;h()(St,{VCombobox:wt["a"],VContainer:yt["a"],VSubheader:E["a"],VTextField:Ct["a"]});var Ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"chunk",staticClass:"chunk max-width-64em px-5"},[a("v-container",{staticClass:"pa-0 d-flex flex-column"},[a("div",{staticClass:"chunk-info px-5 pt-5 pb-0"},[a("img",{staticClass:"background",attrs:{cover:"",width:"100%",gradient:"#ffffffaf 0%, #ffffffaf 50%, #fff 100%",src:t.backgroundUrl}}),a("div",{staticClass:"text-right ma-1",on:{mouseleave:function(e){t.openMenu=!1}}},[a("v-slide-x-reverse-transition",[a("span",{directives:[{name:"show",rawName:"v-show",value:t.openMenu,expression:"openMenu"}]},[a("v-btn",{attrs:{small:"",text:"",color:"warning"},on:{click:t.deleteSelf}},[a("v-icon",[t._v("mdi-delete")]),t._v("删除 ")],1)],1)]),a("v-app-bar-nav-icon",{on:{click:function(e){t.openMenu=!t.openMenu}}})],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("标题")]),a("v-col",{attrs:{cols:"10"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"text-h4",attrs:{type:"text",placeholder:"此处输入标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})])],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("副标题")]),a("v-col",{attrs:{cols:"10"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.subtitle,expression:"subtitle"}],staticClass:"text-subtitle-1",attrs:{type:"text",placeholder:"此处输入副标题"},domProps:{value:t.subtitle},on:{input:function(e){e.target.composing||(t.subtitle=e.target.value)}}})])],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("背景")]),a("v-col",{attrs:{cols:"10"}},[a("ResSelector",{attrs:{placeholder:"选择背景"},model:{value:t.background,callback:function(e){t.background=e},expression:"background"}})],1)],1),a("v-expand-transition",[t.openExits?a("v-container",{staticClass:"py-0"},[a("v-subheader",[t._v("出口列表")]),t._l(t.exits,(function(e,n){return a("v-row",{key:n},[a("v-col",{attrs:{cols:"1"}},[t._v(t._s(n+1))]),a("v-col",{attrs:{cols:"8"}},[a("v-text-field",{attrs:{label:"选项文本",dense:"","hide-details":""},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"exit.text"}})],1),a("v-col",{attrs:{cols:"2"}},[a("v-select",{attrs:{label:"目标",dense:"","hide-details":"",items:t.chunkList,"item-text":"title","item-value":"id"},model:{value:e.target,callback:function(a){t.$set(e,"target",a)},expression:"exit.target"}})],1),a("v-col",{attrs:{cols:"1"}},[a("v-btn",{attrs:{small:"",color:"warning",text:""},on:{click:function(e){return t.deleteExit(n)}}},[t._v("删除")])],1)],1)})),a("v-row",[a("v-btn",{staticClass:"mx-auto",attrs:{text:""},on:{click:t.addExit}},[t._v("新出口")])],1)],2):t._e()],1),a("v-btn",{attrs:{text:"",bottom:"",block:""},on:{click:function(e){t.openExits=!t.openExits}}},[a("v-icon",[t._v(t._s(t.openExits?"mdi-chevron-up":"mdi-chevron-down"))])],1)],1)]),a("v-divider"),a("div",{staticClass:"content"},t._l(t.sections,(function(e,n){return a("Section",{key:n,ref:"section",refInFor:!0,staticClass:"mt-2",attrs:{index:n,section:e,"is-only":1===t.sections.length},on:{"add-line":t.addLine,"delete-line":t.deleteLine,focus:t.focusOnSection,mutate:function(e){return t.$emit("mutate")}}})})),1),a("v-row",{staticClass:"flex-grow-0 pa-2"},[a("v-btn",{ref:"btnAdd",staticClass:"mx-auto",attrs:{color:"primary",elevation:"0"},on:{click:t.addLine}},[a("v-icon",[t._v("mdi-plus")]),t._v("新小节 ")],1)],1)],1)},Tt=[],Vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-select",{attrs:{label:t.label,messages:t.messages,placeholder:t.placeholder,"no-data-text":t.noDataText||"无可用资源",disabled:t.disabled,items:t.resList,"item-text":"name","item-value":"id"},on:{input:t.handleInput},model:{value:t.resId,callback:function(e){t.resId=e},expression:"resId"}})},It=[],Dt={name:"ResSelector",props:{value:String,messages:[Array,String],label:String,disabled:Boolean,placeholder:String,noDataText:String},data:function(){return{resId:this.value}},watch:{value:function(t){this.resId=t}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","resources"])),{},{resList:function(){var t=this;return this.resources.map((function(e){return t.data[e]}))}}),methods:{handleInput:function(){this.$emit("input",this.resId),this.changingRole=!1}}},$t=Dt,Pt=(a("8b81"),a("b974")),Nt=Object(v["a"])($t,Vt,It,!1,null,"87c1a2b8",null),Rt=Nt.exports;h()(Nt,{VSelect:Pt["a"]});var Et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"section d-flex align-start",attrs:{align:"start"},on:{mouseenter:function(e){t.showBtnBar=!0},mouseleave:function(e){t.showBtnBar=!1}}},[a("span",{staticClass:"d-flex align-center"},[a("span",{staticClass:"line-number text-subtitle-2 mr-3"},[t._v(t._s(t.index+1))]),a("span",{staticClass:"speaker"},[a("RoleSelector",{model:{value:t.speaker,callback:function(e){t.speaker=e},expression:"speaker"}})],1),a("span",[t._v(":")])]),a("span",{staticClass:"text mx-2 flex-grow-1",on:{click:t.focus}},[t.editText?a("v-textarea",{ref:"textInput",staticClass:"text-input py-0",attrs:{rows:"1","auto-grow":"",dense:"","hide-details":""},on:{keydown:t.handleInputKey,blur:function(e){t.editText=!1}},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}):t._l(t.lines,(function(e,n){return a("p",{key:n,staticClass:"pt-2 mb-0"},[t._v(t._s(e))])}))],2),a("v-expand-x-transition",[t.showBtnBar&&!t.editText?a("v-btn-toggle",{staticClass:"btn-tgl my-0 py-0",attrs:{dense:"",rounded:"",borderless:""}},[a("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"1.8em",color:"green"},on:{click:function(e){return t.$emit("add-line",t.index)}}},[a("v-icon",[t._v("mdi-plus")])],1),t.isOnly?t._e():a("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"1.8em",color:"red"},on:{click:function(e){return t.$emit("delete-line",t.index)}}},[a("v-icon",[t._v("mdi-minus")])],1)],1):t._e()],1)],1)},At=[],Mt=(a("c975"),a("a9e3"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.changingRole?a("span",{staticClass:"role",on:{blur:function(e){t.changingRole=!1}}},[a("v-select",{attrs:{dense:"","hide-details":"",items:t.roleList,label:t.label,disabled:t.disabled,"item-text":"name","item-value":"id","no-data-text":"无可用角色"},on:{input:t.handleInput},model:{value:t.roleUid,callback:function(e){t.roleUid=e},expression:"roleUid"}})],1):a("span",{staticClass:"role d-flex align-center",on:{click:function(e){t.changingRole=!0}}},[a("RAvatar",{attrs:{size:"1.6em",contain:"",src:t.rolePicUrl}}),a("span",{staticClass:"ml-1"},[t._v(t._s(t.roleName))])],1)}),Bt=[],Lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-avatar",{attrs:{size:t.size}},[t.src?a("v-img",{attrs:{src:t.src,contain:""}}):a("v-icon",{attrs:{size:"normal"}},[t._v(t._s(t.emptyIcon))])],1)},Ft=[],Ut={name:"RAvatar",props:{src:String,size:{type:[String,Number],default:"1em"},emptyIcon:{type:String,default:"mdi-account-alert-outline"}},data:function(){return{text:this.value}}},zt=Ut,qt=a("8212"),Jt=Object(v["a"])(zt,Lt,Ft,!1,null,"651caef7",null),Kt=Jt.exports;h()(Jt,{VAvatar:qt["a"],VIcon:V["a"],VImg:I["a"]});var Gt={name:"RoleSelector",components:{RAvatar:Kt},props:{value:String,disabled:Boolean,label:String},data:function(){return{changingRole:!1,roleUid:this.value}},watch:{value:function(t){this.roleUid=t}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["roles","data","resources"])),{},{roleList:function(){var t=this;return this.roles.map((function(e){return t.data[e]}))},roleName:function(){if(this.roleUid){var t=this.data[this.roleUid];return t.name}return""},rolePicUrl:function(){if(this.roleUid){var t=this.data[this.roleUid];if(t){var e=this.data[t.avatar||t.pic];if(e)return e.src}}return null}}),methods:{handleInput:function(){this.$emit("input",this.roleUid),this.changingRole=!1}}},Ht=Gt,Xt=(a("5485"),Object(v["a"])(Ht,Mt,Bt,!1,null,"73d9dee2",null)),Qt=Xt.exports;h()(Xt,{VSelect:Pt["a"]});var Wt={name:"Section",components:{RoleSelector:Qt},props:{index:Number,section:Object,isOnly:Boolean},data:function(){return{speaker:this.section.speaker,text:this.section.text,showBtnBar:!1,editText:!1}},watch:Object(r["a"])(Object(r["a"])({},_t("section","speaker","text")),{},{section:function(t){this.speaker=t.speaker,this.text=t.text}}),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","roles"])),{},{lines:function(){return this.text.split("\n").filter((function(t){return!/^\s*$/.test(t)})).map((function(t){return t.trim()}))},speakerName:function(){if(this.speaker){var t=this.data[this.speaker];if(t&&t.pic)return t.name}return"      "},speakerPicUrl:function(){if(this.speaker){var t=this.data[this.speaker];if(t){var e=this.data[t.avatar||t.pic];if(e)return e.src}}return null}}),methods:{focus:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(e<0&&(e=a=this.text.length),a<0&&(a=e),this.editText){var n=this.$refs.textInput;n.focus()}else this.editText=!0,this.$nextTick((function(){var e=t.$refs.textInput;e.focus()}))},handleInputKey:function(t){var e=!0;if(t.ctrlKey){switch(t.key){case"Enter":var a=t.target;if(/^\s*$/.test(this.section.text))this.$emit("add-line",this.index+1);else{var n=Math.min(a.selectionStart,a.selectionEnd),s=Math.max(a.selectionStart,a.selectionEnd),i=this.text.slice(s);this.text=this.text.slice(0,n),this.$emit("add-line",this.index+1,i)}break;case"Backspace":var r=t.target;/^\s*$/.test(this.section.text)?this.$emit("delete-line",this.index):this.index>0&&0===r.selectionStart&&0===r.selectionEnd?this.$emit("delete-line",this.index,this.text):e=!1;break;case"ArrowUp":this.$emit("focus",this.index-1);break;case"ArrowDown":this.$emit("focus",this.index+1);break;case"ArrowLeft":this.toggleRole(-1);break;case"ArrowRight":this.toggleRole(1);break;default:e=!1}e&&t.preventDefault()}},toggleRole:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.roles.indexOf(this.speaker);if(e<0)this.speaker=this.roles.length?this.roles[0]:null;else{var a=e+t;a<0&&(a+=(Math.floor(Math.abs(a)/this.roles.length)+1)*this.roles.length),a>=this.roles.length&&(a%=this.roles.length),this.speaker=this.roles[a]}}}},Yt=Wt,Zt=(a("8899"),a("a609")),te=a("0789"),ee=a("a844"),ae=Object(v["a"])(Yt,Et,At,!1,null,"74be1990",null),ne=ae.exports;h()(ae,{VBtn:f["a"],VBtnToggle:Zt["a"],VExpandXTransition:te["b"],VIcon:V["a"],VTextarea:ee["a"]});var se={name:"Chunk",components:{Section:ne,ResSelector:Rt},props:{id:String},data:function(){var t=this.$store.state.data[this.id];return{title:t.title,subtitle:t.subtitle,background:t.background,sections:t.sections,exits:t.exits,openMenu:!1,openExits:!1}},watch:Object(r["a"])({},_t(null,"title","subtitle","background")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","chunks"])),{},{chunkList:function(){var t=this;return this.chunks.map((function(e){return t.data[e]}))},backgroundUrl:function(){if(this.background){var t=this.data[this.background];return t?t.src:null}return null}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["removeChunk","updateData"])),{},{addLine:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";("number"!==typeof t||t<0||t>this.sections.length)&&(t=this.sections.length);var n=t?this.sections[t-1].speaker:null,s={speaker:n,text:a};this.sections.splice(t,0,s),this.$emit("mutate"),this.$nextTick((function(){return e.focusOnSection(t)}))},deleteLine:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.sections.splice(t,1),t){var n=this.sections[t-1];this.sections[t-1]={speaker:n.speaker,text:n.text+a},this.$nextTick((function(){return e.focusOnSection(t-1,n.text.length)}))}else this.$nextTick((function(){return e.focusOnSection(t-1)}));this.$emit("mutate")},addExit:function(){this.exits.push({text:"",target:null}),this.$emit("mutate")},deleteExit:function(t){this.exits.splice(t,1),this.$emit("mutate")},deleteSelf:function(){this.removeChunk(this.id),this.$emit("delete",this.id)},focusOnSection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;t=Math.max(0,Math.min(t,this.sections.length-1));var n=this.$refs.section;if(n.length&&t<n.length){var s=n[t],i=s.$el,r=this.$refs.chunk,o=r.offsetParent;o.scrollTo({top:i.offsetTop+r.offsetTop-(o.clientHeight-i.clientHeight)/2,behavior:"smooth"}),s.focus(e,a)}},save:function(){this.updateData({id:this.id,title:this.title,subtitle:this.subtitle,background:this.background,sections:this.sections,exits:this.exits})}}),created:function(){this.$store.commit("bindEl",{id:this.id,el:this})}},ie=se,re=(a("2c33"),a("5bc1")),oe=a("62ad"),le=a("0fd9"),ce=Object(v["a"])(ie,Ot,Tt,!1,null,"a42ae090",null),ue=ce.exports;h()(ce,{VAppBarNavIcon:re["a"],VBtn:f["a"],VCol:oe["a"],VContainer:yt["a"],VDivider:m["a"],VExpandTransition:te["a"],VIcon:V["a"],VRow:le["a"],VSelect:Pt["a"],VSlideXReverseTransition:te["e"],VSubheader:E["a"],VTextField:Ct["a"]});var de=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"relative fill"},[a("img",{staticClass:"background fill absolute",attrs:{src:t.background}}),a("audio",{ref:"bgm",attrs:{src:t.bgm,loop:""}}),a("img",{staticClass:"speaker fill absolute",attrs:{src:t.speakerPic}}),a("v-toolbar",{staticClass:"debug-panel absolute",attrs:{collapse:t.openDebugPanel,"extension-height":"200"},scopedSlots:t._u([{key:"extension",fn:function(){return[a("div",{staticClass:"align-self-start d-flex align-center"},[a("label",[t._v("指令指针：")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.pointer,expression:"pointer",modifiers:{number:!0}}],attrs:{type:"number",min:0,max:t.script.instructions.length-1},domProps:{value:t.pointer},on:{input:function(e){e.target.composing||(t.pointer=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),a("v-btn",{attrs:{text:"",small:""},on:{click:t.forceRun}},[t._v("执行")])],1),a("ul",{ref:"logger",staticClass:"align-self-start fill-y overflow-auto flex-grow-1"},t._l(t.logger,(function(e,n){return a("li",{key:n},[t._v(t._s(e))])})),0)]},proxy:!0}])},[a("v-app-bar-nav-icon",{on:{click:function(e){t.openDebugPanel=!t.openDebugPanel}}}),a("v-toolbar-title",[t._v("调试工具")])],1),a("div",{staticClass:"content fill pa-3 d-flex flex-column justify-end"},[a("div",{staticClass:"text round oculus white--text mb-3 pa-2"},[t._v(" "+t._s(t.speakerName)+"："+t._s(t.line)+" ")]),a("ul",{staticClass:"options round oculus white--text pa-2"},[t._l(t.options,(function(e,n){return a("li",{key:n,staticClass:"option round py-2 px-5",on:{click:function(e){return t.handleClickOption(n)}}},[t._v(t._s(e.text))])})),t.options.length?t._e():a("li",{staticClass:"option round py-2 px-5",on:{click:t.handleClickDefaultOption}},[t._v("...")])],2)])],1)},ve=[],pe={name:"Demonstration",data:function(){return{pointer:0,background:null,bgm:null,speakerName:"",speakerPic:null,line:"",options:[],hasSetText:!1,logger:[],openDebugPanel:!1}},watch:{bgm:function(t,e){t!==e&&"string"===typeof t&&t.length>0&&this.$refs.bgm.play()}},computed:Object(r["a"])({},Object(o["c"])(["script"])),methods:{run:function(){while(this.pointer<this.script.instructions.length&&this.canStepIn(this.script.instructions[this.pointer]))this.apply(this.script.instructions[this.pointer]),this.pointer++},forceRun:function(){this.hasSetText=!1,this.run()},apply:function(t){var e=this.script;switch(t[0]){case"bg":var a=t[1];this.background=e.resources[a],this.log("设置背景",e.map?e.map.resourceNames[a]:this.background.slice(-32));break;case"bgm":this.bgm=e.resources[t[1]];break;case"line":this.line=t[1];var n=e.roles[t[2]];this.speakerPic=e.resources[n.pic],this.speakerName=n.name,this.options=[],this.hasSetText=!0,this.log("说台词",this.speakerName,this.line);break;case"option":var s={text:t[1],target:t[2]};this.options.push(s),this.log("添加选项",s.text,e.map?e.map.chunkTitles[s.target]:s.target);break}},canStepIn:function(t){switch(t[0]){case"bg":return!0;case"bgm":return!0;case"line":return!this.hasSetText;case"option":return this.hasSetText}},jumpTo:function(t){this.pointer=t,this.log("转跳到",this.pointer,this.script.map?this.script.map.chunkTitles[this.pointer]:"")},handleClickOption:function(t){this.hasSetText=!1;var e=this.options[t];this.log("玩家选择",e.text,this.script.map?this.script.map.chunkTitles[e.target]:e.target),this.jumpTo(e.target),this.run()},handleClickDefaultOption:function(){this.hasSetText=!1,this.run()},log:function(){for(var t=this,e=new Date,a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];this.logger.push("".concat(e.toLocaleString()," [").concat(n[0],"] ")+n.slice(1).join(" ")),this.$nextTick((function(){var e=t.$refs.logger;e&&e.scrollTo({left:0,top:e.scrollHeight,behavior:"smooth"})}))}},created:function(){this.run()}},he=pe,fe=(a("5644"),a("71d9")),me=a("2a7f"),be=Object(v["a"])(he,de,ve,!1,null,"bc686a24",null),ge=be.exports;h()(be,{VAppBarNavIcon:re["a"],VBtn:f["a"],VToolbar:fe["a"],VToolbarTitle:me["a"]});var _e=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},xe=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"pa-5"},[a("div",{attrs:{id:"write"}},[a("h1",[a("a",{staticClass:"md-header-anchor",attrs:{name:"江奶奶的galgame编辑器食用指南"}}),a("span",[t._v("江奶奶的Galgame编辑器食用指南")])]),a("h2",[a("a",{staticClass:"md-header-anchor",attrs:{name:"基本概念"}}),a("span",[t._v("基本概念")])]),a("p",[a("span",[t._v("首先，与该编辑器与播放器（虽然还没完成）的用户有三个身份：开发者、作者、玩家：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("开发者")])]),a("span",[t._v("：顾名思义，就是开发这个编辑器的人，当前只有江奶奶；")])]),a("li",[a("strong",[a("span",[t._v("作者")])]),a("span",[t._v("：编辑剧本的作者，一般用的是编辑器；")])]),a("li",[a("strong",[a("span",[t._v("玩家")])]),a("span",[t._v("：当一个作者完成一个剧本之后，游玩剧本的人，用的一般是播放器。")])])]),a("p",[a("span",[t._v("在本编辑器，工程由三种主要数据构成：资源、角色、文本段。")])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"资源"}}),a("span",[t._v("资源")])]),a("p",[a("span",[t._v("这里的资源，指的主要是多媒体资源，如：")])]),a("ul",[a("li",[a("span",[t._v("以")]),a("code",[t._v(".png")]),a("span",[t._v("或")]),a("code",[t._v(".jpg")]),a("span",[t._v("等结尾的图片文件，")])]),a("li",[a("span",[t._v("以")]),a("code",[t._v(".ogg")]),a("span",[t._v("或")]),a("code",[t._v(".mp3")]),a("span",[t._v("等结尾的音频文件，")])]),a("li",[a("span",[t._v("以")]),a("code",[t._v(".mp4")]),a("span",[t._v("或")]),a("code",[t._v(".wmv")]),a("span",[t._v("等结尾的视频文件。")])])]),a("p",[a("span",[t._v("该数据包含了三个主要字段：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("名字")])]),a("span",[t._v("：一个资源的名字，但是这只是用于作者识别的，对于程序来说识别的标识是其ID，这在编译过程中会被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("内容")])]),a("span",[t._v("：这一般是作者从本地上传的上述多媒体文件的内容，要注意，如果文件过大，会导致内存占用过多。")])])]),a("p",[a("span",[t._v("对于已有资源，其名字是可以改变的，其内容也是可以改变的。但是要知道，如果一个资源被删除，而后又新建了一个相同名字的资源的话，哪怕内容是一样的，也会")]),a("strong",[a("span",[t._v("被认为是不同的资源")])]),a("span",[t._v("！所以删除资源前请三思。")])]),a("p",[a("strong",[a("span",[t._v("注意")])]),a("span",[t._v("：")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("人物立绘请使用")]),a("strong",[a("span",[t._v("png")])]),a("span",[t._v("格式图片，因为该格式允许角色以外的空白部分呈现透明状态；")])]),a("li",[a("span",[t._v("暂时")]),a("strong",[a("span",[t._v("不支持视频")])]),a("span",[t._v("格式的使用，虽然你可以导入，但是这会导致大量的内存消耗，而且并不能用于剧本的编写；")])]),a("li",[a("span",[t._v("音频也")]),a("strong",[a("span",[t._v("暂不支持")])]),a("span",[t._v("，因为音频功能虽然计划加入，但是目前还没完成这部分的功能。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"角色"}}),a("span",[t._v("角色")])]),a("p",[a("span",[t._v("作为一个Galgame的角色，该数据包含了三个主要字段：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("名字")])]),a("span",[t._v("：一般来说，一个角色都会有名字，但是并不一定是一个名字对应一个角色（角色的）；")])]),a("li",[a("strong",[a("span",[t._v("头像")])]),a("span",[t._v("：这个头像仅仅作为编辑器中方便作者直观地分辨角色的附属功能，会在编译为脚本的时候被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("立绘")])]),a("span",[t._v("：不用多说，要注意的是制作的时候，要注意统一画布大小，否则可能会出现大小以及像素的失真情况。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"文本段"}}),a("span",[t._v("文本段")])]),a("p",[a("span",[t._v("这是一个江奶奶捏造的概念，如“文本段”这三个字一样，就是指文本段落，是一堆文本的合集。一个文本段相当于一般意义上的章节，包含一段完整或不完整的故事，但是同时又不太一样，因为一个文本段内，只能使用在一张背景。其长短没有指定，可以由几千行，也可以只有寥寥几行。")])]),a("p",[a("span",[t._v("这个数据结构，有以下几个重要字段：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("标题")])]),a("span",[t._v("：这是作者识别文本段的内容的标识，这在编译过程中会被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("副标题")])]),a("span",[t._v("：目前仅仅是作为标题的注释一般，通常不必在意，这在编译过程中会被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("背景")])]),a("span",[t._v("：目前一个文本段只能由一张背景，一图流走到底，相当于")]),a("strong",[a("span",[t._v("传统")])]),a("span",[t._v("舞台上的一个场景，不到拉幕就不会改变；")])]),a("li",[a("del",[a("strong",[a("span",[t._v("BGM")])]),a("span",[t._v("：背景音乐，没什么好说的，在一整个文本段持续的时间中都会循环播放该音频，该功能尚不完善，请忽略；")])])]),a("li",[a("strong",[a("span",[t._v("小节列表")])]),a("span",[t._v("：这是一个小节的有序列表，在玩家游玩的时候每一个小节会依序被显示在屏幕上，关于小节的详情见下文；")])]),a("li",[a("strong",[a("span",[t._v("出口列表")])]),a("span",[t._v("：这是一个出口的集合，关于出口的详情见下文；")])])]),a("h4",[a("a",{staticClass:"md-header-anchor",attrs:{name:"小节"}}),a("span",[t._v("小节")])]),a("p",[a("span",[t._v("一个小节主要由发言者与台词文本组成。发言者是从已有的角色中选择的一个，而台词文本是一段文字。")])]),a("p",[a("span",[t._v("关于台词文本，一个小节中的台词文本可以有多句组成，每行文本都会被视为一句台词，相当于是这个发言者连续说了多句台词。")])]),a("h4",[a("a",{staticClass:"md-header-anchor",attrs:{name:"出口"}}),a("span",[t._v("出口")])]),a("p",[a("span",[t._v("在游戏中，若一个文本段被播放完毕，这时候一般是场景的切换，或者玩家的选择，而可供玩家可以选择的选项就被称为这个文本段的出口。一个出口会对应一个文本段，该文本段将会在玩家选择了该出口后开始播放。")])]),a("p",[a("span",[t._v("每个出口都会有一段文本，用于提供给玩家进行选择，或者说是一种提示，而其会有一个与其相对应的目标，这个目标是从已经存在的文本段中选取的其中一个。")])]),a("p",[a("span",[t._v("附注：无论是资源、角色、文本段，都是以一个用户看不到的ID号码作为其唯一标识，所以哪怕是名字相同的资源、角色，也是被视为不同的两个或多个对象。")])]),a("h2",[a("a",{staticClass:"md-header-anchor",attrs:{name:"食用步骤"}}),a("span",[t._v("食用步骤")])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"完善基础信息"}}),a("span",[t._v("完善基础信息")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("基础信息")]),a("span",[t._v("项目；")])]),a("li",[a("span",[t._v("按照提示填补完善信息，完成后你会发现编辑面板上方（也就是菜单栏下方）的，该项目标签的文字右侧有一个实心原点，这代表该项目还未保存，此时按下")]),a("code",[t._v("ctrl + S")]),a("span",[t._v("保存当前项目，或者按下")]),a("code",[t._v("ctrl + shift + S")]),a("span",[t._v("保存所有项目，或者在菜单栏的")]),a("code",[t._v("文件")]),a("span",[t._v("下找到相应操作;")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"准备资源"}}),a("span",[t._v("准备资源")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("资源管理器")]),a("span",[t._v("项目；")])]),a("li",[a("span",[t._v("准备好图片资源（毕竟现在也只支持图片资源XD），如头像、立绘、背景等；")])]),a("li",[a("span",[t._v("将它们从电脑的资源管理器中拖入那个写有“拖拽或点击输入文件”且有文件图标的小框中，或者点击文件图标输入文件（推荐后者）；")])]),a("li",[a("span",[t._v("拖进来后，在面板中会出现刚才拖入的资源，它们会自动根据文件名设置好自己的名字，如果不满意，可以自己修改名字，点击一下名字即可开始编辑，按下")]),a("code",[t._v("Enter")]),a("span",[t._v("键或者点击输入框以外的位置完成编辑；")])]),a("li",[a("span",[t._v("如果有一些资源不满意，可以点击下方第二个按钮（总之不是那个长的像垃圾桶的就对了），然后重新输入文件（由于作用域的问题，请尽量点击图标正中）；")])]),a("li",[a("span",[t._v("当你想要删除一些不必要的资源的时候，只要点击下方的垃圾桶图标即可，注意，")]),a("strong",[a("span",[t._v("这是不可逆的")])]),a("span",[t._v("。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"创建角色"}}),a("span",[t._v("创建角色")])]),a("p",[a("span",[t._v("当你设置完一些基础的素材后，便可以开始创建自己游戏中的角色了。")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("角色")]),a("span",[t._v("项目，展开角色列表；")])]),a("li",[a("span",[t._v("点击最下边的")]),a("code",[t._v("新建角色")]),a("span",[t._v("按键，而后在右边就会打开这个新建角色的编辑面板（如果没有自动打开的话，就点一下列表中的角色）；")])]),a("li",[a("span",[t._v("编辑名字，选择头像，选择立绘；")])]),a("li",[a("span",[t._v("编辑完成后，保存该项目；")])]),a("li",[a("span",[t._v("若想要删除该角色，只需要按下那个醒目的")]),a("code",[t._v("删除该角色")]),a("span",[t._v("按钮即可，注意，")]),a("strong",[a("span",[t._v("这是不可逆的")])]),a("span",[t._v("！")])]),a("li",[a("span",[t._v("想要关闭该项目，仅需在标签栏中关闭该项目的标签即可。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"编辑文本段"}}),a("span",[t._v("编辑文本段")])]),a("p",[a("span",[t._v("连角色也创建好后，就可以正式开始写作了（其实之前的不做也没关系，大不了留空XD）。这也是这个编辑过程的重头戏。")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("文本段")]),a("span",[t._v("项目，展开文本段列表；")])]),a("li",[a("span",[t._v("点击最下边的")]),a("code",[t._v("新建文本段")]),a("span",[t._v("按键，而后在右边就会打开这个新建文本段的编辑面板；")])]),a("li",[a("span",[t._v("在编辑界面可以看到标题、副标题、背景的编辑区域，这些在上文已经介绍过了，按照所想编辑即可；")])]),a("li",[a("span",[t._v("在背景的输入框下面，你还能看到一个“新出口”按键，这个先跳过，这在之后再使用；")])]),a("li",[a("span",[t._v("点击下方的")]),a("code",[t._v("新小节")]),a("span",[t._v("按键，会在该按键上方多出一行小节面板；")])]),a("li",[a("span",[t._v("在小节面板的左边是序号，而后是发言者，如果之前有创建角色并保存的话，这里就可以选择需要的角色，选择好后，其头像和名字将会显示出来（如果没有头像，则会用立绘代替头像显示）；")])]),a("li",[a("span",[t._v("在发言者设置好后，再往右，就是文本框了，这里作者可以输入一行或多行文本，每一行都会被作为单独的台词呈现（游戏中同屏只会出现一句台词）；")])]),a("li",[a("span",[t._v("如果鼠标位于该小节的编辑面板中的话，就会出现两个按钮：")]),a("code",[t._v("+")]),a("span",[t._v("与")]),a("code",[t._v("-")]),a("span",[t._v("，按下")]),a("code",[t._v("+")]),a("span",[t._v("按键，则可以在该小节")]),a("strong",[a("span",[t._v("前")])]),a("span",[t._v("插入新的小节，按下")]),a("code",[t._v("-")]),a("span",[t._v("按键则会删除该小节；")])]),a("li",[a("span",[t._v("而后重复上述操作，知道该文本段编写完毕，然后与编辑角色时候一样保存即可；")])]),a("li",[a("span",[t._v("现在开始编辑出口，点击")]),a("code",[t._v("新出口")]),a("span",[t._v("按键，会出现一行新的出口面板，从左到右是：序号、文本输入框、目标选择框、删除按键，基本一看就懂，要注意文本框只能输入一行文本，目标选择框可以选择该出口对应的下一个文本段；")])]),a("li",[a("span",[t._v("若要删除文本段，则点击右上角的三道杠按钮，然后会出现")]),a("code",[t._v("删除")]),a("span",[t._v("按钮，点击该按钮即可删除文本段，注意，")]),a("strong",[a("span",[t._v("这是不可逆的")])]),a("span",[t._v("！")])]),a("li",[a("span",[t._v("想要关闭该项目，仅需在标签栏中关闭该项目的标签即可。")])])]),a("p",[a("span",[t._v("另外，在编辑小节的文本的时候，")])]),a("ul",[a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + Enter（回车）")]),a("span",[t._v("，则是自动在该小节后插入一个新的小节，并聚焦到这个新的小节上；")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + BackSpace（退格）")]),a("span",[t._v("且该小节文本都是空的（或者由空字符组成），则该小节将被删除并合并到上一个小节（如果存在的话）；")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + ArrowUp（上箭头）")]),a("span",[t._v("，则聚焦到上一个小节（如果存在的话）；")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + ArrowDown（下箭头）")]),a("span",[t._v("，则聚焦到下一个小节（如果存在的话）。")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + ArrowDown（左箭头）")]),a("span",[t._v("，切换发言者为角色列表的上一个角色（如果存在的话）。")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + ArrowDown（右箭头）")]),a("span",[t._v("，切换发言者为角色列表的下一个角色（如果存在的话）。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"持久化"}}),a("span",[t._v("持久化")])]),a("p",[a("span",[t._v("编辑过程中有两个概念：工程与脚本：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("工程")])]),a("span",[t._v("：这是作者写作时候，用编辑器编辑的工程文件，并不能直接游玩；")])]),a("li",[a("strong",[a("span",[t._v("脚本")])]),a("span",[t._v("：当一个作者完成一个剧本之后，会将其编译为脚本，而后可以在播放器或者编辑器自带的测试面板中游玩。")])])]),a("p",[a("span",[t._v("之前的保存操作，其实是将内容缓存到了浏览器自带的一个叫做")]),a("code",[t._v("LocalStorage")]),a("span",[t._v("的地方，如果浏览器清理缓存，或者更换了新的计算机、新的浏览器、新的域名，那么该数据就找不到了。所以为了更好的持久化，还是要将工程下载到能看得到的地方。")])]),a("p",[a("span",[t._v("所以在菜单栏下点击")]),a("code",[t._v("文件")]),a("span",[t._v("下的")]),a("code",[t._v("下载工程")]),a("span",[t._v("或者")]),a("code",[t._v("下载脚本")]),a("span",[t._v("完成相应操作，要注意，")]),a("code",[t._v("下载脚本")]),a("span",[t._v("按键只有在有已经编译完成的脚本时候才可用。当你下一次想要在别的计算机或者浏览器载入工程的时候，只要有改文件即可载入。")])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"编译"}}),a("span",[t._v("编译")])]),a("p",[a("span",[t._v("想要最终得到一个可以游玩的脚本，就需要这个叫做编译的过程。它将一个工程内的数据进行整理、编号、排序、简化、链接，最终得到一份可以游玩的游戏脚本文件。在菜单栏下点击")]),a("code",[t._v("工程")]),a("span",[t._v("下的")]),a("code",[t._v("编译为测试版")]),a("span",[t._v("完成相应操作。编译后的脚本将会缓存在内存中，如果不下载，那么在浏览器关闭，甚至该页面关闭之后，该脚本就会消失，但是这并不可怕，由于工程还在，所以只要重新编译即可。可以在在菜单栏下点击")]),a("code",[t._v("文件")]),a("span",[t._v("下的")]),a("code",[t._v("下载脚本")]),a("span",[t._v("以下载编译好的脚本。")])]),a("h2",[a("a",{staticClass:"md-header-anchor",attrs:{name:"最后"}}),a("span",[t._v("最后")])]),a("blockquote",[a("p",[a("span",[t._v("子未曰：“Hava a gada daya!”")])])])])])}],ke={},we=Object(v["a"])(ke,_e,xe,!1,null,null,null),ye=we.exports,Ce=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{staticClass:"resource-manager d-flex flex-wrap",on:{dragover:function(e){t.overlay=!0},dragend:function(e){t.overlay=!1},drop:t.handleDrop}},[t._l(t.resources,(function(e){return a("Resouece",{key:e,staticClass:"resource ma-3",attrs:{uid:e,res:t.data[e]}})})),a("v-card",{staticClass:"resource ma-3 d-flex flex-column"},[a("div",{staticClass:"input-wrapper flex-grow-1 flex-shrink-1 d-flex justify-center align-center"},[a("v-icon",{attrs:{"x-large":""}},[t._v("mdi-file-multiple")]),a("input",{attrs:{type:"file",multiple:""},on:{change:t.inputFiles}})],1),a("v-card-subtitle",[t._v("拖拽或点击输入文件")])],1)],2)},Se=[],je=(a("baa5"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{staticClass:"d-flex flex-column"},[a("v-img",{staticClass:"flex-shrink-1",attrs:{src:t.res.src,contain:""}}),a("v-card-title",{staticClass:"name"},[t.editName?a("v-text-field",{attrs:{"hide-details":"auto",dense:"","error-messages":t.errors},on:{blur:function(e){t.editName=!1},keydown:t.handleEnter},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}):a("span",{on:{click:function(e){t.editName=!0}}},[t._v(t._s(t.name))])],1),a("v-card-actions",[a("v-btn",{attrs:{icon:""},on:{click:function(e){return t.removeResource(t.id)}}},[a("v-icon",[t._v("mdi-delete")])],1),a("v-btn",{attrs:{icon:""}},[a("v-icon",[t._v("mdi-share")]),a("input",{ref:"btnReplace",staticClass:"fill",attrs:{type:"file"},on:{input:t.replaceRes}})],1)],1)],1)}),Oe=[],Te={name:"Resource",props:{res:Object},data:function(){return{id:this.res.id,name:this.res.name,src:this.res.src,type:this.res.type,editName:!1,errors:null}},watch:{name:function(t,e){this.errors=0===t.length?"名字不可为空":null,t!==e&&t&&this.updateData({id:this.id,name:t})},src:function(t,e){t!==e&&this.updateData({id:this.id,src:this.src,type:this.type})}},methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["removeResource","updateData"])),{},{replaceRes:function(t){var e,a=this,n=Object(J["a"])(t.target.files);try{var s=function(){var t=e.value,n=new FileReader;n.onload=function(){return Object.assign(a,{src:n.result,type:t.type})},n.readAsDataURL(t)};for(n.s();!(e=n.n()).done;)s()}catch(i){n.e(i)}finally{n.f()}},handleEnter:function(t){"Enter"===t.key&&(this.editName=!1,this.updateData({id:this.id,name:this.name}))}})},Ve=Te,Ie=(a("ea04"),a("b0af")),De=a("99d9"),$e=Object(v["a"])(Ve,je,Oe,!1,null,"df95f3c8",null),Pe=$e.exports;h()($e,{VBtn:f["a"],VCard:Ie["a"],VCardActions:De["a"],VCardTitle:De["c"],VIcon:V["a"],VImg:I["a"],VTextField:Ct["a"]});var Ne={name:"ResourceManager",components:{Resouece:Pe},data:function(){return{overlay:!1}},computed:Object(r["a"])({},Object(o["c"])(["resources","data"])),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["createResource"])),{},{inputFiles:function(t){var e,a=this,n=Object(J["a"])(t.target.files);try{var s=function(){var t=e.value,n=t.name.lastIndexOf("."),s=n>=0?t.name.slice(0,n):t.name,i=new FileReader;i.onload=function(){return a.createResource({name:s,src:i.result,type:t.type})},i.readAsDataURL(t)};for(n.s();!(e=n.n()).done;)s()}catch(i){n.e(i)}finally{n.f()}},handleDrop:function(){this.overlay=!1}})},Re=Ne,Ee=(a("923f"),Object(v["a"])(Re,Ce,Se,!1,null,"391424e6",null)),Ae=Ee.exports;h()(Ee,{VCard:Ie["a"],VCardSubtitle:De["b"],VContainer:yt["a"],VIcon:V["a"]});var Me=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fill-y max-width-64em pa-5 d-flex"},[a("div",{staticClass:"form d-flex flex-column align-center"},[a("v-avatar",{attrs:{size:"160",color:"grey"}},[t.avatar?a("img",{attrs:{src:t.avatarUrl}}):a("span",{staticClass:"white--text text-h3"},[t._v(t._s(t.name.slice(0,2)))])]),a("v-text-field",{staticClass:"input flex-grow-0",attrs:{label:"名字",messages:"必填，最好不要超过三个中文",placeholder:"角色的名字"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("v-switch",{staticClass:"flex-grow-0",attrs:{label:"无立绘角色"},model:{value:t.noPic,callback:function(e){t.noPic=e},expression:"noPic"}}),a("ResSelector",{staticClass:"flex-grow-0",attrs:{label:"头像",messages:"无实际用途，仅方便编辑"},model:{value:t.avatar,callback:function(e){t.avatar=e},expression:"avatar"}}),a("ResSelector",{staticClass:"flex-grow-0",attrs:{label:"立绘",disabled:t.noPic,messages:t.noPic?"无立绘角色无法设置立绘":""},model:{value:t.pic,callback:function(e){t.pic=e},expression:"pic"}}),a("v-spacer"),a("v-btn",{attrs:{color:"warning"},on:{click:t.deleteSelf}},[a("v-icon",[t._v("mdi-delete")]),t._v(" 删除该角色 ")],1)],1),a("div",{staticClass:"img-wrapper flex-grow-1"},[!t.noPic&&t.pic?a("img",{attrs:{alt:t.name,src:t.picUrl}}):t._e()])])},Be=[],Le={name:"Role",components:{ResSelector:Rt},props:{id:String},data:function(){var t=this.$store.state.data[this.id];return{name:t.name,avatar:t.avatar,pic:t.pic,noPic:!1}},watch:Object(r["a"])({},_t(null,"name","avatar","pic","noPic")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data"])),{},{picUrl:function(){var t=this.data[this.pic];return t?t.src:null},avatarUrl:function(){var t=this.data[this.avatar];return t?t.src:null}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateData","removeRole"])),{},{deleteSelf:function(){this.removeRole(this.id),this.$emit("delete",this.id)},save:function(){this.updateData({id:this.id,name:this.name,avatar:this.avatar,pic:this.pic,noPic:this.noPic})}}),created:function(){this.$store.commit("bindEl",{id:this.id,el:this})}},Fe=Le,Ue=(a("7eb5"),a("b73d")),ze=Object(v["a"])(Fe,Me,Be,!1,null,"7e8e0bf6",null),qe=ze.exports;h()(ze,{VAvatar:qt["a"],VBtn:f["a"],VIcon:V["a"],VSpacer:R["a"],VSwitch:Ue["a"],VTextField:Ct["a"]});var Je={"base-info":function(t){return{id:t,icon:"mdi-information-outline",title:"基础信息",component:jt}},"res-manager":function(t){return{id:t,icon:"mdi-folder-outline",title:"资源管理器",component:Ae}},doc:function(){return{id:"doc",icon:"mdi-document",title:"帮助文档",component:ye}},demo:function(){return{id:"demo",icon:"mdi-play",title:"演示",component:ge}},role:function(t,e){return{id:t,icon:"mdi-account-outline",title:e[t]?e[t].name:"未知角色",component:qe}},chunk:function(t,e){return{id:t,icon:"mdi-text",title:e[t]?e[t].title:"未知文本段",component:ue}}};function Ke(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e<0?a?t.panels.findIndex((function(t){return t.id===a})):t.tabIndex:e}function Ge(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e=Ke(t,e);var a=t.panels[e];a&&(a.dirty&&!confirm("".concat(a.title,"还未保存，确定关闭？"))||t.panels.splice(e,1))}function He(t,e){var a=e.type,n=e.id,s=e.index,i=void 0===s?null:s;i=null!==i?i:t.panels.length;var r=Je[a]?Object.assign({},Je[a](n,t.data),{type:a,dirty:!1,el:null}):null;if(r){var o=t.panels.findIndex((function(t){return t.id===r.id}));o>=0?t.tabIndex=o:(t.panels.splice(i,0,r),t.tabIndex=i)}}function Xe(t,e){var a=e.index,n=void 0===a?null:a,s=e.id,i=void 0===s?null:s;n=Ke(t,n,i),n>=0&&Ge(t,n)}function Qe(t){var e=-1;while(t.panels.length&&t.panels.length!==e)e=t.panels.length,Ge(t,0)}function We(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(e=Ke(t,e),e>=0){var a=t.panels[e];if(a){a.el&&a.el.save&&(a.el.save(),ct(t)),a.dirty=!1;var n=Je[a.type](a.id,t.data);a.title=n.title}}}function Ye(t){for(var e=0;e<t.panels.length;e++)We(t,e);ct(t)}function Ze(t,e){var a=e.index,n=e.id,s=e.el;a=Ke(t,a,n),t.panels[a].el=s}var ta=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",[a("v-container",[a("v-row",[a("v-select",{attrs:{label:"文本段",chips:"","deletable-chips":"",multiple:"",items:t.chunkList,"item-value":"id","item-text":"title"},model:{value:t.selectedChunks,callback:function(e){t.selectedChunks=e},expression:"selectedChunks"}})],1),a("v-row",{staticClass:"d-flex justify-space-around"},[a("v-switch",{attrs:{label:"显示发言者"},model:{value:t.withName,callback:function(e){t.withName=e},expression:"withName"}}),a("v-switch",{attrs:{label:"缩减姓名数量",hint:"一个角色说了很多话也只显示一次名字",disabled:!t.withName},model:{value:t.reduceName,callback:function(e){t.reduceName=e},expression:"reduceName"}})],1),a("v-row",{staticClass:"d-flex justify-space-around"},[a("v-switch",{attrs:{label:"显示标题"},model:{value:t.withTitle,callback:function(e){t.withTitle=e},expression:"withTitle"}}),a("v-switch",{attrs:{label:"给标题加括号",hint:"例如：【第一章】",disabled:!t.withTitle},model:{value:t.quotedTitle,callback:function(e){t.quotedTitle=e},expression:"quotedTitle"}}),a("v-switch",{attrs:{label:"显示副标题"},model:{value:t.withSubtitle,callback:function(e){t.withSubtitle=e},expression:"withSubtitle"}})],1),a("v-row",{staticClass:"d-flex justify-space-around"},[a("v-btn",{attrs:{color:"primary"},on:{click:t.doExport}},[a("v-icon",[t._v("mdi-export")]),t._v("导出 ")],1),a("v-btn",{on:{click:t.closeDialog}},[a("v-icon",[t._v("mdi-cancel")]),t._v("取消 ")],1)],1)],1)],1)},ea=[],aa={name:"TextExport",data:function(){return{selectedChunks:[],withName:!0,reduceName:!0,quotedTitle:!0,withTitle:!0,withSubtitle:!0}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","chunks"])),{},{chunkList:function(){var t=this;return this.chunks.map((function(e){return t.data[e]}))}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["exportToText","closeDialog"])),{},{doExport:function(){this.exportToText({selectedChunks:this.selectedChunks,withName:this.withName,reduceName:this.reduceName,quotedTitle:this.quotedTitle,withTitle:this.withTitle,withSubtitle:this.withSubtitle}),this.closeDialog()}})},na=aa,sa=Object(v["a"])(na,ta,ea,!1,null,null,null),ia=sa.exports;h()(sa,{VBtn:f["a"],VCard:Ie["a"],VContainer:yt["a"],VIcon:V["a"],VRow:le["a"],VSelect:Pt["a"],VSwitch:Ue["a"]});var ra=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{attrs:{height:"86vh"}},[a("v-container",{staticClass:"fill-y d-flex flex-column"},[a("v-row",{staticClass:"flex-grow-1"},[a("v-col",{staticClass:"d-flex flex-column",attrs:{cols:"8"}},[a("span",{staticClass:"flex-grow-0"},[t._v(t._s(t.prevText))]),a("v-textarea",{staticClass:"flex-grow-1",attrs:{"multi-line":"",rows:"10"},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),a("span",{staticClass:"flex-grow-0"},[t._v(t._s(t.nextText))])],1),a("v-col",{attrs:{cols:"4"}},[a("v-switch",{attrs:{label:"添加到新文本段"},model:{value:t.appendToNewChunk,callback:function(e){t.appendToNewChunk=e},expression:"appendToNewChunk"}}),a("v-select",{attrs:{label:"目标文本段",disabled:t.appendToNewChunk,items:t.chunkList,"item-value":"id","item-text":"title"},model:{value:t.targetChunk,callback:function(e){t.targetChunk=e},expression:"targetChunk"}}),a("v-text-field",{attrs:{label:"插入小节位置",type:"number",min:0,max:t.chunk.sections.length,disabled:t.appendToNewChunk||!t.targetChunk},model:{value:t.targetSection,callback:function(e){t.targetSection=t._n(e)},expression:"targetSection"}}),a("v-switch",{attrs:{label:"自动识别发言者"},model:{value:t.autoDetectSpeaker,callback:function(e){t.autoDetectSpeaker=t._n(e)},expression:"autoDetectSpeaker"}}),a("RoleSelector",{attrs:{label:"首选发言者",disabled:t.autoDetectSpeaker},model:{value:t.primarySpeaker,callback:function(e){t.primarySpeaker=e},expression:"primarySpeaker"}}),a("RoleSelector",{attrs:{label:"次选发言者",disabled:t.autoDetectSpeaker},model:{value:t.secondarySpeaker,callback:function(e){t.secondarySpeaker=e},expression:"secondarySpeaker"}})],1)],1),a("v-row",{staticClass:"flex-grow-0 d-flex justify-space-around"},[a("v-btn",{attrs:{color:"primary"},on:{click:t.doImport}},[a("v-icon",[t._v("mdi-import")]),t._v("导入 ")],1),a("v-btn",{on:{click:t.closeDialog}},[a("v-icon",[t._v("mdi-cancel")]),t._v("取消 ")],1)],1)],1)],1)},oa=[],la={name:"TextImport",components:{RoleSelector:Qt},data:function(){return{appendToNewChunk:!1,targetChunk:null,targetSection:-1,autoDetectSpeaker:!1,primarySpeaker:null,secondarySpeaker:null,text:"",prevText:"",nextText:""}},watch:{targetChunk:function(t,e){t!==e&&(this.targetSection=t?this.data[t].sections.length:-1)},targetSection:function(t){if(this.targetChunk){var e=this.data[this.targetChunk].sections;this.prevText=t>0?e[t-1].text:"",this.nextText=t>0&&t<e.length?e[t].text:""}}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","chunks"])),{},{chunkList:function(){var t=this;return this.chunks.map((function(e){return t.data[e]}))},chunk:function(){return this.targetChunk?this.data[this.targetChunk]:{sections:[]}}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["importFromText","closeDialog"])),{},{doImport:function(){this.importFromText({appendToNewChunk:this.appendToNewChunk,targetChunk:this.targetChunk,targetSection:this.targetSection,autoDetectSpeaker:this.autoDetectSpeaker,primarySpeaker:this.primarySpeaker,secondarySpeaker:this.secondarySpeaker,text:this.text}),this.closeDialog()}})},ca=la,ua=Object(v["a"])(ca,ra,oa,!1,null,null,null),da=ua.exports;function va(t,e){switch(e){case"export-to-text":t.dialog={component:ia};break;case"import-from-text":t.dialog={component:da};break}}function pa(t){t.dialog=null}h()(ua,{VBtn:f["a"],VCard:Ie["a"],VCol:oe["a"],VContainer:yt["a"],VIcon:V["a"],VRow:le["a"],VSelect:Pt["a"],VSwitch:Ue["a"],VTextField:Ct["a"],VTextarea:ee["a"]}),n["a"].use(o["a"]);var ha=new o["a"].Store({state:{id:Object(X["a"])(),lastModified:Date.now(),name:"未命名",version:"1.0.0",authors:[],entry:null,data:{},resources:[],roles:[],chunks:[],script:null,panels:[],tabIndex:-1,app:null,messages:[],dialog:null},mutations:{openPanel:He,closePanel:Xe,closeAllPanels:Qe,savePanel:We,saveAllPanels:Ye,bindEl:Ze,openDialog:va,closeDialog:pa,cacheState:ct,compile:lt,downloadProject:ut,downloadScript:pt,loadProjectFromFile:vt,loadProjectFromCache:dt,createResource:Z,createRole:tt,createChunk:et,removeResource:nt,removeRole:st,removeChunk:it,updateData:rt,exportToText:ft,importFromText:mt,updateBaseInfo:function(t,e){var a=e.name,n=e.version,s=e.authors;t.name=a||t.name,t.version=n||t.version,t.authors=s||t.authors},setTabIndex:function(t,e){t.tabIndex=e},setApp:function(t,e){t.app=e}}});n["a"].config.productionTip=!1,n["a"].filter("localizeDate",(function(t){var e=new Date(t);return e.toLocaleDateString()+" - "+e.toLocaleTimeString(void 0,{hour12:!1})})),new n["a"]({vuetify:q,store:ha,render:function(t){return t(U)}}).$mount("#app")},"736b":function(t,e,a){},"7af6":function(t,e,a){},"7eb5":function(t,e,a){"use strict";var n=a("281c"),s=a.n(n);s.a},"85ec":function(t,e,a){},8899:function(t,e,a){"use strict";var n=a("9461"),s=a.n(n);s.a},"8b81":function(t,e,a){"use strict";var n=a("fbb4"),s=a.n(n);s.a},"923f":function(t,e,a){"use strict";var n=a("29b3"),s=a.n(n);s.a},9461:function(t,e,a){},ea04:function(t,e,a){"use strict";var n=a("1a7b"),s=a.n(n);s.a},fbb4:function(t,e,a){}});
//# sourceMappingURL=app.1e3bae30.js.map
var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e,n,i){if(t){const r=l(t,e,n,i);return t[0](r)}}function l(t,e,n,i){return t[1]&&i?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](i(e))):n.ctx}function o(t,e,n,i){if(t[2]&&i){const r=t[2](i(n));if(void 0===e.dirty)return r;if("object"==typeof r){const t=[],n=Math.max(e.dirty.length,r.length);for(let i=0;i<n;i+=1)t[i]=e.dirty[i]|r[i];return t}return e.dirty|r}return e.dirty}function c(t,e,n,i,r,s){if(r){const a=l(e,n,i,s);t.p(a,r)}}function u(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function f(t){return null==t?"":t}function h(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function m(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function y(){return g(" ")}function v(){return g("")}function x(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function w(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function S(t){return""===t?null:+t}function E(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function b(t,e){t.value=null==e?"":e}let k;function T(t){k=t}function z(){if(!k)throw new Error("Function called outside component initialization");return k}function W(t){z().$$.on_mount.push(t)}function M(t,e){z().$$.context.set(t,e)}function C(t){return z().$$.context.get(t)}const L=[],G=[],V=[],P=[],R=Promise.resolve();let N=!1;function _(t){V.push(t)}function D(t){P.push(t)}const F=new Set;let I=0;function A(){const t=k;do{for(;I<L.length;){const t=L[I];I++,T(t),O(t.$$)}for(T(null),L.length=0,I=0;G.length;)G.pop()();for(let t=0;t<V.length;t+=1){const e=V[t];F.has(e)||(F.add(e),e())}V.length=0}while(L.length);for(;P.length;)P.pop()();N=!1,F.clear(),T(t)}function O(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_)}}const j=new Set;let q;function Y(){q={r:0,c:[],p:q}}function B(){q.r||i(q.c),q=q.p}function X(t,e){t&&t.i&&(j.delete(t),t.i(e))}function H(t,e,n,i){if(t&&t.o){if(j.has(t))return;j.add(t),q.c.push((()=>{j.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function U(t,e,n){const i=t.$$.props[e];void 0!==i&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}function J(t){t&&t.c()}function K(t,n,s,a){const{fragment:l,on_mount:o,on_destroy:c,after_update:u}=t.$$;l&&l.m(n,s),a||_((()=>{const n=o.map(e).filter(r);c?c.push(...n):i(n),t.$$.on_mount=[]})),u.forEach(_)}function Q(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Z(t,e){-1===t.$$.dirty[0]&&(L.push(t),N||(N=!0,R.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function tt(e,r,s,a,l,o,c,u=[-1]){const f=k;T(e);const h=e.$$={fragment:null,ctx:null,props:o,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:n(),dirty:u,skip_bound:!1,root:r.target||f.$$.root};c&&c(h.root);let $=!1;if(h.ctx=s?s(e,r.props||{},((t,n,...i)=>{const r=i.length?i[0]:n;return h.ctx&&l(h.ctx[t],h.ctx[t]=r)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](r),$&&Z(e,t)),n})):[],h.update(),$=!0,i(h.before_update),h.fragment=!!a&&a(h.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);h.fragment&&h.fragment.l(t),t.forEach(d)}else h.fragment&&h.fragment.c();r.intro&&X(e.$$.fragment),K(e,r.target,r.anchor,r.customElement),A()}T(f)}class et{$destroy(){Q(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}class nt{constructor(t,e=0){this.altitude=t,this.water=e}get level(){return this.altitude+this.water}}function it(t,e){return Array.from(Array(t),((t,n)=>e(n)))}function rt(t,e){return t+Math.random()*(e-t)}function st(t,e){return Math.floor(rt(t,e))}function at(t,e){const n=t.slice();for(let t=0;t<n.length&&t<e;t++){const e=st(t,n.length),i=n[t];n[t]=n[e],n[e]=i}return n.slice(0,e)}function lt(t,e,n){return Math.min(Math.max(e,t),n)}function ot(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ct(t){return t.toFixed(2)}function ut(t){return at(t,t.length)}class ft{constructor(t,e,n){this.game=t,this.x=e,this.y=n,this.terrain=new nt(0),this.structure=null}tick(){this.structure&&this.structure.tick(this)}evenify(){const t=[this.left,this.right,this.up,this.down].filter((t=>!!t));if(0===t.length)return;t.sort(((t,e)=>t.terrain.level-e.terrain.level));const e=lt(this.terrain.level-t[0].terrain.level,0,this.terrain.water);let n=e;const i=t.map((()=>0));let r=0;for(let e=0;e<t.length&&n>0;e++){const s=t[e],a=t[e+1];let l=0;if(a){const t=a.terrain.level-s.terrain.level,i=Math.min(t*(e+2),n);n-=i,l=i/(e+2)}else l=n/(e+2),n=0;for(let t=0;t<=e;t++)i[t]+=l;r+=l}t.forEach(((t,e)=>t.terrain.water+=i[e])),this.terrain.water=this.terrain.water-e+r}get left(){return this.game.getTile(this.x-1,this.y)}get right(){return this.game.getTile(this.x+1,this.y)}get up(){return this.game.getTile(this.x,this.y-1)}get down(){return this.game.getTile(this.x,this.y+1)}}class ht{constructor(t,e){this.pid=null,this.width=t,this.height=e,this.status="waiting",this.ticks=0,this.tiles=Array.from(Array(t*e),((e,n)=>new ft(this,n%t,Math.floor(n/t))))}getTile(t,e){return this.contains(t,e)?this.tiles[e*this.width+t]:null}contains(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}tick(){"running"===this.status&&(this.ticks++,this.tiles.forEach((t=>t.tick())),this.tiles.forEach((t=>t.evenify())))}initialize(t){t(this)}start(t){null===this.pid&&(this.pid=setInterval(this.tick.bind(this),t))}stop(){null!==this.pid&&(clearInterval(this.pid),this.pid=null)}}const $t=[[0,-2],[0,2],[-2,0],[2,0]];class dt{generate(t){this.setupGrid(t),t.tiles.forEach((({x:t,y:e,terrain:n})=>n.altitude=this.getGridValueAt(t,e))),this.clearGrid()}setupGrid(t){const e=st(0,t.width),n=st(0,t.height),i=it(t.height,(e=>it(t.width,(t=>({x:t,y:e,visited:!1,nexts:[]})))));let r=[[[e,n],null]];for(;r.length>0;){r=ut(r);const[[e,n],s]=r.shift();if(!t.contains(e,n))continue;const a=i[n][e];if(a&&!a.visited){if(a.visited=!0,s){s.nexts.push(a);const{x:t,y:r}=s;t===e?i[Math.round((n+r)/2)][e].visited=!0:r===n&&(i[n][Math.round((e+t)/2)].visited=!0)}ut($t).forEach((([t,i])=>r.push([[e+t,n+i],a])))}}const s=it(t.height,(e=>it(t.width,(n=>{const r=t.getTile(n,e).terrain.altitude;return i[e][n].visited?lt(Math.floor(r/2),1,CONFIG.maxWaterLevel):r}))));this.grid=s}getGridValueAt(t,e){return this.grid[e][t]}clearGrid(){this.grid=null}}class mt{constructor(t){this.genEnergyPerTick=t.genEnergyPerTick,this.transportSpeed=t.transportSpeed,this.transportPeriodTick=t.transportPeriodTick,this.transportEnergy=t.transportEnergy,this.activeValve=t.activeValve,this.maxEnergy=t.maxEnergy,this.energy=t.energy,this.active=t.active,this.ruined=t.ruined,this.transportationLines=[]}get id(){return"city"}changeEnergy(t){this.energy=lt(this.energy+t,0,this.maxEnergy)}tick(t){if(t.terrain.water>0&&(this.ruined=!0),!this.ruined){if(!this.active){if(this.energy<this.activeValve)return;this.changeEnergy(-this.activeValve),this.active=!0}for(const{target:e,pipe:n}of this.transportationLines){const i=ot(t,e);for(let t=0;t<n.length;t++){const r=n[t];r.progress+=this.transportSpeed,r.progress>=i&&(n.splice(t,1),e.structure.changeEnergy(r.energy))}}if(t.game.ticks%this.transportPeriodTick==0&&this.transportationLines.length>0){const t=this.transportationLines.length,e=lt(this.transportEnergy*t,0,this.energy);this.changeEnergy(-e);const n=e/t;this.transportationLines.forEach((t=>this.transport(t.target,n)))}this.changeEnergy(this.genEnergyPerTick*(1+this.energy/this.maxEnergy*.5))}}addTransportLine(t,e){if(!this.hasTransportLine(t)){const n=ot(e,t),i=CONFIG.lineCost*n;if(this.energy<i)return!1;this.changeEnergy(-i);const r={target:t,pipe:[]};return this.transportationLines.push(r),!0}return!1}removeTransportLine(t){const e=this.transportationLines.findIndex((e=>e.target===t));e>=0&&this.transportationLines.splice(e,1)}hasTransportLine(t){return this.transportationLines.findIndex((e=>e.target===t))>=0}transport(t,e){const n={energy:e,progress:0},i=this.transportationLines.find((e=>e.target===t));i&&i.pipe.push(n)}}class pt{constructor(t){this.targetEnergy=t.targetEnergy,this.energy=t.energy,this.ruined=t.ruined}get id(){return"rocket"}changeEnergy(t){this.energy=lt(this.energy+t,0,this.targetEnergy)}tick(t){t.terrain.water>0&&(this.ruined=!0),this.ruined?(t.game.status="failed",window.alert("Rocket is ruined, YOU LOSE!")):this.energy>=this.targetEnergy&&(t.game.status="succeed",window.alert("Rocket launched, YOU WIN!"))}}class gt{constructor(t){this.speed=t.speed}get id(){return"water-source"}tick(t){t.terrain.water=lt(t.terrain.water+this.speed,0,CONFIG.maxWaterLevel-t.terrain.altitude)}}class yt{constructor(t){this.parameters=t}generate(t){const{maxWaterLevel:e,initWaterSourceCount:n,initCityCount:i}=this.parameters;at(t.tiles.filter((t=>t.terrain.altitude<.25*e)),n).forEach((t=>t.structure=new gt({speed:.3})));const r=t.tiles.slice().sort(((t,e)=>t.terrain.altitude-e.terrain.altitude)).reverse();var s;(s=r.filter((t=>t.terrain.altitude>=r[0].terrain.altitude&&!t.structure)))[st(0,s.length)].structure=new pt({targetEnergy:5e3,energy:0,ruined:!1});const a=at(t.tiles.filter((t=>t.terrain.altitude>.5*e&&!t.structure)),i);a.forEach((t=>t.structure=new mt({genEnergyPerTick:rt(2,5),transportSpeed:rt(.1,.2),transportPeriodTick:st(12,18),transportEnergy:st(20,30),activeValve:st(600,1e3),maxEnergy:st(4e3,8e3),energy:0,active:!1,ruined:!1}))),at(a,1).forEach((t=>t.structure.active=!0))}}class vt{constructor(t){this.parameters=t}generate(t){this.setupGrid(t.width,t.height),t.tiles.forEach((({x:t,y:e,terrain:n})=>n.altitude=this.getGridValueAt(t,e))),this.clearGrid()}setupGrid(t,e){const{initGridSize:n,initMaxWaterLevel:i}=this.parameters,r=Math.floor(t/n)+2,s=Math.floor(e/n)+2;this.grid=it(s,(()=>it(r,(()=>rt(1,.8*i)))))}getGridValueAt(t,e){const n=this.parameters.initGridSize,i=Math.floor(t/n),r=Math.floor(e/n),s=i+1,a=r+1,l=t%n/n,o=1-l,c=e%n/n,u=1-c;return Math.floor(o*(u*this.grid[r][i]+c*this.grid[a][i])+l*(u*this.grid[r][s]+c*this.grid[a][s]))}clearGrid(){this.grid=null}}class xt{constructor(t){this.parameters=t}generate(t){const{wallAltitude:e,wallRadius:n}=this.parameters,i=Math.floor(t.width/2),r=Math.floor(t.height/2);t.tiles.forEach((({x:t,y:s,terrain:a})=>{Math.abs(Math.round(Math.sqrt(Math.pow(t-i,2)+Math.pow(s-r,2)))-n)<.01&&(a.altitude=e)}))}}const wt={createGame:function(t){const{gameMapWidth:e,gameMapHeight:n,genSimpleRandomTerrain:i,initGridSize:r,initMaxWaterLevel:s,genMaze:a,genWallTerrain:l,wallAltitude:o,wallRadius:c,genRandomStructure:u,maxWaterLevel:f,initWaterSourceCount:h,initCityCount:$}=t,d=new ht(e,n);return[i?new vt({initGridSize:r,initMaxWaterLevel:s}):null,a?new dt:null,l?new xt({wallAltitude:o,wallRadius:c}):null,u?new yt({maxWaterLevel:f,initWaterSourceCount:h,initCityCount:$}):null].forEach((t=>null==t?void 0:t.generate(d))),d},getParameterPatterns:function(){const t=[],e={id:"boolean",name:"genRandomStructure",display:"生成随机建筑",defaultValue:!0,subParameters:[{id:"number",name:"maxWaterLevel",display:"最高水平面",defaultValue:16,min:1,max:64,step:1},{id:"number",name:"initWaterSourceCount",display:"水源个数",defaultValue:2,min:0,max:64,step:1},{id:"number",name:"initCityCount",display:"城市个数",defaultValue:12,min:0,max:64,step:1}]},n={id:"boolean",name:"genSimpleRandomTerrain",display:"生成简单随机地形",defaultValue:!0,subParameters:[{id:"number",name:"initGridSize",display:"网格单元长度",defaultValue:4,min:1,max:64,step:1,integer:!0},{id:"number",name:"initMaxWaterLevel",display:"初始地形最高水平面",defaultValue:16,min:1,max:64,step:1,integer:!0}]},i={id:"boolean",name:"genWallTerrain",display:"生成墙壁",defaultValue:!1,subParameters:[{id:"number",name:"wallAltitude",display:"墙高",defaultValue:12,min:1,max:16,step:1,integer:!0},{id:"number",name:"wallRadius",display:"墙半径",defaultValue:5,min:0,max:64,step:1}]};return t.push({id:"number",name:"gameMapWidth",display:"游戏地图宽度（格）",defaultValue:16,min:1,max:100,step:1},{id:"number",name:"gameMapHeight",display:"游戏地图高度（格）",defaultValue:12,min:1,max:64,step:1},n,{id:"boolean",name:"genMaze",display:"生成迷宫",defaultValue:!1},i,e),t}},St=Symbol("startGame"),Et=Symbol("setParameter");function bt(e){let n,r,s,a,l,o,c,u,f,m,g,v;return{c(){n=p("div"),r=p("input"),o=y(),c=p("input"),w(r,"type","number"),w(r,"min",s=e[1].min),w(r,"max",a=e[1].max),w(r,"step",l=e[1].step),w(r,"class","svelte-b2wzj8"),w(c,"type","range"),w(c,"min",u=e[1].min),w(c,"max",f=e[1].max),w(c,"step",m=e[1].step),w(c,"class","svelte-b2wzj8"),w(n,"class","svelte-b2wzj8")},m(t,i){$(t,n,i),h(n,r),b(r,e[0]),h(n,o),h(n,c),b(c,e[0]),g||(v=[x(r,"input",e[2]),x(c,"change",e[3]),x(c,"input",e[3])],g=!0)},p(t,[e]){2&e&&s!==(s=t[1].min)&&w(r,"min",s),2&e&&a!==(a=t[1].max)&&w(r,"max",a),2&e&&l!==(l=t[1].step)&&w(r,"step",l),1&e&&S(r.value)!==t[0]&&b(r,t[0]),2&e&&u!==(u=t[1].min)&&w(c,"min",u),2&e&&f!==(f=t[1].max)&&w(c,"max",f),2&e&&m!==(m=t[1].step)&&w(c,"step",m),1&e&&b(c,t[0])},i:t,o:t,d(t){t&&d(n),g=!1,i(v)}}}function kt(t,e,n){let{pattern:i}=e,{value:r=i.defaultValue}=e;return t.$$set=t=>{"pattern"in t&&n(1,i=t.pattern),"value"in t&&n(0,r=t.value)},[r,i,function(){r=S(this.value),n(0,r)},function(){r=S(this.value),n(0,r)}]}class Tt extends et{constructor(t){super(),tt(this,t,kt,bt,s,{pattern:1,value:0})}}const zt=t=>({}),Wt=t=>({}),Mt=t=>({}),Ct=t=>({});function Lt(t){let e,n,i,r,s,l,f;const m=t[5].name,g=a(m,t,t[4],Ct),v=t[5].value,x=a(v,t,t[4],Wt);return{c(){e=p("div"),n=p("span"),g&&g.c(),r=y(),s=p("span"),x&&x.c(),w(n,"class","name svelte-s8a408"),w(n,"style",i=`flex: ${t[0]}; ${t[2]}`),w(s,"class","value svelte-s8a408"),w(s,"style",l=`flex: ${t[1]}; ${t[3]}`),w(e,"class","row svelte-s8a408")},m(t,i){$(t,e,i),h(e,n),g&&g.m(n,null),h(e,r),h(e,s),x&&x.m(s,null),f=!0},p(t,[e]){g&&g.p&&(!f||16&e)&&c(g,m,t,t[4],f?o(m,t[4],e,Mt):u(t[4]),Ct),(!f||5&e&&i!==(i=`flex: ${t[0]}; ${t[2]}`))&&w(n,"style",i),x&&x.p&&(!f||16&e)&&c(x,v,t,t[4],f?o(v,t[4],e,zt):u(t[4]),Wt),(!f||10&e&&l!==(l=`flex: ${t[1]}; ${t[3]}`))&&w(s,"style",l)},i(t){f||(X(g,t),X(x,t),f=!0)},o(t){H(g,t),H(x,t),f=!1},d(t){t&&d(e),g&&g.d(t),x&&x.d(t)}}}function Gt(t,e,n){let{$$slots:i={},$$scope:r}=e,{nameWeight:s=4}=e,{valueWeight:a=8}=e,{nameStyle:l=""}=e,{valueStyle:o=""}=e;return t.$$set=t=>{"nameWeight"in t&&n(0,s=t.nameWeight),"valueWeight"in t&&n(1,a=t.valueWeight),"nameStyle"in t&&n(2,l=t.nameStyle),"valueStyle"in t&&n(3,o=t.valueStyle),"$$scope"in t&&n(4,r=t.$$scope)},[s,a,l,o,r,i]}class Vt extends et{constructor(t){super(),tt(this,t,Gt,Lt,s,{nameWeight:0,valueWeight:1,nameStyle:2,valueStyle:3})}}function Pt(e){let n,i,r,s,a;return{c(){n=p("div"),i=p("div"),w(i,"class","dot svelte-18gqcs0"),w(n,"class",r=f(`${e[0]}`)+" svelte-18gqcs0")},m(t,r){$(t,n,r),h(n,i),s||(a=x(n,"click",e[1]),s=!0)},p(t,[e]){1&e&&r!==(r=f(`${t[0]}`)+" svelte-18gqcs0")&&w(n,"class",r)},i:t,o:t,d(t){t&&d(n),s=!1,a()}}}function Rt(t,e,n){let{value:i=!1}=e;return t.$$set=t=>{"value"in t&&n(0,i=t.value)},[i,()=>n(0,i=!i)]}class Nt extends et{constructor(t){super(),tt(this,t,Rt,Pt,s,{value:0})}}function _t(t){let e,n,i,r,s,a,l,o=t[0]?"开":"关";function c(e){t[2](e)}let u={};return void 0!==t[0]&&(u.value=t[0]),n=new Nt({props:u}),G.push((()=>U(n,"value",c))),{c(){e=p("div"),J(n.$$.fragment),r=y(),s=p("span"),a=g(o),w(s,"class","svelte-ujctj2"),w(e,"class","svelte-ujctj2")},m(t,i){$(t,e,i),K(n,e,null),h(e,r),h(e,s),h(s,a),l=!0},p(t,[e]){const r={};!i&&1&e&&(i=!0,r.value=t[0],D((()=>i=!1))),n.$set(r),(!l||1&e)&&o!==(o=t[0]?"开":"关")&&E(a,o)},i(t){l||(X(n.$$.fragment,t),l=!0)},o(t){H(n.$$.fragment,t),l=!1},d(t){t&&d(e),Q(n)}}}function Dt(t,e,n){let{pattern:i}=e,{value:r=i.defaultValue}=e;return t.$$set=t=>{"pattern"in t&&n(1,i=t.pattern),"value"in t&&n(0,r=t.value)},[r,i,function(t){r=t,n(0,r)}]}class Ft extends et{constructor(t){super(),tt(this,t,Dt,_t,s,{pattern:1,value:0})}}function It(t,e,n){const i=t.slice();return i[10]=e[n],i}function At(t){let e,n,i=(t[0].display||t[0].name)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","name")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=(t[0].display||t[0].name)+"")&&E(n,i)},d(t){t&&d(e)}}}function Ot(t){let e,n,i,r;function s(e){t[8](e)}var a=t[7][t[0].id];function l(t){let e={pattern:t[0]};return void 0!==t[5]&&(e.value=t[5]),{props:e}}return a&&(n=new a(l(t)),G.push((()=>U(n,"value",s)))),{c(){e=p("span"),n&&J(n.$$.fragment),w(e,"slot","value")},m(t,i){$(t,e,i),n&&K(n,e,null),r=!0},p(t,r){const o={};if(1&r&&(o.pattern=t[0]),!i&&32&r&&(i=!0,o.value=t[5],D((()=>i=!1))),a!==(a=t[7][t[0].id])){if(n){Y();const t=n;H(t.$$.fragment,1,0,(()=>{Q(t,1)})),B()}a?(n=new a(l(t)),G.push((()=>U(n,"value",s))),J(n.$$.fragment),X(n.$$.fragment,1),K(n,e,null)):n=null}else a&&n.$set(o)},i(t){r||(n&&X(n.$$.fragment,t),r=!0)},o(t){n&&H(n.$$.fragment,t),r=!1},d(t){t&&d(e),n&&Q(n)}}}function jt(t){let e,n;return e=new Bt({props:{pattern:t[10],nameStyle:t[3],valueStyle:t[4],nameWeight:t[1],valueWeight:t[2]}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},p(t,n){const i={};64&n&&(i.pattern=t[10]),8&n&&(i.nameStyle=t[3]),16&n&&(i.valueStyle=t[4]),2&n&&(i.nameWeight=t[1]),4&n&&(i.valueWeight=t[2]),e.$set(i)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function qt(t){let e,n,i,r;e=new Vt({props:{nameStyle:t[3],valueStyle:t[4],nameWeight:t[1],valueWeight:t[2],$$slots:{value:[Ot],name:[At]},$$scope:{ctx:t}}});let s=t[6],a=[];for(let e=0;e<s.length;e+=1)a[e]=jt(It(t,s,e));const l=t=>H(a[t],1,1,(()=>{a[t]=null}));return{c(){J(e.$$.fragment),n=y();for(let t=0;t<a.length;t+=1)a[t].c();i=v()},m(t,s){K(e,t,s),$(t,n,s);for(let e=0;e<a.length;e+=1)a[e].m(t,s);$(t,i,s),r=!0},p(t,[n]){const r={};if(8&n&&(r.nameStyle=t[3]),16&n&&(r.valueStyle=t[4]),2&n&&(r.nameWeight=t[1]),4&n&&(r.valueWeight=t[2]),8225&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r),94&n){let e;for(s=t[6],e=0;e<s.length;e+=1){const r=It(t,s,e);a[e]?(a[e].p(r,n),X(a[e],1)):(a[e]=jt(r),a[e].c(),X(a[e],1),a[e].m(i.parentNode,i))}for(Y(),e=s.length;e<a.length;e+=1)l(e);B()}},i(t){if(!r){X(e.$$.fragment,t);for(let t=0;t<s.length;t+=1)X(a[t]);r=!0}},o(t){H(e.$$.fragment,t),a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)H(a[t]);r=!1},d(t){Q(e,t),t&&d(n),m(a,t),t&&d(i)}}}function Yt(t,e,n){let i,{pattern:r}=e,{nameWeight:s=4}=e,{valueWeight:a=5}=e,{nameStyle:l=""}=e,{valueStyle:o=""}=e;const c=C(Et),u={number:Tt,boolean:Ft};let f;return t.$$set=t=>{"pattern"in t&&n(0,r=t.pattern),"nameWeight"in t&&n(1,s=t.nameWeight),"valueWeight"in t&&n(2,a=t.valueWeight),"nameStyle"in t&&n(3,l=t.nameStyle),"valueStyle"in t&&n(4,o=t.valueStyle)},t.$$.update=()=>{33&t.$$.dirty&&c(r.name,f),33&t.$$.dirty&&n(6,i=function(t,e){return"boolean"!==t.id?[]:!0===e&&t.subParameters||[]}(r,f))},[r,s,a,l,o,f,i,u,function(t){f=t,n(5,f)}]}class Bt extends et{constructor(t){super(),tt(this,t,Yt,qt,s,{pattern:0,nameWeight:1,valueWeight:2,nameStyle:3,valueStyle:4})}}function Xt(e){let n;return{c(){n=p("div"),w(n,"style",e[0]),w(n,"class","svelte-1hzn8rv")},m(t,e){$(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function Ht(t,e,n){let{width:i=0}=e,{height:r=0}=e;const s=`\n        width: ${"number"==typeof i?i+"px":i};\n        height: ${"number"==typeof r?r+"px":r};\n    `;return t.$$set=t=>{"width"in t&&n(1,i=t.width),"height"in t&&n(2,r=t.height)},[s,i,r]}class Ut extends et{constructor(t){super(),tt(this,t,Ht,Xt,s,{width:1,height:2})}}function Jt(t,e,n){const i=t.slice();return i[5]=e[n],i[7]=n,i}function Kt(e){let n,i,r,s=e[7]>0&&function(t){let e,n;return e=new Ut({props:{height:"0.5em"}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}();return i=new Bt({props:{pattern:e[5],nameStyle:"text-align: right;",nameWeight:6,valueWeight:6}}),{c(){s&&s.c(),n=y(),J(i.$$.fragment)},m(t,e){s&&s.m(t,e),$(t,n,e),K(i,t,e),r=!0},p:t,i(t){r||(X(s),X(i.$$.fragment,t),r=!0)},o(t){H(s),H(i.$$.fragment,t),r=!1},d(t){s&&s.d(t),t&&d(n),Q(i,t)}}}function Qt(t){let e,n,i,r,s,a,l,o,c,u=t[0],f=[];for(let e=0;e<u.length;e+=1)f[e]=Kt(Jt(t,u,e));const g=t=>H(f[t],1,1,(()=>{f[t]=null}));return{c(){e=p("main"),n=p("h1"),n.textContent="参数设置",i=y(),r=p("div");for(let t=0;t<f.length;t+=1)f[t].c();s=y(),a=p("button"),a.textContent="开始",w(n,"class","svelte-nwl7sr"),w(r,"class","parameters svelte-nwl7sr"),w(a,"class","svelte-nwl7sr"),w(e,"class","svelte-nwl7sr")},m(u,d){$(u,e,d),h(e,n),h(e,i),h(e,r);for(let t=0;t<f.length;t+=1)f[t].m(r,null);h(e,s),h(e,a),l=!0,o||(c=x(a,"click",t[1]),o=!0)},p(t,[e]){if(1&e){let n;for(u=t[0],n=0;n<u.length;n+=1){const i=Jt(t,u,n);f[n]?(f[n].p(i,e),X(f[n],1)):(f[n]=Kt(i),f[n].c(),X(f[n],1),f[n].m(r,null))}for(Y(),n=u.length;n<f.length;n+=1)g(n);B()}},i(t){if(!l){for(let t=0;t<u.length;t+=1)X(f[t]);l=!0}},o(t){f=f.filter(Boolean);for(let t=0;t<f.length;t+=1)H(f[t]);l=!1},d(t){t&&d(e),m(f,t),o=!1,c()}}}function Zt(t){const e=C(St),n=wt.getParameterPatterns(),i=Object.fromEntries(n.map((({name:t,defaultValue:e})=>[t,e])));return M(Et,((t,e)=>i[t]=e)),[n,function(){const t=wt.createGame(i);e(t)}]}class te extends et{constructor(t){super(),tt(this,t,Zt,Qt,s,{})}}function ee(t){const{src:e,dst:n}=t,i=e.structure,r=n.structure;if(i&&r&&"city"===i.id){const t=i;t.hasTransportLine(n)?t.removeTransportLine(n):t.active&&(s=["city","rocket"],a=r.id,s.indexOf(a)>=0)&&t.addTransportLine(n,e)}var s,a}window.CONFIG={tileSize:20,tileEdgeWidth:1,doDrawTileEdge:!1,maxWaterLevel:16,lineCost:100,initWaterLevel:7,initGridSize:4,initCityCount:12,initWaterSourceCount:2};class ne{constructor(){this.handlers=new Set}add(t){return this.handlers.add(t)}remove(t){return this.handlers.delete(t)}clear(){return this.handlers.clear()}emit(t){this.handlers.forEach((e=>e(t)))}}class ie extends class{constructor(){this.doDraw=!1,this.onRender=new ne,this.onLinkTileDispatcher=new ne,this.onClickTileDispatcher=new ne}start(){this.doDraw||(this.doDraw=!0,this.loop())}loop(){this.doDraw&&(requestAnimationFrame(this.loop.bind(this)),this.render())}stop(){this.doDraw=!1}}{constructor(){super(...arguments),this.tileSize=CONFIG.tileSize,this.tileEdgeWidth=CONFIG.tileEdgeWidth}initialize(t,e){this.game=t,this.canvas=e,e.width=this.game.width*this.tileSize,e.height=this.game.height*this.tileSize,this.setupListeners(e,t)}setupListeners(t,e){const n=t=>{const n=Math.floor(t.offsetX/this.tileSize),i=Math.floor(t.offsetY/this.tileSize),r=e.getTile(n,i);this.ghostSrcTile=r},i=t=>{const n=Math.floor(t.offsetX/this.tileSize),i=Math.floor(t.offsetY/this.tileSize),r=e.getTile(n,i);r&&(r!==this.ghostSrcTile&&this.ghostSrcTile?this.onLinkTileDispatcher.emit({src:this.ghostSrcTile,dst:r}):(this.onClickTileDispatcher.emit({tile:r}),this.choosenTile=r)),this.ghostSrcTile=null,this.ghostDstTile=null},r=t=>{const n=Math.floor(t.offsetX/this.tileSize),i=Math.floor(t.offsetY/this.tileSize),r=e.getTile(n,i);this.ghostSrcTile&&r&&(this.ghostDstTile=this.ghostSrcTile===r?null:r)},s=t=>{this.ghostSrcTile=null,this.ghostDstTile=null},a=t=>{if(" "===t.key)switch(e.status){case"running":e.status="waiting";break;case"waiting":e.status="running"}};t.addEventListener("mousedown",n),t.addEventListener("mouseup",i),t.addEventListener("mousemove",r),t.addEventListener("mouseleave",s),window.addEventListener("keyup",a),this.cleanListeners=()=>{t.removeEventListener("mousedown",n),t.removeEventListener("mouseup",i),t.removeEventListener("mousemove",r),t.removeEventListener("mouseleave",s),window.removeEventListener("keyup",a)}}render(){this.canvas.width=this.game.width*this.tileSize,this.canvas.height=this.game.height*this.tileSize;const t=this.canvas.getContext("2d");this.game.tiles.forEach((e=>this.renderTerrain(e,t))),this.game.tiles.forEach((e=>this.renderTransportationLine(e,t))),this.game.tiles.forEach((e=>this.renderStructure(e,t))),this.renderChooseFrame(this.choosenTile,t),this.renderGhostTiles(this.ghostSrcTile,this.ghostDstTile,t),this.onRender.emit(this)}renderTerrain(t,e){const{x:n,y:i,terrain:{altitude:r,water:s}}=t,a=Math.floor(n*this.tileSize),l=Math.floor(i*this.tileSize);e.fillStyle="#00"+Math.floor(lt(r/16*256,0,255)).toString(16).padStart(2,"0")+Math.floor(lt(s/CONFIG.maxWaterLevel*191+(s>0?64:0),0,255)).toString(16).padStart(2,"0"),e.fillRect(a,l,this.tileSize,this.tileSize),CONFIG.doDrawTileEdge&&(e.fillStyle="#ffffff",t.up&&t.up.terrain.altitude===r||e.fillRect(a,l,this.tileSize,this.tileEdgeWidth),t.left&&t.left.terrain.altitude===r||e.fillRect(a,l,this.tileEdgeWidth,this.tileSize),t.right&&t.right.terrain.altitude===r||e.fillRect(a+this.tileSize-this.tileEdgeWidth,l,this.tileEdgeWidth,this.tileSize),t.down&&t.down.terrain.altitude===r||e.fillRect(a,l+this.tileSize-this.tileEdgeWidth,this.tileSize,this.tileEdgeWidth))}renderTransportationLine(t,e){const{x:n,y:i,structure:r}=t;if(!r||"city"!==r.id)return;const s=Math.floor((n+.5)*this.tileSize),a=Math.floor((i+.5)*this.tileSize),l=r;for(const{target:t,pipe:r}of l.transportationLines){const l=Math.floor((t.x+.5)*this.tileSize),o=Math.floor((t.y+.5)*this.tileSize),c=Math.atan2(t.y-i,t.x-n);e.strokeStyle="#ffffff",e.lineWidth=.1*this.tileSize,e.beginPath(),e.moveTo(s,a),e.lineTo(l,o),e.stroke();for(const{energy:t,progress:n}of r){const i=.1*this.tileSize*(1+Math.tanh(t/50));e.fillStyle="#ffffff",e.beginPath(),e.arc(s+n*Math.cos(c)*this.tileSize,a+n*Math.sin(c)*this.tileSize,i,0,2*Math.PI),e.fill()}}}renderStructure(t,e){const{x:n,y:i,structure:r}=t;if(!r)return;const s=Math.floor(n*this.tileSize),a=Math.floor(i*this.tileSize);let l="#ff0000";switch(r.id){case"water-source":l="#00ffff";break;case"rocket":l=r?"#8f8f8f":"#ffffff";break;case"city":{const t=r;l=t.ruined?"#8f8f8f":t.active?"#ffff00":"#afaf00"}}if(e.fillStyle=l,e.beginPath(),e.arc(s+this.tileSize/2,a+this.tileSize/2,this.tileSize/2*.6,0,2*Math.PI),e.fill(),"city"===r.id||"rocket"===r.id){e.strokeStyle="#000000",e.lineWidth=.1*this.tileSize,e.stroke(),e.strokeStyle="#ffffff";let t=0;if("city"===r.id){const e=r;t=e.active?e.energy/e.maxEnergy:e.energy/e.activeValve}else if("rocket"===r.id){const e=r;t=lt(e.energy/e.targetEnergy,0,1)}e.beginPath(),e.arc(s+this.tileSize/2,a+this.tileSize/2,this.tileSize/2*.6,-.5*Math.PI,(2*t-.5)*Math.PI,!1),e.stroke()}}renderGhostTiles(t,e,n){const i=this.tileSize;if(t&&e&&t!==e){let r="#ffff00";if(t.structure&&"city"===t.structure.id){const n=t.structure;r=ot(t,e)*CONFIG.lineCost<=n.energy?"#7fff7f":"#ff0000"}n.strokeStyle=r,n.beginPath(),n.moveTo((t.x+.5)*i,(t.y+.5)*i),n.lineTo((e.x+.5)*i,(e.y+.5)*i),n.stroke()}this.renderGhostTile(t,n,"#0066FF"),this.renderGhostTile(e,n,"#FFCC33")}renderGhostTile(t,e,n){if(!t)return;const{x:i,y:r}=t,s=this.tileSize,a=this.tileEdgeWidth,l=(i+.5)*s,o=(r+.5)*s,c=s/2-a,u=s/2-2*a;e.fillStyle=n,e.fillRect(l-c,o-c,2*c,a),e.fillRect(l-c,o+u,2*c,a),e.fillRect(l-c,o-c,a,2*c),e.fillRect(l+u,o-c,a,2*c)}renderChooseFrame(t,e){if(!t)return;const{x:n,y:i,terrain:{altitude:r,water:s,level:a},structure:l}=t,o=Math.floor(n*this.tileSize),c=Math.floor(i*this.tileSize),u=this.tileSize,f=this.tileEdgeWidth;e.fillStyle="#ffffff",e.fillRect(o,c,u,f),e.fillRect(o,c,f,u),e.fillRect(o+u-f,c,f,u),e.fillRect(o,c+u-f,u,f)}dispose(){this.cleanListeners&&(this.cleanListeners(),this.cleanListeners=null),[this.onRender,this.onClickTileDispatcher,this.onLinkTileDispatcher].forEach((t=>t.clear()))}}function re(t,e,n){const i=t.slice();return i[10]=e[n],i}function se(t){let e,n;return{c(){e=p("div"),w(e,"style",n=t[10]),w(e,"class","svelte-1sqqcn1")},m(t,n){$(t,e,n)},p(t,i){2&i&&n!==(n=t[10])&&w(e,"style",n)},d(t){t&&d(e)}}}function ae(e){let n,i=e[1],r=[];for(let t=0;t<i.length;t+=1)r[t]=se(re(e,i,t));return{c(){n=p("div");for(let t=0;t<r.length;t+=1)r[t].c();var t,i,s,a;t=n,i="height",null===(s=e[2])?t.style.removeProperty(i):t.style.setProperty(i,s,a?"important":""),w(n,"class","svelte-1sqqcn1")},m(t,i){$(t,n,i);for(let t=0;t<r.length;t+=1)r[t].m(n,null);e[7](n)},p(t,[e]){if(2&e){let s;for(i=t[1],s=0;s<i.length;s+=1){const a=re(t,i,s);r[s]?r[s].p(a,e):(r[s]=se(a),r[s].c(),r[s].m(n,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=i.length}},i:t,o:t,d(t){t&&d(n),m(r,t),e[7](null)}}}function le(t,e,n){let i,{items:r}=e,{total:s=100}=e,{filler:a="transparent"}=e,{height:l="1em"}=e;const o="number"==typeof l?l+"px":l;let c,u=0;return W((()=>{u=c.offsetWidth})),t.$$set=t=>{"items"in t&&n(3,r=t.items),"total"in t&&n(4,s=t.total),"filler"in t&&n(5,a=t.filler),"height"in t&&n(6,l=t.height)},t.$$.update=()=>{8&t.$$.dirty&&n(1,i=function(t){const e=[];let n=0;for(const i of t){if(!i)continue;const[t,r]=i,a=n;n=lt(n+r,0,s);const l=n;e.push(`\n                width: ${(l-a)/s*u}px;\n                background-color: ${t}; \n            `)}return n<s&&e.push(`\n                width: ${(s-n)/s*u}px;\n                background-color: ${a}; \n            `),e}(r))},[c,i,o,r,s,a,l,function(t){G[t?"unshift":"push"]((()=>{c=t,n(0,c)}))}]}class oe extends et{constructor(t){super(),tt(this,t,le,ae,s,{items:3,total:4,filler:5,height:6})}}function ce(t){let e;return{c(){e=p("span"),e.textContent="状态",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function ue(t){let e,n,i=t[0].ruined?"已毁坏":"完好";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=t[0].ruined?"已毁坏":"完好")&&E(n,i)},d(t){t&&d(e)}}}function fe(t){let e;return{c(){e=p("span"),e.textContent="激活状态",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function he(t){let e,n;return{c(){e=p("span"),n=g(t[2]),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){4&e&&E(n,t[2])},d(t){t&&d(e)}}}function $e(t){let e;return{c(){e=p("span"),e.textContent="能量",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function de(t){let e,n,i=ct(t[0].energy)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].energy)+"")&&E(n,i)},d(t){t&&d(e)}}}function me(t){let e;return{c(){e=p("span"),e.textContent="最大能量",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function pe(t){let e,n,i=ct(t[0].maxEnergy)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].maxEnergy)+"")&&E(n,i)},d(t){t&&d(e)}}}function ge(t){let e,n,i,r,s,a,l,o,c,u;return e=new oe({props:{items:t[1],filler:"#7f7f00",total:t[0].maxEnergy}}),i=new Vt({props:{$$slots:{value:[ue],name:[ce]},$$scope:{ctx:t}}}),s=new Vt({props:{$$slots:{value:[he],name:[fe]},$$scope:{ctx:t}}}),l=new Vt({props:{$$slots:{value:[de],name:[$e]},$$scope:{ctx:t}}}),c=new Vt({props:{$$slots:{value:[pe],name:[me]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment),n=y(),J(i.$$.fragment),r=y(),J(s.$$.fragment),a=y(),J(l.$$.fragment),o=y(),J(c.$$.fragment)},m(t,f){K(e,t,f),$(t,n,f),K(i,t,f),$(t,r,f),K(s,t,f),$(t,a,f),K(l,t,f),$(t,o,f),K(c,t,f),u=!0},p(t,[n]){const r={};2&n&&(r.items=t[1]),1&n&&(r.total=t[0].maxEnergy),e.$set(r);const a={};17&n&&(a.$$scope={dirty:n,ctx:t}),i.$set(a);const o={};20&n&&(o.$$scope={dirty:n,ctx:t}),s.$set(o);const u={};17&n&&(u.$$scope={dirty:n,ctx:t}),l.$set(u);const f={};17&n&&(f.$$scope={dirty:n,ctx:t}),c.$set(f)},i(t){u||(X(e.$$.fragment,t),X(i.$$.fragment,t),X(s.$$.fragment,t),X(l.$$.fragment,t),X(c.$$.fragment,t),u=!0)},o(t){H(e.$$.fragment,t),H(i.$$.fragment,t),H(s.$$.fragment,t),H(l.$$.fragment,t),H(c.$$.fragment,t),u=!1},d(t){Q(e,t),t&&d(n),Q(i,t),t&&d(r),Q(s,t),t&&d(a),Q(l,t),t&&d(o),Q(c,t)}}}function ye(t,e,n){let i,r,s,{tile:a}=e;return t.$$set=t=>{"tile"in t&&n(3,a=t.tile)},t.$$.update=()=>{var e;8&t.$$.dirty&&n(0,i=a.structure),1&t.$$.dirty&&n(2,r=i.active?"已激活":`未激活(${ct(i.energy)}/${ct(i.activeValve)}=${e=i.energy/i.activeValve,(100*e).toFixed(1)+"%"})`),1&t.$$.dirty&&n(1,s=[["#ffff00",i.energy],["#7f0000",i.active?0:lt(i.activeValve-i.energy,0,i.maxEnergy)]])},[i,s,r,a]}class ve extends et{constructor(t){super(),tt(this,t,ye,ge,s,{tile:3})}}function xe(t){let e;return{c(){e=p("span"),e.textContent="状态",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function we(t){let e,n,i=t[0].ruined?"已毁坏":"完好";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=t[0].ruined?"已毁坏":"完好")&&E(n,i)},d(t){t&&d(e)}}}function Se(t){let e;return{c(){e=p("span"),e.textContent="能量",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function Ee(t){let e,n,i=ct(t[0].energy)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].energy)+"")&&E(n,i)},d(t){t&&d(e)}}}function be(t){let e;return{c(){e=p("span"),e.textContent="目标能量",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function ke(t){let e,n,i=ct(t[0].targetEnergy)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].targetEnergy)+"")&&E(n,i)},d(t){t&&d(e)}}}function Te(t){let e,n,i,r,s,a,l,o;return e=new oe({props:{items:t[1],filler:"#7f7f00",total:t[0].targetEnergy}}),i=new Vt({props:{$$slots:{value:[we],name:[xe]},$$scope:{ctx:t}}}),s=new Vt({props:{$$slots:{value:[Ee],name:[Se]},$$scope:{ctx:t}}}),l=new Vt({props:{$$slots:{value:[ke],name:[be]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment),n=y(),J(i.$$.fragment),r=y(),J(s.$$.fragment),a=y(),J(l.$$.fragment)},m(t,c){K(e,t,c),$(t,n,c),K(i,t,c),$(t,r,c),K(s,t,c),$(t,a,c),K(l,t,c),o=!0},p(t,[n]){const r={};2&n&&(r.items=t[1]),1&n&&(r.total=t[0].targetEnergy),e.$set(r);const a={};9&n&&(a.$$scope={dirty:n,ctx:t}),i.$set(a);const o={};9&n&&(o.$$scope={dirty:n,ctx:t}),s.$set(o);const c={};9&n&&(c.$$scope={dirty:n,ctx:t}),l.$set(c)},i(t){o||(X(e.$$.fragment,t),X(i.$$.fragment,t),X(s.$$.fragment,t),X(l.$$.fragment,t),o=!0)},o(t){H(e.$$.fragment,t),H(i.$$.fragment,t),H(s.$$.fragment,t),H(l.$$.fragment,t),o=!1},d(t){Q(e,t),t&&d(n),Q(i,t),t&&d(r),Q(s,t),t&&d(a),Q(l,t)}}}function ze(t,e,n){let i,r,{tile:s}=e;return t.$$set=t=>{"tile"in t&&n(2,s=t.tile)},t.$$.update=()=>{4&t.$$.dirty&&n(0,i=s.structure),1&t.$$.dirty&&n(1,r=[["#ffff00",i.energy]])},[i,r,s]}class We extends et{constructor(t){super(),tt(this,t,ze,Te,s,{tile:2})}}function Me(t){let e;return{c(){e=p("span"),e.textContent="出水速度",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function Ce(e){let n;return{c(){n=p("span"),n.textContent=`${e[0].speed}`,w(n,"slot","value")},m(t,e){$(t,n,e)},p:t,d(t){t&&d(n)}}}function Le(t){let e,n;return e=new Vt({props:{$$slots:{value:[Ce],name:[Me]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},p(t,[n]){const i={};8&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function Ge(t,e,n){let{tile:i}=e;const r=i.structure;return t.$$set=t=>{"tile"in t&&n(1,i=t.tile)},[r,i]}class Ve extends et{constructor(t){super(),tt(this,t,Ge,Le,s,{tile:1})}}function Pe(t){let e,n;return{c(){e=p("h3"),n=g(t[2]),w(e,"class","svelte-1kao90s")},m(t,i){$(t,e,i),h(e,n)},p(t,e){4&e&&E(n,t[2])},d(t){t&&d(e)}}}function Re(t){let e,n,i,r,s=t[2]&&Pe(t);const l=t[4].default,m=a(l,t,t[3],null);return{c(){e=p("div"),s&&s.c(),n=y(),m&&m.c(),w(e,"class",i=f(t[0])+" svelte-1kao90s"),w(e,"style",t[1])},m(t,i){$(t,e,i),s&&s.m(e,null),h(e,n),m&&m.m(e,null),r=!0},p(t,[a]){t[2]?s?s.p(t,a):(s=Pe(t),s.c(),s.m(e,n)):s&&(s.d(1),s=null),m&&m.p&&(!r||8&a)&&c(m,l,t,t[3],r?o(l,t[3],a,null):u(t[3]),null),(!r||1&a&&i!==(i=f(t[0])+" svelte-1kao90s"))&&w(e,"class",i),(!r||2&a)&&w(e,"style",t[1])},i(t){r||(X(m,t),r=!0)},o(t){H(m,t),r=!1},d(t){t&&d(e),s&&s.d(),m&&m.d(t)}}}function Ne(t,e,n){let{$$slots:i={},$$scope:r}=e,{className:s=""}=e,{style:a=""}=e,{title:l=""}=e;return t.$$set=t=>{"className"in t&&n(0,s=t.className),"style"in t&&n(1,a=t.style),"title"in t&&n(2,l=t.title),"$$scope"in t&&n(3,r=t.$$scope)},[s,a,l,r,i]}class _e extends et{constructor(t){super(),tt(this,t,Ne,Re,s,{className:0,style:1,title:2})}}function De(t){let e;return{c(){e=p("span"),e.textContent="位置",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function Fe(t){let e,n,i,r,s,a,l=t[0].x+"",o=t[0].y+"";return{c(){e=p("span"),n=g("("),i=g(l),r=g(", "),s=g(o),a=g(")"),w(e,"slot","value")},m(t,l){$(t,e,l),h(e,n),h(e,i),h(e,r),h(e,s),h(e,a)},p(t,e){1&e&&l!==(l=t[0].x+"")&&E(i,l),1&e&&o!==(o=t[0].y+"")&&E(s,o)},d(t){t&&d(e)}}}function Ie(t){let e,n;return e=new Vt({props:{$$slots:{value:[Fe],name:[De]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},p(t,n){const i={};9&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function Ae(t){let e;return{c(){e=p("span"),e.textContent="海拔",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function Oe(t){let e,n,i=ct(t[0].terrain.altitude)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].terrain.altitude)+"")&&E(n,i)},d(t){t&&d(e)}}}function je(t){let e;return{c(){e=p("span"),e.textContent="水位",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function qe(t){let e,n,i=ct(t[0].terrain.water)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].terrain.water)+"")&&E(n,i)},d(t){t&&d(e)}}}function Ye(t){let e;return{c(){e=p("span"),e.textContent="水平面",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function Be(t){let e,n,i=ct(t[0].terrain.level)+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=ct(t[0].terrain.level)+"")&&E(n,i)},d(t){t&&d(e)}}}function Xe(t){let e,n,i,r,s,a,l,o;return e=new oe({props:{items:t[1],filler:"#00ccff",total:CONFIG.maxWaterLevel}}),i=new Vt({props:{$$slots:{value:[Oe],name:[Ae]},$$scope:{ctx:t}}}),s=new Vt({props:{$$slots:{value:[qe],name:[je]},$$scope:{ctx:t}}}),l=new Vt({props:{$$slots:{value:[Be],name:[Ye]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment),n=y(),J(i.$$.fragment),r=y(),J(s.$$.fragment),a=y(),J(l.$$.fragment)},m(t,c){K(e,t,c),$(t,n,c),K(i,t,c),$(t,r,c),K(s,t,c),$(t,a,c),K(l,t,c),o=!0},p(t,n){const r={};2&n&&(r.items=t[1]),e.$set(r);const a={};9&n&&(a.$$scope={dirty:n,ctx:t}),i.$set(a);const o={};9&n&&(o.$$scope={dirty:n,ctx:t}),s.$set(o);const c={};9&n&&(c.$$scope={dirty:n,ctx:t}),l.$set(c)},i(t){o||(X(e.$$.fragment,t),X(i.$$.fragment,t),X(s.$$.fragment,t),X(l.$$.fragment,t),o=!0)},o(t){H(e.$$.fragment,t),H(i.$$.fragment,t),H(s.$$.fragment,t),H(l.$$.fragment,t),o=!1},d(t){Q(e,t),t&&d(n),Q(i,t),t&&d(r),Q(s,t),t&&d(a),Q(l,t)}}}function He(t){let e;return{c(){e=p("span"),e.textContent="ID",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function Ue(t){let e,n,i=(t[0].structure?.id||"N/A")+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=(t[0].structure?.id||"N/A")+"")&&E(n,i)},d(t){t&&d(e)}}}function Je(t){let e,n,i;var r=t[2][t[0].structure.id];function s(t){return{props:{tile:t[0]}}}return r&&(e=new r(s(t))),{c(){e&&J(e.$$.fragment),n=v()},m(t,r){e&&K(e,t,r),$(t,n,r),i=!0},p(t,i){const a={};if(1&i&&(a.tile=t[0]),r!==(r=t[2][t[0].structure.id])){if(e){Y();const t=e;H(t.$$.fragment,1,0,(()=>{Q(t,1)})),B()}r?(e=new r(s(t)),J(e.$$.fragment),X(e.$$.fragment,1),K(e,n.parentNode,n)):e=null}else r&&e.$set(a)},i(t){i||(e&&X(e.$$.fragment,t),i=!0)},o(t){e&&H(e.$$.fragment,t),i=!1},d(t){t&&d(n),e&&Q(e,t)}}}function Ke(t){let e,n,i,r;e=new Vt({props:{$$slots:{value:[Ue],name:[He]},$$scope:{ctx:t}}});let s=t[0].structure&&Je(t);return{c(){J(e.$$.fragment),n=y(),s&&s.c(),i=v()},m(t,a){K(e,t,a),$(t,n,a),s&&s.m(t,a),$(t,i,a),r=!0},p(t,n){const r={};9&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r),t[0].structure?s?(s.p(t,n),1&n&&X(s,1)):(s=Je(t),s.c(),X(s,1),s.m(i.parentNode,i)):s&&(Y(),H(s,1,1,(()=>{s=null})),B())},i(t){r||(X(e.$$.fragment,t),X(s),r=!0)},o(t){H(e.$$.fragment,t),H(s),r=!1},d(t){Q(e,t),t&&d(n),s&&s.d(t),t&&d(i)}}}function Qe(t){let e,n,i,r,s,a,l,o,c,u;return e=new _e({props:{title:"图格",style:"background-color: #ffffff;",$$slots:{default:[Ie]},$$scope:{ctx:t}}}),i=new Ut({props:{height:"0.5em"}}),s=new _e({props:{title:"地形",style:"background-color: #ffffff;",$$slots:{default:[Xe]},$$scope:{ctx:t}}}),l=new Ut({props:{height:"0.5em"}}),c=new _e({props:{title:"建筑",style:"background-color: #ffffff;",$$slots:{default:[Ke]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment),n=y(),J(i.$$.fragment),r=y(),J(s.$$.fragment),a=y(),J(l.$$.fragment),o=y(),J(c.$$.fragment)},m(t,f){K(e,t,f),$(t,n,f),K(i,t,f),$(t,r,f),K(s,t,f),$(t,a,f),K(l,t,f),$(t,o,f),K(c,t,f),u=!0},p(t,[n]){const i={};9&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i);const r={};11&n&&(r.$$scope={dirty:n,ctx:t}),s.$set(r);const a={};9&n&&(a.$$scope={dirty:n,ctx:t}),c.$set(a)},i(t){u||(X(e.$$.fragment,t),X(i.$$.fragment,t),X(s.$$.fragment,t),X(l.$$.fragment,t),X(c.$$.fragment,t),u=!0)},o(t){H(e.$$.fragment,t),H(i.$$.fragment,t),H(s.$$.fragment,t),H(l.$$.fragment,t),H(c.$$.fragment,t),u=!1},d(t){Q(e,t),t&&d(n),Q(i,t),t&&d(r),Q(s,t),t&&d(a),Q(l,t),t&&d(o),Q(c,t)}}}function Ze(t,e,n){let i;const r={"water-source":Ve,city:ve,rocket:We};let{tile:s}=e;return t.$$set=t=>{"tile"in t&&n(0,s=t.tile)},t.$$.update=()=>{1&t.$$.dirty&&n(1,i=[["#00ff00",s.terrain.altitude],["#0000ff",s.terrain.water]])},[s,i,r]}class tn extends et{constructor(t){super(),tt(this,t,Ze,Qe,s,{tile:0})}}function en(t){let e,n;const i=t[1].default,r=a(i,t,t[0],null);return{c(){e=p("div"),r&&r.c(),w(e,"class","list svelte-nxd2dn")},m(t,i){$(t,e,i),r&&r.m(e,null),n=!0},p(t,[e]){r&&r.p&&(!n||1&e)&&c(r,i,t,t[0],n?o(i,t[0],e,null):u(t[0]),null)},i(t){n||(X(r,t),n=!0)},o(t){H(r,t),n=!1},d(t){t&&d(e),r&&r.d(t)}}}function nn(t,e,n){let{$$slots:i={},$$scope:r}=e;return t.$$set=t=>{"$$scope"in t&&n(0,r=t.$$scope)},[r,i]}class rn extends et{constructor(t){super(),tt(this,t,nn,en,s,{})}}function sn(e){let n;return{c(){n=p("canvas"),w(n,"class","svelte-hyg2g5")},m(t,i){$(t,n,i),e[6](n)},p:t,d(t){t&&d(n),e[6](null)}}}function an(t){let e,n,i,r,s;function a(e){t[7](e)}let l={pattern:t[4]};return void 0!==t[3].tileSize&&(l.value=t[3].tileSize),i=new Tt({props:l}),G.push((()=>U(i,"value",a))),{c(){e=p("span"),e.textContent=`${t[4].display||t[4].name}`,n=y(),J(i.$$.fragment)},m(t,r){$(t,e,r),$(t,n,r),K(i,t,r),s=!0},p(t,e){const n={};!r&&8&e&&(r=!0,n.value=t[3].tileSize,D((()=>r=!1))),i.$set(n)},i(t){s||(X(i.$$.fragment,t),s=!0)},o(t){H(i.$$.fragment,t),s=!1},d(t){t&&d(e),t&&d(n),Q(i,t)}}}function ln(t){let e;return{c(){e=p("span"),e.textContent="状态",w(e,"slot","name")},m(t,n){$(t,e,n)},d(t){t&&d(e)}}}function on(t){let e,n,i=t[0].status+"";return{c(){e=p("span"),n=g(i),w(e,"slot","value")},m(t,i){$(t,e,i),h(e,n)},p(t,e){1&e&&i!==(i=t[0].status+"")&&E(n,i)},d(t){t&&d(e)}}}function cn(t){let e,n;return e=new Vt({props:{$$slots:{value:[on],name:[ln]},$$scope:{ctx:t}}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},p(t,n){const i={};2049&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function un(t){let e,n;return e=new tn({props:{tile:t[2]}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},p(t,n){const i={};4&n&&(i.tile=t[2]),e.$set(i)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function fn(t){let e,n,i,r,s,a,l,o,c,u;e=new _e({props:{style:"background-color: #ffffff;",$$slots:{default:[an]},$$scope:{ctx:t}}}),i=new Ut({props:{height:"0.5em"}}),s=new _e({props:{title:"游戏",style:"background-color: #ffffff;",$$slots:{default:[cn]},$$scope:{ctx:t}}}),l=new Ut({props:{height:"0.5em"}});let f=t[2]&&un(t);return{c(){J(e.$$.fragment),n=y(),J(i.$$.fragment),r=y(),J(s.$$.fragment),a=y(),J(l.$$.fragment),o=y(),f&&f.c(),c=v()},m(t,h){K(e,t,h),$(t,n,h),K(i,t,h),$(t,r,h),K(s,t,h),$(t,a,h),K(l,t,h),$(t,o,h),f&&f.m(t,h),$(t,c,h),u=!0},p(t,n){const i={};2056&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i);const r={};2049&n&&(r.$$scope={dirty:n,ctx:t}),s.$set(r),t[2]?f?(f.p(t,n),4&n&&X(f,1)):(f=un(t),f.c(),X(f,1),f.m(c.parentNode,c)):f&&(Y(),H(f,1,1,(()=>{f=null})),B())},i(t){u||(X(e.$$.fragment,t),X(i.$$.fragment,t),X(s.$$.fragment,t),X(l.$$.fragment,t),X(f),u=!0)},o(t){H(e.$$.fragment,t),H(i.$$.fragment,t),H(s.$$.fragment,t),H(l.$$.fragment,t),H(f),u=!1},d(t){Q(e,t),t&&d(n),Q(i,t),t&&d(r),Q(s,t),t&&d(a),Q(l,t),t&&d(o),f&&f.d(t),t&&d(c)}}}function hn(t){let e,n,i,r,s,a,l;return i=new _e({props:{style:t[5],$$slots:{default:[sn]},$$scope:{ctx:t}}}),a=new rn({props:{$$slots:{default:[fn]},$$scope:{ctx:t}}}),{c(){e=p("main"),n=p("div"),J(i.$$.fragment),r=y(),s=p("div"),J(a.$$.fragment),w(n,"class","canvas-wrapper svelte-hyg2g5"),w(s,"class","info svelte-hyg2g5"),w(e,"class","svelte-hyg2g5")},m(t,o){$(t,e,o),h(e,n),K(i,n,null),h(e,r),h(e,s),K(a,s,null),l=!0},p(t,[e]){const n={};2050&e&&(n.$$scope={dirty:e,ctx:t}),i.$set(n);const r={};2061&e&&(r.$$scope={dirty:e,ctx:t}),a.$set(r)},i(t){l||(X(i.$$.fragment,t),X(a.$$.fragment,t),l=!0)},o(t){H(i.$$.fragment,t),H(a.$$.fragment,t),l=!1},d(t){t&&d(e),Q(i),Q(a)}}}function $n(t,e,n){let i,r,{game:s=null}=e,a=null,l=new ie;const o=({tile:t})=>n(2,a=t),c=()=>{n(2,a),n(0,s)};var u;W((()=>{if(!s)throw new Error("No game!");l.onLinkTileDispatcher.add(ee),l.onClickTileDispatcher.add(o),l.onRender.add(c),l.initialize(s,i),l.start(),n(0,s.status="running",s),s.start(100),r=()=>{"running"===s.status&&n(0,s.status="waiting",s),l.stop(),l.dispose(),s.stop(),n(0,s=null)}})),u=()=>{r&&r()},z().$$.on_destroy.push(u);return t.$$set=t=>{"game"in t&&n(0,s=t.game)},[s,i,a,l,{id:"number",name:"tileSize",display:"瓦片边长(px)",defaultValue:20,min:1,max:1e3,step:1,integer:!0},"\n        width: 100%;\n        height: 100%;\n        overflow: auto;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background-color: #ffffff;\n    ",function(t){G[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},function(e){t.$$.not_equal(l.tileSize,e)&&(l.tileSize=e,n(3,l))}]}class dn extends et{constructor(t){super(),tt(this,t,$n,hn,s,{game:0})}}function mn(t){let e,n;return e=new dn({props:{game:t[0]}}),{c(){J(e.$$.fragment)},m(t,i){K(e,t,i),n=!0},p(t,n){const i={};1&n&&(i.game=t[0]),e.$set(i)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function pn(e){let n,i;return n=new te({}),{c(){J(n.$$.fragment)},m(t,e){K(n,t,e),i=!0},p:t,i(t){i||(X(n.$$.fragment,t),i=!0)},o(t){H(n.$$.fragment,t),i=!1},d(t){Q(n,t)}}}function gn(t){let e,n,i,r;const s=[pn,mn],a=[];function l(t,e){return t[0]?1:0}return n=l(t),i=a[n]=s[n](t),{c(){e=p("main"),i.c(),w(e,"class","svelte-1vngb98")},m(t,i){$(t,e,i),a[n].m(e,null),r=!0},p(t,[r]){let o=n;n=l(t),n===o?a[n].p(t,r):(Y(),H(a[o],1,1,(()=>{a[o]=null})),B(),i=a[n],i?i.p(t,r):(i=a[n]=s[n](t),i.c()),X(i,1),i.m(e,null))},i(t){r||(X(i),r=!0)},o(t){H(i),r=!1},d(t){t&&d(e),a[n].d()}}}function yn(t,e,n){let i=null;return M(St,(t=>n(0,i=t))),[i]}return new class extends et{constructor(t){super(),tt(this,t,yn,gn,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map

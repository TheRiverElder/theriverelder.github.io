(function(t){function e(e){for(var n,r,o=e[0],c=e[1],l=e[2],d=0,v=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&v.push(i[r][0]),i[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(v.length)v.shift()();return s.push.apply(s,l||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,o=1;o<a.length;o++){var c=a[o];0!==i[c]&&(n=!1)}n&&(s.splice(e--,1),t=r(r.s=a[0]))}return t}var n={},i={app:0},s=[];function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/pl-editor/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("85ec"),i=a.n(n);i.a},"1a16":function(t,e,a){"use strict";var n=a("eaae"),i=a.n(n);i.a},"1adf":function(t,e,a){"use strict";var n=a("9461"),i=a.n(n);i.a},"24c4":function(t,e,a){},"27af":function(t,e,a){},3271:function(t,e,a){},3456:function(t,e,a){"use strict";var n=a("83c7"),i=a.n(n);i.a},"4ab4":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"app"}},[a("v-app-bar",{attrs:{app:"",color:"primary",height:"32","clipped-left":""}},[a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,i=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",i,!1),n),[t._v("文件")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:t.downloadProject}},[a("v-list-item-title",[t._v("下载工程")])],1),a("v-list-item",{attrs:{dense:"",disabled:!t.script},on:{click:t.downloadScript}},[a("v-list-item-title",[t._v("下载脚本")])],1),a("v-divider"),a("v-list-item",{attrs:{dense:""},on:{click:t.cacheState}},[a("v-list-item-title",[t._v("缓存至浏览器")])],1),a("v-list-item",{attrs:{dense:""},on:{click:t.loadProjectFromCache}},[a("v-list-item-title",[t._v("从浏览器缓存载入工程")])],1),a("v-list-item",{attrs:{dense:""}},[a("v-list-item-title",{staticClass:"p-relative"},[t._v(" 从文件载入工程 "),a("input",{staticClass:"invisible-overlay",attrs:{type:"file"},on:{change:function(e){return t.loadProjectFromFile(e.target.files[0])}}})])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,i=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",i,!1),n),[t._v("工程")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:t.compile}},[a("v-list-item-title",[t._v("编译为测试版")])],1),a("v-list-item",{attrs:{dense:"",disabled:""},on:{click:t.compile}},[a("v-list-item-title",[t._v("编译为发行版")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,i=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",i,!1),n),[t._v("脚本")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:"",disabled:!t.script},on:{click:t.compile}},[a("v-list-item-title",[t._v("测试脚本（需要先编译）")])],1)],1)],1)],1),a("v-navigation-drawer",{attrs:{app:"",permanent:"",clipped:""}},[a("v-list",[a("v-list-item",{on:{click:function(e){return t.open("base-info")}}},[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-information-outline")])],1),a("v-list-item-title",[t._v("基础信息")])],1),a("v-list-item",{on:{click:function(e){return t.open("resource")}}},[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-folder-outline")])],1),a("v-list-item-title",[t._v("资源管理器")])],1),a("v-list-group",{scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-account-outline")])],1),a("v-list-item-subtitle",[t._v("角色")])]},proxy:!0}])},[t._l(t.roles,(function(e){return a("v-list-item",{key:e,on:{click:function(a){return t.open("role",e)}}},[a("v-list-item-avatar",{attrs:{color:"grey lighten-2"}},[a("v-img",{attrs:{src:t.data[t.data[e].avatar]}})],1),a("v-list-item-title",[t._v(t._s(t.data[e].name))])],1)})),a("v-list-item",[a("v-btn",{staticClass:"mx-auto",attrs:{text:"",color:"primary"},on:{click:t.createNewRole}},[t._v("新建角色")])],1)],2),a("v-list-group",{scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-text")])],1),a("v-list-item-subtitle",[t._v("台词段")])]},proxy:!0}])},[t._l(t.chunks,(function(e){return a("v-list-item",{key:e,on:{click:function(a){return t.open("chunk",e)}}},[a("v-list-item-title",[t._v(t._s(t.data[e].title))])],1)})),a("v-list-item",[a("v-btn",{staticClass:"mx-auto",attrs:{text:"",color:"primary"},on:{click:t.createNewChunk}},[t._v("新建文本段")])],1)],2)],1)],1),a("v-main",{staticClass:"fill-y"},[a("div",{staticClass:"fill-y flex-grow-1 d-flex flex-column"},[a("v-tabs",{staticClass:"flex-grow-0",attrs:{height:"2em"},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},t._l(t.tabs,(function(e,n){return a("v-tab",{key:e.id,attrs:{size:"small"}},[a("v-icon",{attrs:{small:""}},[t._v(t._s(t.getIcon(e.type)))]),a("span",{staticClass:"mx-1"},[t._v(t._s(e.title))]),a("v-btn",{attrs:{"x-small":"",icon:""},on:{click:function(e){return t.close(n)}}},[a("v-icon",{attrs:{"x-small":""}},[t._v(t._s(e.dirty?"mdi-circle":"mdi-close"))])],1)],1)})),1),a("v-divider"),a("v-tabs-items",{staticClass:"grey lighten-4 flex-grow-1",attrs:{"active-class":""},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},t._l(t.tabs,(function(e){return a("v-tab-item",{key:e.id,staticClass:"fill-y grey lighten-4"},[a(t.getComponent(e.type),{ref:"tabs",refInFor:!0,tag:"component",staticClass:"fill-y edit-area",attrs:{content:e.content},on:{mutate:function(a){return t.markDirty(e)}}})],1)})),1)],1)])],1)},s=[],r=(a("c740"),a("4160"),a("a434"),a("b0c0"),a("159b"),a("5530")),o=a("2f62"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{staticClass:"resource-manager d-flex flex-wrap",on:{dragover:function(e){t.overlay=!0},dragend:function(e){t.overlay=!1},drop:t.handleDrop}},[t._l(t.resources,(function(e){return a("Resouece",{key:e,staticClass:"resource ma-3",attrs:{uid:e,res:t.data[e]}})})),a("v-card",{staticClass:"resource ma-3 d-flex flex-column"},[a("div",{staticClass:"input-wrapper flex-grow-1 flex-shrink-1 d-flex justify-center align-center"},[a("v-icon",{attrs:{"x-large":""}},[t._v("mdi-file-multiple")]),a("input",{attrs:{type:"file",multiple:""},on:{change:t.inputFiles}})],1),a("v-card-subtitle",[t._v("拖拽或点击输入文件")])],1)],2)},l=[],u=(a("baa5"),a("fb6a"),a("b85c")),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{staticClass:"d-flex flex-column"},[a("v-img",{staticClass:"flex-shrink-1",attrs:{src:t.res.src,contain:""}}),a("v-card-title",{staticClass:"name"},[t.editName?a("v-text-field",{attrs:{"hide-details":"auto",dense:"","error-messages":t.errors},on:{blur:function(e){t.editName=!1},keydown:t.handleEnter},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}):a("span",{on:{click:function(e){t.editName=!0}}},[t._v(t._s(t.name))])],1),a("v-card-actions",[a("v-btn",{attrs:{icon:""},on:{click:function(e){return t.removeResource(t.id)}}},[a("v-icon",[t._v("mdi-delete")])],1),a("v-btn",{attrs:{icon:""}},[a("v-icon",[t._v("mdi-share")]),a("input",{ref:"btnReplace",staticClass:"fill",attrs:{type:"file"},on:{input:t.replaceRes}})],1)],1)],1)},v=[],p={name:"Resource",props:{res:Object},data:function(){return{id:this.res.id,name:this.res.name,src:this.res.src,type:this.res.type,editName:!1,errors:null}},watch:{name:function(t,e){this.errors=0===t.length?"名字不可为空":null,t!==e&&this.$emit("mutate")},src:function(t,e){t!==e&&this.updateData({id:this.id,src:this.src,type:this.type})}},methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["removeResource","updateData"])),{},{replaceRes:function(t){var e,a=this,n=Object(u["a"])(t.target.files);try{var i=function(){var t=e.value,n=new FileReader;n.onload=function(){return Object.assign(a,{src:n.result,type:t.type})},n.readAsDataURL(t)};for(n.s();!(e=n.n()).done;)i()}catch(s){n.e(s)}finally{n.f()}},handleEnter:function(t){"Enter"===t.key&&(this.editName=!1,this.updateData({id:this.id,name:this.name}))}})},f=p,m=(a("1a16"),a("2877")),h=a("6544"),b=a.n(h),g=a("8336"),x=a("b0af"),k=a("99d9"),_=a("132d"),y=a("adda"),j=a("8654"),C=Object(m["a"])(f,d,v,!1,null,"8c0dd874",null),w=C.exports;b()(C,{VBtn:g["a"],VCard:x["a"],VCardActions:k["a"],VCardTitle:k["c"],VIcon:_["a"],VImg:y["a"],VTextField:j["a"]});var O={name:"ResourceManager",components:{Resouece:w},data:function(){return{overlay:!1}},computed:Object(r["a"])({},Object(o["c"])(["resources","data"])),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["createResource"])),{},{inputFiles:function(t){var e,a=this,n=Object(u["a"])(t.target.files);try{var i=function(){var t=e.value,n=t.name.lastIndexOf("."),i=n>=0?t.name.slice(0,n):t.name,s=new FileReader;s.onload=function(){return a.createResource({name:i,src:s.result,type:t.type})},s.readAsDataURL(t)};for(n.s();!(e=n.n()).done;)i()}catch(s){n.e(s)}finally{n.f()}},handleDrop:function(){this.overlay=!1},save:function(){}})},I=O,S=(a("d2a1"),a("a523")),V=Object(m["a"])(I,c,l,!1,null,"3dab9a01",null),R=V.exports;b()(V,{VCard:x["a"],VCardSubtitle:k["b"],VContainer:S["a"],VIcon:_["a"]});var $=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pa-5 d-flex"},[a("div",{staticClass:"form d-flex flex-column align-center"},[a("v-avatar",{attrs:{size:"160",color:"grey"}},[t.avatar?a("img",{attrs:{src:t.avatarUrl}}):a("span",{staticClass:"white--text text-h3"},[t._v(t._s(t.name.slice(0,2)))])]),a("v-text-field",{staticClass:"input flex-grow-0",attrs:{label:"名字",messages:"必填，最好不要超过三个中文",placeholder:"角色的名字"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("ResSelector",{attrs:{label:"头像",messages:"无实际用途，仅方便编辑"},model:{value:t.avatar,callback:function(e){t.avatar=e},expression:"avatar"}}),a("ResSelector",{attrs:{label:"立绘"},model:{value:t.pic,callback:function(e){t.pic=e},expression:"pic"}})],1),a("div",{staticClass:"img-wrapper flex-grow-1"},[a("img",{attrs:{src:t.picUrl}})])])},U=[],P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-select",{attrs:{label:t.label,messages:t.messages,placeholder:t.placeholder,"no-data-text":t.noDataText||"无可用资源",items:t.resList,"item-text":"name","item-value":"id"},on:{input:t.handleInput},model:{value:t.resId,callback:function(e){t.resId=e},expression:"resId"}})},N=[],T=(a("d81d"),{name:"ResSelector",props:{value:String,messages:[Array,String],label:String,placeholder:String,noDataText:String},data:function(){return{resId:this.value}},watch:{value:function(t){this.resId=t}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","resources"])),{},{resList:function(){var t=this;return this.resources.map((function(e){return t.data[e]}))}}),methods:{handleInput:function(){this.$emit("input",this.resId),this.changingRole=!1}}}),D=T,E=(a("1adf"),a("b974")),M=Object(m["a"])(D,P,N,!1,null,"6df42ebf",null),L=M.exports;b()(M,{VSelect:E["a"]});a("13d5");function B(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];return a.reduce((function(e,a){return e[a]=function(e,n){t&&(this[t][a]=e),e!==n&&this.$emit("mutate")},e}),{})}var A={name:"Role",components:{ResSelector:L},props:{content:Object},data:function(){return{name:this.content.name,avatar:this.content.avatar,pic:this.content.pic}},watch:Object(r["a"])({},B("content","name","avatar","pic")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data"])),{},{id:function(){return this.content.id},picUrl:function(){var t=this.data[this.pic];return t?t.src:null},avatarUrl:function(){var t=this.data[this.avatar];return t?t.src:null}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateData"])),{},{save:function(){this.updateData({id:this.id,name:this.name,avatar:this.avatar,pic:this.pic})}})},F=A,J=(a("63ed"),a("8212")),z=Object(m["a"])(F,$,U,!1,null,"5f927c0d",null),K=z.exports;b()(z,{VAvatar:J["a"],VTextField:j["a"]});var G=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chunk fill px-5"},[a("v-container",{staticClass:"pa-0 d-flex flex-column"},[a("div",{staticClass:"chunk-info pa-5"},[a("img",{staticClass:"background",attrs:{cover:"",width:"100%",gradient:"#ffffffaf 0%, #ffffffaf 50%, #fff 100%",src:t.backgroundUrl}}),a("div",{staticClass:"text-right ma-1",on:{mouseleave:function(e){t.openMenu=!1}}},[a("v-slide-x-reverse-transition",[a("span",{directives:[{name:"show",rawName:"v-show",value:t.openMenu,expression:"openMenu"}]},[a("v-btn",{attrs:{small:"",text:"",color:"warning"},on:{click:t.deleteSelf}},[a("v-icon",[t._v("mdi-delete")]),t._v("删除 ")],1)],1)]),a("v-app-bar-nav-icon",{on:{click:function(e){t.openMenu=!t.openMenu}}})],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("标题")]),a("v-col",{attrs:{cols:"10"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"text-h4",attrs:{type:"text",placeholder:"此处输入标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})])],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("副标题")]),a("v-col",{attrs:{cols:"10"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.subtitle,expression:"subtitle"}],staticClass:"text-subtitle-1",attrs:{type:"text",placeholder:"此处输入副标题"},domProps:{value:t.subtitle},on:{input:function(e){e.target.composing||(t.subtitle=e.target.value)}}})])],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("背景")]),a("v-col",{attrs:{cols:"10"}},[a("ResSelector",{attrs:{placeholder:"选择背景"},model:{value:t.background,callback:function(e){t.background=e},expression:"background"}})],1)],1),a("v-container",[t._l(t.exits,(function(e,n){return a("v-row",{key:n},[a("v-col",{attrs:{cols:"1"}},[t._v(t._s(n+1))]),a("v-col",{attrs:{cols:"8"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"exit.text"}],domProps:{value:e.text},on:{input:function(a){a.target.composing||t.$set(e,"text",a.target.value)}}})]),a("v-col",{attrs:{cols:"2"}},[a("v-select",{attrs:{dense:"","hide-details":"",items:t.chunkList,"item-text":"title","item-value":"uid"},model:{value:e.target,callback:function(a){t.$set(e,"target",a)},expression:"exit.target"}})],1),a("v-col",{attrs:{cols:"1"}},[a("v-btn",{on:{click:function(e){return t.deleteExit(n)}}},[t._v("删除")])],1)],1)})),a("v-row",[a("v-btn",{attrs:{block:""},on:{click:t.addExit}},[t._v("新分支")])],1)],2)],1)]),a("v-divider"),a("div",{staticClass:"content"},t._l(t.sections,(function(e,n){return a("Section",{key:n,ref:"section",refInFor:!0,attrs:{index:n,section:e,"is-only":1===t.sections.length},on:{"add-line":t.addLine,"delete-line":t.deleteLine,focus:t.focusOnSection,mutate:function(e){return t.$emit("mutate")}}})})),1),a("v-row",{staticClass:"flex-grow-0 pa-2"},[a("v-btn",{ref:"btnAdd",staticClass:"mx-auto",attrs:{color:"primary",elevation:"0"},on:{click:t.addLine}},[a("v-icon",[t._v("mdi-plus")]),t._v("新台词 ")],1)],1)],1)},H=[],X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"section d-flex align-start",attrs:{align:"start"},on:{mouseenter:function(e){t.showBtnBar=!0},mouseleave:function(e){t.showBtnBar=!1}}},[a("span",{staticClass:"mt-2 d-flex align-center"},[a("span",{staticClass:"line-number text-subtitle-2 mr-3"},[t._v(t._s(t.index+1))]),a("span",{staticClass:"speaker"},[a("RoleSelector",{model:{value:t.speaker,callback:function(e){t.speaker=e},expression:"speaker"}})],1),a("span",[t._v(":")])]),a("span",{staticClass:"mx-2 flex-grow-1"},[a("v-textarea",{ref:"textInput",staticClass:"text-input py-1",attrs:{rows:"1","auto-grow":"",dense:"","hide-details":""},on:{keyup:t.handleInputKey},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1),a("v-expand-x-transition",[t.showBtnBar?a("v-btn-toggle",{staticClass:"btn-tgl mt-2",attrs:{dense:"",rounded:"",borderless:""}},[a("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"2em",color:"green"},on:{click:function(e){return t.$emit("add-line",t.index)}}},[a("v-icon",[t._v("mdi-plus")])],1),t.isOnly?t._e():a("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"2em",color:"red"},on:{click:function(e){return t.$emit("delete-line",t.index)}}},[a("v-icon",[t._v("mdi-minus")])],1)],1):t._e()],1)],1)},q=[],Q=(a("a9e3"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.changingRole?a("span",{staticClass:"role",on:{blur:function(e){t.changingRole=!1}}},[a("v-select",{attrs:{dense:"","hide-details":"",items:t.roleList,"item-text":"name","item-value":"id","no-data-text":"无可用角色"},on:{input:t.handleInput},model:{value:t.roleUid,callback:function(e){t.roleUid=e},expression:"roleUid"}})],1):a("span",{staticClass:"role d-flex align-center",on:{click:function(e){t.changingRole=!0}}},[a("RAvatar",{attrs:{size:"2em",contain:"",src:t.rolePicUrl}}),a("span",[t._v(t._s(t.roleName))])],1)}),W=[],Y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-avatar",{attrs:{size:t.size}},[t.src?a("v-img",{attrs:{src:t.src,contain:""}}):a("v-icon",{attrs:{size:"normal"}},[t._v(t._s(t.emptyIcon))])],1)},Z=[],tt={name:"RAvatar",props:{src:String,size:{type:[String,Number],default:"1em"},emptyIcon:{type:String,default:"mdi-account-alert-outline"}},data:function(){return{text:this.value}}},et=tt,at=Object(m["a"])(et,Y,Z,!1,null,"651caef7",null),nt=at.exports;b()(at,{VAvatar:J["a"],VIcon:_["a"],VImg:y["a"]});var it={name:"RoleSelector",components:{RAvatar:nt},props:{value:String},data:function(){return{changingRole:!1,roleUid:this.value}},watch:{value:function(t){this.roleUid=t}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["roles","data","resources"])),{},{roleList:function(){var t=this;return this.roles.map((function(e){return t.data[e]}))},roleName:function(){if(this.roleUid){var t=this.data[this.roleUid];return t.name}return""},rolePicUrl:function(){if(this.roleUid){var t=this.data[this.roleUid];if(t){var e=this.data[t.avatar||t.pic];if(e)return e.src}}return null}}),methods:{handleInput:function(){this.$emit("input",this.roleUid),this.changingRole=!1}}},st=it,rt=(a("d795"),Object(m["a"])(st,Q,W,!1,null,"6dc2f815",null)),ot=rt.exports;b()(rt,{VSelect:E["a"]});var ct={name:"Section",components:{RoleSelector:ot},props:{index:Number,section:Object,isOnly:Boolean},data:function(){return{speaker:null,text:"",showBtnBar:!1}},watch:Object(r["a"])({},B("section","speaker","text")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data"])),{},{speakerName:function(){if(this.speaker){var t=this.data[this.speaker];if(t&&t.pic)return t.name}return"      "},speakerPicUrl:function(){if(this.speaker){var t=this.data[this.speaker];if(t){var e=this.data[t.avatar||t.pic];if(e)return e.src}}return null}}),methods:{focus:function(){this.$refs.textInput.focus()},handleInputKey:function(t){var e=!0;if(t.ctrlKey){switch(t.key){case"Enter":this.$emit("add-line",this.index+1);break;case"ArrowUp":this.$emit("focus",this.index-1);break;case"ArrowDown":this.$emit("focus",this.index+1);break;case"Backspace":/^\s*$/.test(this.section.text)&&this.$emit("delete-line",this.index);break;default:e=!1}e&&t.preventDefault()}}}},lt=ct,ut=(a("a6a9"),a("a609")),dt=a("0789"),vt=a("a844"),pt=Object(m["a"])(lt,X,q,!1,null,"4240e50d",null),ft=pt.exports;b()(pt,{VBtn:g["a"],VBtnToggle:ut["a"],VExpandXTransition:dt["b"],VIcon:_["a"],VTextarea:vt["a"]});var mt={name:"Chunk",components:{Section:ft,ResSelector:L},props:{content:Object},data:function(){return{id:this.content.id,title:this.content.title,subtitle:this.content.subtitle,background:this.content.background,sections:this.content.sections,exits:this.content.exits,openMenu:!1}},watch:Object(r["a"])({},B("content","title","subtitle","background")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","chunks"])),{},{chunkList:function(){var t=this;return this.chunks.map((function(e){return t.data[e]}))},backgroundUrl:function(){if(this.background){var t=this.data[this.background];return t?t.src:null}return null}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["removeChunk","updateData"])),{},{addLine:function(t){var e=this;("number"!==typeof t||t<0||t>this.sections.length)&&(t=this.sections.length);var a=t?this.sections[t-1].speaker:null,n={speaker:a,text:""};this.sections.splice(t,0,n),this.$emit("mutate"),this.$nextTick((function(){return e.focusOnSection(t)}))},deleteLine:function(t){var e=this;this.sections.splice(t,1),this.$emit("mutate"),this.$nextTick((function(){return e.focusOnSection(t-1)}))},addExit:function(){this.exits.push({text:"",target:null}),this.$emit("mutate")},deleteExit:function(t){this.exits.splice(t,1),this.$emit("mutate")},deleteSelf:function(){this.removeChunk(this.id)},focusOnSection:function(t){t=Math.max(0,Math.min(t,this.sections.length-1));var e=this.$refs.section;e.length&&t<e.length&&e[t].focus()},save:function(){this.updateData({id:this.content.id,title:this.title,subtitle:this.subtitle,background:this.background,sections:this.sections,exits:this.exits})}})},ht=mt,bt=(a("d10a"),a("5bc1")),gt=a("62ad"),xt=a("ce7e"),kt=a("0fd9"),_t=Object(m["a"])(ht,G,H,!1,null,"6f8e05fd",null),yt=_t.exports;b()(_t,{VAppBarNavIcon:bt["a"],VBtn:g["a"],VCol:gt["a"],VContainer:S["a"],VDivider:xt["a"],VIcon:_["a"],VRow:kt["a"],VSelect:E["a"],VSlideXReverseTransition:dt["e"]});var jt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[a("v-text-field",{attrs:{label:"剧本名称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("v-text-field",{attrs:{label:"版本"},model:{value:t.version,callback:function(e){t.version=e},expression:"version"}}),a("v-combobox",{attrs:{chips:"",multiple:"","deletable-chips":"",label:"作者"},model:{value:t.authors,callback:function(e){t.authors=e},expression:"authors"}})],1)},Ct=[],wt={name:"BaseInfo",data:function(){return{name:this.$store.state.name,version:this.$store.state.version,authors:this.$store.state.authors}},watch:Object(r["a"])({},B(null,"name","version","authors")),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateBaseInfo"])),{},{save:function(){this.updateBaseInfo({name:this.name,version:this.version,authors:this.authors})}})},Ot=wt,It=a("2b5d"),St=Object(m["a"])(Ot,jt,Ct,!1,null,null,null),Vt=St.exports;b()(St,{VCombobox:It["a"],VContainer:S["a"],VTextField:j["a"]});a("4fad"),a("b64b"),a("d3b7"),a("6062"),a("3ca3"),a("ddb0");var Rt=a("3835"),$t=a("53ca"),Ut=a("2909");function Pt(t){return Array.isArray(t)?t.map(Pt):"object"===Object($t["a"])(t)&&null!==t?Object.entries(t).reduce((function(t,e){var a=Object(Rt["a"])(e,2),n=a[0],i=a[1];return t[n]=Pt(i),t}),{}):t}var Nt={resource:"mdi-folder-outline",role:"mdi-account-outline",chunk:"mdi-text","base-info":"mdi-information-outline"},Tt={name:"App",components:{ResourceManager:R,Role:K,Chunk:yt,BaseInfo:Vt},data:function(){return{tabIndex:null,tabs:[]}},computed:Object(r["a"])({},Object(o["c"])(["resources","roles","chunks","data","script"])),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateData","cacheState","createRole","createChunk","downloadProject","downloadScript","compile","loadProjectFromFile","loadProjectFromCache"])),{},{createNewRole:function(){var t=this;this.createRole({cb:function(e){return t.open("role",e.id)}})},createNewChunk:function(){var t=this;this.createChunk({cb:function(e){return t.open("chunk",e.id)}})},getIcon:function(t){return Nt[t]||"mdi-help"},getComponent:function(t){switch(t){case"resource":return"ResourceManager";case"role":return"Role";case"chunk":return"Chunk";default:return"BaseInfo"}},open:function(t,e){"resource"!==t&&"base-info"!==t||(e=t);var a=this.tabs.findIndex((function(t){return t.id===e}));if(a>=0)this.tabIndex=a;else{var n=null;if("resource"===t||"base-info"===t)n={title:"资源管理器",type:t,id:e,dirty:!1};else{var i=Pt(this.data[e]);switch(n={title:null,type:t,id:e,content:i,dirty:!1},t){case"role":n.title=i.name;break;case"chunk":n.title=i.title;break}}this.tabs.push(n),this.tabIndex=this.tabs.length-1}},close:function(t){var e=this.tabs[t];e&&(e.dirty&&!confirm("".concat(e.title,"还未保存，确定关闭？"))||this.tabs.splice(t,1))},saveTab:function(t,e){t&&(this.$refs.tabs[e].save(),t.dirty=!1)},markDirty:function(t){t.dirty=!0}}),created:function(){var t=this;window.addEventListener("keydown",(function(e){"S"!==e.key&&"s"!==e.key||!e.ctrlKey||(e.preventDefault(),e.stopPropagation(),e.shiftKey?t.tabs.forEach((function(e,a){return t.saveTab(e,a)})):t.saveTab(t.tabs[t.tabIndex],t.tabIndex),t.cacheState(),t.$forceUpdate())})),this.open("base-info")}},Dt=Tt,Et=(a("034f"),a("7496")),Mt=a("40dc"),Lt=a("8860"),Bt=a("56b0"),At=a("da13"),Ft=a("8270"),Jt=a("5d23"),zt=a("f6c4"),Kt=a("e449"),Gt=a("f774"),Ht=a("71a3"),Xt=a("c671"),qt=a("fe57"),Qt=a("aac8"),Wt=Object(m["a"])(Dt,i,s,!1,null,null,null),Yt=Wt.exports;b()(Wt,{VApp:Et["a"],VAppBar:Mt["a"],VBtn:g["a"],VDivider:xt["a"],VIcon:_["a"],VImg:y["a"],VList:Lt["a"],VListGroup:Bt["a"],VListItem:At["a"],VListItemAvatar:Ft["a"],VListItemSubtitle:Jt["b"],VListItemTitle:Jt["c"],VMain:zt["a"],VMenu:Kt["a"],VNavigationDrawer:Gt["a"],VTab:Ht["a"],VTabItem:Xt["a"],VTabs:qt["a"],VTabsItems:Qt["a"]});var Zt=a("8c4f"),te=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"home d-flex flex-column justify-space-around align-center"},[a("v-card",{staticClass:"script-info pa-5"},[a("v-text-field",{attrs:{label:"剧本名："},model:{value:t.info.name,callback:function(e){t.$set(t.info,"name",e)},expression:"info.name"}}),a("v-text-field",{attrs:{label:"版本："},model:{value:t.info.version,callback:function(e){t.$set(t.info,"version",e)},expression:"info.version"}}),a("v-combobox",{attrs:{label:"创作者：",chips:"",multiple:"",clearable:"","deletable-chips":"","disable-lookup":""},model:{value:t.info.authors,callback:function(e){t.$set(t.info,"authors",e)},expression:"info.authors"}})],1),a("div",[a("v-btn",{on:{click:t.saveProject}},[a("v-icon",[t._v("mdi-download")]),t._v("保存项目 ")],1),a("v-btn",{on:{click:t.compile}},[a("v-icon",[t._v("mdi-arrow-right")]),t._v("编译 ")],1),a("v-btn",{on:{click:t.compile}},[a("v-icon",[t._v("mdi-download")]),t._v("下载脚本 ")],1),a("v-btn",[a("v-icon",[t._v("mdi-upload")]),a("span",[t._v("导入项目")]),a("input",{staticClass:"fill",attrs:{type:"file"},on:{input:t.loadProject}})],1),a("v-btn",{on:{click:t.clearProject}},[a("v-icon",[t._v("mdi-clear")]),t._v("清空项目 ")],1)],1),a("article",[a("h1",[t._v("江奶奶的Galgame编辑器")]),a("h2",[t._v("食用方法")]),a("h3",[t._v("开始项目")]),a("ol",[a("li",[t._v("首先在顶部导航栏点击“资源”，上传所需的各种资源（主要是图片），其它资源暂时不支持预览。")]),a("li",[t._v("然后再顶部导航栏点击“角色”，在左侧列表中点击“+新角色”按键，然后填充名字、头像、立绘。其中头像只是方便后续文本编辑，并不会对编译后的脚本呢产生影响。")]),a("li",[t._v("然后在顶部导航栏点击“台词”，在左侧列表中点击“+新文本段”按键，点击右边面板左上角的三条横杠（"),a("v-app-bar-nav-icon"),t._v("）按钮，填充该文本段所需的信息，而后即可收起信息面板，编辑台词")],1),t._m(0),a("li",[t._v("点击“编译”生成脚本，而后可以选择“下载脚本”或者到“演示面板”开始测试。")])])])],1)},ee=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",[t._v("回到“主页”，点击“保存项目”"),a("del",[t._v("（或者在任何页面按下 "),a("em",[t._v("ctrl")]),t._v(" + "),a("em",[t._v("S")]),t._v("缓存，或者"),a("em",[t._v("ctrl")]),t._v(" + "),a("em",[t._v("shift")]),t._v(" + "),a("em",[t._v("S")]),t._v("下载）")]),t._v("。")])}],ae=a("ec26"),ne="river-galgame-project";function ie(t){if(t){var e=JSON.stringify(t);return localStorage.setItem(ne,e),e}}function se(){return JSON.parse(localStorage.getItem(ne))}function re(t){return t||(t={info:{name:"未命名剧本",version:"1.0.0",authors:["RiverElder"]},data:{},chunks:[],roles:[],resources:[],addData:function(t){var e=Object(ae["a"])();return this.data[e]=t,e}}),t.addData=function(t){var e=Object(ae["a"])();return this.data[e]=t,e},t}var oe={project:re(se()),script:null,chunkEditorBar:{selectState:new Set,primaryRoleUid:null,secondaryRoleUid:null,fillMode:"all",clickMode:"fill",selectRange:function(t,e){for(var a=t;a<=e;a++)this.selectState.add(a)}},messages:["打开新世界的大门"]},ce=oe,le=(a("99af"),a("aeb1")),ue=a.n(le),de=ce.project;function ve(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=ie(de);if(ce.messages.push("已缓存工程"),t)if(e){var a=ce.project.info.name+".proj.json";ce.messages.push("开始下载工程文件："+a),ue()(e,a,"application/json")}else ce.messages.push("未下载工程文件")}function pe(){var t={},e=de.resources.map((function(t){return de.data[t].src}));de.resources.forEach((function(e,a){return t[e]=a}));var a=de.roles.map((function(e){var a=de.data[e];return{name:a.name,avatar:t[a.avatar],pic:t[a.pic]}}));de.roles.forEach((function(e,a){return t[e]=a}));var n=[];de.chunks.map((function(e){var a=de.data[e];t[e]=n.length,n.push.apply(n,[["bg",t[a.background]],["bgm",t[a.bgm]]].concat(Object(Ut["a"])(a.sections.map((function(e){return["line",e.text,t[e.speaker]]}))),Object(Ut["a"])(a.exits.map((function(e){return["exit",e.text,t[e.target]]})))))})),n.forEach((function(e){"exit"===e[0]&&(e[2]=t[e[2]])}));var i={info:de.info,instructions:n,resources:e,roles:a};ce.script=i,ce.messages.push("编译完成，可以演示或者下载脚本")}function fe(){if(ce.script){var t=ce.script.info.name+".json";ce.messages.push("开始下载："+t),ue()(JSON.stringify(ce.script),t,"application/json")}else ce.messages.push("无可用的编译后脚本")}function me(t){var e=new FileReader;e.onload=function(){return he(JSON.parse(e.result))},e.readAsText(t.target.files[0])}function he(t){t&&Object.assign(de,t)}var be={info:{name:"未命名剧本",version:"1.0.0",authors:["RiverElder"]},data:{},chunks:[],roles:[],resources:[],addData:function(t){var e=Object(ae["a"])();return this.data[e]=t,e}};function ge(){Object.assign(de,be)}var xe={name:"Home",data:function(){return ce.project},methods:{saveProject:ve,compile:pe,downloadScript:fe,loadProject:me,fillProject:he,clearProject:ge}},ke=xe,_e=(a("aa36"),Object(m["a"])(ke,te,ee,!1,null,"b269a8ce",null)),ye=_e.exports;b()(_e,{VAppBarNavIcon:bt["a"],VBtn:g["a"],VCard:x["a"],VCombobox:It["a"],VIcon:_["a"],VTextField:j["a"]});var je=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fill d-flex"},[a("v-navigation-drawer",{staticClass:"role-list",attrs:{permanent:""}},[a("v-list",[a("v-list-item-group",{model:{value:t.roleIndex,callback:function(e){t.roleIndex=e},expression:"roleIndex"}},t._l(t.roles,(function(e){return a("v-list-item",{key:e},[a("RAvatar",{staticClass:"mr-5",attrs:{src:t.getAvatarUrl(e),size:"2em"}}),t._v(" "+t._s(t.data[e].name)+" ")],1)})),1)],1),a("div",{staticClass:"mx-5"},[a("v-btn",{attrs:{block:""},on:{click:t.addRole}},[a("v-icon",[t._v("mdi-plus")]),t._v(" 新角色 ")],1)],1)],1),t.role?a("div",{staticClass:"role ma-5 d-flex flex-column align-center"},[a("div",{staticClass:"input d-flex align-start"},[a("label",{staticClass:"mr-2"},[t._v("名字:")]),a("v-input",{staticClass:"input flex-grow-0",attrs:{messages:"必填，最好不要超过三个中文",placeholder:"角色的名字"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.role.name,expression:"role.name"}],ref:"nameInput",attrs:{autofocus:""},domProps:{value:t.role.name},on:{input:function(e){e.target.composing||t.$set(t.role,"name",e.target.value)}}})]),a("v-spacer"),a("label",{staticClass:"mr-2"},[t._v("头像:")]),a("div",{staticClass:"input flex-grow-0"},[a("v-autocomplete",{staticClass:"ma-0",attrs:{dense:"",messages:"无实际用途，仅方便编辑",placeholder:"角色的头像","no-data-text":"无可用资源",items:t.resList,"item-text":"name","item-value":"uid"},model:{value:t.role.avatar,callback:function(e){t.$set(t.role,"avatar",e)},expression:"role.avatar"}})],1),a("RAvatar",{staticClass:"ml-3",attrs:{src:t.avatarUrl,size:"3em"}})],1),a("v-input",{staticClass:"input flex-grow-0"},[a("label",{staticClass:"mr-2"},[t._v("立绘:")]),a("v-autocomplete",{attrs:{placeholder:"角色的立绘","no-data-text":"无可用资源",items:t.resources.map((function(e){return Object.assign({},t.data[e],{uid:e})})),"item-text":"name","item-value":"uid"},model:{value:t.role.pic,callback:function(e){t.$set(t.role,"pic",e)},expression:"role.pic"}})],1),a("div",{staticClass:"img-wrapper"},[a("img",{attrs:{src:t.picUrl}})]),a("v-btn",{staticClass:"white--text",attrs:{color:"red"},on:{click:t.deleteRole}},[a("v-icon",[t._v("mdi-minus")]),t._v(" 删除该角色 ")],1)],1):t._e()],1)},Ce=[],we=ce.project,Oe={name:"RoleManager",components:{RAvatar:nt},data:function(){return{roleIndex:null,data:we.data,resources:we.resources,roles:we.roles,role:null}},watch:{roleIndex:function(t){var e=we.roles[t];this.role=e?we.data[e]:null}},computed:{resList:function(){var t=this;return we.resources.map((function(e){return Object(r["a"])({uid:e},t.data[e])}))},picUrl:function(){var t=this.role;if(t&&t.pic){var e=we.data[t.pic];return e?e.src:null}return null},avatarUrl:function(){var t=this.role;if(t&&t.avatar){var e=we.data[t.avatar];return e?e.src:null}return null}},methods:{addRole:function(){we.roles.push(we.addData({name:"未命名角色",avatar:null,pic:null})),this.roleIndex=we.roles.length-1},deleteRole:function(){if("number"===typeof this.roleIndex&&this.roleIndex>=0){var t=we.roles[this.roleIndex];we.roles.splice(this.roleIndex,1),delete we.data[t],this.roleIndex=null}},getAvatarUrl:function(t){var e=we.data[t];if(e){var a=we.data[e.avatar||e.pic];return a?a.src:null}return null}}},Ie=Oe,Se=(a("a3c3"),a("c6a6")),Ve=a("b675"),Re=a("1baa"),$e=a("2fa4"),Ue=Object(m["a"])(Ie,je,Ce,!1,null,"2b1cc075",null),Pe=Ue.exports;b()(Ue,{VAutocomplete:Se["a"],VBtn:g["a"],VIcon:_["a"],VInput:Ve["a"],VList:Lt["a"],VListItem:At["a"],VListItemGroup:Re["a"],VNavigationDrawer:Gt["a"],VSpacer:$e["a"]});var Ne=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fill d-flex"},[a("v-navigation-drawer",{attrs:{permanent:""}},[a("v-list",[a("v-list-item-group",{model:{value:t.chunkIndex,callback:function(e){t.chunkIndex=e},expression:"chunkIndex"}},t._l(t.chunkTitleList,(function(e){return a("v-list-item",{key:e.uid},[t._v(t._s(e.title))])})),1)],1),a("div",{staticClass:"mx-5"},[a("v-btn",{attrs:{block:""},on:{click:t.addChunk}},[a("v-icon",[t._v("mdi-plus")]),t._v(" 新文本段 ")],1)],1)],1),a("div",{staticClass:"content flex-grow-1 d-flex flex-column"},[a("div",{staticClass:"chunk-wrapper flex-grow-1"},[t.chunk?a("Chunk",{staticClass:"chunk",attrs:{chunk:t.chunk,index:t.chunkIndex}}):t._e()],1),t.hasPrevPage?a("div",{staticClass:"page-changer prev-page px-2 d-flex align-center",on:{click:t.toPrevPage}},[a("v-icon",[t._v("mdi-arrow-left")])],1):t._e(),t.hasNextPage?a("div",{staticClass:"page-changer next-page px-2 d-flex align-center",on:{click:t.toNextPage}},[a("v-icon",[t._v("mdi-arrow-right")])],1):t._e()])],1)},Te=[],De=ce.project,Ee={name:"ChunkManager",components:{Chunk:yt},data:function(){return{chunkIndex:null,chunk:null,chunks:De.chunks,data:De.data}},watch:{chunkIndex:function(t){if("number"===typeof t){var e=De.chunks[t];if(e)return void(this.chunk=De.data[e])}this.chunk=null}},computed:{chunkTitleList:function(){var t=this;return this.chunks.map((function(e){return{uid:e,title:t.data[e].title}}))},hasPrevPage:function(){return"number"===typeof this.chunkIndex&&this.chunkIndex>0},hasNextPage:function(){return"number"===typeof this.chunkIndex&&this.chunkIndex<De.chunks.length-1}},methods:{addChunk:function(){this.chunks.push(De.addData({title:"文本段标题",subtitle:"",background:null,bgm:null,sections:[{speaker:null,text:""}],exits:[]})),this.$forceUpdate()},toPrevPage:function(){this.chunkIndex--},toNextPage:function(){this.chunkIndex++}}},Me=Ee,Le=(a("9e48"),Object(m["a"])(Me,Ne,Te,!1,null,"62f02815",null)),Be=Le.exports;b()(Le,{VBtn:g["a"],VIcon:_["a"],VList:Lt["a"],VListItem:At["a"],VListItemGroup:Re["a"],VNavigationDrawer:Gt["a"]});var Ae=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"overflow-hidden fill d-flex flex-column"},[a("div",{staticClass:"d-flex align-center pa-5"},[a("v-chip",{staticClass:"mx-2"},[a("span",{staticClass:"text-subtitle-1 mx-2"},[t._v("初选角色")]),a("RoleSelector",{model:{value:t.primaryRoleUid,callback:function(e){t.primaryRoleUid=e},expression:"primaryRoleUid"}})],1),a("v-chip",{staticClass:"mx-2"},[a("span",{staticClass:"text-subtitle-1 mx-2"},[t._v("次选角色")]),a("RoleSelector",{model:{value:t.secondaryRoleUid,callback:function(e){t.secondaryRoleUid=e},expression:"secondaryRoleUid"}})],1),a("v-chip",{staticClass:"mx-2"},[a("span",[t._v("新文本段")]),a("v-switch",{model:{value:t.newChunk,callback:function(e){t.newChunk=e},expression:"newChunk"}})],1),a("v-chip",{staticClass:"mx-2"},[a("span",{staticClass:"text-subtitle-1 mx-2"},[t._v("插入章节")]),a("v-select",{attrs:{items:t.chunkList,"item-text":"title","item-value":"uid","no-data-text":"无可用章节",disabled:t.newChunk},model:{value:t.chunkUid,callback:function(e){t.chunkUid=e},expression:"chunkUid"}})],1),a("v-btn-toggle",{attrs:{dense:"",rounded:""}},[a("v-btn",{on:{click:t.inject}},[t._v("注入")]),a("v-btn",{on:{click:function(e){t.text=""}}},[t._v("清空")])],1)],1),a("div",{staticClass:"overflow-auto flex-grow-1 px-5"},[a("v-textarea",{staticClass:"fill ma-0",attrs:{height:"100%","auto-grow":"","hide-details":"",dense:"","no-resize":""},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1),a("v-snackbar",{attrs:{timeout:2e3},model:{value:t.hasMessage,callback:function(e){t.hasMessage=e},expression:"hasMessage"}},[t._v(t._s(t.message))])],1)},Fe=[],Je=(a("4de4"),a("ac1f"),a("1276"),{name:"InjectPage",components:{RoleSelector:ot},data:function(){return{text:"",hasMessage:!1,message:null,newChunk:!1,chunkUid:null,primaryRoleUid:null,secondaryRoleUid:null}},computed:{chunkList:function(){var t=ce.project.data;return ce.project.chunks.map((function(e){return{uid:e,title:t[e].title}}))}},methods:{inject:function(){var t=this;if(/^\s*$/g.test(this.text))this.showMessage("输入文本不可为空!");else{var e=this.text.split(/[\n\r](\s*[\n\r])?/).filter((function(t){return t&&t.length})).map((function(e,a){return{speaker:a%2?t.secondaryRoleUid:t.primaryRoleUid,text:e}}));if(this.newChunk)ce.project.chunks.push(ce.project.addData({title:"注入文本",subtitle:"",background:null,bgm:null,sections:e,exits:[]}));else{var a,n=ce.project.data[this.chunkUid];if(!n)return void this.showMessage("不存在指定文本段");(a=n.sections).push.apply(a,Object(Ut["a"])(e))}this.showMessage("向【".concat(this.newChunk?"新文本段":ce.project.data[this.chunkUid].title,"】注入文本").concat(e.length,"条"))}},showMessage:function(t){this.message=t,this.hasMessage=!0}}}),ze=Je,Ke=(a("3456"),a("cc20")),Ge=a("2db4"),He=a("b73d"),Xe=Object(m["a"])(ze,Ae,Fe,!1,null,"65e8a157",null),qe=Xe.exports;b()(Xe,{VBtn:g["a"],VBtnToggle:ut["a"],VChip:Ke["a"],VSelect:E["a"],VSnackbar:Ge["a"],VSwitch:He["a"],VTextarea:vt["a"]});var Qe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"relative fill"},[a("img",{staticClass:"background fill absolute",attrs:{src:t.background}}),a("audio",{ref:"bgm",attrs:{src:t.bgm,loop:""}}),a("img",{staticClass:"speaker fill absolute",attrs:{src:t.speakerPic}}),a("div",{staticClass:"content fill pa-3 d-flex flex-column justify-end"},[a("div",{staticClass:"text oculus mb-3 pa-2"},[t._v(" "+t._s(t.speakerName)+"："+t._s(t.text)+" ")]),a("ul",{staticClass:"options oculus pa-2"},[t._l(t.options,(function(e,n){return a("li",{key:n,staticClass:"option pa-2",on:{click:t.handleClickOption}},[t._v(" "+t._s(e.text)+" ")])})),t.options.length?t._e():a("li",{staticClass:"option",on:{click:t.handleClickDefaultOption}},[t._v("...")])],2)]),a("div",{staticClass:"debug-panel absolute pa-3"},[a("div",{staticClass:"d-flex justify-center"},[a("v-input",{attrs:{label:"指针："}},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.pointer,expression:"pointer",modifiers:{number:!0}}],attrs:{type:"number",min:0,max:t.script.instructions.length-1},domProps:{value:t.pointer},on:{input:function(e){e.target.composing||(t.pointer=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),a("v-btn",{on:{click:t.forceRun}},[t._v("执行")])],1),a("ul",t._l(t.logger,(function(e,n){return a("li",{key:n},[t._v(t._s(e))])})),0)])])},We=[],Ye=(a("a15b"),{name:"Demonstration",data:function(){return{pointer:0,background:null,bgm:null,speakerPic:null,speakerName:"",line:"",options:[],hasSetText:!1,logger:[]}},watch:{bgm:function(t,e){t!==e&&"string"===typeof t&&t.length>0&&this.$refs.bgm.play()}},computed:{script:function(){return ce.script}},methods:{run:function(){while(this.pointer<this.script.instructions.length&&this.canStepIn(this.script.instructions[this.pointer]))this.apply(this.script.instructions[this.pointer]),this.pointer++},forceRun:function(){this.hasSetText=!1,this.run()},apply:function(t){switch(this.log(t.join(" ")),t[0]){case"bg":this.background=this.script.resources[t[1]];break;case"bgm":this.bgm=this.script.resources[t[1]];break;case"line":this.text=t[1];var e=this.script.roles[t[2]];this.speakerPic=this.script.resources[e.pic],this.speakerName=e.name,this.options=[],this.hasSetText=!0;break;case"option":this.options.push({text:t[1],target:t[2]});break}},canStepIn:function(t){switch(t[0]){case"bg":return!0;case"bgm":return!0;case"line":return!this.hasSetText;case"option":return this.hasSetText}},jumpTo:function(t){this.pointer=t},handleClickOption:function(t){this.hasSetText=!1;var e=this.options[t];this.jumpTo(e.target),this.run()},handleClickDefaultOption:function(){this.hasSetText=!1,this.run()},log:function(t){this.logger.length>=10&&this.logger.shift(),this.logger.push(t)}},created:function(){this.run()}}),Ze=Ye,ta=(a("7c0c"),Object(m["a"])(Ze,Qe,We,!1,null,"7d3e8764",null)),ea=ta.exports;b()(ta,{VBtn:g["a"],VInput:Ve["a"]}),n["a"].use(Zt["a"]);var aa=[{path:"/",name:"Home",component:ye},{path:"/resource-manager",name:"ResourceManager",component:R},{path:"/role-manager",name:"RoleManager",component:Pe},{path:"/chunk-manager",name:"ChunkManager",component:Be},{path:"/inject-page",name:"InjectPage",component:qe},{path:"/demonstration",name:"Demonstration",component:ea}],na=new Zt["a"]({routes:aa}),ia=na,sa=a("f309");n["a"].use(sa["a"]);var ra=new sa["a"]({}),oa="pl-editor-project";function ca(t){console.log(t)}function la(t){localStorage.setItem(oa,JSON.stringify(t))}function ua(t){var e={name:t.name,version:t.version,authors:t.authors,resources:t.resources,roles:t.roles,chunks:t.chunks,data:t.data};ue()(JSON.stringify(e),e.name+".egg.proj.json","application/json")}function da(t){var e=localStorage.getItem(oa);e&&Object.assign(t,JSON.parse(e))}function va(t,e){var a=new FileReader;a.onload=function(){Object.assign(t,JSON.parse(a.result))},a.readAsText(e)}function pa(t){var e=t.script;e&&ue()(JSON.stringify(e),(e.name||"未命名")+".egg.json","application/json")}function fa(t,e,a,n){var i=Object(r["a"])({id:Object(ae["a"])()},a);t.data[i.id]=i,t[e].push(i.id),n&&n(i)}function ma(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.name,n=void 0===a?"未命名资源":a,i=e.src,s=void 0===i?null:i,r=e.type,o=void 0===r?"image/*":r,c=e.cb;fa(t,"resources",{name:n,src:s,type:o},c)}function ha(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.name,n=void 0===a?"未命名角色":a,i=e.avatar,s=void 0===i?null:i,r=e.pic,o=void 0===r?null:r,c=e.cb;fa(t,"roles",{name:n,avatar:s,pic:o},c)}function ba(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.title,n=void 0===a?"未命名文本段":a,i=e.subtitle,s=void 0===i?"":i,r=e.background,o=void 0===r?null:r,c=e.sections,l=void 0===c?[{speaker:null,text:""}]:c,u=e.exits,d=void 0===u?[]:u,v=e.cb;fa(t,"chunks",{title:n,subtitle:s,background:o,sections:l,exits:d},v)}function ga(t,e,a){delete t.data[a];var n=t[e],i=n.findIndex((function(t){return t===a}));i>=0&&n.splice(i,1)}function xa(t,e){ga(t,"resources",e)}function ka(t,e){ga(t,"roles",e)}function _a(t,e){ga(t,"chunks",e)}function ya(t,e){var a=t.data[e.id];a?Object.assign(a,e):t.data[e.id]=e}n["a"].use(o["a"]);var ja=new o["a"].Store({state:{name:"未命名",version:"1.0.0",authors:[],data:{"res-1":{id:"res-1",src:null,name:"Unnamed"},"role-1":{id:"role-1",name:"内啥",avatar:null,pic:null},"chunk-1":{id:"chunk-1",title:"未命名章节",subtitle:"",background:null,sections:[],exits:[]}},resources:["res-1"],roles:["role-1"],chunks:["chunk-1"],script:null},mutations:{cacheState:la,compile:ca,downloadProject:ua,downloadScript:pa,loadProjectFromFile:va,loadProjectFromCache:da,createResource:ma,createRole:ha,createChunk:ba,removeResource:xa,removeRole:ka,removeChunk:_a,updateData:ya,updateBaseInfo:function(t,e){var a=e.name,n=e.version,i=e.authors;t.name=a||t.name,t.version=n||t.version,t.authors=i||t.authors}},actions:{}});n["a"].config.productionTip=!1,new n["a"]({router:ia,vuetify:ra,store:ja,render:function(t){return t(Yt)}}).$mount("#app")},"616c":function(t,e,a){},"63ed":function(t,e,a){"use strict";var n=a("24c4"),i=a.n(n);i.a},"7c0c":function(t,e,a){"use strict";var n=a("a654"),i=a.n(n);i.a},"83c7":function(t,e,a){},"85ec":function(t,e,a){},9461:function(t,e,a){},"9e48":function(t,e,a){"use strict";var n=a("d3c1"),i=a.n(n);i.a},a3c3:function(t,e,a){"use strict";var n=a("3271"),i=a.n(n);i.a},a654:function(t,e,a){},a6a9:function(t,e,a){"use strict";var n=a("27af"),i=a.n(n);i.a},aa36:function(t,e,a){"use strict";var n=a("ae1f"),i=a.n(n);i.a},ae1f:function(t,e,a){},cc1b:function(t,e,a){},d10a:function(t,e,a){"use strict";var n=a("cc1b"),i=a.n(n);i.a},d2a1:function(t,e,a){"use strict";var n=a("616c"),i=a.n(n);i.a},d3c1:function(t,e,a){},d795:function(t,e,a){"use strict";var n=a("4ab4"),i=a.n(n);i.a},eaae:function(t,e,a){}});
//# sourceMappingURL=app.8da71b99.js.map
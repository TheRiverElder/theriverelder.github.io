(this["webpackJsonpmind-node-2"]=this["webpackJsonpmind-node-2"]||[]).push([[0],{18:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var o=n(1),i=n.n(o),s=n(12),a=n.n(s),r=(n(18),n(13)),d=n(8),c=n(2),u=n(10),l=n(3),h=n(4),f=n(7),g=n(6);n(19),n(20);function v(e){var t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=e[n];"string"===typeof o?t.push(o):o&&t.push(n)}return t.join(" ")}function p(e,t,n){var o=e.get(t);o&&n(o,t)}function j(e){var t,n=null===(t=e.current)||void 0===t?void 0:t.getBoundingClientRect();return{x:(null===n||void 0===n?void 0:n.x)||0,y:(null===n||void 0===n?void 0:n.y)||0,width:(null===n||void 0===n?void 0:n.width)||0,height:(null===n||void 0===n?void 0:n.height)||0}}n(21);var N=n(0);var b=function(e){return Object(N.jsx)("div",{className:v({RadioButton:!0,checked:e.value}),onClick:function(){return e.onChange(!e.value)},children:e.children})},S=function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(l.a)(this,n);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).onHandleMouseDown=function(t){0===t.button&&(t.stopPropagation(),e.props.onDragStart(e.props.node.uid,t))},e.selfRef=i.a.createRef(),e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.props.onRectUpdate(this.props.node.uid,j(this.selfRef))}},{key:"componentDidUpdate",value:function(){this.props.onRectUpdate(this.props.node.uid,j(this.selfRef))}},{key:"render",value:function(){var e=this,t=this.props,n=t.node,o=Object(c.a)(n.position,2),i=o[0],s=o[1],a=n.text,r=Object(c.a)(t.anchor,2),d=r[0],u=r[1],l=t.dragging,h=t.linking,f=t.choosen,g=i+d,p=s+u;return Object(N.jsxs)("div",{className:v({MindNodeCard:!0,linking:h,dragging:l,choosen:f}),ref:this.selfRef,style:{left:"".concat(g,"px"),top:"".concat(p,"px")},onClick:function(t){return e.props.onClick(e.props.node.uid,t)},children:[Object(N.jsx)("div",{className:"handle",onMouseDown:this.onHandleMouseDown}),Object(N.jsxs)("div",{className:"wrapper",children:[Object(N.jsx)("div",{className:"text",children:a.split("\n").map((function(e,t){return Object(N.jsx)("p",{children:e},t)}))}),Object(N.jsxs)("div",{className:"tool-bar",children:[Object(N.jsx)(b,{value:h,onChange:function(){return e.props.onClickLinkButton(e.props.node.uid)},children:Object(N.jsx)("span",{children:"\ud83d\udd17"})},h?11:10),Object(N.jsx)(b,{value:f,onChange:function(t){return e.props.onClickChooseButton(e.props.node.uid,t)},children:Object(N.jsx)("span",{children:"\u2714"})},f?1:0)]})]})]})}}]),n}(o.Component),O=S,x=(n(23),function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){var o;return Object(l.a)(this,n),(o=t.call(this,e)).getBrief=function(e){var t=o.props.nodes.get(e);return t?"#"+e+"\uff1a"+t.text:"#"+e},o.state={inputingText:e.node.text},o}return Object(h.a)(n,[{key:"render",value:function(){var e=this,t=this.props.node,n=t.uid,o=t.position,i=t.outPorts,s=t.inPorts;return Object(N.jsxs)("div",{className:"MindNodeInfo",children:[Object(N.jsx)("div",{className:"top-bar"}),Object(N.jsxs)("div",{className:"content",children:[Object(N.jsxs)("p",{children:[Object(N.jsx)("span",{className:"title",children:"UID\uff1a"}),Object(N.jsxs)("span",{className:"text",children:["#",n]})]}),Object(N.jsxs)("p",{children:[Object(N.jsx)("span",{className:"title",children:"\u4f4d\u7f6e\uff1a"}),Object(N.jsxs)("span",{className:"text",children:["(",o.join(", "),")"]})]}),Object(N.jsx)("p",{children:Object(N.jsx)("span",{className:"title",children:"\u5185\u5bb9\uff1a"})}),Object(N.jsx)("textarea",{value:this.state.inputingText,onChange:function(t){return e.setText(t.target.value)}}),Object(N.jsxs)("p",{className:"title",children:["\u51fa\u7ebf\uff08",i.length,"\u4e2a\uff09\uff1a"]}),Object(N.jsx)("ol",{className:"text",children:i.map((function(t){return Object(N.jsx)("li",{className:"snapshot",children:e.getBrief(t)},t)}))}),Object(N.jsxs)("p",{className:"title",children:["\u5165\u7ebf\uff08",s.length,"\u4e2a\uff09\uff1a"]}),Object(N.jsx)("ol",{className:"text",children:s.map((function(t){return Object(N.jsx)("li",{className:"snapshot",children:e.getBrief(t)},t)}))})]})]})}},{key:"setText",value:function(e){this.setState((function(){return{inputingText:e}}));var t=Object(d.a)(Object(d.a)({},this.props.node),{},{text:e});this.props.onUpdate(t)}}]),n}(o.Component));function m(e,t){return[e[0]+t[0],e[1]+t[1]]}function k(e,t){return[e[0]-t[0],e[1]-t[1]]}var y=function(e){Object(f.a)(n,e);var t=Object(g.a)(n);function n(e){var o;return Object(l.a)(this,n),(o=t.call(this,e)).nodeCardRects=new Map,o.nodes=new Map,o.origin=[0,0],o.resetView=function(){var e,t=null===(e=o.poolRef.current)||void 0===e?void 0:e.getBoundingClientRect();if(t){o.origin=[t.width/2,t.height/2];var n=o.canvasRef.current;n&&(n.width=t.width,n.height=t.height),o.forceUpdate()}},o.poolRef=i.a.createRef(),o.canvasRef=i.a.createRef(),o.hideNodeInfoView=function(){return o.setState((function(){return{editingNodeUid:null}}))},o.createNode=function(){var e=o.state.uidCounter;o.setState((function(e){return{uidCounter:e.uidCounter+1}}));var t={uid:e,position:k([0,0],o.state.offset),text:"#".concat(e),outPorts:[],inPorts:[]};o.addNode(t)},o.linkingNodeUid=null,o.onClickNode=function(e,t){t.ctrlKey?o.toggleChooseNode(e):o.setState((function(){return{editingNodeUid:e}}))},o.onMouseDown=function(e){o.state.mouseState||(0===e.nativeEvent.button?o.onSectionChooseStart(e):1===e.nativeEvent.button&&o.onDragPoolStart(e))},o.onMouseMove=function(e){o.state.mouseState&&("dragNode"===o.state.mouseState?o.onDragNodeMove(e):"dragPool"===o.state.mouseState?o.onDragPool(e):"chooseNodes"===o.state.mouseState&&o.onSectionChooseMove(e))},o.onMouseUp=function(e){o.state.mouseState&&("dragNode"===o.state.mouseState?(o.onDragNodeMove(e),o.onDragNodeEnd(e)):"dragPool"===o.state.mouseState?o.onDragPoolEnd(e):"chooseNodes"===o.state.mouseState&&o.onSectionChooseEnd(e))},o.onMouseLeave=function(e){o.onMouseUp(e)},o.draggingNodeStartPositions=new Map,o.dragNodeStartMousePosition=[0,0],o.onDragNodeStart=function(e,t){o.setState((function(){return{mouseState:"dragNode"}})),o.dragNodeStartMousePosition=[t.screenX,t.screenY],[e].concat(Object(u.a)(Array.from(o.choosenNodeUids))).forEach((function(e){return p(o.nodes,e,(function(t){return o.draggingNodeStartPositions.set(e,t.position)}))}))},o.onDragNodeMove=function(e){if(o.draggingNodeStartPositions.size){for(var t=k([e.screenX,e.screenY],o.dragNodeStartMousePosition),n=function(){var e=Object(c.a)(s[i],2),n=e[0],a=m(e[1],t);p(o.nodes,n,(function(e){return o.updateNode(Object(d.a)(Object(d.a)({},e),{},{position:a}))}))},i=0,s=Array.from(o.draggingNodeStartPositions.entries());i<s.length;i++)n();o.updateStateNodes()}},o.onDragNodeEnd=function(e){o.draggingNodeStartPositions.size&&(o.draggingNodeStartPositions.clear(),o.updateStateNodes()),o.setState((function(){return{mouseState:null}}))},o.dragPoolStartOffset=[0,0],o.dragPoolStartMousePosition=[0,0],o.load=function(){try{var e=JSON.parse(o.state.dataString);o.nodes.clear(),o.nodeCardRects.clear(),o.draggingNodeStartPositions.clear(),o.choosenNodeUids.clear(),e.nodes.forEach((function(e){return o.nodes.set(e.uid,e)})),o.setState((function(){return{uidCounter:e.uidCounter,offset:e.offset,nodes:e.nodes}}))}catch(t){alert("\u89e3\u6790\u6570\u636e\u5931\u8d25\uff01")}},o.save=function(){var e=o.buildPool();o.setState((function(){return{dataString:JSON.stringify(e)}})),console.log(e)},o.choosenNodeUids=new Set,o.setNodeChoosen=function(e,t){console.log("setNodeChoosen",e,t),t?o.chooseNode(e):o.unchooseNode(e)},o.unchooseAllNodes=function(){o.choosenNodeUids.clear(),o.forceUpdate()},o.sectionChooseStartMousePosition=[0,0],o.state={uidCounter:0,nodes:[],offset:[0,0],editingNodeUid:null,mouseState:null,section:null,dataString:""},o}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.updateStateNodes(),this.drawLines(),window.addEventListener("resize",this.resetView),this.resetView()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resetView)}},{key:"componentDidUpdate",value:function(){this.drawLines()}},{key:"render",value:function(){var e=this;return Object(N.jsxs)("div",{className:"App",children:[this.renderTopBar(),Object(N.jsxs)("div",{className:"node-pool"+(this.draggingNodeStartPositions.size?" dragging":""),ref:this.poolRef,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseLeave,children:[Object(N.jsx)("canvas",{ref:this.canvasRef}),this.state.nodes.map((function(t){return Object(N.jsx)(O,{anchor:e.getAnchor(),node:t,linking:e.linkingNodeUid===t.uid,choosen:e.choosenNodeUids.has(t.uid),dragging:e.draggingNodeStartPositions.has(t.uid),onClick:e.onClickNode,onDragStart:e.onDragNodeStart,onRectUpdate:function(t,n){return e.nodeCardRects.set(t,n)},onClickLinkButton:function(t){return e.linkNode(t)},onClickChooseButton:e.setNodeChoosen},t.uid)})),this.renderSection(),this.renderNodeInfo()]}),this.renderBottomBar()]})}},{key:"getAnchor",value:function(){return m(this.origin,this.state.offset)}},{key:"getPoolFix",value:function(){return[(null===(e=j(this.poolRef))||void 0===e?void 0:e.x)||0,(null===e||void 0===e?void 0:e.y)||0];var e}},{key:"drawLines",value:function(){var e=function(e){var t=e.current;if(!t)return null;var n=t.getContext("2d");return n?[t,n]:null}(this.canvasRef);if(e){var t=Object(c.a)(e,2),n=t[0],o=t[1];o.clearRect(0,0,n.width,n.height),o.strokeStyle="#808080",o.fillStyle="#000000",o.lineWidth=3;for(var i=this.getPoolFix(),s=0,a=Array.from(this.nodes.values());s<a.length;s++){var d,l=a[s],h=j(this.nodeCardRects.get(l.uid)),f=Object(r.a)(l.outPorts);try{for(f.s();!(d=f.n()).done;){var g=d.value,v=this.nodes.get(g);if(v){var p=j(this.nodeCardRects.get(v.uid));o.beginPath(),o.moveTo.apply(o,Object(u.a)(h)),o.lineTo.apply(o,Object(u.a)(p)),o.stroke()}}}catch(N){f.e(N)}finally{f.f()}}}else console.log("Invalid canvas");function j(e){if(e){var t=e.x,n=e.y;return k([t+e.width/2,n+e.height/2],i)}return[0,0]}}},{key:"renderTopBar",value:function(){var e=this;return Object(N.jsxs)("div",{className:"top-bar",children:[Object(N.jsx)("button",{onClick:this.createNode,children:"\u65b0\u589e"}),Object(N.jsx)("button",{onClick:this.save,children:"\u4fdd\u5b58"}),Object(N.jsx)("button",{onClick:this.load,children:"\u8f7d\u5165"}),Object(N.jsx)("button",{onClick:this.unchooseAllNodes,children:"\u53d6\u6d88\u9009\u62e9"}),Object(N.jsx)("textarea",{value:this.state.dataString,placeholder:"\u5728\u6b64\u8f93\u5165/\u8f93\u51fa\u6570\u636e",onChange:function(t){return e.setState((function(){return{dataString:t.target.value}}))}})]})}},{key:"renderBottomBar",value:function(){return Object(N.jsxs)("div",{className:"bottom-bar",children:[Object(N.jsxs)("span",{className:"piece",children:["\u603b\u8282\u70b9\u6570\uff1a",this.state.nodes.length]}),Object(N.jsxs)("span",{className:"piece",children:["\u9009\u4e2d\u8282\u70b9\u6570\uff1a",this.choosenNodeUids.size]})]})}},{key:"renderNodeInfo",value:function(){var e=this,t=null!==this.state.editingNodeUid?this.nodes.get(this.state.editingNodeUid):null;return t?Object(N.jsxs)("div",{className:"node-info",children:[Object(N.jsx)("button",{className:"icon",onClick:this.hideNodeInfoView,children:">"}),Object(N.jsx)(x,{node:t,nodes:this.nodes,onUpdate:function(t){return e.updateNode(t)}},t.uid)]}):null}},{key:"renderSection",value:function(){var e=this.state.section;return e?Object(N.jsx)("div",{className:"section",style:{left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"px"}}):null}},{key:"addNode",value:function(e){this.nodes.set(e.uid,e),this.updateStateNodes()}},{key:"updateNode",value:function(e){this.nodes.set(e.uid,e),this.updateStateNodes()}},{key:"removeNode",value:function(e){this.nodes.delete(e),this.nodeCardRects.delete(e),this.choosenNodeUids.delete(e),this.draggingNodeStartPositions.delete(e),this.updateStateNodes()}},{key:"updateStateNodes",value:function(){var e=this;this.setState((function(){return{nodes:Array.from(e.nodes.values())}}))}},{key:"linkNode",value:function(e){var t=this.nodes.get(e);if(t)if(null!==this.linkingNodeUid){if(this.linkingNodeUid!==t.uid){var n=this.nodes.get(this.linkingNodeUid);if(n&&t){var o=new Set(n.outPorts),i=new Set(t.inPorts);o.has(t.uid)?(o.delete(t.uid),i.delete(n.uid)):(o.add(t.uid),i.add(n.uid)),n.outPorts=Array.from(o),t.inPorts=Array.from(i),this.updateStateNodes()}}this.linkingNodeUid=null}else this.linkingNodeUid=t.uid}},{key:"onDragPoolStart",value:function(e){this.setState((function(){return{mouseState:"dragPool"}})),this.dragPoolStartOffset=this.state.offset,this.dragPoolStartMousePosition=[e.screenX,e.screenY]}},{key:"onDragPool",value:function(e){var t=this;e.stopPropagation();var n=k([e.screenX,e.screenY],this.dragPoolStartMousePosition);this.setState((function(){return{offset:m(t.dragPoolStartOffset,n)}}))}},{key:"onDragPoolEnd",value:function(e){this.onDragPool(e),this.setState((function(){return{mouseState:null}}))}},{key:"buildPool",value:function(){return{uidCounter:this.state.uidCounter,offset:this.state.offset,nodes:Array.from(this.nodes.values())}}},{key:"toggleChooseNode",value:function(e){this.choosenNodeUids.has(e)?this.unchooseNode(e):this.chooseNode(e)}},{key:"chooseNode",value:function(e){this.choosenNodeUids.add(e),this.forceUpdate()}},{key:"unchooseNode",value:function(e){this.choosenNodeUids.delete(e),this.forceUpdate()}},{key:"onSectionChooseStart",value:function(e){this.setState((function(){return{mouseState:"chooseNodes"}})),this.sectionChooseStartMousePosition=[e.clientX,e.clientY]}},{key:"onSectionChooseMove",value:function(e){var t=this.getPoolFix(),n=k([e.clientX,e.clientY],t),o=k(this.sectionChooseStartMousePosition,t),i=Object(c.a)(o,2),s=i[0],a=i[1];this.setState((function(){return{section:{x:s,y:a,width:n[0]-s,height:n[1]-a}}}))}},{key:"onSectionChooseEnd",value:function(e){var t=this,n=[this.sectionChooseStartMousePosition[0],e.clientX].sort(),o=Object(c.a)(n,2),i=o[0],s=o[1],a=[this.sectionChooseStartMousePosition[1],e.clientY].sort(),r=Object(c.a)(a,2),d=r[0],u=r[1],l=Array.from(this.nodeCardRects.entries()).filter((function(e){var t=Object(c.a)(e,2)[1],n=t.x,o=t.y,a=t.width,r=t.height;return n>=i&&o>=d&&n+a<=s&&o+r<=u})).map((function(e){return Object(c.a)(e,1)[0]}));e.ctrlKey||this.choosenNodeUids.clear(),l.forEach((function(e){return t.choosenNodeUids.add(e)})),this.setState((function(){return{mouseState:null,section:null}}))}}]),n}(o.Component),C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,25)).then((function(t){var n=t.getCLS,o=t.getFID,i=t.getFCP,s=t.getLCP,a=t.getTTFB;n(e),o(e),i(e),s(e),a(e)}))};a.a.render(Object(N.jsx)(i.a.StrictMode,{children:Object(N.jsx)(y,{})}),document.getElementById("root")),C()}},[[24,1,2]]]);
//# sourceMappingURL=main.62ae5578.chunk.js.map
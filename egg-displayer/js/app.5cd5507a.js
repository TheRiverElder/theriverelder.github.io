(function(t){function e(e){for(var n,s,o=e[0],l=e[1],c=e[2],d=0,p=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&p.push(a[s][0]),a[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(p.length)p.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],n=!0,o=1;o<r.length;o++){var l=r[o];0!==a[l]&&(n=!1)}n&&(i.splice(e--,1),t=s(s.s=r[0]))}return t}var n={},a={app:0},i=[];function s(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=n,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;i.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";var n=r("85ec"),a=r.n(n);a.a},2587:function(t,e,r){},"452c":function(t,e,r){},"559d":function(t,e,r){},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[t.started?r("Displayer",{attrs:{script:t.script}}):r("GameLoader",{on:{"load-script":t.loadScript,"load-bundle":t.loadBundle,"start-game":t.startGame}})],1)},i=[],s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"full-wrapper displayer"},[r("div",{staticClass:"full-wrapper background-wrapper"},[r("transition",{attrs:{"enter-active-class":"animate__animated animate__fadeIn animate__fast","leave-active-class":"animate__animated animate__fadeOut animate__fast"}},[r("img",{key:t.background,staticClass:"background",attrs:{src:t.background,alt:t.currentNode.background}})]),r("transition",{attrs:{"enter-active-class":"animate__animated animate__slideInLeft animate__faster","leave-active-class":"animate__animated animate__slideOutRight animate__faster"}},["self"!==t.currentNode.role?r("img",{key:t.role,staticClass:"role",attrs:{src:t.role,alt:t.currentNode.role}}):t._e()])],1),r("div",{staticClass:"full-wrapper content"},[r("div",{staticClass:"scroll-wrapper option-list-wrapper"},[r("transition",{attrs:{mode:"out-in","enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__slideOutRight animate__faster"}},[r("div",{key:t.current,staticClass:"option-list"},t._l(t.options,(function(e,n){return r("div",{key:n,staticClass:"option-text",on:{click:function(r){return t.jump(e.target)}}},[t._v(t._s(e.text))])})),0)])],1),r("div",{staticClass:"node-text-wrapper"},[r("transition",{attrs:{mode:"out-in","enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__fadeOut animate__faster"}},[r("p",{key:t.current,staticClass:"node-text"},[t._v(t._s(t.currentNode.text))])])],1)])])},o=[],l=(r("b0c0"),r("77ed"),{name:"Displayer",components:{},props:{script:{type:Object,required:!0}},data:function(){return{current:null,background:null,role:null,roleName:""}},computed:{currentNode:function(){return this.script.nodes[this.current]||{text:"空节点",role:"",background:""}},options:function(){var t=this.currentNode;return this.currentNode.options||[{text:"...",target:t.target}]}},methods:{jump:function(t){var e=this.currentNode;"number"===typeof t?this.current=t:this.current++;var r=this.currentNode;if(e&&r)if(r.background&&e.background!==r.background&&(this.background=this.script.resources[r.background]),"self"===r.role)this.role=null,this.roleName="自己";else if(r.role&&e.role!==r.role){var n=this.script.roles[r.role];this.role=this.script.resources[n.pic],this.roleName=n.name}},log:function(t){console.log(t)}},mounted:function(){this.jump(0)}}),c=l,u=(r("64ef"),r("2877")),d=Object(u["a"])(c,s,o,!1,null,"747708dc",null),p=d.exports,f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"full-wrapper game-loader-wrapper"},[r("div",{staticClass:"game-loader shadow"},[r("div",{staticClass:"line"},[r("span",{staticClass:"title"},[t._v("输入脚本文件")]),t.selectedScript?r("span",{staticClass:"subtitle"},[t._v("输入成功【"+t._s(t.scriptName)+" v"+t._s(t.scriptVersion)+"】")]):t._e(),r("WideFileLoader",{attrs:{accept:".json",json:!0,placeholder:"/test/script.json"},on:{error:t.handleError,load:t.selectScript}})],1),r("div",{staticClass:"divider"}),r("div",{staticClass:"line"},[r("span",{staticClass:"title"},[t._v("输入存档文件")]),r("span",{staticClass:"subtitle"},[t._v("留空则会生成新的存档")]),t.selectedBundle?r("span",{staticClass:"subtitle"},[t._v("输入成功√")]):t._e(),r("WideFileLoader",{attrs:{accept:".json",json:!0},on:{error:t.handleError,load:t.selectBundle}})],1),r("div",{staticClass:"divider"}),r("div",{staticClass:"line tool-bar"},[r("button",{on:{click:t.start}},[t._v("开始")])])])])},m=[],h=(r("a623"),r("45fc"),r("b64b"),r("07ac"),r("53ca")),v=function(t){return"object"===Object(h["a"])(t)&&!Array.isArray(t)},_=function(t){return Array.isArray(t)},b=function(t){return null===t||void 0===t},g=function(t){return"string"===typeof t},y=function(t){return"number"===typeof t};function j(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t,r){return e.some((function(e){return e(t,r)}))}}function k(t){return function(e,r){return!!v(e)&&Object.keys(t).every((function(n){return t[n](e[n],r)}))}}function x(t){return function(e,r){return!!v(e)&&Object.values(e).every((function(e){return t(e,r)}))}}function O(t){return function(e,r){return!!_(e)&&e.every((function(e){return t(e,r)}))}}k({name:g,version:g,resources:x(g),roles:x(k({name:g,pic:g})),nodes:O(k({text:g,target:j(b,y),background:g,role:g,options:j(b,O(k({text:g,target:j(b,y)})))}))}),k({roles:x(k({pic:function(t,e){return!!e.resources[t]}})),nodes:O(k({role:j(b,(function(t,e){return!!e.roles[t]})),background:j(b,(function(t,e){return!!e.resources[t]}))}))});function w(t){return!0}function S(t,e){if(!t)return null;var r=new FileReader;r.onload=function(){try{var t=JSON.parse(r.result);e(t)}catch(n){e(null,"读取失败，可能不是JSON格式文件！")}},r.onerror=function(){return e(null,r.error)},r.readAsText(t)}function C(t,e){if(!t)return null;var r=new FileReader;r.onload=function(){return e(r.result)},r.onerror=function(){return e(null,r.error)},r.readAsText(t)}var N={name:"Test Script",version:"1.0.1",nodes:[{text:"你好!",target:1,background:"bg1",role:"lty"},{text:"And then ..."},{text:"Hello World!",options:[{text:"Hello JavaScript"},{text:"Hello JavaScript"}]}],roles:{lty:{name:"洛天依",pic:"pic_lty"},yzl:{name:"乐正绫",pic:"pic_yzl"}},resources:{pic_lty:"/test/assets/pic_lty.png",pic_yzl:"/test/assets/pic_yzl.png",bg1:"/test/assets/bg1.jpg",bg2:"/test/assets/bg2.jpg"}},$=N,B=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:"wide-file-loader"+(t.inline?" inline":"")},[r("div",{staticClass:"input-wrapper"},["checkbox"===(t.useUrl?"url":"file")?r("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],ref:"input",attrs:{accept:t.accept,placeholder:t.placeholder,type:"checkbox"},domProps:{checked:Array.isArray(t.url)?t._i(t.url,null)>-1:t.url},on:{change:function(e){var r=t.url,n=e.target,a=!!n.checked;if(Array.isArray(r)){var i=null,s=t._i(r,i);n.checked?s<0&&(t.url=r.concat([i])):s>-1&&(t.url=r.slice(0,s).concat(r.slice(s+1)))}else t.url=a}}}):"radio"===(t.useUrl?"url":"file")?r("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],ref:"input",attrs:{accept:t.accept,placeholder:t.placeholder,type:"radio"},domProps:{checked:t._q(t.url,null)},on:{change:function(e){t.url=null}}}):r("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],ref:"input",attrs:{accept:t.accept,placeholder:t.placeholder,type:t.useUrl?"url":"file"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}})]),r("div",{staticClass:"buttons"},[r("button",{on:{click:function(e){t.useUrl=!t.useUrl}}},[t._v(t._s(t.useUrl?"使用文件":"使用URL"))]),t.button?r("button",{attrs:{disabled:t.useUrl&&!t.url&&!t.placeholder},on:{click:t.load}},[t._v("确定")]):t._e()])])},A=[],U=r("bc3a"),P={name:"WideFileLoader",props:{disabled:{type:Boolean,default:!1},json:{type:Boolean,default:!1},accept:{type:String,default:"*/*"},inline:{type:Boolean,default:!1},button:{type:Boolean,default:!0},placeholder:{type:String,default:""}},data:function(){return{useUrl:!1,url:""}},methods:{load:function(){(this.useUrl?this.loadUrl:this.loadFile)()},loadFile:function(){var t=this,e=this.$refs.input.files[0];e||this.$emit("error","还未输入文件"),C(e,(function(e,r){return t.processData(e,r)}))},loadUrl:function(){var t=this;U["get"](this.url||this.placeholder).then((function(e){return t.processData(e.data)})).catch((function(e){return t.processData(null,e)}))},processData:function(t,e){if(e)this.$emit("error",e);else if(this.json)if("object"===Object(h["a"])(t))this.$emit("load",t);else try{var r=JSON.parse(t);r?this.$emit("load",r):this.$emit("error","解析JSON失败")}catch(n){this.$emit("error",n)}else"object"===Object(h["a"])(t)?this.$emit("load",JSON.stringify(t)):this.$emit("load",t)}}},J=P,L=(r("a984"),Object(u["a"])(J,B,A,!1,null,"075cdfc0",null)),F=L.exports,D={name:"GameLoader",components:{WideFileLoader:F},data:function(){return{selectedScript:!1,scriptName:null,scriptVersion:null,selectedBundle:!1}},methods:{handleError:function(t){alert(t)},useTestScript:function(){this.selectScript($)},selectScript:function(t){(w(t)||confirm("该脚本不符合规范，是否继续？"))&&(this.selectedScript=!0,this.scriptName=t.name,this.scriptVersion=t.version,this.$emit("load-script",t))},selectBundle:function(t){this.selectedBundle=!0,this.$emit("load-bundle",t)},load:function(){var t=this,e=this.$refs.scriptInput.files[0],r=this.$refs.bundleInput.files[0];S(e,(function(e,r){r?alert(r):t.selectScript(e)})),S(r,(function(e,r){r?alert(r):t.selectBundle(e)}))},start:function(){this.selectedScript?(this.selectedBundle||(alert("还未载入存档，将会自动生成存档。"),this.selectBundle({current:0})),this.$emit("start-game")):alert("还未载入脚本！")}}},E=D,T=(r("8983"),Object(u["a"])(E,f,m,!1,null,"264cc948",null)),I=T.exports,G={name:"App",components:{Displayer:p,GameLoader:I},data:function(){return{script:$,bundle:null,started:!1}},methods:{loadScript:function(t){this.script=t},loadBundle:function(t){this.bundle=t},startGame:function(){console.log("started",this.started),this.started=!0,console.log("started",this.started)}}},R=G,W=(r("034f"),r("b0a0"),Object(u["a"])(R,a,i,!1,null,null,null)),z=W.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(z)}}).$mount("#app")},"64ef":function(t,e,r){"use strict";var n=r("559d"),a=r.n(n);a.a},"85ec":function(t,e,r){},8983:function(t,e,r){"use strict";var n=r("c9a5"),a=r.n(n);a.a},a984:function(t,e,r){"use strict";var n=r("2587"),a=r.n(n);a.a},b0a0:function(t,e,r){"use strict";var n=r("452c"),a=r.n(n);a.a},c9a5:function(t,e,r){}});
//# sourceMappingURL=app.5cd5507a.js.map
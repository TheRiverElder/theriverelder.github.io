(function(t){function e(e){for(var n,r,o=e[0],c=e[1],l=e[2],v=0,p=[];v<o.length;v++)r=o[v],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&p.push(s[r][0]),s[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(p.length)p.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],n=!0,o=1;o<a.length;o++){var c=a[o];0!==s[c]&&(n=!1)}n&&(i.splice(e--,1),t=r(r.s=a[0]))}return t}var n={},s={app:0},i=[];function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/pl-editor/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("85ec"),s=a.n(n);s.a},"1a7b":function(t,e,a){},"1adf":function(t,e,a){"use strict";var n=a("9461"),s=a.n(n);s.a},"26a7":function(t,e,a){"use strict";var n=a("3019"),s=a.n(n);s.a},"2c20":function(t,e,a){"use strict";var n=a("adeb"),s=a.n(n);s.a},3019:function(t,e,a){},"4ab4":function(t,e,a){},"509b":function(t,e,a){},"51c7":function(t,e,a){"use strict";var n=a("509b"),s=a.n(n);s.a},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"app"}},[a("v-app-bar",{attrs:{app:"",color:"primary",height:"32","clipped-left":""}},[a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("文件")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:"",disabled:!t.tabs.length},on:{click:function(e){return t.saveTab(t.tabIndex)}}},[a("v-list-item-title",[t._v("保存当前项目")])],1),a("v-list-item",{attrs:{dense:"",disabled:!t.tabs.length},on:{click:t.saveAllTabs}},[a("v-list-item-title",[t._v("保存所有项目")])],1),a("v-divider"),a("v-list-item",{attrs:{dense:""},on:{click:t.downloadProject}},[a("v-list-item-title",[t._v("下载工程")])],1),a("v-list-item",{attrs:{dense:"",disabled:!t.script},on:{click:t.downloadScript}},[a("v-list-item-title",[t._v("下载脚本")])],1),a("v-list-item",{attrs:{dense:""},on:{click:t.cacheState}},[a("v-list-item-title",[t._v("缓存至浏览器")])],1),a("v-divider"),a("v-list-item",{attrs:{dense:""},on:{click:t.loadProjectFromCache}},[a("v-list-item-title",[t._v("从浏览器缓存载入工程")])],1),a("v-list-item",{attrs:{dense:""}},[a("v-list-item-title",{staticClass:"p-relative"},[t._v(" 从文件载入工程 "),a("input",{staticClass:"invisible-overlay",attrs:{type:"file"},on:{change:function(e){return t.loadProjectFromFile(e.target.files[0])}}})])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("工程")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:function(e){return t.compile("development")}}},[a("v-list-item-title",[t._v("编译为测试版")])],1),a("v-list-item",{attrs:{dense:"",disabled:""},on:{click:function(e){return t.compile("production")}}},[a("v-list-item-title",[t._v("编译为发行版")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("脚本")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:"",disabled:!t.script},on:{click:function(e){return t.open("demo")}}},[a("v-list-item-title",[t._v("开始测试")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("窗口")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:function(e){t.showNav=!t.showNav}}},[a("v-list-item-title",[t._v("开关导航栏")])],1),a("v-list-item",{attrs:{dense:""},on:{click:t.closeAll}},[a("v-list-item-title",[t._v("关闭所有标签")])],1)],1)],1),a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-btn",t._g(t._b({attrs:{dark:"",text:"",height:"32",tile:""}},"v-btn",s,!1),n),[t._v("帮助")])]}}])},[a("v-list",[a("v-list-item",{attrs:{dense:""},on:{click:function(e){return t.open("doc")}}},[a("v-list-item-title",[t._v("帮助文档")])],1)],1)],1),a("v-spacer"),a("v-subheader",{staticClass:"white--text"},[t._v("v2.4")])],1),t.showNav?a("v-navigation-drawer",{attrs:{app:"",permanent:"",clipped:""}},[a("v-list",[a("v-list-item",{on:{click:function(e){return t.open("base-info","base-info"+t.id)}}},[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-information-outline")])],1),a("v-list-item-title",[t._v("基础信息")])],1),a("v-list-item",{on:{click:function(e){return t.open("res-manager","res-manager"+t.id)}}},[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-folder-outline")])],1),a("v-list-item-title",[t._v("资源管理器")])],1),a("v-list-group",{scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-account-outline")])],1),a("v-list-item-subtitle",[t._v("角色")])]},proxy:!0}],null,!1,3000131414)},[t._l(t.roles,(function(e){return a("v-list-item",{key:e,on:{click:function(a){return t.open("role",e)}}},[a("v-list-item-avatar",{attrs:{color:"grey lighten-2"}},[a("v-img",{attrs:{src:t.data[t.data[e].avatar]}})],1),a("v-list-item-title",[t._v(t._s(t.data[e].name))])],1)})),a("v-list-item",[a("v-btn",{staticClass:"mx-auto",attrs:{text:"",color:"primary"},on:{click:t.createNewRole}},[t._v("新建角色")])],1)],2),a("v-list-group",{scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-avatar",[a("v-icon",[t._v("mdi-text")])],1),a("v-list-item-subtitle",[t._v("台词段")])]},proxy:!0}],null,!1,2461098671)},[t._l(t.chunks,(function(e){return a("v-list-item",{key:e,on:{click:function(a){return t.open("chunk",e)}}},[a("v-list-item-title",[t._v(t._s(t.data[e].title))])],1)})),a("v-list-item",[a("v-btn",{staticClass:"mx-auto",attrs:{text:"",color:"primary"},on:{click:t.createNewChunk}},[t._v("新建文本段")])],1)],2)],1)],1):t._e(),a("v-main",{staticClass:"fill-y"},[a("div",{staticClass:"fill-y flex-grow-1 d-flex flex-column"},[a("v-tabs",{staticClass:"flex-grow-0",attrs:{height:"2em"},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},t._l(t.tabs,(function(e,n){return a("v-tab",{key:e.id,attrs:{size:"small"}},[a("v-icon",{attrs:{small:""}},[t._v(t._s(e.icon))]),a("span",{staticClass:"mx-1"},[t._v(t._s(e.title))]),a("v-btn",{attrs:{"x-small":"",icon:""},on:{click:function(e){return t.close(n)}}},[a("v-icon",{attrs:{"x-small":""}},[t._v(t._s(e.dirty?"mdi-circle":"mdi-close"))])],1)],1)})),1),a("v-divider"),a("v-tabs-items",{staticClass:"fill-y inner-fill-y overflow-hidden inner-overflow-auto grey lighten-4 flex-grow-1",attrs:{"active-class":""},model:{value:t.tabIndex,callback:function(e){t.tabIndex=e},expression:"tabIndex"}},t._l(t.tabs,(function(e,n){return a("v-tab-item",{key:e.id,staticClass:"fill-y grey lighten-4"},[a(e.component,{ref:"tabs",refInFor:!0,tag:"component",staticClass:"edit-area",attrs:{id:e.id},on:{mutate:function(a){return t.markDirty(e)},delete:function(e){return t.close(n)}}})],1)})),1)],1)])],1)},i=[],r=(a("c740"),a("4160"),a("a434"),a("b0c0"),a("159b"),a("5530")),o=a("2f62"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{staticClass:"resource-manager d-flex flex-wrap",on:{dragover:function(e){t.overlay=!0},dragend:function(e){t.overlay=!1},drop:t.handleDrop}},[t._l(t.resources,(function(e){return a("Resouece",{key:e,staticClass:"resource ma-3",attrs:{uid:e,res:t.data[e]}})})),a("v-card",{staticClass:"resource ma-3 d-flex flex-column"},[a("div",{staticClass:"input-wrapper flex-grow-1 flex-shrink-1 d-flex justify-center align-center"},[a("v-icon",{attrs:{"x-large":""}},[t._v("mdi-file-multiple")]),a("input",{attrs:{type:"file",multiple:""},on:{change:t.inputFiles}})],1),a("v-card-subtitle",[t._v("拖拽或点击输入文件")])],1)],2)},l=[],u=(a("baa5"),a("fb6a"),a("b85c")),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{staticClass:"d-flex flex-column"},[a("v-img",{staticClass:"flex-shrink-1",attrs:{src:t.res.src,contain:""}}),a("v-card-title",{staticClass:"name"},[t.editName?a("v-text-field",{attrs:{"hide-details":"auto",dense:"","error-messages":t.errors},on:{blur:function(e){t.editName=!1},keydown:t.handleEnter},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}):a("span",{on:{click:function(e){t.editName=!0}}},[t._v(t._s(t.name))])],1),a("v-card-actions",[a("v-btn",{attrs:{icon:""},on:{click:function(e){return t.removeResource(t.id)}}},[a("v-icon",[t._v("mdi-delete")])],1),a("v-btn",{attrs:{icon:""}},[a("v-icon",[t._v("mdi-share")]),a("input",{ref:"btnReplace",staticClass:"fill",attrs:{type:"file"},on:{input:t.replaceRes}})],1)],1)],1)},p=[],d={name:"Resource",props:{res:Object},data:function(){return{id:this.res.id,name:this.res.name,src:this.res.src,type:this.res.type,editName:!1,errors:null}},watch:{name:function(t,e){this.errors=0===t.length?"名字不可为空":null,t!==e&&t&&this.updateData({id:this.id,name:t})},src:function(t,e){t!==e&&this.updateData({id:this.id,src:this.src,type:this.type})}},methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["removeResource","updateData"])),{},{replaceRes:function(t){var e,a=this,n=Object(u["a"])(t.target.files);try{var s=function(){var t=e.value,n=new FileReader;n.onload=function(){return Object.assign(a,{src:n.result,type:t.type})},n.readAsDataURL(t)};for(n.s();!(e=n.n()).done;)s()}catch(i){n.e(i)}finally{n.f()}},handleEnter:function(t){"Enter"===t.key&&(this.editName=!1,this.updateData({id:this.id,name:this.name}))}})},h=d,f=(a("ea04"),a("2877")),m=a("6544"),b=a.n(m),_=a("8336"),g=a("b0af"),x=a("99d9"),k=a("132d"),y=a("adda"),w=a("8654"),C=Object(f["a"])(h,v,p,!1,null,"df95f3c8",null),j=C.exports;b()(C,{VBtn:_["a"],VCard:g["a"],VCardActions:x["a"],VCardTitle:x["c"],VIcon:k["a"],VImg:y["a"],VTextField:w["a"]});var O={name:"ResourceManager",components:{Resouece:j},data:function(){return{overlay:!1}},computed:Object(r["a"])({},Object(o["c"])(["resources","data"])),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["createResource"])),{},{inputFiles:function(t){var e,a=this,n=Object(u["a"])(t.target.files);try{var s=function(){var t=e.value,n=t.name.lastIndexOf("."),s=n>=0?t.name.slice(0,n):t.name,i=new FileReader;i.onload=function(){return a.createResource({name:s,src:i.result,type:t.type})},i.readAsDataURL(t)};for(n.s();!(e=n.n()).done;)s()}catch(i){n.e(i)}finally{n.f()}},handleDrop:function(){this.overlay=!1},save:function(){}})},S=O,V=(a("d2a1"),a("a523")),I=Object(f["a"])(S,c,l,!1,null,"3dab9a01",null),T=I.exports;b()(I,{VCard:g["a"],VCardSubtitle:x["b"],VContainer:V["a"],VIcon:k["a"]});var $=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fill-y max-width-64em pa-5 d-flex"},[a("div",{staticClass:"form d-flex flex-column align-center"},[a("v-avatar",{attrs:{size:"160",color:"grey"}},[t.avatar?a("img",{attrs:{src:t.avatarUrl}}):a("span",{staticClass:"white--text text-h3"},[t._v(t._s(t.name.slice(0,2)))])]),a("v-text-field",{staticClass:"input flex-grow-0",attrs:{label:"名字",messages:"必填，最好不要超过三个中文",placeholder:"角色的名字"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("ResSelector",{staticClass:"flex-grow-0",attrs:{label:"头像",messages:"无实际用途，仅方便编辑"},model:{value:t.avatar,callback:function(e){t.avatar=e},expression:"avatar"}}),a("ResSelector",{staticClass:"flex-grow-0",attrs:{label:"立绘"},model:{value:t.pic,callback:function(e){t.pic=e},expression:"pic"}}),a("v-spacer"),a("v-btn",{attrs:{color:"warning"},on:{click:t.deleteSelf}},[a("v-icon",[t._v("mdi-delete")]),t._v(" 删除该角色 ")],1)],1),a("div",{staticClass:"img-wrapper flex-grow-1"},[a("img",{attrs:{src:t.picUrl}})])])},R=[],D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-select",{attrs:{label:t.label,messages:t.messages,placeholder:t.placeholder,"no-data-text":t.noDataText||"无可用资源",items:t.resList,"item-text":"name","item-value":"id"},on:{input:t.handleInput},model:{value:t.resId,callback:function(e){t.resId=e},expression:"resId"}})},E=[],N=(a("d81d"),{name:"ResSelector",props:{value:String,messages:[Array,String],label:String,placeholder:String,noDataText:String},data:function(){return{resId:this.value}},watch:{value:function(t){this.resId=t}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","resources"])),{},{resList:function(){var t=this;return this.resources.map((function(e){return t.data[e]}))}}),methods:{handleInput:function(){this.$emit("input",this.resId),this.changingRole=!1}}}),P=N,A=(a("1adf"),a("b974")),B=Object(f["a"])(P,D,E,!1,null,"6df42ebf",null),U=B.exports;b()(B,{VSelect:A["a"]});a("13d5");function L(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];return a.reduce((function(e,a){return e[a]=function(e,n){t&&(this[t][a]=e),e!==n&&this.$emit("mutate")},e}),{})}var F={name:"Role",components:{ResSelector:U},props:{id:String},data:function(){var t=this.$store.state.data[this.id];return{name:t.name,avatar:t.avatar,pic:t.pic}},watch:Object(r["a"])({},L(null,"name","avatar","pic")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data"])),{},{picUrl:function(){var t=this.data[this.pic];return t?t.src:null},avatarUrl:function(){var t=this.data[this.avatar];return t?t.src:null}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateData","removeRole"])),{},{deleteSelf:function(){this.removeRole(this.id),this.$emit("delete",this.id)},save:function(){this.updateData({id:this.id,name:this.name,avatar:this.avatar,pic:this.pic})}})},M=F,z=(a("51c7"),a("8212")),J=a("2fa4"),K=Object(f["a"])(M,$,R,!1,null,"79fd9c71",null),G=K.exports;b()(K,{VAvatar:z["a"],VBtn:_["a"],VIcon:k["a"],VSpacer:J["a"],VTextField:w["a"]});var X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chunk max-width-64em px-5"},[a("v-container",{staticClass:"pa-0 d-flex flex-column"},[a("div",{staticClass:"chunk-info px-5 pt-5 pb-0"},[a("img",{staticClass:"background",attrs:{cover:"",width:"100%",gradient:"#ffffffaf 0%, #ffffffaf 50%, #fff 100%",src:t.backgroundUrl}}),a("div",{staticClass:"text-right ma-1",on:{mouseleave:function(e){t.openMenu=!1}}},[a("v-slide-x-reverse-transition",[a("span",{directives:[{name:"show",rawName:"v-show",value:t.openMenu,expression:"openMenu"}]},[a("v-btn",{attrs:{small:"",text:"",color:"warning"},on:{click:t.deleteSelf}},[a("v-icon",[t._v("mdi-delete")]),t._v("删除 ")],1)],1)]),a("v-app-bar-nav-icon",{on:{click:function(e){t.openMenu=!t.openMenu}}})],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("标题")]),a("v-col",{attrs:{cols:"10"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"text-h4",attrs:{type:"text",placeholder:"此处输入标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})])],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("副标题")]),a("v-col",{attrs:{cols:"10"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.subtitle,expression:"subtitle"}],staticClass:"text-subtitle-1",attrs:{type:"text",placeholder:"此处输入副标题"},domProps:{value:t.subtitle},on:{input:function(e){e.target.composing||(t.subtitle=e.target.value)}}})])],1),a("v-row",{attrs:{align:"baseline"}},[a("v-col",{attrs:{cols:"2"}},[t._v("背景")]),a("v-col",{attrs:{cols:"10"}},[a("ResSelector",{attrs:{placeholder:"选择背景"},model:{value:t.background,callback:function(e){t.background=e},expression:"background"}})],1)],1),a("v-expand-transition",[t.openExits?a("v-container",{staticClass:"py-0"},[a("v-subheader",[t._v("出口列表")]),t._l(t.exits,(function(e,n){return a("v-row",{key:n},[a("v-col",{attrs:{cols:"1"}},[t._v(t._s(n+1))]),a("v-col",{attrs:{cols:"8"}},[a("v-text-field",{attrs:{label:"选项文本",dense:"","hide-details":""},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"exit.text"}})],1),a("v-col",{attrs:{cols:"2"}},[a("v-select",{attrs:{label:"目标",dense:"","hide-details":"",items:t.chunkList,"item-text":"title","item-value":"id"},model:{value:e.target,callback:function(a){t.$set(e,"target",a)},expression:"exit.target"}})],1),a("v-col",{attrs:{cols:"1"}},[a("v-btn",{attrs:{small:"",color:"warning",text:""},on:{click:function(e){return t.deleteExit(n)}}},[t._v("删除")])],1)],1)})),a("v-row",[a("v-btn",{staticClass:"mx-auto",attrs:{text:""},on:{click:t.addExit}},[t._v("新出口")])],1)],2):t._e()],1),a("v-btn",{attrs:{text:"",bottom:"",block:""},on:{click:function(e){t.openExits=!t.openExits}}},[a("v-icon",[t._v(t._s(t.openExits?"mdi-chevron-up":"mdi-chevron-down"))])],1)],1)]),a("v-divider"),a("div",{staticClass:"content"},t._l(t.sections,(function(e,n){return a("Section",{key:n,ref:"section",refInFor:!0,attrs:{index:n,section:e,"is-only":1===t.sections.length},on:{"add-line":t.addLine,"delete-line":t.deleteLine,focus:t.focusOnSection,mutate:function(e){return t.$emit("mutate")}}})})),1),a("v-row",{staticClass:"flex-grow-0 pa-2"},[a("v-btn",{ref:"btnAdd",staticClass:"mx-auto",attrs:{color:"primary",elevation:"0"},on:{click:t.addLine}},[a("v-icon",[t._v("mdi-plus")]),t._v("新小节 ")],1)],1)],1)},H=[],q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"section d-flex align-start",attrs:{align:"start"},on:{mouseenter:function(e){t.showBtnBar=!0},mouseleave:function(e){t.showBtnBar=!1}}},[a("span",{staticClass:"mt-2 d-flex align-center"},[a("span",{staticClass:"line-number text-subtitle-2 mr-3"},[t._v(t._s(t.index+1))]),a("span",{staticClass:"speaker"},[a("RoleSelector",{model:{value:t.speaker,callback:function(e){t.speaker=e},expression:"speaker"}})],1),a("span",[t._v(":")])]),a("span",{staticClass:"text mx-2 flex-grow-1",on:{click:t.focus}},[t.editText?a("v-textarea",{ref:"textInput",staticClass:"text-input py-1",attrs:{rows:"1","auto-grow":"",dense:"","hide-details":""},on:{keyup:t.handleInputKey,blur:function(e){t.editText=!1}},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}):t._l(t.lines,(function(e,n){return a("p",{key:n,staticClass:"pt-2 mb-0"},[t._v(t._s(e))])}))],2),a("v-expand-x-transition",[t.showBtnBar&&!t.editText?a("v-btn-toggle",{staticClass:"btn-tgl mt-2",attrs:{dense:"",rounded:"",borderless:""}},[a("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"2em",color:"green"},on:{click:function(e){return t.$emit("add-line",t.index)}}},[a("v-icon",[t._v("mdi-plus")])],1),t.isOnly?t._e():a("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"2em",color:"red"},on:{click:function(e){return t.$emit("delete-line",t.index)}}},[a("v-icon",[t._v("mdi-minus")])],1)],1):t._e()],1)],1)},Q=[],W=(a("4de4"),a("a9e3"),a("ac1f"),a("1276"),a("498a"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.changingRole?a("span",{staticClass:"role",on:{blur:function(e){t.changingRole=!1}}},[a("v-select",{attrs:{dense:"","hide-details":"",items:t.roleList,"item-text":"name","item-value":"id","no-data-text":"无可用角色"},on:{input:t.handleInput},model:{value:t.roleUid,callback:function(e){t.roleUid=e},expression:"roleUid"}})],1):a("span",{staticClass:"role d-flex align-center",on:{click:function(e){t.changingRole=!0}}},[a("RAvatar",{attrs:{size:"2em",contain:"",src:t.rolePicUrl}}),a("span",[t._v(t._s(t.roleName))])],1)}),Y=[],Z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-avatar",{attrs:{size:t.size}},[t.src?a("v-img",{attrs:{src:t.src,contain:""}}):a("v-icon",{attrs:{size:"normal"}},[t._v(t._s(t.emptyIcon))])],1)},tt=[],et={name:"RAvatar",props:{src:String,size:{type:[String,Number],default:"1em"},emptyIcon:{type:String,default:"mdi-account-alert-outline"}},data:function(){return{text:this.value}}},at=et,nt=Object(f["a"])(at,Z,tt,!1,null,"651caef7",null),st=nt.exports;b()(nt,{VAvatar:z["a"],VIcon:k["a"],VImg:y["a"]});var it={name:"RoleSelector",components:{RAvatar:st},props:{value:String},data:function(){return{changingRole:!1,roleUid:this.value}},watch:{value:function(t){this.roleUid=t}},computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["roles","data","resources"])),{},{roleList:function(){var t=this;return this.roles.map((function(e){return t.data[e]}))},roleName:function(){if(this.roleUid){var t=this.data[this.roleUid];return t.name}return""},rolePicUrl:function(){if(this.roleUid){var t=this.data[this.roleUid];if(t){var e=this.data[t.avatar||t.pic];if(e)return e.src}}return null}}),methods:{handleInput:function(){this.$emit("input",this.roleUid),this.changingRole=!1}}},rt=it,ot=(a("d795"),Object(f["a"])(rt,W,Y,!1,null,"6dc2f815",null)),ct=ot.exports;b()(ot,{VSelect:A["a"]});var lt={name:"Section",components:{RoleSelector:ct},props:{index:Number,section:Object,isOnly:Boolean},data:function(){return{speaker:this.section.speaker,text:this.section.text,showBtnBar:!1,editText:!1}},watch:Object(r["a"])({},L("section","speaker","text")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data"])),{},{lines:function(){return this.text.split("\n").filter((function(t){return!/^\s*$/.test(t)})).map((function(t){return t.trim()}))},speakerName:function(){if(this.speaker){var t=this.data[this.speaker];if(t&&t.pic)return t.name}return"      "},speakerPicUrl:function(){if(this.speaker){var t=this.data[this.speaker];if(t){var e=this.data[t.avatar||t.pic];if(e)return e.src}}return null}}),methods:{focus:function(){var t=this;this.editText?this.$refs.textInput.focus():(this.editText=!0,this.$nextTick((function(){return t.$refs.textInput.focus()})))},handleInputKey:function(t){var e=!0;if(t.ctrlKey){switch(t.key){case"Enter":this.$emit("add-line",this.index+1);break;case"ArrowUp":this.$emit("focus",this.index-1);break;case"ArrowDown":this.$emit("focus",this.index+1);break;case"Backspace":/^\s*$/.test(this.section.text)&&this.$emit("delete-line",this.index);break;default:e=!1}e&&t.preventDefault()}}}},ut=lt,vt=(a("2c20"),a("a609")),pt=a("0789"),dt=a("a844"),ht=Object(f["a"])(ut,q,Q,!1,null,"4550ed76",null),ft=ht.exports;b()(ht,{VBtn:_["a"],VBtnToggle:vt["a"],VExpandXTransition:pt["b"],VIcon:k["a"],VTextarea:dt["a"]});var mt={name:"Chunk",components:{Section:ft,ResSelector:U},props:{id:String},data:function(){var t=this.$store.state.data[this.id];return{title:t.title,subtitle:t.subtitle,background:t.background,sections:t.sections,exits:t.exits,openMenu:!1,openExits:!1}},watch:Object(r["a"])({},L(null,"title","subtitle","background")),computed:Object(r["a"])(Object(r["a"])({},Object(o["c"])(["data","chunks"])),{},{chunkList:function(){var t=this;return this.chunks.map((function(e){return t.data[e]}))},backgroundUrl:function(){if(this.background){var t=this.data[this.background];return t?t.src:null}return null}}),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["removeChunk","updateData"])),{},{addLine:function(t){var e=this;("number"!==typeof t||t<0||t>this.sections.length)&&(t=this.sections.length);var a=t?this.sections[t-1].speaker:null,n={speaker:a,text:""};this.sections.splice(t,0,n),this.$emit("mutate"),this.$nextTick((function(){return e.focusOnSection(t)}))},deleteLine:function(t){var e=this;this.sections.splice(t,1),this.$emit("mutate"),this.$nextTick((function(){return e.focusOnSection(t-1)}))},addExit:function(){this.exits.push({text:"",target:null}),this.$emit("mutate")},deleteExit:function(t){this.exits.splice(t,1),this.$emit("mutate")},deleteSelf:function(){this.removeChunk(this.id),this.$emit("delete",this.id)},focusOnSection:function(t){t=Math.max(0,Math.min(t,this.sections.length-1));var e=this.$refs.section;e.length&&t<e.length&&e[t].focus()},save:function(){this.updateData({id:this.id,title:this.title,subtitle:this.subtitle,background:this.background,sections:this.sections,exits:this.exits})}})},bt=mt,_t=(a("e6ac"),a("5bc1")),gt=a("62ad"),xt=a("ce7e"),kt=a("0fd9"),yt=a("e0c7"),wt=Object(f["a"])(bt,X,H,!1,null,"5535b8f3",null),Ct=wt.exports;b()(wt,{VAppBarNavIcon:_t["a"],VBtn:_["a"],VCol:gt["a"],VContainer:V["a"],VDivider:xt["a"],VExpandTransition:pt["a"],VIcon:k["a"],VRow:kt["a"],VSelect:A["a"],VSlideXReverseTransition:pt["d"],VSubheader:yt["a"],VTextField:w["a"]});var jt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[a("v-text-field",{attrs:{label:"剧本名称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("v-text-field",{attrs:{label:"版本"},model:{value:t.version,callback:function(e){t.version=e},expression:"version"}}),a("v-combobox",{attrs:{chips:"",multiple:"","deletable-chips":"",label:"作者"},model:{value:t.authors,callback:function(e){t.authors=e},expression:"authors"}})],1)},Ot=[],St={name:"BaseInfo",data:function(){return{name:this.$store.state.name,version:this.$store.state.version,authors:this.$store.state.authors}},watch:Object(r["a"])({},L(null,"name","version","authors")),methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateBaseInfo"])),{},{save:function(){this.updateBaseInfo({name:this.name,version:this.version,authors:this.authors})},update:function(){this.name=this.$store.state.name,this.version=this.$store.state.version,this.authors=this.$store.state.authors}})},Vt=St,It=a("2b5d"),Tt=Object(f["a"])(Vt,jt,Ot,!1,null,null,null),$t=Tt.exports;b()(Tt,{VCombobox:It["a"],VContainer:V["a"],VTextField:w["a"]});var Rt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Dt=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"pa-5"},[a("div",{attrs:{id:"write"}},[a("h1",[a("a",{staticClass:"md-header-anchor",attrs:{name:"江奶奶的galgame编辑器食用指南"}}),a("span",[t._v("江奶奶的Galgame编辑器食用指南")])]),a("h2",[a("a",{staticClass:"md-header-anchor",attrs:{name:"基本概念"}}),a("span",[t._v("基本概念")])]),a("p",[a("span",[t._v("首先，与该编辑器与播放器（虽然还没完成）的用户有三个身份：开发者、作者、玩家：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("开发者")])]),a("span",[t._v("：顾名思义，就是开发这个编辑器的人，当前只有江奶奶；")])]),a("li",[a("strong",[a("span",[t._v("作者")])]),a("span",[t._v("：编辑剧本的作者，一般用的是编辑器；")])]),a("li",[a("strong",[a("span",[t._v("玩家")])]),a("span",[t._v("：当一个作者完成一个剧本之后，游玩剧本的人，用的一般是播放器。")])])]),a("p",[a("span",[t._v("在本编辑器，工程由三种主要数据构成：资源、角色、文本段。")])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"资源"}}),a("span",[t._v("资源")])]),a("p",[a("span",[t._v("这里的资源，指的主要是多媒体资源，如：")])]),a("ul",[a("li",[a("span",[t._v("以")]),a("code",[t._v(".png")]),a("span",[t._v("或")]),a("code",[t._v(".jpg")]),a("span",[t._v("等结尾的图片文件，")])]),a("li",[a("span",[t._v("以")]),a("code",[t._v(".ogg")]),a("span",[t._v("或")]),a("code",[t._v(".mp3")]),a("span",[t._v("等结尾的音频文件，")])]),a("li",[a("span",[t._v("以")]),a("code",[t._v(".mp4")]),a("span",[t._v("或")]),a("code",[t._v(".wmv")]),a("span",[t._v("等结尾的视频文件。")])])]),a("p",[a("span",[t._v("该数据包含了三个主要字段：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("名字")])]),a("span",[t._v("：一个资源的名字，但是这只是用于作者识别的，对于程序来说识别的标识是其ID，这在编译过程中会被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("内容")])]),a("span",[t._v("：这一般是作者从本地上传的上述多媒体文件的内容，要注意，如果文件过大，会导致内存占用过多。")])])]),a("p",[a("span",[t._v("对于已有资源，其名字是可以改变的，其内容也是可以改变的。但是要知道，如果一个资源被删除，而后又新建了一个相同名字的资源的话，哪怕内容是一样的，也会")]),a("strong",[a("span",[t._v("被认为是不同的资源")])]),a("span",[t._v("！所以删除资源前请三思。")])]),a("p",[a("strong",[a("span",[t._v("注意")])]),a("span",[t._v("：")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("人物立绘请使用")]),a("strong",[a("span",[t._v("png")])]),a("span",[t._v("格式图片，因为该格式允许角色以外的空白部分呈现透明状态；")])]),a("li",[a("span",[t._v("暂时")]),a("strong",[a("span",[t._v("不支持视频")])]),a("span",[t._v("格式的使用，虽然你可以导入，但是这会导致大量的内存消耗，而且并不能用于剧本的编写；")])]),a("li",[a("span",[t._v("音频也")]),a("strong",[a("span",[t._v("暂不支持")])]),a("span",[t._v("，因为音频功能虽然计划加入，但是目前还没完成这部分的功能。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"角色"}}),a("span",[t._v("角色")])]),a("p",[a("span",[t._v("作为一个Galgame的角色，该数据包含了三个主要字段：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("名字")])]),a("span",[t._v("：一般来说，一个角色都会有名字，但是并不一定是一个名字对应一个角色（角色的）；")])]),a("li",[a("strong",[a("span",[t._v("头像")])]),a("span",[t._v("：这个头像仅仅作为编辑器中方便作者直观地分辨角色的附属功能，会在编译为脚本的时候被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("立绘")])]),a("span",[t._v("：不用多说，要注意的是制作的时候，要注意统一画布大小，否则可能会出现大小以及像素的失真情况。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"文本段"}}),a("span",[t._v("文本段")])]),a("p",[a("span",[t._v("这是一个江奶奶捏造的概念，如“文本段”这三个字一样，就是指文本段落，是一堆文本的合集。一个文本段相当于一般意义上的章节，包含一段完整或不完整的故事，但是同时又不太一样，因为一个文本段内，只能使用在一张背景。其长短没有指定，可以由几千行，也可以只有寥寥几行。")])]),a("p",[a("span",[t._v("这个数据结构，有以下几个重要字段：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("标题")])]),a("span",[t._v("：这是作者识别文本段的内容的标识，这在编译过程中会被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("副标题")])]),a("span",[t._v("：目前仅仅是作为标题的注释一般，通常不必在意，这在编译过程中会被舍弃；")])]),a("li",[a("strong",[a("span",[t._v("背景")])]),a("span",[t._v("：目前一个文本段只能由一张背景，一图流走到底，相当于")]),a("strong",[a("span",[t._v("传统")])]),a("span",[t._v("舞台上的一个场景，不到拉幕就不会改变；")])]),a("li",[a("del",[a("strong",[a("span",[t._v("BGM")])]),a("span",[t._v("：背景音乐，没什么好说的，在一整个文本段持续的时间中都会循环播放该音频，该功能尚不完善，请忽略；")])])]),a("li",[a("strong",[a("span",[t._v("小节列表")])]),a("span",[t._v("：这是一个小节的有序列表，在玩家游玩的时候每一个小节会依序被显示在屏幕上，关于小节的详情见下文；")])]),a("li",[a("strong",[a("span",[t._v("出口列表")])]),a("span",[t._v("：这是一个出口的集合，关于出口的详情见下文；")])])]),a("h4",[a("a",{staticClass:"md-header-anchor",attrs:{name:"小节"}}),a("span",[t._v("小节")])]),a("p",[a("span",[t._v("一个小节主要由发言者与台词文本组成。发言者是从已有的角色中选择的一个，而台词文本是一段文字。")])]),a("p",[a("span",[t._v("关于台词文本，一个小节中的台词文本可以有多句组成，每行文本都会被视为一句台词，相当于是这个发言者连续说了多句台词。")])]),a("h4",[a("a",{staticClass:"md-header-anchor",attrs:{name:"出口"}}),a("span",[t._v("出口")])]),a("p",[a("span",[t._v("在游戏中，若一个文本段被播放完毕，这时候一般是场景的切换，或者玩家的选择，而可供玩家可以选择的选项就被称为这个文本段的出口。一个出口会对应一个文本段，该文本段将会在玩家选择了该出口后开始播放。")])]),a("p",[a("span",[t._v("每个出口都会有一段文本，用于提供给玩家进行选择，或者说是一种提示，而其会有一个与其相对应的目标，这个目标是从已经存在的文本段中选取的其中一个。")])]),a("p",[a("span",[t._v("附注：无论是资源、角色、文本段，都是以一个用户看不到的ID号码作为其唯一标识，所以哪怕是名字相同的资源、角色，也是被视为不同的两个或多个对象。")])]),a("h2",[a("a",{staticClass:"md-header-anchor",attrs:{name:"食用步骤"}}),a("span",[t._v("食用步骤")])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"完善基础信息"}}),a("span",[t._v("完善基础信息")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("基础信息")]),a("span",[t._v("项目；")])]),a("li",[a("span",[t._v("按照提示填补完善信息，完成后你会发现编辑面板上方（也就是菜单栏下方）的，该项目标签的文字右侧有一个实心原点，这代表该项目还未保存，此时按下")]),a("code",[t._v("ctrl + S")]),a("span",[t._v("保存当前项目，或者按下")]),a("code",[t._v("ctrl + shift + S")]),a("span",[t._v("保存所有项目，或者在菜单栏的")]),a("code",[t._v("文件")]),a("span",[t._v("下找到相应操作;")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"准备资源"}}),a("span",[t._v("准备资源")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("资源管理器")]),a("span",[t._v("项目；")])]),a("li",[a("span",[t._v("准备好图片资源（毕竟现在也只支持图片资源XD），如头像、立绘、背景等；")])]),a("li",[a("span",[t._v("将它们从电脑的资源管理器中拖入那个写有“拖拽或点击输入文件”且有文件图标的小框中，或者点击文件图标输入文件（推荐后者）；")])]),a("li",[a("span",[t._v("拖进来后，在面板中会出现刚才拖入的资源，它们会自动根据文件名设置好自己的名字，如果不满意，可以自己修改名字，点击一下名字即可开始编辑，按下")]),a("code",[t._v("Enter")]),a("span",[t._v("键或者点击输入框以外的位置完成编辑；")])]),a("li",[a("span",[t._v("如果有一些资源不满意，可以点击下方第二个按钮（总之不是那个长的像垃圾桶的就对了），然后重新输入文件（由于作用域的问题，请尽量点击图标正中）；")])]),a("li",[a("span",[t._v("当你想要删除一些不必要的资源的时候，只要点击下方的垃圾桶图标即可，注意，")]),a("strong",[a("span",[t._v("这是不可逆的")])]),a("span",[t._v("。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"创建角色"}}),a("span",[t._v("创建角色")])]),a("p",[a("span",[t._v("当你设置完一些基础的素材后，便可以开始创建自己游戏中的角色了。")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("角色")]),a("span",[t._v("项目，展开角色列表；")])]),a("li",[a("span",[t._v("点击最下边的")]),a("code",[t._v("新建角色")]),a("span",[t._v("按键，而后在右边就会打开这个新建角色的编辑面板（如果没有自动打开的话，就点一下列表中的角色）；")])]),a("li",[a("span",[t._v("编辑名字，选择头像，选择立绘；")])]),a("li",[a("span",[t._v("编辑完成后，保存该项目；")])]),a("li",[a("span",[t._v("若想要删除该角色，只需要按下那个醒目的")]),a("code",[t._v("删除该角色")]),a("span",[t._v("按钮即可，注意，")]),a("strong",[a("span",[t._v("这是不可逆的")])]),a("span",[t._v("！")])]),a("li",[a("span",[t._v("想要关闭该项目，仅需在标签栏中关闭该项目的标签即可。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"编辑文本段"}}),a("span",[t._v("编辑文本段")])]),a("p",[a("span",[t._v("连角色也创建好后，就可以正式开始写作了（其实之前的不做也没关系，大不了留空XD）。这也是这个编辑过程的重头戏。")])]),a("ol",{attrs:{start:""}},[a("li",[a("span",[t._v("点击左边导航栏的")]),a("code",[t._v("文本段")]),a("span",[t._v("项目，展开文本段列表；")])]),a("li",[a("span",[t._v("点击最下边的")]),a("code",[t._v("新建文本段")]),a("span",[t._v("按键，而后在右边就会打开这个新建文本段的编辑面板；")])]),a("li",[a("span",[t._v("在编辑界面可以看到标题、副标题、背景的编辑区域，这些在上文已经介绍过了，按照所想编辑即可；")])]),a("li",[a("span",[t._v("在背景的输入框下面，你还能看到一个“新出口”按键，这个先跳过，这在之后再使用；")])]),a("li",[a("span",[t._v("点击下方的")]),a("code",[t._v("新小节")]),a("span",[t._v("按键，会在该按键上方多出一行小节面板；")])]),a("li",[a("span",[t._v("在小节面板的左边是序号，而后是发言者，如果之前有创建角色并保存的话，这里就可以选择需要的角色，选择好后，其头像和名字将会显示出来（如果没有头像，则会用立绘代替头像显示）；")])]),a("li",[a("span",[t._v("在发言者设置好后，再往右，就是文本框了，这里作者可以输入一行或多行文本，每一行都会被作为单独的台词呈现（游戏中同屏只会出现一句台词）；")])]),a("li",[a("span",[t._v("如果鼠标位于该小节的编辑面板中的话，就会出现两个按钮：")]),a("code",[t._v("+")]),a("span",[t._v("与")]),a("code",[t._v("-")]),a("span",[t._v("，按下")]),a("code",[t._v("+")]),a("span",[t._v("按键，则可以在该小节")]),a("strong",[a("span",[t._v("前")])]),a("span",[t._v("插入新的小节，按下")]),a("code",[t._v("-")]),a("span",[t._v("按键则会删除该小节；")])]),a("li",[a("span",[t._v("而后重复上述操作，知道该文本段编写完毕，然后与编辑角色时候一样保存即可；")])]),a("li",[a("span",[t._v("现在开始编辑出口，点击")]),a("code",[t._v("新出口")]),a("span",[t._v("按键，会出现一行新的出口面板，从左到右是：序号、文本输入框、目标选择框、删除按键，基本一看就懂，要注意文本框只能输入一行文本，目标选择框可以选择该出口对应的下一个文本段；")])]),a("li",[a("span",[t._v("若要删除文本段，则点击右上角的三道杠按钮，然后会出现")]),a("code",[t._v("删除")]),a("span",[t._v("按钮，点击该按钮即可删除文本段，注意，")]),a("strong",[a("span",[t._v("这是不可逆的")])]),a("span",[t._v("！")])]),a("li",[a("span",[t._v("想要关闭该项目，仅需在标签栏中关闭该项目的标签即可。")])])]),a("p",[a("span",[t._v("另外，在编辑小节的文本的时候，")])]),a("ul",[a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + Enter")]),a("span",[t._v("，则是自动在该小节后插入一个新的小节，并聚焦到这个新的小节上；")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + BackSpace")]),a("span",[t._v("且该小节文本都是空的（或者由空字符组成），则该小节将被删除并聚焦到上一个小节（如果存在的话）；")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + ArrowUp")]),a("span",[t._v("，则聚焦到上一个小节（如果存在的话）；")])]),a("li",[a("span",[t._v("按下")]),a("code",[t._v("ctrl + ArrowDown")]),a("span",[t._v("，则聚焦到下一个小节（如果存在的话）。")])])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"持久化"}}),a("span",[t._v("持久化")])]),a("p",[a("span",[t._v("编辑过程中有两个概念：工程与脚本：")])]),a("ul",[a("li",[a("strong",[a("span",[t._v("工程")])]),a("span",[t._v("：这是作者写作时候，用编辑器编辑的工程文件，并不能直接游玩；")])]),a("li",[a("strong",[a("span",[t._v("脚本")])]),a("span",[t._v("：当一个作者完成一个剧本之后，会将其编译为脚本，而后可以在播放器或者编辑器自带的测试面板中游玩。")])])]),a("p",[a("span",[t._v("之前的保存操作，其实是将内容缓存到了浏览器自带的一个叫做")]),a("code",[t._v("LocalStorage")]),a("span",[t._v("的地方，如果浏览器清理缓存，或者更换了新的计算机、新的浏览器、新的域名，那么该数据就找不到了。所以为了更好的持久化，还是要将工程下载到能看得到的地方。")])]),a("p",[a("span",[t._v("所以在菜单栏下点击")]),a("code",[t._v("文件")]),a("span",[t._v("下的")]),a("code",[t._v("下载工程")]),a("span",[t._v("或者")]),a("code",[t._v("下载脚本")]),a("span",[t._v("完成相应操作，要注意，")]),a("code",[t._v("下载脚本")]),a("span",[t._v("按键只有在有已经编译完成的脚本时候才可用。当你下一次想要在别的计算机或者浏览器载入工程的时候，只要有改文件即可载入。")])]),a("h3",[a("a",{staticClass:"md-header-anchor",attrs:{name:"编译"}}),a("span",[t._v("编译")])]),a("p",[a("span",[t._v("想要最终得到一个可以游玩的脚本，就需要这个叫做编译的过程。它将一个工程内的数据进行整理、编号、排序、简化、链接，最终得到一份可以游玩的游戏脚本文件。在菜单栏下点击")]),a("code",[t._v("工程")]),a("span",[t._v("下的")]),a("code",[t._v("编译为测试版")]),a("span",[t._v("完成相应操作。编译后的脚本将会缓存在内存中，如果不下载，那么在浏览器关闭，甚至该页面关闭之后，该脚本就会消失，但是这并不可怕，由于工程还在，所以只要重新编译即可。可以在在菜单栏下点击")]),a("code",[t._v("文件")]),a("span",[t._v("下的")]),a("code",[t._v("下载脚本")]),a("span",[t._v("以下载编译好的脚本。")])]),a("h2",[a("a",{staticClass:"md-header-anchor",attrs:{name:"最后"}}),a("span",[t._v("最后")])]),a("blockquote",[a("p",[a("span",[t._v("子未曰：“Hava a gada daya!”")])])])])])}],Et={},Nt=Object(f["a"])(Et,Rt,Dt,!1,null,null,null),Pt=Nt.exports,At=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"relative fill"},[a("img",{staticClass:"background fill absolute",attrs:{src:t.background}}),a("audio",{ref:"bgm",attrs:{src:t.bgm,loop:""}}),a("img",{staticClass:"speaker fill absolute",attrs:{src:t.speakerPic}}),a("v-toolbar",{staticClass:"debug-panel absolute",attrs:{collapse:t.openDebugPanel,"extension-height":"200"},scopedSlots:t._u([{key:"extension",fn:function(){return[a("div",{staticClass:"align-self-start d-flex align-center"},[a("label",[t._v("指令指针：")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.pointer,expression:"pointer",modifiers:{number:!0}}],attrs:{type:"number",min:0,max:t.script.instructions.length-1},domProps:{value:t.pointer},on:{input:function(e){e.target.composing||(t.pointer=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),a("v-btn",{attrs:{text:"",small:""},on:{click:t.forceRun}},[t._v("执行")])],1),a("ul",{ref:"logger",staticClass:"align-self-start fill-y overflow-auto flex-grow-1"},t._l(t.logger,(function(e,n){return a("li",{key:n},[t._v(t._s(e))])})),0)]},proxy:!0}])},[a("v-app-bar-nav-icon",{on:{click:function(e){t.openDebugPanel=!t.openDebugPanel}}}),a("v-toolbar-title",[t._v("调试工具")])],1),a("div",{staticClass:"content fill pa-3 d-flex flex-column justify-end"},[a("div",{staticClass:"text round oculus white--text mb-3 pa-2"},[t._v(" "+t._s(t.speakerName)+"："+t._s(t.line)+" ")]),a("ul",{staticClass:"options round oculus white--text pa-2"},[t._l(t.options,(function(e,n){return a("li",{key:n,staticClass:"option round py-2 px-5",on:{click:function(e){return t.handleClickOption(n)}}},[t._v(t._s(e.text))])})),t.options.length?t._e():a("li",{staticClass:"option round py-2 px-5",on:{click:t.handleClickDefaultOption}},[t._v("...")])],2)])],1)},Bt=[],Ut=(a("99af"),a("a15b"),{name:"Demonstration",data:function(){return{pointer:0,background:null,bgm:null,speakerName:"",speakerPic:null,line:"",options:[],hasSetText:!1,logger:[],openDebugPanel:!1}},watch:{bgm:function(t,e){t!==e&&"string"===typeof t&&t.length>0&&this.$refs.bgm.play()}},computed:Object(r["a"])({},Object(o["c"])(["script"])),methods:{run:function(){while(this.pointer<this.script.instructions.length&&this.canStepIn(this.script.instructions[this.pointer]))this.apply(this.script.instructions[this.pointer]),this.pointer++},forceRun:function(){this.hasSetText=!1,this.run()},apply:function(t){var e=this.script;switch(t[0]){case"bg":var a=t[1];this.background=e.resources[a],this.log("设置背景",e.map?e.map.resourceNames[a]:this.background.slice(-32));break;case"bgm":this.bgm=e.resources[t[1]];break;case"line":this.line=t[1];var n=e.roles[t[2]];this.speakerPic=e.resources[n.pic],this.speakerName=n.name,this.options=[],this.hasSetText=!0,this.log("说台词",this.speakerName,this.line);break;case"option":var s={text:t[1],target:t[2]};this.options.push(s),this.log("添加选项",s.text,e.map?e.map.chunkTitles[s.target]:s.target);break}},canStepIn:function(t){switch(t[0]){case"bg":return!0;case"bgm":return!0;case"line":return!this.hasSetText;case"option":return this.hasSetText}},jumpTo:function(t){this.pointer=t,this.log("转跳到",this.pointer,this.script.map?this.script.map.chunkTitles[this.pointer]:"")},handleClickOption:function(t){this.hasSetText=!1;var e=this.options[t];this.log("玩家选择",e.text,this.script.map?this.script.map.chunkTitles[e.target]:e.target),this.jumpTo(e.target),this.run()},handleClickDefaultOption:function(){this.hasSetText=!1,this.run()},log:function(){for(var t=this,e=new Date,a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];this.logger.push("".concat(e.toLocaleString()," [").concat(n[0],"] ")+n.slice(1).join(" ")),this.$nextTick((function(){var e=t.$refs.logger;e&&e.scrollTo({left:0,top:e.scrollHeight,behavior:"smooth"})}))}},created:function(){this.run()}}),Lt=Ut,Ft=(a("26a7"),a("71d9")),Mt=a("2a7f"),zt=Object(f["a"])(Lt,At,Bt,!1,null,"48606270",null),Jt=zt.exports;b()(zt,{VAppBarNavIcon:_t["a"],VBtn:_["a"],VToolbar:Ft["a"],VToolbarTitle:Mt["a"]});var Kt={"base-info":function(t){return{type:"base-info",id:t,icon:"mdi-information-outline",title:"基础信息",component:"BaseInfo",dirty:!1}},"res-manager":function(t){return{type:"res-manager",id:t,icon:"mdi-folder-outline",title:"资源管理器",component:"ResourceManager",dirty:!1}},doc:function(){return{type:"doc",id:"doc",icon:"mdi-document",title:"帮助文档",component:"Doc",dirty:!1}},demo:function(){return{type:"demo",id:"demo",icon:"mdi-play",title:"演示",component:"Demonstration",dirty:!1}},role:function(t,e){return{type:"role",id:t,icon:"mdi-account-outline",title:e[t]?e[t].name:"未知角色",component:"Role",dirty:!1}},chunk:function(t,e){return{type:"chunk",id:t,icon:"mdi-text",title:e[t]?e[t].title:"未知文本段",component:"Chunk",dirty:!1}}},Gt={name:"App",components:{ResourceManager:T,Role:G,Chunk:Ct,BaseInfo:$t,Doc:Pt,Demonstration:Jt},data:function(){return{tabIndex:null,tabs:[],showNav:!0,Demonstration:Jt}},computed:Object(r["a"])({},Object(o["c"])(["id","resources","roles","chunks","data","script"])),watch:{id:function(t){this.closeAll(),this.open("base-info",t)}},methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["updateData","cacheState","createRole","createChunk","downloadProject","downloadScript","compile","loadProjectFromFile","loadProjectFromCache"])),{},{createNewRole:function(){var t=this;this.createRole({cb:function(e){return t.open("role",e.id)}})},createNewChunk:function(){var t=this;this.createChunk({cb:function(e){return t.open("chunk",e.id)}})},open:function(t,e){var a=Kt[t]?Kt[t](e,this.data):null;if(a){var n=this.tabs.findIndex((function(t){return t.id===a.id}));n>=0?this.tabIndex=n:(this.tabs.push(a),this.tabIndex=this.tabs.length-1)}},close:function(t){var e=this.tabs[t];e&&(e.dirty&&!confirm("".concat(e.title,"还未保存，确定关闭？"))||this.tabs.splice(t,1))},closeAll:function(){var t=-1;while(this.tabs.length&&this.tabs.length!==t)t=this.tabs.length,this.close(0)},saveTab:function(t,e){if(t){var a=this.$refs.tabs[e];a&&a.save(),t.dirty=!1,this.cacheState(),Object.assign(t,Kt[t.type](t.id,this.data))}},saveAllTabs:function(){var t=this;this.tabs.forEach((function(e,a){return t.saveTab(e,a)})),this.cacheState()},markDirty:function(t){t.dirty=!0}}),created:function(){var t=this;window.addEventListener("keydown",(function(e){"S"!==e.key&&"s"!==e.key||!e.ctrlKey||(e.preventDefault(),e.stopPropagation(),e.shiftKey?t.tabs.forEach((function(e,a){return t.saveTab(e,a)})):t.saveTab(t.tabs[t.tabIndex],t.tabIndex),t.$forceUpdate())})),this.open("base-info",this.id)}},Xt=Gt,Ht=(a("034f"),a("7496")),qt=a("40dc"),Qt=a("8860"),Wt=a("56b0"),Yt=a("da13"),Zt=a("8270"),te=a("5d23"),ee=a("f6c4"),ae=a("e449"),ne=a("f774"),se=a("71a3"),ie=a("c671"),re=a("fe57"),oe=a("aac8"),ce=Object(f["a"])(Xt,s,i,!1,null,null,null),le=ce.exports;b()(ce,{VApp:Ht["a"],VAppBar:qt["a"],VBtn:_["a"],VDivider:xt["a"],VIcon:k["a"],VImg:y["a"],VList:Qt["a"],VListGroup:Wt["a"],VListItem:Yt["a"],VListItemAvatar:Zt["a"],VListItemSubtitle:te["b"],VListItemTitle:te["c"],VMain:ee["a"],VMenu:ae["a"],VNavigationDrawer:ne["a"],VSpacer:J["a"],VSubheader:yt["a"],VTab:se["a"],VTabItem:ie["a"],VTabs:re["a"],VTabsItems:oe["a"]});var ue=a("f309");n["a"].use(ue["a"]);var ve=new ue["a"]({}),pe=a("2909"),de=a("aeb1"),he=a.n(de),fe=a("ec26"),me="pl-editor-project";function be(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"development",a="development"===e,n={},s=a?{resourceNames:t.resources.map((function(e){return t.data[e].name})),chunkTitles:{}}:null,i=t.resources.map((function(e){return t.data[e].src}));t.resources.forEach((function(t,e){return n[t]=e}));var r=t.roles.map((function(e){var a=t.data[e];return{name:a.name,avatar:n[a.avatar],pic:n[a.pic]}}));t.roles.forEach((function(t,e){return n[t]=e}));var o=[];t.chunks.forEach((function(e){var i=t.data[e];n[e]=o.length,a&&(s.chunkTitles[o.length]=i.title),o.push.apply(o,[["bg",n[i.background]]].concat(Object(pe["a"])(i.sections.reduce((function(t,e){return t.push.apply(t,Object(pe["a"])(e.text.split("\n").filter((function(t){return!/^\s*$/.test(t)})).map((function(t){return["line",t,n[e.speaker]]})))),t}),[])),Object(pe["a"])(i.exits.map((function(t){return["option",t.text,t.target]})))))})),o.forEach((function(t){"option"===t[0]&&(t[2]=n[t[2]])}));var c={name:t.name,version:t.verion,authors:t.authors,instructions:o,resources:i,roles:r};a&&(c.map=s),t.script=c}function _e(t){localStorage.setItem(me,JSON.stringify(t))}function ge(t){var e={name:t.name,version:t.version,authors:t.authors,resources:t.resources,roles:t.roles,chunks:t.chunks,data:t.data};he()(JSON.stringify(e),e.name+".egg.proj.json","application/json")}function xe(t){var e=localStorage.getItem(me);e&&we(t,JSON.parse(e))}function ke(t,e){var a=new FileReader;a.onload=function(){we(t,JSON.parse(a.result))},a.readAsText(e)}function ye(t){var e=t.script;e&&he()(JSON.stringify(e),(e.name||"未命名")+".egg.json","application/json")}function we(t,e){Object.assign(t,{id:Object(fe["a"])(),name:"未命名",version:"1.0.0",authors:[],data:{},resources:[],roles:[],chunks:[],script:null},e)}function Ce(t,e,a,n){var s=Object(r["a"])({id:Object(fe["a"])()},a);t.data[s.id]=s,t[e].push(s.id),n&&n(s)}function je(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.name,n=void 0===a?"未命名资源":a,s=e.src,i=void 0===s?null:s,r=e.type,o=void 0===r?"image/*":r,c=e.cb;Ce(t,"resources",{name:n,src:i,type:o},c)}function Oe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.name,n=void 0===a?"未命名角色":a,s=e.avatar,i=void 0===s?null:s,r=e.pic,o=void 0===r?null:r,c=e.cb;Ce(t,"roles",{name:n,avatar:i,pic:o},c)}function Se(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.title,n=void 0===a?"未命名文本段":a,s=e.subtitle,i=void 0===s?"":s,r=e.background,o=void 0===r?null:r,c=e.sections,l=void 0===c?[{speaker:null,text:""}]:c,u=e.exits,v=void 0===u?[]:u,p=e.cb;Ce(t,"chunks",{title:n,subtitle:i,background:o,sections:l,exits:v},p)}function Ve(t,e,a){delete t.data[a];var n=t[e],s=n.findIndex((function(t){return t===a}));s>=0&&n.splice(s,1)}function Ie(t,e){Ve(t,"resources",e)}function Te(t,e){Ve(t,"roles",e)}function $e(t,e){Ve(t,"chunks",e)}function Re(t,e){var a=t.data[e.id];a?Object.assign(a,e):t.data[e.id]=e}n["a"].use(o["a"]);var De=new o["a"].Store({state:{id:Object(fe["a"])(),name:"未命名",version:"1.0.0",authors:[],data:{},resources:[],roles:[],chunks:[],script:null},mutations:{cacheState:_e,compile:be,downloadProject:ge,downloadScript:ye,loadProjectFromFile:ke,loadProjectFromCache:xe,createResource:je,createRole:Oe,createChunk:Se,removeResource:Ie,removeRole:Te,removeChunk:$e,updateData:Re,updateBaseInfo:function(t,e){var a=e.name,n=e.version,s=e.authors;t.name=a||t.name,t.version=n||t.version,t.authors=s||t.authors}},actions:{}});n["a"].config.productionTip=!1,new n["a"]({vuetify:ve,store:De,render:function(t){return t(le)}}).$mount("#app")},"616c":function(t,e,a){},"85ec":function(t,e,a){},9461:function(t,e,a){},"9e60":function(t,e,a){},adeb:function(t,e,a){},d2a1:function(t,e,a){"use strict";var n=a("616c"),s=a.n(n);s.a},d795:function(t,e,a){"use strict";var n=a("4ab4"),s=a.n(n);s.a},e6ac:function(t,e,a){"use strict";var n=a("9e60"),s=a.n(n);s.a},ea04:function(t,e,a){"use strict";var n=a("1a7b"),s=a.n(n);s.a}});
//# sourceMappingURL=app.6c5433a4.js.map
(this["webpackJsonpcoc-run"]=this["webpackJsonpcoc-run"]||[]).push([[0],{20:function(t,e,n){},21:function(t,e,n){},22:function(t,e,n){"use strict";n.r(e);var i=n(4),a=n(8),r=n.n(a),s=n(13),o=n.n(s),c=(n(20),n(7)),u=n(0),h=n(1),l=n(3),v=n(2);n(21);function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Array.from(Array(n),(function(){return Math.floor(Math.random()*(t-e)+e)})).reduce((function(t,e){return t+e}),0)}function f(t){return Math.random()<(t>1?t/100:t)}function m(t){return t[d(t.length)]}var p=Date.now();function g(){return p++}var y=function(){function t(e){Object(u.a)(this,t),this.map=new Map,e&&this.add.apply(this,Object(c.a)(e))}return Object(h.a)(t,[{key:"add",value:function(){for(var t=this,e=0,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){t.map.has(n.uid)||(t.map.set(n.uid,n),e++)})),e}},{key:"remove",value:function(){for(var t=this,e=0,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){return e+=t.map.delete("number"===typeof n?n:n.uid)?1:0})),e}},{key:"get",value:function(t){return this.map.get(t)}},{key:"keys",value:function(){return Array.from(this.map.keys())}},{key:"values",value:function(){return Array.from(this.map.values())}},{key:"clear",value:function(){this.map.clear()}},{key:"forEach",value:function(t){return this.map.forEach(t)}},{key:"find",value:function(t){for(var e=0,n=Array.from(this.map.values());e<n.length;e++){var i=n[e];if(t(i))return i}}},{key:"size",get:function(){return this.map.size}}]),t}(),b=function(){function t(e){var n,i=this;Object(u.a)(this,t),this.id=void 0,this.name=void 0,this.entities=new y,this.onEnterFn=void 0,this.id=e.id,this.name=e.name,this.onEnterFn=e.onEnter||null,null===(n=e.entities)||void 0===n||n.forEach((function(t){i.entities.add(t),t.site=i}))}return Object(h.a)(t,[{key:"onEnter",value:function(t){this.onEnterFn&&("function"===typeof this.onEnterFn?this.onEnterFn(t):t.triggerEvent(this.onEnterFn))}},{key:"addEntity",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.entities.add(e),e.site!==this&&(e.site=this,i||this.entities.values().forEach((function(i){return i.onDetect(t,e,n)}))),this}},{key:"addEntities",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.forEach((function(e){return n.addEntity(t,e,i)})),this}},{key:"removeEntity",value:function(e,n){return this.entities.remove(n.uid),n.site=t.FAKE_SITE,this}},{key:"removeEntities",value:function(t,e){var n=this;return e.forEach((function(e){return n.removeEntity(t,e)})),this}}]),t}();b.FAKE_SITE=new b({id:"__fake_site__",name:"Fake Site",entities:[]});var x=b,k=function(){function t(e){Object(u.a)(this,t),this.id=void 0,this.uid=void 0,this.name=void 0,this.site=void 0,this.id=e.id||"entity",this.uid=e.uid||g(),this.name=e.name,this.site=e.site||x.FAKE_SITE}return Object(h.a)(t,[{key:"onDetect",value:function(t,e,n){}},{key:"goToSite",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.site.removeEntity(t,this),n?e.entities.add(this):e.addEntity(t,this),this.site=e}},{key:"getInteractions",value:function(t){return[]}},{key:"onInteract",value:function(t,e,n){}}]),t}(),j=function(){function t(e){Object(u.a)(this,t),this.id=void 0,this.priority=void 0,this.uid=void 0,this.id=e.id,this.priority=e.priority||0,this.uid=e.uid||g()}return Object(h.a)(t,[{key:"onStart",value:function(t){t.appendText("\u4e8b\u4ef6[".concat(this.id,"]\u5f00\u59cb\u4e86"))}},{key:"onRender",value:function(t){return[]}},{key:"onInput",value:function(t,e,n){t.appendText("\u6765\u81ea\u4e8b\u4ef6[".concat(this.id,"]"))}}]),t}(),O=function(){function t(e){Object(u.a)(this,t),this.id=void 0,this.uid=void 0,this.name=void 0,this.id=e.id||"item",this.uid=e.uid||g(),this.name=e.name}return Object(h.a)(t,[{key:"onAttack",value:function(t,e){return{value:0,type:"melee"}}},{key:"previewDamage",value:function(t,e){return"0"}}]),t}(),w=n(5),E=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,Object(w.a)(Object(w.a)({},t),{},{id:t.id||"melee_weapon"}))).damage=void 0,i.damage=t.damage,i}return Object(h.a)(n,[{key:"onAttack",value:function(t,e){return{value:(n=this.damage,"number"===typeof n?n:d(n.faces+1,1,n.times)*(n.factor||1)+(n.fix||0)),type:"melee"};var n}},{key:"previewDamage",value:function(t,e){if("number"===typeof this.damage)return String(this.damage);var n=this.damage,i=n.faces,a=n.times,r=n.fix,s=n.factor,o="".concat(a||1,"d").concat(i);return s&&1!==s&&(o="".concat(s,"*(").concat(o,")")),r&&(o+=r>=0?"+"+r:String(r)),o}}]),n}(O),T=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i,a=t.item,r=t.site,s=t.autoEquip;return Object(u.a)(this,n),(i=e.call(this,{id:"item",name:a.name,site:r})).item=void 0,i.autoEquip=void 0,i.item=a,i.autoEquip=s||!1,i}return Object(h.a)(n,[{key:"getInteractions",value:function(){return[{text:"\u6361\u8d77"+this.item.name,leftText:"\ud83d\udc8e",tag:[]}]}},{key:"onInteract",value:function(t,e){this.autoEquip?t.getPlayer().holdItem(t,this.item):t.getPlayer().addItemToInventory(t,this.item),this.site.removeEntity(t,this),t.showPortOptions()}}]),n}(k),S=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i,a=t.target,r=t.site,s=t.timeCost;return Object(u.a)(this,n),(i=e.call(this,{id:"port",name:a,site:r})).target=void 0,i.timeCost=void 0,i.target=a,i.timeCost=s||1,i}return Object(h.a)(n,[{key:"getInteractions",value:function(t){var e,n;return[{text:"\u53bb\u5f80"+((null===(e=t.getMap().get(this.target))||void 0===e?void 0:e.name)||"#ERROR#"),leftText:(null===(n=t.getPlayer().prevSite)||void 0===n?void 0:n.id)===this.target?"\u2b05":"\u27a1",tag:this.uid}]}},{key:"onInteract",value:function(t,e){if(e.tag===this.uid){var n=t.getMap().get(this.target);n&&(t.getPlayer().goToSite(t,n),t.timePass(this.timeCost))}}}]),n}(k),I=n(9),_=n(6);function A(t,e){for(var n=t,i=null,a=0;a<e.length&&n;a++){i=n,n=n[e[a]]}return{result:n,thisArg:i}}function C(t){return t>=0?"+"+t:String(t)}var N=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i,a;return Object(u.a)(this,n),(a=e.call(this,t)).health=void 0,a.maxHealth=void 0,a.shield=void 0,a.strength=void 0,a.dexterity=void 0,a.baseDamage=void 0,a.baseWeaponName=void 0,a.loots=void 0,a.health=t.health,a.maxHealth=t.maxHealth,a.shield=t.shield||0,a.strength=t.strength,a.dexterity=t.dexterity,a.baseDamage=t.baseDamage,a.baseWeaponName=t.baseWeaponName,a.loots=(null===(i=t.loots)||void 0===i?void 0:i.map((function(t){return t instanceof O?new T({item:t}):t})))||[],a}return Object(h.a)(n,[{key:"mutateValue",value:function(t,e,n,i){switch(e){case"health":this.health+=n;break;case"strength":this.strength+=n;break;case"dexterity":this.dexterity+=n}t.appendText("".concat(this.name," ").concat(i||""," ").concat(t.translate(e)," ").concat(C(n))),this.health<=0&&(t.appendText("".concat(this.name,"\u6b7b\u4ea1")),this.site.addEntities(t,this.loots),this.site.removeEntity(t,this))}},{key:"onCombatStart",value:function(t,e,n){}},{key:"onCombatTurn",value:function(t,e,n){}},{key:"onCombatEnd",value:function(t,e,n){}},{key:"attack",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.getWeapon(),a=i.onAttack(t,e);return this.onAttack(t,a,e),a.value&&e.onReceiveDamage(t,a,this,n),a}},{key:"onAttack",value:function(t,e,n){}},{key:"onReceiveDamage",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(i||!f(this.dexterity))e.value=Math.max(0,e.value-this.shield),e.value?this.mutateValue(t,"health",-e.value,"\u53d7\u5230".concat(n.name,"\u653b\u51fb")):t.appendText("".concat(this.name,"\u7684\u62a4\u7532\u9632\u4f4f\u4e86").concat(n.name,"\u7684\u653b\u52bf"),"good");else{var a="".concat(this.name,"\u8eb2\u8fc7\u4e86").concat(n.name,"\u7684\u8fdb\u653b");f(this.dexterity)?(t.appendText(a+"\uff0c\u5e76\u8fd4\u56de\u6253\u4e00\u628a","good"),this.attack(t,n,!0)):t.appendText(a,"good")}}},{key:"goToSite",value:function(t,e){t.appendText("".concat(this.name,"\u6765\u5230\u4e86").concat(e.name),"mutate"),Object(I.a)(Object(_.a)(n.prototype),"goToSite",this).call(this,t,e)}},{key:"getWeapon",value:function(){return new E({id:"melee",name:this.baseWeaponName,damage:this.baseDamage})}},{key:"isAlive",value:function(){return this.health>0}},{key:"removeSelf",value:function(t){return this.site!==x.FAKE_SITE&&(this.site.removeEntity(t,this),!0)}}]),n}(k),D=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,Object(w.a)(Object(w.a)({},t),{},{id:"player"}))).money=void 0,i.magic=void 0,i.insight=void 0,i.holdingItem=void 0,i.inventory=new y,i.prevSite=void 0,i.money=t.money,i.magic=t.magic,i.insight=t.insight,i.holdingItem=t.holdingItem,t.inventory.forEach((function(t){return i.inventory.add(t)})),i.prevSite=t.prevSite,i}return Object(h.a)(n,[{key:"mutateValue",value:function(t,e,n,i){switch(e){case"health":this.health+=n;break;case"magic":this.magic+=n;break;case"money":this.money+=n;break;case"strength":this.strength+=n;break;case"insight":this.insight+=n;break;case"dexterity":this.dexterity+=n}t.appendText("".concat(this.name," ").concat(i||""," ").concat(t.translate(e)," ").concat(C(n))),this.isAlive()||t.gameOver("\u5931\u8840\u8fc7\u591a")}},{key:"holdItem",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"restore",i=this.holdingItem;if(this.holdingItem=e,e?(this.inventory.remove(e),t.appendText("".concat(this.name,"\u62ff\u8d77\u4e86").concat(e.name),"mutate")):i&&t.appendText("".concat(this.name,"\u6536\u8d77\u4e86").concat(i.name),"mutate"),i)switch(n){case"drop":this.site.addEntity(t,new T({item:i}));break;case"restore":this.inventory.add(i)}}},{key:"goToSite",value:function(t,e){this.prevSite=this.site,Object(I.a)(Object(_.a)(n.prototype),"goToSite",this).call(this,t,e)}},{key:"goBack",value:function(t){if(this.prevSite&&this.prevSite!==x.FAKE_SITE){var e=this.site;return Object(I.a)(Object(_.a)(n.prototype),"goToSite",this).call(this,t,this.prevSite),this.prevSite=e,!0}return!1}},{key:"addItemToInventory",value:function(t,e){return!!this.inventory.add(e)&&(t.appendText("".concat(this.name,"\u83b7\u5f97\u4e86").concat(e.name),"mutate"),!0)}},{key:"removeItemFromInventory",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"drop";if("number"===typeof e){var i=this.inventory.get(e);if(!i)return!1;e=i}if(!this.inventory.remove(e))return!1;switch(n){case"drop":this.site.addEntity(t,new T({item:e,site:this.site}))}return t.appendText("".concat(this.name,"\u5931\u53bb\u4e86").concat(e.name),"mutate"),!0}},{key:"getWeapon",value:function(){return this.holdingItem||Object(I.a)(Object(_.a)(n.prototype),"getWeapon",this).call(this)}},{key:"getInteractions",value:function(){return[]}}]),n}(N),P=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;if(Object(u.a)(this,n),(i=e.call(this,Object(w.a)(Object(w.a)({},t),{},{id:"combat",priority:10}))).rivals=void 0,i.next=void 0,i.rivals=t.rivals.map((function(t,e){return{entity:t.entity,tag:t.tag,dexFix:t.dexFix||0,order:e}})),!i.rivals.length)throw new Error("Combat with no rivals is not allowed!");return i.next="next"in t&&i.rivals.find((function(e){return e.entity.uid===t.next}))||i.rivals[0],i}return Object(h.a)(n,[{key:"onStart",value:function(t){var e=this;t.appendText("\u6218\u6597\u5f00\u59cb\uff01"),this.rivals.forEach((function(n){return n.entity.onCombatStart(t,e,n)})),this.displayRivals(t),this.runForPlayer(t)}},{key:"onRender",value:function(t){var e=t.getPlayer(),n=this.rivals.find((function(t){return t.entity.uid===e.uid})),i={text:"\u9003\u8dd1",leftText:"\ud83c\udfc3\u200d",rightText:"".concat(e.dexterity,"%"),tag:"escape"};if(!n)return[i];var a=e.getWeapon(),r=this.rivals.filter((function(t){return t.tag!==n.tag})).map((function(e){return{text:"\u653b\u51fb".concat(e.entity.name),leftText:"\ud83d\udde1",rightText:"".concat(a.previewDamage(t,e.entity),"\u2665"),tag:e.entity.uid}}));return r.push(i),t.debugMode&&r.push({text:"\u4e00\u51fb\u5fc5\u6740",leftText:"\ud83d\udc80",rightText:"\u8c03\u8bd5\u6a21\u5f0f",tag:"one_punch"}),r}},{key:"displayRivals",value:function(t){t.appendText("\u573a\u4e0a\u5269\u4f59\uff1a"+this.rivals.filter((function(t){return"player"!==t.entity.id})).map((function(t){var e=t.entity;return"".concat(e.name,"(").concat(e.health,"/").concat(e.maxHealth,")")})).join("\u3001"))}},{key:"onInput",value:function(t,e){var n=t.getPlayer(),i=this.rivals.find((function(t){return t.entity.uid===n.uid}));if(i){if("one_punch"===e.tag)this.rivals.filter((function(t){return t.tag===i.tag})).forEach((function(e){return e.entity.mutateValue(t,"health",-e.entity.health,"\u56e0\u4e3a\u82df\u7ba1\u7406")}));else if("escape"===e.tag)this.escape(t,n);else if("number"===typeof e.tag){var a=this.rivals.find((function(t){return t.entity.uid===e.tag}));a&&n.attack(t,a.entity)}this.checkCombatEnd(t)||(this.turnNext(),this.runForPlayer(t),this.displayRivals(t))}else t.endEvent(this)}},{key:"checkCombatEnd",value:function(t){var e,n=this;this.remanageRivals();var i=null===(e=this.rivals)||void 0===e?void 0:e[0].tag;return!!(this.rivals.length<=1||this.rivals.every((function(t){return t.tag===i})))&&(t.appendText("\u6218\u6597\u7ed3\u675f"),t.endEvent(this),this.rivals.forEach((function(e){return e.entity.onCombatStart(t,n,e)})),!0)}},{key:"remanageRivals",value:function(){this.rivals=this.rivals.filter((function(t){return t.entity.isAlive()})),this.rivals.sort((function(t,e){return t.entity.dexterity-e.entity.dexterity})),this.rivals.forEach((function(t,e){return t.order=e}))}},{key:"nextAct",value:function(t){this.next.entity.onCombatTurn(t,this,this.next),this.turnNext()}},{key:"turnNext",value:function(){this.next=this.rivals[(this.next.order+1)%this.rivals.length]}},{key:"runForPlayer",value:function(t){for(;!this.checkCombatEnd(t)&&"player"!==this.next.entity.id;)this.nextAct(t)}},{key:"escape",value:function(t,e){if(f(e.dexterity)){t.appendText("".concat(e.name,"\u9003\u8dd1\u6210\u529f"),"good"),t.endEvent(this);var n=this.rivals.findIndex((function(t){return t.entity.uid===e.uid}));n>=0&&(this.rivals.splice(n,1),e.uid===this.next.entity.uid&&(this.next=this.rivals[n%this.rivals.length])),this.remanageRivals()}else t.appendText("".concat(e.name,"\u9003\u8dd1\u5931\u8d25"),"bad")}},{key:"attack",value:function(t,e,n){t.appendText("".concat(e.name,"\u4f7f\u7528").concat(e.getWeapon().name,"\u653b\u51fb").concat(n.name),"bad"),e.attack(t,n)}}]),n}(j),F=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(){return Object(u.a)(this,n),e.call(this,{id:"inventory",priority:99})}return Object(h.a)(n,[{key:"onStart",value:function(t){var e=t.getPlayer();t.setOptions([{text:"\u8fd4\u56de",tag:[]}].concat(Array.from(e.inventory.values(),(function(t){var n,i;return{text:((null===(n=e.holdingItem)||void 0===n?void 0:n.uid)===t.uid?"\u5378\u4e0b":"\u88c5\u5907")+t.name,tag:["currentState","player","holdItem",[(null===(i=e.holdingItem)||void 0===i?void 0:i.uid)===t.uid?t:null]]}}))))}},{key:"onRender",value:function(t){var e=t.getPlayer(),n=[{text:"\u8fd4\u56de"}].concat(Object(c.a)(e.inventory.values().map((function(e){return{text:e.name,leftText:"\ud83e\udd1c",rightText:e.previewDamage(t),subopts:[{text:"\u88c5\u5907",tag:"hold"},{text:"\u4e22\u5f03",tag:"drop"}],tag:e.uid}}))));return e.holdingItem&&n.splice(1,0,{text:"\u6536\u8d77"+e.holdingItem.name,leftText:"\ud83e\udd1a",rightText:e.holdingItem.previewDamage(t),tag:e.holdingItem.uid}),n}},{key:"onInput",value:function(t,e,n){if("number"===typeof e.tag){var i,a=e.tag,r=t.getPlayer();if(a===(null===(i=r.holdingItem)||void 0===i?void 0:i.uid))r.holdItem(t,null);else{var s=r.inventory.get(e.tag);s&&("hold"===n.tag?r.holdItem(t,s):"drop"===n.tag&&r.removeItemFromInventory(t,s,"drop"))}}else t.endEvent(this)}}]),n}(j);function M(t){var e=t.className,n=t.option,a=t.onClick;return Object(i.jsxs)("button",{className:e,onClick:n.subopts?void 0:function(){return a(n,null)},children:[n.leftText?Object(i.jsx)("span",{className:"option-side-text left",children:n.leftText}):null,n.rightText?Object(i.jsx)("span",{className:"option-side-text right",children:n.rightText}):null,n.text,n.subopts?n.subopts.map((function(t,e){return Object(i.jsx)("span",{className:"subopt",onClick:function(){return a(n,t)},children:t.text},e)})):null]})}var R=["magic","money","insight","strength","dexterity"],W=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,t)).debugMode=void 0,i.textListEl=void 0,i.resetting=!1,i.textBuffer=[],i.pid=null,i.gameOverMessage="",i.currentState=void 0,i.debugMode=t.debugMode||!1,i.textListEl=r.a.createRef(),i.currentState=t.data.initialize(),i.state=Object.assign({},i.currentState,{textList:[],showOptions:!0,showInventory:!1}),i}return Object(h.a)(n,[{key:"render",value:function(){var t=this,e=this.state,n=e.player;return Object(i.jsxs)("div",{className:"App",children:[Object(i.jsxs)("header",{className:"state-bar",children:[Object(i.jsxs)("p",{children:[Object(i.jsxs)("span",{children:["\u7b2c",Math.floor(e.time/24)+1,"\u5929",e.time%24,"\u70b9\u949f\uff0c"]}),Object(i.jsxs)("span",{children:["\u5728",n.site.name,"\uff0c"]}),Object(i.jsx)("span",{children:n.holdingItem?"\u624b\u6301".concat(n.holdingItem.name,"(").concat(n.holdingItem.previewDamage(this),")"):"\u4e24\u624b\u7a7a\u7a7a"})]}),Object(i.jsxs)("p",{className:"values",children:[Object(i.jsx)("span",{className:"value",children:"".concat(this.translate("health"),":").concat(n.health,"/").concat(n.maxHealth)}),R.map((function(e){return"".concat(t.translate(e),":").concat(n[e])})).map((function(t){return Object(i.jsx)("span",{className:"value",children:t},t)}))]})]}),Object(i.jsxs)("div",{className:"panel",children:[Object(i.jsx)("div",{className:"text-panel",ref:this.textListEl,children:this.state.textList.map((function(t,e){var n;return Object(i.jsx)("p",{className:"text "+(null===(n=t.types)||void 0===n?void 0:n.join(" "))||!1,children:Object(i.jsx)("span",{className:"content",children:t.text})},e)}))}),Object(i.jsxs)("div",{className:"option-panel",children:[Object(i.jsx)("div",{className:"fab",onClick:this.openInventory.bind(this),children:"\ud83d\udcb0"}),this.state.showOptions?this.state.options.map((function(e,n){return Object(i.jsx)(M,{className:"option",option:e,onClick:t.handleClickOption.bind(t)},n)})):Object(i.jsx)("button",{className:"option skip-btn",onClick:this.flushText.bind(this,!0),children:" \u23e9 "})]})]})]})}},{key:"flushText",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.textBuffer.splice(0,e?this.textBuffer.length:1);this.setState((function(t){return{textList:t.textList.concat(n).slice(-100)}}),(function(){var e;return null===(e=t.textListEl.current)||void 0===e?void 0:e.scrollTo({top:t.textListEl.current.scrollHeight,behavior:"smooth"})}))}},{key:"flushLoop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===this.pid?(this.setState((function(){return{showOptions:!1}})),this.flushText(),this.pid=setInterval(this.flushLoop.bind(this,!0),350)):t&&(this.textBuffer.length?(this.setState((function(){return{showOptions:!1}})),this.flushText()):(clearInterval(this.pid),this.pid=null,this.setState((function(){return{showOptions:!0}}))))}},{key:"appendText",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];var r=!1;"string"===typeof t&&t.startsWith("#")&&(t={text:t.slice(1),translated:!0}),"string"!==typeof t&&(r=t.translated||!1,i=t.types||i,t=t.text);var s=(t=r?this.translate(t):t).split("\n").map((function(t){return t.trim()})).filter((function(t){return!/^\s*$/.test(t)})).map((function(t){var e=/@\s*([^@]+)\s*@$/.exec(t),n=i;return e&&(t=t.slice(0,e.index).trim(),n=e[1].trim().split(/\s+/)),{text:t,types:n}}));(e=this.textBuffer).push.apply(e,Object(c.a)(s)),this.flushLoop()}},{key:"setOptions",value:function(t){this.currentState.options=t}},{key:"timePass",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?this.currentState.time=24*(Math.floor(this.currentState.time/24)+1)+t%24:this.currentState.time+=t,this.currentState.time}},{key:"reset",value:function(){this.resetting=!0,this.currentState=this.props.data.initialize();var t=this.currentState.player;t.site.addEntity(this,t),this.refreshOptions(),this.resetting=!1,this.appendText("\u5f00\u59cb\u6e38\u620f","system"),this.props.data.start(this),this.applyChange()}},{key:"applyChange",value:function(){this.setState(this.currentState)}},{key:"gameOver",value:function(t){this.gameOverMessage="\u6e38\u620f\u7ed3\u675f "+t,this.resetting=!0}},{key:"handleClickOption",value:function(t,e){this.appendText(t.text,"self"),this.showPortOptions();var n=this.currentState;if("__reset__"===t.tag)this.reset();else if(n.events.length>0){n.events[0].onInput(this,t,e)}else if(t.entityUid){var i=n.player.site.entities.get(t.entityUid);i&&i.onInteract(this,t,e)}else Array.isArray(t.tag)&&this.execCmd(t.tag);this.refreshOptions(),this.resetting&&(this.appendText(this.gameOverMessage,"system"),this.setOptions([{text:"\u91cd\u6765",tag:"__reset__"}])),this.applyChange()}},{key:"execCmd",value:function(t){var e=t.slice(0,t.length-1),n=t[t.length-2]||[],i=A(this,e),a=i.result,r=i.thisArg;"function"===typeof a&&a.apply(r,n)}},{key:"triggerEvent",value:function(t){this.currentState.events.push(t),this.refreshEvents(),t.onStart(this)}},{key:"endEvent",value:function(t){var e=this.currentState.events.findIndex((function(e){return e.uid===t.uid}));e>=0&&this.currentState.events.splice(e,1),this.refreshOptions()}},{key:"refreshEvents",value:function(){this.currentState.events.sort((function(t,e){return e.priority-t.priority}))}},{key:"findEvent",value:function(t){var e="number"===typeof t?function(e){return e.uid===t}:function(e){return e.id===t};return this.currentState.events.find(e)}},{key:"refreshOptions",value:function(){var t=this.currentState;if(t.events.length>0){var e=t.events[t.events.length-1];this.setOptions(e.onRender(this))}else this.showPortOptions()}},{key:"openInventory",value:function(){this.findEvent("inventory")||(this.triggerEvent(new F),this.refreshOptions(),this.applyChange())}},{key:"showPortOptions",value:function(){var t=this,e=this.currentState.player.site,n=Array.from(e.entities.values(),(function(e){return e.getInteractions(t).map((function(t){return Object.assign(t,{entityUid:e.uid})}))})).flat();this.setOptions(n)}},{key:"getPlayer",value:function(){return this.currentState.player}},{key:"getMap",value:function(){return this.currentState.map}},{key:"translate",value:function(t){return this.props.data.translate(t)}},{key:"componentDidMount",value:function(){this.reset()}}]),n}(r.a.Component),B=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,23)).then((function(e){var n=e.getCLS,i=e.getFID,a=e.getFCP,r=e.getLCP,s=e.getTTFB;n(t),i(t),a(t),r(t),s(t)}))},H=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,{id:"site_investigation",name:"site_investigation"})).results=void 0,i.counter=void 0,i.chances=void 0,i.results=t.results,i.counter=t.counter||0,i.chances=t.chances||2,i}return Object(h.a)(n,[{key:"getInteractions",value:function(t){return[{text:"\u8c03\u67e5".concat(this.site.name),leftText:"\ud83d\udca1",rightText:"\u7b2c".concat(this.counter+1,"\u6b21")}]}},{key:"onInteract",value:function(t,e){var n=this.site;this.counter++,this.counter>=this.chances&&n.removeEntity(t,this),f(t.getPlayer().insight)?(t.appendText("\u4f60\u4f3c\u4e4e\u5bdf\u89c9\u5230\u4e86\u4ec0\u4e48"),n.removeEntity(t,this),n.addEntities(t,this.results,!0)):this.counter>=this.chances?(t.appendText("\u597d\u50cf\u6ca1\u53d1\u73b0\u4ec0\u4e48\uff0c\u653e\u5f03\u5427"),t.appendText("\u4f60\u5931\u53bb\u4e86\u5bf9".concat(n.name,"\u7684\u5174\u8da3"),"mutate")):t.appendText("\u6ca1\u4ec0\u4e48\u7279\u522b\u7684")}}]),n}(k),L=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i,a=t.event,r=t.once,s=t.option;return Object(u.a)(this,n),(i=e.call(this,{id:"event_trigger",name:a.id})).event=void 0,i.option=void 0,i.once=void 0,i.event=a,i.option=s||{text:"..."},i.once=r||!0,i}return Object(h.a)(n,[{key:"getInteractions",value:function(t){return[this.option]}},{key:"onInteract",value:function(t,e){t.triggerEvent(this.event),this.once&&this.site.removeEntity(t,this)}}]),n}(k),z=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,{id:"text",priority:10})).texts=void 0,i.texts=t.texts,i}return Object(h.a)(n,[{key:"onStart",value:function(t){this.texts.forEach((function(e){return t.appendText(e)})),t.endEvent(this)}}]),n}(j),q=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,{id:"sequence",priority:0})).events=void 0,i.joints=void 0,i.pointer=0,i.events=t.events,i.joints=Array(i.events.length-1).fill(0).map((function(e,n){var i;return(null===(i=t.joints)||void 0===i?void 0:i[n])||{text:"..."}})),i}return Object(h.a)(n,[{key:"nextEvent",value:function(t){if(this.pointer>=this.events.length)t.endEvent(this);else{var e=this.events[this.pointer++];t.triggerEvent(e)}}},{key:"onStart",value:function(t){this.nextEvent(t)}},{key:"onRender",value:function(t){return[this.joints[this.pointer-1]]}},{key:"onInput",value:function(t,e){this.nextEvent(t)}}]),n}(j),K=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,{id:"game_over",priority:10})).reason=void 0,i.reason=t.reason,i}return Object(h.a)(n,[{key:"onStart",value:function(t){t.gameOver(this.reason)}}]),n}(j),U={text:{money:"\u786c\u5e01",health:"\u4f53\u529b",magic:"\u9b54\u529b",strength:"\u529b\u91cf",dexterity:"\u654f\u6377",insight:"\u6d1e\u5bdf"},story:{start:"\n            \u6211\u53eb\u738b\u4e8c\u72d7\uff0c\u662f\u5bb6\u91cc\u7684\u8001\u56db\n            \uff08\u6b64\u5904\u7701\u7565\u4e09\u5343\u5b57\uff09\n            \u51e0\u5929\u540e\uff0c\u6709\u6751\u6c11\u76ee\u51fb\u5230\u4e86\u5927\u8205\u4eb2\u624b\u628a\u6bcd\u4eb2\u9000\u4e0b\u4e86\u60ac\u5d16\n            \u73b0\u5728\u6709\u4e86\u4e09\u4efd\u8d22\u4ea7\u7b49\u7740\u6211\u7ee7\u627f\n            \u5e26\u7740\u590d\u6742\u7684\u5fc3\u60c5\uff0c\u6211\u5750\u4e0a\u4e86\u56de\u4e61\u7684\u5927\u5df4\n        ",end:"\n            \u4f60\u53d1\u73b0\u4e86\u5730\u4e0b\u6709\u4e00\u6761\u6697\u9ed1\u7684\u6cb3\u6d41\uff0c\u751a\u81f3\u624b\u7535\u7b52\u7684\u5173\u8054\u90fd\u4e0d\u80fd\u7167\u4eae\u5b83\u4e00\u6beb\n            \u4eff\u4f5b\u6709\u4e00\u79cd\u58f0\u97f3\u5728\u53ec\u5524\u4f60\uff0c\u8ba9\u4f60\u5411\u5b83\u9760\u8fd1\n            \u6b63\u5728\u601d\u8003\u773c\u524d\u7684\u4e00\u5207\u65f6\uff0c\u4f60\u5df2\u7ecf\u6765\u5230\u4e86\u6697\u6cb3\u8fb9\n            \u4f60\u8df3\u5165\u4e86\u8fd9\u6761\u6cb3\u6d41\n            \u6ca1\u6709\u4e00\u4e1d\u4e1d\u51b0\u51c9\u6216\u6eba\u6c34\u7684\u75db\u82e6\uff0c\u4e5f\u6ca1\u6709\u4efb\u4f55\u5176\u5b83\u611f\u89c9\n            \u4f60\u80fd\u611f\u53d7\u5230\u6cb3\u6c34\u5e26\u7740\u4f60\u98d8\u5411\u4e86\u65e0\u5c3d\u7684\u9ed1\u6697\u6df1\u6e0a\n            \u53ef\u662f\u4f60\u5374\u4e1d\u6beb\u4e0d\u60f3\u53cd\u6297\n            \u4e0d\u77e5\u9053\u8fc7\u4e86\u591a\u4e45\u540e\uff0c\u4f60\u9192\u4e86\n            \u5728\u6e05\u6668\u7684\u9633\u5149\u4e2d\uff0c\u75c5\u5e8a\u4e0a\u7684\u4f60\u7741\u5f00\u53cc\u773c\n            \u8be2\u95ee\u62a4\u58eb\u7684\u7ed3\u679c\u662f\uff0c\u6709\u4eba\u5728\u6d77\u8fb9\u53d1\u73b0\u4e86\u4f60\uff0c\u795e\u5fd7\u4e0d\u6e05\n        ",old_mans_talk:"\n            \u54df~\u5c0f\u4f19\u5b50\n            \u5e94\u8be5\u662f\u738b\u5927\u58ee\u5bb6\u91cc\u7684\u5427\n            \u5e74\u8f7b\u771f\u597d\n            \u6211\u8981\u662f\u4e5f\u5e74\u8f7b\u5c31\u597d\u4e86\n        ",wang:"\n            \u8fd9\u4e0d\u662f\u5ed6\u79cb\u5417\uff1f\u597d\u4e45\u4e0d\u89c1\u4e86\n        ",elder:{welcome:"\n                \u4f60\u5c31\u662f\u5ed6\u79cb\u5427@talk@\n                \u6211\u662f\u5ed6\u5bb6\u7684\u65cf\u957f\uff0c\u63a5\u4e0b\u6765\u5c31\u7531\u6211\u5e26\u4f60\u5427@talk@\n                \u5148\u53bb\u4f60\u5bb6\u628a\u4e1c\u897f\u62ff\u4e0a@talk@\n            ",take_things:"\n                \u597d\u4e45\u6ca1\u6765\u4e86\u5427@talk@\n                \u4f60\u5916\u516c\u7684\u4e1c\u897f\u90fd\u653e\u5728\u4ed6\u7684\u623f\u95f4\u4e86\uff0c\u81ea\u5df1\u53bb\u62ff\u5427@talk@\n                \u6211\u5c31\u4e0d\u966a\u4f60\u4e86@talk@\n            "}},idle:{old_man:["\u55ef\uff1f\u6709\u4e8b\u5417\uff1f","\u4eca\u5929\u7684\u592a\u9633\u771f\u8212\u670d","\u4eba\u90fd\u53d8\u4e86\u554a","\u4e16\u754c\u66f4\u597d\u4e86\u5462","\u54ce"]},description:{strange_note:"\n            \u4e0a\u9762\u5199\u7740\u201c\u2026\u2026\u201d\n            \u4f46\u662f\n        ",site:{old_house:"\n                \u968f\u8ba9\u53c8\u65b0\u589e\u4e86\u4e00\u4e9b\u8fdd\u7ae0\u5efa\u7b51\uff0c\u4f46\u662f\u603b\u4f53\u7ed3\u6784\u8fd8\u662f\u6ca1\u53d8\n                \u3010\u623f\u5c4b\u7ed3\u6784\u56fe\u3011\n            "}}},V=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,Object(w.a)(Object(w.a)({},t),{},{id:"npc"}))).talkText=void 0,i.idleText=void 0,i.chat=void 0,i.autoChat=void 0,i.takled=void 0,i.talkText=t.talkText,i.chat=t.chat,i.idleText=t.idleText||{text:"..."},i.autoChat=t.autoChat||!1,i.takled=!1,i}return Object(h.a)(n,[{key:"onDetect",value:function(t,e,n){"player"!==e.id||this.takled||this.talk(t)}},{key:"getInteractions",value:function(t){return[{text:this.name,leftText:"\ud83d\udc68\u200d\ud83e\uddb2",subopts:[{text:"\u5bf9\u8bdd",tag:"talk"},{text:"\u653b\u51fb",tag:"attack"}]}]}},{key:"onInteract",value:function(t,e,n){"talk"===n.tag?this.chat?t.triggerEvent(this.chat):this.talk(t):"attack"===n.tag&&this.onBeAttack(t)}},{key:"onBeAttack",value:function(t){t.triggerEvent(new P({rivals:[{entity:t.getPlayer(),tag:"civilian"},{entity:this,tag:"angry_civilian"}]}))}},{key:"talk",value:function(t){this.takled?t.appendText(this.idleText):(t.appendText("".concat(this.name,"\u8bf4:")),t.appendText(this.talkText,"talk"),this.takled=!0)}},{key:"onCombatTurn",value:function(t,e,n){this.health>=.75*this.maxHealth?e.attack(t,this,m(e.rivals.filter((function(t){return t.tag!==n.tag}))).entity):e.escape(t,this)}}]),n}(N),J=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){return Object(u.a)(this,n),e.call(this,Object(w.a)(Object(w.a)({},t),{},{id:"monster"}))}return Object(h.a)(n,[{key:"onDetect",value:function(t,e,n){("player"===e.id||e instanceof D)&&t.triggerEvent(new P({rivals:[{entity:this,tag:"monster"},{entity:e,tag:"civilian"}]}))}},{key:"onCombatTurn",value:function(t,e,n){this.health>=this.maxHealth/4?e.attack(t,this,m(e.rivals.filter((function(t){return t.tag!==n.tag}))).entity):e.escape(t,this)}}]),n}(N),$=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;Object(u.a)(this,n);var a=t.owner,r=Object(w.a)(Object(w.a)({},t),{},{id:"shadow",name:"".concat(a.name,"\u7684\u5f71\u5b50"),health:a.health,maxHealth:a.maxHealth,strength:a.strength,dexterity:a.dexterity,baseDamage:a.baseDamage,baseWeaponName:a.baseWeaponName});return(i=e.call(this,r)).owner=void 0,i.owner=a,i}return Object(h.a)(n,[{key:"onCombatStart",value:function(t,e,n){}},{key:"onCombatTurn",value:function(t,e,n){e.attack(t,this,m(e.rivals.filter((function(t){return t.tag!==n.tag}))).entity)}},{key:"onCombatEnd",value:function(t,e,n){this.removeSelf(t)}}]),n}(J),G=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,t)).shadow=void 0,i.shadow=t.shadow,i}return Object(h.a)(n,[{key:"onBeAttack",value:function(t){this.shadow&&this.shadow.isAlive()||(this.shadow=new $({owner:this}),this.site.addEntity(t,this.shadow)),t.triggerEvent(new P({rivals:[{entity:t.getPlayer(),tag:"civilian"},{entity:this,tag:"angry_civilian"},{entity:this.shadow,tag:"angry_civilian"}]}))}}]),n}(V),Q=function(){function t(e){Object(u.a)(this,t),this.map=new Map,e&&this.add.apply(this,Object(c.a)(e))}return Object(h.a)(t,[{key:"add",value:function(){for(var t=this,e=0,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){t.map.has(n.id)||(t.map.set(n.id,n),e++)})),e}},{key:"remove",value:function(){for(var t=this,e=0,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){return e+=t.map.delete("string"===typeof n?n:n.id)?1:0})),e}},{key:"get",value:function(t){return this.map.get(t)}},{key:"keys",value:function(){return Array.from(this.map.keys())}},{key:"values",value:function(){return Array.from(this.map.values())}},{key:"clear",value:function(){this.map.clear()}},{key:"forEach",value:function(t){return this.map.forEach(t)}},{key:"find",value:function(t){for(var e=0,n=Array.from(this.map.values());e<n.length;e++){var i=n[e];if(t(i))return i}}},{key:"size",get:function(){return this.map.size}}]),t}(),X=function(t){Object(l.a)(n,t);var e=Object(v.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,{id:"chat",priority:10})).blocks=void 0,i.currentBlockId=void 0,i.blocks=new Q(t.blocks),i.currentBlockId=t.entry||t.blocks[0].id,i}return Object(h.a)(n,[{key:"onStart",value:function(t){this.displayTextAndCheckEnd(t)}},{key:"onRender",value:function(t){var e,n=this.blocks.get(this.currentBlockId);return(null===n||void 0===n||null===(e=n.options)||void 0===e?void 0:e.map((function(t){return{text:t.text,tag:t.target}})))||[]}},{key:"onInput",value:function(t,e,n){"string"===typeof e.tag?(this.currentBlockId=e.tag,this.displayTextAndCheckEnd(t)):t.endEvent(this)}},{key:"displayTextAndCheckEnd",value:function(t){var e=this.blocks.get(this.currentBlockId);e&&(e.text.forEach((function(e){return t.appendText(e)})),e.options&&e.options.length||t.endEvent(this))}}]),n}(j);function Y(){return 5*d(7,1,3)}var Z={initialize:function(){var t=new V({name:"\u738b\u5c60\u592b",health:7,maxHealth:7,strength:30,dexterity:30,baseDamage:1,baseWeaponName:"\u62f3\u5934",talkText:{text:"story.wang",translated:!0}}),e=new G({name:"\u8001\u8005",health:7,maxHealth:7,strength:30,dexterity:30,baseDamage:1,baseWeaponName:"\u62f3\u5934",loots:[new T({item:new O({name:"\u626d\u66f2\u7684\u6728\u62d0\u6756"})}),new T({item:new O({name:"\u78e8\u635f\u7684\u94dc\u94b1"})})],talkText:{text:"story.old_mans_talk",translated:!0},idleText:{text:"idle.old_man",translated:!0}}),n=new V({name:"\u5ed6\u65cf\u957f",health:7,maxHealth:7,strength:30,dexterity:30,baseDamage:1,baseWeaponName:"\u62f3\u5934",talkText:"#story.elder.welcome"}),i=[new x({id:"apartment",name:"\u516c\u5bd3",entities:[new L({event:new X({blocks:[{id:"start",text:["#story.start"]}]})})]}),new x({id:"bus_stop",name:"\u5df4\u58eb\u8f66\u7ad9",entities:[new S({target:"ng_bridge"}),new L({option:{text:"\u8fd8\u662f\u56de\u57ce\u91cc\u5427",leftText:"\ud83c\udfd9"},event:new K({reason:"\u56e0\u4e3a\u4f60\u662f\u5934\u53f7\u73a9\u5bb6"}),once:!0})]}),new x({id:"ng_bridge",name:"\u9f10\u6c9f\u6865",entities:[new S({target:"hs_village"}),new S({target:"bus_stop"}),e]}),new x({id:"hs_village",name:"\u7074\u5c71\u6751",entities:[new S({target:"main_streat"}),new S({target:"ng_bridge"})]}),new x({id:"main_streat",name:"\u5927\u8def",entities:[new S({target:"temple"}),new S({target:"wang_house"}),new S({target:"ng_bridge"}),new T({item:new E({id:"bone",name:"\u732a\u9aa8",damage:3}),autoEquip:!0})]}),new x({id:"wang_house",name:"\u738b\u5c60\u6237\u5bb6",entities:[new S({target:"main_streat"}),t,new H({results:[new T({item:new E({name:"\u6740\u732a\u5200",damage:{faces:3,times:2,fix:-1}}),autoEquip:!0})]})]}),new x({id:"temple",name:"\u7960\u5802",entities:[new S({target:"temple_basement"}),new S({target:"main_streat"}),n]}),new x({id:"temple_basement",name:"\u7960\u5802\u5730\u4e0b\u5ba4",entities:[new S({target:"temple"}),new J({name:"\u89e6\u624b\u602a",baseDamage:{faces:2,fix:1},baseWeaponName:"\u722a\u5b50",health:10,maxHealth:10,strength:30,dexterity:40,loots:[new S({target:"dark_river"})]})]}),new x({id:"dark_river",name:"\u6f06\u9ed1\u4e4b\u6cb3",entities:[new S({target:"temple_basement"}),new L({option:{text:"\u8df3\u5165\u5176\u4e2d",leftText:"\ud83c\udfca\u200d"},event:new q({events:[new z({texts:[{text:"story.end",translated:!0}]}),new K({reason:"\u5b8c\u7f8e\u901a\u5173"})],joints:[{text:"\u7ed3\u675f\u4e86"}]})})]}),new x({id:"old_house",name:"laofangzi"})],a=new Map;i.map((function(t){return a.set(t.id,t)}));var r=d(10)+5;return{events:[],map:a,options:[],time:0,player:new D({id:"player",name:"\u738b\u4e8c\u72d7",site:a.get("bus_stop"),money:Y(),health:r,maxHealth:r,magic:Y(),strength:Y(),dexterity:Y(),insight:Y(),holdingItem:null,inventory:[new O({name:"\u5947\u602a\u7684\u7c2a\u5b50"})],baseDamage:1,baseWeaponName:"\u62f3\u5934"})}},start:function(t){t.appendText({text:"story.start",translated:!0}),t.getPlayer().goToSite(t,t.getMap().get("bus_stop"))},translate:function(t){var e=function(t,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"").split(n).concat(e.split(n)).filter((function(t){return""!==t}));return A(t,i).result}(U,t,t.indexOf(".")>=0?"":"text")||t;return Array.isArray(e)?m(e):"string"===typeof e?e:String(e)}},tt=n(14);(function(){Object.fromEntries||(Object.fromEntries=function(t){for(var e={},n=0;n<t.length;n++){var i=t[n];e[i[0]]=i[1]}return e}),Array.prototype.flat||(Array.prototype.flat=function(t){var e,n=[],i=Object(tt.a)(this);try{for(i.s();!(e=i.n()).done;){var a=e.value;n=n.concat(a)}}catch(r){i.e(r)}finally{i.f()}return n})})(),o.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsx)(W,{data:Z,debugMode:"true"===new URLSearchParams(window.location.search).get("debug-mode")})}),document.getElementById("root")),B()}},[[22,1,2]]]);
//# sourceMappingURL=main.26cf3957.chunk.js.map
(function(e){function t(t){for(var n,s,o=t[0],l=t[1],c=t[2],d=0,p=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&p.push(a[s][0]),a[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,o=1;o<r.length;o++){var l=r[o];0!==a[l]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},a={app:0},i=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("85ec"),a=r.n(n);a.a},"452c":function(e,t,r){},"559d":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.started?r("Displayer",{attrs:{script:e.script}}):r("GameLoader",{on:{"load-script":e.loadScript,"load-bundle":e.loadBundle,"start-game":e.startGame}})],1)},i=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"full-wrapper displayer"},[r("div",{staticClass:"full-wrapper background-wrapper"},[r("transition",{attrs:{"enter-active-class":"animate__animated animate__fadeIn animate__fast","leave-active-class":"animate__animated animate__fadeOut animate__fast"}},[r("img",{key:e.background,staticClass:"background",attrs:{src:e.background,alt:e.currentNode.background}})]),r("transition",{attrs:{"enter-active-class":"animate__animated animate__slideInLeft animate__faster","leave-active-class":"animate__animated animate__slideOutRight animate__faster"}},["self"!==e.currentNode.role?r("img",{key:e.role,staticClass:"role",attrs:{src:e.role,alt:e.currentNode.role}}):e._e()])],1),r("div",{staticClass:"full-wrapper content"},[r("div",{staticClass:"scroll-wrapper option-list-wrapper"},[r("transition",{attrs:{mode:"out-in","enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__slideOutRight animate__faster"}},[r("div",{key:e.current,staticClass:"option-list"},e._l(e.options,(function(t,n){return r("div",{key:n,staticClass:"option-text",on:{click:function(r){return e.jump(t.target)}}},[e._v(e._s(t.text))])})),0)])],1),r("div",{staticClass:"node-text-wrapper"},[r("transition",{attrs:{mode:"out-in","enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__fadeOut animate__faster"}},[r("p",{key:e.current,staticClass:"node-text"},[e._v(e._s(e.currentNode.text))])])],1)])])},o=[],l=(r("b0c0"),r("77ed"),{name:"Displayer",components:{},props:{script:{type:Object,required:!0}},data:function(){return{current:null,background:null,role:null,roleName:""}},computed:{currentNode:function(){return this.script.nodes[this.current]||{text:"空节点",role:"",background:""}},options:function(){var e=this.currentNode;return this.currentNode.options||[{text:"...",target:e.target}]}},methods:{jump:function(e){var t=this.currentNode;"number"===typeof e?this.current=e:this.current++;var r=this.currentNode;if(t&&r)if(r.background&&t.background!==r.background&&(this.background=this.script.resources[r.background]),"self"===r.role)this.role=null,this.roleName="自己";else if(r.role&&t.role!==r.role){var n=this.script.roles[r.role];this.role=this.script.resources[n.pic],this.roleName=n.name}},log:function(e){console.log(e)}},mounted:function(){this.jump(0)}}),c=l,u=(r("64ef"),r("2877")),d=Object(u["a"])(c,s,o,!1,null,"747708dc",null),p=d.exports,f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"full-wrapper game-loader-wrapper"},[r("div",{staticClass:"game-loader shadow"},[r("div",{staticClass:"line"},[r("span",{staticClass:"title"},[e._v("输入脚本文件")]),e.selectedScript?r("span",{staticClass:"subtitle"},[e._v("输入成功【"+e._s(e.scriptName)+" v"+e._s(e.scriptVersion)+"】")]):e._e(),r("WideFileLoader",{attrs:{accept:".json",json:!0,placeholder:"/test/script.json"},on:{error:e.handleError,load:e.selectScript}})],1),r("div",{staticClass:"divider"}),r("div",{staticClass:"line"},[r("span",{staticClass:"title"},[e._v("输入存档文件")]),r("span",{staticClass:"subtitle"},[e._v("留空则会生成新的存档")]),e.selectedBundle?r("span",{staticClass:"subtitle"},[e._v("输入成功√")]):e._e(),r("WideFileLoader",{attrs:{accept:".json",json:!0},on:{error:e.handleError,load:e.selectBundle}})],1),r("div",{staticClass:"divider"}),r("div",{staticClass:"line tool-bar"},[r("button",{on:{click:e.start}},[e._v("开始")])])])])},m=[],h=(r("a623"),r("45fc"),r("b64b"),r("07ac"),r("53ca")),v=function(e){return"object"===Object(h["a"])(e)&&!Array.isArray(e)},_=function(e){return Array.isArray(e)},b=function(e){return null===e||void 0===e},g=function(e){return"string"===typeof e},y=function(e){return"number"===typeof e};function j(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r){return t.some((function(t){return t(e,r)}))}}function k(e){return function(t,r){return!!v(t)&&Object.keys(e).every((function(n){return e[n](t[n],r)}))}}function x(e){return function(t,r){return!!v(t)&&Object.values(t).every((function(t){return e(t,r)}))}}function O(e){return function(t,r){return!!_(t)&&t.every((function(t){return e(t,r)}))}}k({name:g,version:g,resources:x(g),roles:x(k({name:g,pic:g})),nodes:O(k({text:g,target:j(b,y),background:g,role:g,options:j(b,O(k({text:g,target:j(b,y)})))}))}),k({roles:x(k({pic:function(e,t){return!!t.resources[e]}})),nodes:O(k({role:j(b,(function(e,t){return!!t.roles[e]})),background:j(b,(function(e,t){return!!t.resources[e]}))}))});function w(e){return!0}function S(e,t){if(!e)return null;var r=new FileReader;r.onload=function(){try{var e=JSON.parse(r.result);t(e)}catch(n){t(null,"读取失败，可能不是JSON格式文件！")}},r.onerror=function(){return t(null,r.error)},r.readAsText(e)}function C(e,t){if(!e)return null;var r=new FileReader;r.onload=function(){return t(r.result)},r.onerror=function(){return t(null,r.error)},r.readAsText(e)}var N={name:"Test Script",version:"1.0.1",nodes:[{text:"你好!",target:1,background:"bg1",role:"lty"},{text:"And then ..."},{text:"Hello World!",options:[{text:"Hello JavaScript"},{text:"Hello JavaScript"}]}],roles:{lty:{name:"洛天依",pic:"pic_lty"},yzl:{name:"乐正绫",pic:"pic_yzl"}},resources:{pic_lty:"/test/assets/pic_lty.png",pic_yzl:"/test/assets/pic_yzl.png",bg1:"/test/assets/bg1.jpg",bg2:"/test/assets/bg2.jpg"}},$=N,B=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:"wide-file-loader"+(e.inline?" inline":"")},[r("div",{staticClass:"input-wrapper"},["checkbox"===(e.useUrl?"url":"file")?r("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],ref:"input",attrs:{accept:e.accept,placeholder:e.placeholder,type:"checkbox"},domProps:{checked:Array.isArray(e.url)?e._i(e.url,null)>-1:e.url},on:{change:function(t){var r=e.url,n=t.target,a=!!n.checked;if(Array.isArray(r)){var i=null,s=e._i(r,i);n.checked?s<0&&(e.url=r.concat([i])):s>-1&&(e.url=r.slice(0,s).concat(r.slice(s+1)))}else e.url=a}}}):"radio"===(e.useUrl?"url":"file")?r("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],ref:"input",attrs:{accept:e.accept,placeholder:e.placeholder,type:"radio"},domProps:{checked:e._q(e.url,null)},on:{change:function(t){e.url=null}}}):r("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],ref:"input",attrs:{accept:e.accept,placeholder:e.placeholder,type:e.useUrl?"url":"file"},domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value)}}})]),r("div",{staticClass:"buttons"},[r("button",{on:{click:function(t){e.useUrl=!e.useUrl}}},[e._v(e._s(e.useUrl?"使用文件":"使用URL"))]),e.button?r("button",{attrs:{disabled:e.useUrl&&!e.url&&!e.placeholder},on:{click:e.load}},[e._v("确定")]):e._e()])])},U=[],A=(r("c975"),r("bc3a")),L={name:"WideFileLoader",props:{disabled:{type:Boolean,default:!1},json:{type:Boolean,default:!1},accept:{type:String,default:"*/*"},inline:{type:Boolean,default:!1},button:{type:Boolean,default:!0},placeholder:{type:String,default:""}},data:function(){return{useUrl:!1,url:""}},methods:{load:function(){(this.useUrl?this.loadUrl:this.loadFile)()},loadFile:function(){var e=this,t=this.$refs.input.files[0];t||this.$emit("error","还未输入文件"),C(t,(function(t,r){return e.processData(t,r)}))},loadUrl:function(){var e=this,t=location.href,r=t.substring(0,t.indexOf("?")||t.length);console.log("baseURL",r),A["get"](this.url||this.placeholder,{baseURL:r}).then((function(t){return e.processData(t.data)})).catch((function(t){return e.processData(null,t)}))},processData:function(e,t){if(t)this.$emit("error",t);else if(this.json)if("object"===Object(h["a"])(e))this.$emit("load",e);else try{var r=JSON.parse(e);r?this.$emit("load",r):this.$emit("error","解析JSON失败")}catch(n){this.$emit("error",n)}else"object"===Object(h["a"])(e)?this.$emit("load",JSON.stringify(e)):this.$emit("load",e)}}},P=L,J=(r("9535"),Object(u["a"])(P,B,U,!1,null,"f16a5f2a",null)),F=J.exports,D={name:"GameLoader",components:{WideFileLoader:F},data:function(){return{selectedScript:!1,scriptName:null,scriptVersion:null,selectedBundle:!1}},methods:{handleError:function(e){alert(e)},useTestScript:function(){this.selectScript($)},selectScript:function(e){(w(e)||confirm("该脚本不符合规范，是否继续？"))&&(this.selectedScript=!0,this.scriptName=e.name,this.scriptVersion=e.version,this.$emit("load-script",e))},selectBundle:function(e){this.selectedBundle=!0,this.$emit("load-bundle",e)},load:function(){var e=this,t=this.$refs.scriptInput.files[0],r=this.$refs.bundleInput.files[0];S(t,(function(t,r){r?alert(r):e.selectScript(t)})),S(r,(function(t,r){r?alert(r):e.selectBundle(t)}))},start:function(){this.selectedScript?(this.selectedBundle||(alert("还未载入存档，将会自动生成存档。"),this.selectBundle({current:0})),this.$emit("start-game")):alert("还未载入脚本！")}}},E=D,R=(r("8983"),Object(u["a"])(E,f,m,!1,null,"264cc948",null)),T=R.exports,I={name:"App",components:{Displayer:p,GameLoader:T},data:function(){return{script:$,bundle:null,started:!1}},methods:{loadScript:function(e){this.script=e},loadBundle:function(e){this.bundle=e},startGame:function(){console.log("started",this.started),this.started=!0,console.log("started",this.started)}}},G=I,W=(r("034f"),r("b0a0"),Object(u["a"])(G,a,i,!1,null,null,null)),z=W.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(z)}}).$mount("#app")},"64ef":function(e,t,r){"use strict";var n=r("559d"),a=r.n(n);a.a},"85ec":function(e,t,r){},8983:function(e,t,r){"use strict";var n=r("c9a5"),a=r.n(n);a.a},9535:function(e,t,r){"use strict";var n=r("c114"),a=r.n(n);a.a},b0a0:function(e,t,r){"use strict";var n=r("452c"),a=r.n(n);a.a},c114:function(e,t,r){},c9a5:function(e,t,r){}});
//# sourceMappingURL=app.2eeef215.js.map
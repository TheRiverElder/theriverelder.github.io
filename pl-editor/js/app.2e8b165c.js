(function(t){function e(e){for(var a,r,o=e[0],c=e[1],l=e[2],d=0,p=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&p.push(s[r][0]),s[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(p.length)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(a=!1)}a&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},s={app:0},i=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/pl-editor/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"00a8":function(t,e,n){"use strict";var a=n("6e3d"),s=n.n(a);s.a},"034f":function(t,e,n){"use strict";var a=n("85ec"),s=n.n(a);s.a},"0b92":function(t,e,n){"use strict";var a=n("615a"),s=n.n(a);s.a},"1c73":function(t,e,n){},3271:function(t,e,n){},"32c7":function(t,e,n){"use strict";var a=n("7d9e"),s=n.n(a);s.a},3456:function(t,e,n){"use strict";var a=n("83c7"),s=n.n(a);s.a},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{attrs:{id:"app"},on:{keyup:t.handleKeyUp}},[n("v-app-bar",{attrs:{app:"",color:"primary"}},[n("v-tabs",{staticClass:"flex-grow-0 flex-shrink-1 width-fit",staticStyle:{width:"fit-content"},attrs:{color:"white"},model:{value:t.currentPageIndex,callback:function(e){t.currentPageIndex=e},expression:"currentPageIndex"}},t._l(t.links,(function(e){return n("v-tab",{key:e.to,staticClass:"white--text",attrs:{to:e.to}},[t._v(t._s(e.text))])})),1),n("v-card",{staticClass:"flex-grow-1 pa-2 ma-2",attrs:{flat:""}},[n("v-icon",{staticClass:"mr-2"},[t._v("mdi-information-outline")]),n("span",{staticClass:"grey--text"},[t._v(t._s(t.messages[t.messages.length-1]))])],1)],1),n("v-main",{staticClass:"fill-y"},[n("router-view")],1)],1)},i=[],r=(n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("ec26")),o="river-galgame-project";function c(t){if(t){var e=JSON.stringify(t);return localStorage.setItem(o,e),e}}function l(){return JSON.parse(localStorage.getItem(o))}function u(t){return t||(t={info:{name:"未命名剧本",version:"1.0.0",authors:["RiverElder"]},data:{},chunks:[],roles:[],resources:[],addData:function(t){var e=Object(r["a"])();return this.data[e]=t,e}}),t.addData=function(t){var e=Object(r["a"])();return this.data[e]=t,e},t}var d={project:u(l()),script:null,chunkEditorBar:{selectState:new Set,primaryRoleUid:null,secondaryRoleUid:null,fillMode:"all",clickMode:"fill",selectRange:function(t,e){for(var n=t;n<=e;n++)this.selectState.add(n)}},messages:["打开新世界的大门"]},p=d,f=(n("99af"),n("4160"),n("d81d"),n("b0c0"),n("159b"),n("2909")),v=n("aeb1"),h=n.n(v),m=p.project;function g(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=c(m);if(p.messages.push("已缓存工程"),t)if(e){var n=p.project.info.name+".proj.json";p.messages.push("开始下载工程文件："+n),h()(e,n,"application/json")}else p.messages.push("未下载工程文件")}function x(){var t={},e=m.resources.map((function(t){return m.data[t].src}));m.resources.forEach((function(e,n){return t[e]=n}));var n=m.roles.map((function(e){var n=m.data[e];return{name:n.name,avatar:t[n.avatar],pic:t[n.pic]}}));m.roles.forEach((function(e,n){return t[e]=n}));var a=[];m.chunks.map((function(e){var n=m.data[e];t[e]=a.length,a.push.apply(a,[["bg",t[n.background]],["bgm",t[n.bgm]]].concat(Object(f["a"])(n.sections.map((function(e){return["line",e.text,t[e.speaker]]}))),Object(f["a"])(n.exits.map((function(e){return["exit",e.text,t[e.target]]})))))})),a.forEach((function(e){"exit"===e[0]&&(e[2]=t[e[2]])}));var s={info:m.info,instructions:a,resources:e,roles:n};p.script=s,p.messages.push("编译完成，可以演示或者下载脚本")}function b(){if(p.script){var t=p.script.info.name+".json";p.messages.push("开始下载："+t),h()(JSON.stringify(p.script),t,"application/json")}else p.messages.push("无可用的编译后脚本")}function k(t){var e=new FileReader;e.onload=function(){return _(JSON.parse(e.result))},e.readAsText(t.target.files[0])}function _(t){t&&Object.assign(m,t)}var C={name:"App",data:function(){return{links:[{to:"/",text:"主页"},{to:"/resource-manager",text:"资源"},{to:"/role-manager",text:"角色"},{to:"/chunk-manager",text:"台词"},{to:"/inject-page",text:"注入"},{to:"/demonstration",text:"演示"}],currentPageIndex:0,messages:p.messages}},methods:{handleKeyUp:function(t){"s"===t.key&&t.ctrlKey&&(t.preventDefault(),t.stopPropagation(),g(t.shiftKey))}}},w=C,y=(n("034f"),n("2877")),j=n("6544"),V=n.n(j),I=n("7496"),S=n("40dc"),O=n("b0af"),R=n("132d"),U=n("f6c4"),P=n("71a3"),$=n("fe57"),B=Object(y["a"])(w,s,i,!1,null,null,null),E=B.exports;V()(B,{VApp:I["a"],VAppBar:S["a"],VCard:O["a"],VIcon:R["a"],VMain:U["a"],VTab:P["a"],VTabs:$["a"]});var N=n("8c4f"),L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home d-flex flex-column justify-space-around align-center"},[n("v-card",{staticClass:"script-info pa-5"},[n("v-text-field",{attrs:{label:"剧本名："},model:{value:t.info.name,callback:function(e){t.$set(t.info,"name",e)},expression:"info.name"}}),n("v-text-field",{attrs:{label:"版本："},model:{value:t.info.version,callback:function(e){t.$set(t.info,"version",e)},expression:"info.version"}}),n("v-combobox",{attrs:{label:"创作者：",chips:"",multiple:"",clearable:"","deletable-chips":"","disable-lookup":""},model:{value:t.info.authors,callback:function(e){t.$set(t.info,"authors",e)},expression:"info.authors"}})],1),n("div",[n("v-btn",{on:{click:t.saveProject}},[n("v-icon",[t._v("mdi-download")]),t._v("保存项目 ")],1),n("v-btn",{on:{click:t.compile}},[n("v-icon",[t._v("mdi-arrow-right")]),t._v("编译 ")],1),n("v-btn",{on:{click:t.compile}},[n("v-icon",[t._v("mdi-download")]),t._v("下载脚本 ")],1),n("v-btn",[n("v-icon",[t._v("mdi-upload")]),n("span",[t._v("导入项目")]),n("input",{staticClass:"fill",attrs:{type:"file"},on:{input:t.loadProject}})],1)],1),n("article",[n("h1",[t._v("江奶奶的Galgame编辑器")]),n("h2",[t._v("食用方法")]),n("h3",[t._v("开始项目")]),n("ol",[n("li",[t._v("首先在顶部导航栏点击“资源”，上传所需的各种资源（主要是图片），其它资源暂时不支持预览。")]),n("li",[t._v("然后再顶部导航栏点击“角色”，在左侧列表中点击“+新角色”按键，然后填充名字、头像、立绘。其中头像只是方便后续文本编辑，并不会对编译后的脚本呢产生影响。")]),n("li",[t._v("然后在顶部导航栏点击“台词”，在左侧列表中点击“+新文本段”按键，点击右边面板左上角的三条横杠（"),n("v-app-bar-nav-icon"),t._v("）按钮，填充该文本段所需的信息，而后即可收起信息面板，编辑台词")],1),t._m(0),n("li",[t._v("点击“编译”生成脚本，而后可以选择“下载脚本”或者到“演示面板”开始测试。")])])])],1)},M=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",[t._v("回到“主页”，点击“保存项目”"),n("del",[t._v("（或者在任何页面按下 "),n("em",[t._v("ctrl")]),t._v(" + "),n("em",[t._v("S")]),t._v("缓存，或者"),n("em",[t._v("ctrl")]),t._v(" + "),n("em",[t._v("shift")]),t._v(" + "),n("em",[t._v("S")]),t._v("下载）")]),t._v("。")])}],T={name:"Home",data:function(){return p.project},methods:{saveProject:g,compile:x,downloadScript:b,loadProject:k,fillProject:_}},A=T,D=(n("ed7e"),n("5bc1")),z=n("8336"),K=n("2b5d"),F=n("8654"),J=Object(y["a"])(A,L,M,!1,null,"645b45e4",null),G=J.exports;V()(J,{VAppBarNavIcon:D["a"],VBtn:z["a"],VCard:O["a"],VCombobox:K["a"],VIcon:R["a"],VTextField:F["a"]});var H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{staticClass:"resource-manager d-flex flex-wrap",on:{dragover:function(e){t.overlay=!0},dragend:function(e){t.overlay=!1},drop:t.handleDrop}},[t._l(t.resources,(function(e){return n("Resouece",{key:e,staticClass:"resource ma-3",attrs:{uid:e,res:t.data[e]}})})),n("v-card",{staticClass:"resource ma-3 d-flex flex-column"},[n("div",{staticClass:"input-wrapper flex-grow-1 flex-shrink-1 d-flex justify-center align-center"},[n("v-icon",{attrs:{"x-large":""}},[t._v("mdi-file-multiple")]),n("input",{attrs:{type:"file",multiple:""},on:{change:t.inputFiles}})],1),n("v-card-subtitle",[t._v("拖拽或点击输入文件")])],1),n("v-overlay",{staticClass:"fill ma-auto",attrs:{value:!1,absolute:""}},[n("div",{staticClass:"overlay input-wrapper d-flex flex-column justify-center align-center"},[n("v-icon",{attrs:{size:"100"}},[t._v("mdi-file-multiple")]),n("p",{staticClass:"mt-10"},[t._v("松开鼠标以输入文件")]),n("input",{attrs:{type:"file",multiple:""},on:{change:t.inputFiles}})],1)])],2)},X=[],Y=(n("baa5"),n("fb6a"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card",{staticClass:"d-flex flex-column"},[n("v-img",{staticClass:"flex-shrink-1",attrs:{src:t.res.src,contain:""}}),n("v-card-title",{staticClass:"name"},[n("v-input",{attrs:{"hide-details":"auto","error-messages":t.errors}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.res.name,expression:"res.name"}],ref:"nameInput",domProps:{value:t.res.name},on:{input:[function(e){e.target.composing||t.$set(t.res,"name",e.target.value)},t.handleNameChange]}})])],1),n("v-card-actions",[n("v-btn",{attrs:{icon:""},on:{click:t.deleteSelf}},[n("v-icon",[t._v("mdi-delete")])],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-share")]),n("input",{ref:"btnReplace",staticClass:"fill",attrs:{type:"file"},on:{input:t.replaceRes}})],1)],1)],1)}),q=[],Q=(n("c975"),n("a434"),n("2b3d"),p.project),W={name:"Resource",props:{uid:String,res:Object},data:function(){return{data:Q.data,resources:Q.resources,errors:null}},methods:{handleNameChange:function(t){0===t.target.value.length?this.errors="名字不可为空":this.errors=null},deleteSelf:function(){var t=Q.resources.indexOf(this.uid);Q.resources.splice(t,1),delete Q.data[this.uid]},replaceRes:function(t){this.res.src=URL.createObjectURL(t.target.files[0])||this.res.src,this.$forceUpdate()}}},Z=W,tt=(n("32c7"),n("99d9")),et=n("adda"),nt=n("b675"),at=Object(y["a"])(Z,Y,q,!1,null,"5b18b583",null),st=at.exports;V()(at,{VBtn:z["a"],VCard:O["a"],VCardActions:tt["a"],VCardTitle:tt["c"],VIcon:R["a"],VImg:et["a"],VInput:nt["a"]});var it=p.project,rt={name:"ResourceManager",components:{Resouece:st},data:function(){return{resources:it.resources,data:it.data,overlay:!1}},methods:{inputFiles:function(t){t.target.files.forEach((function(t){var e=t.name.lastIndexOf("."),n=e>=0?t.name.slice(0,e):t.name,a=new FileReader;a.onload=function(){it.resources.push(it.addData({name:n,src:a.result}))},a.readAsDataURL(t)}))},handleDrop:function(t){console.log("ecent",t),this.overlay=!1}}},ot=rt,ct=(n("00a8"),n("a523")),lt=n("a797"),ut=Object(y["a"])(ot,H,X,!1,null,"e9297880",null),dt=ut.exports;V()(ut,{VCard:O["a"],VCardSubtitle:tt["b"],VContainer:ct["a"],VIcon:R["a"],VOverlay:lt["a"]});var pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fill d-flex"},[n("v-navigation-drawer",{staticClass:"role-list",attrs:{permanent:""}},[n("v-list",[n("v-list-item-group",{model:{value:t.roleIndex,callback:function(e){t.roleIndex=e},expression:"roleIndex"}},t._l(t.roles,(function(e){return n("v-list-item",{key:e},[n("RAvatar",{staticClass:"mr-5",attrs:{src:t.getAvatarUrl(e),size:"2em"}}),t._v(" "+t._s(t.data[e].name)+" ")],1)})),1)],1),n("div",{staticClass:"mx-5"},[n("v-btn",{attrs:{block:""},on:{click:t.addRole}},[n("v-icon",[t._v("mdi-plus")]),t._v(" 新角色 ")],1)],1)],1),t.role?n("div",{staticClass:"role ma-5 d-flex flex-column align-center"},[n("div",{staticClass:"input d-flex align-start"},[n("label",{staticClass:"mr-2"},[t._v("名字:")]),n("v-input",{staticClass:"input flex-grow-0",attrs:{messages:"必填，最好不要超过三个中文",placeholder:"角色的名字"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.role.name,expression:"role.name"}],ref:"nameInput",attrs:{autofocus:""},domProps:{value:t.role.name},on:{input:function(e){e.target.composing||t.$set(t.role,"name",e.target.value)}}})]),n("v-spacer"),n("label",{staticClass:"mr-2"},[t._v("头像:")]),n("div",{staticClass:"input flex-grow-0"},[n("v-autocomplete",{staticClass:"ma-0",attrs:{dense:"",messages:"无实际用途，仅方便编辑",placeholder:"角色的头像","no-data-text":"无可用资源",items:t.resList,"item-text":"name","item-value":"uid"},model:{value:t.role.avatar,callback:function(e){t.$set(t.role,"avatar",e)},expression:"role.avatar"}})],1),n("RAvatar",{staticClass:"ml-3",attrs:{src:t.avatarUrl,size:"3em"}})],1),n("v-input",{staticClass:"input flex-grow-0"},[n("label",{staticClass:"mr-2"},[t._v("立绘:")]),n("v-autocomplete",{attrs:{placeholder:"角色的立绘","no-data-text":"无可用资源",items:t.resources.map((function(e){return Object.assign({},t.data[e],{uid:e})})),"item-text":"name","item-value":"uid"},model:{value:t.role.pic,callback:function(e){t.$set(t.role,"pic",e)},expression:"role.pic"}})],1),n("div",{staticClass:"img-wrapper"},[n("img",{attrs:{src:t.picUrl}})]),n("v-btn",{staticClass:"white--text",attrs:{color:"red"},on:{click:t.deleteRole}},[n("v-icon",[t._v("mdi-minus")]),t._v(" 删除该角色 ")],1)],1):t._e()],1)},ft=[],vt=n("5530"),ht=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-avatar",{attrs:{size:t.size}},[t.src?n("v-img",{attrs:{src:t.src,contain:""}}):n("v-icon",{attrs:{size:"normal"}},[t._v(t._s(t.emptyIcon))])],1)},mt=[],gt=(n("a9e3"),{name:"RAvatar",props:{src:String,size:{type:[String,Number],default:"1em"},emptyIcon:{type:String,default:"mdi-account-alert-outline"}},data:function(){return{text:this.value}}}),xt=gt,bt=n("8212"),kt=Object(y["a"])(xt,ht,mt,!1,null,"651caef7",null),_t=kt.exports;V()(kt,{VAvatar:bt["a"],VIcon:R["a"],VImg:et["a"]});var Ct=p.project,wt={name:"RoleManager",components:{RAvatar:_t},data:function(){return{roleIndex:null,data:Ct.data,resources:Ct.resources,roles:Ct.roles,role:null}},watch:{roleIndex:function(t){var e=Ct.roles[t];this.role=e?Ct.data[e]:null}},computed:{resList:function(){var t=this;return Ct.resources.map((function(e){return Object(vt["a"])({uid:e},t.data[e])}))},picUrl:function(){var t=this.role;if(t&&t.pic){var e=Ct.data[t.pic];return e?e.src:null}return null},avatarUrl:function(){var t=this.role;if(t&&t.avatar){var e=Ct.data[t.avatar];return e?e.src:null}return null}},methods:{addRole:function(){Ct.roles.push(Ct.addData({name:"未命名角色",avatar:null,pic:null})),this.roleIndex=Ct.roles.length-1},deleteRole:function(){if("number"===typeof this.roleIndex&&this.roleIndex>=0){var t=Ct.roles[this.roleIndex];Ct.roles.splice(this.roleIndex,1),delete Ct.data[t],this.roleIndex=null}},getAvatarUrl:function(t){var e=Ct.data[t];if(e){var n=Ct.data[e.avatar||e.pic];return n?n.src:null}return null}}},yt=wt,jt=(n("a3c3"),n("c6a6")),Vt=n("8860"),It=n("da13"),St=n("1baa"),Ot=n("f774"),Rt=n("2fa4"),Ut=Object(y["a"])(yt,pt,ft,!1,null,"2b1cc075",null),Pt=Ut.exports;V()(Ut,{VAutocomplete:jt["a"],VBtn:z["a"],VIcon:R["a"],VInput:nt["a"],VList:Vt["a"],VListItem:It["a"],VListItemGroup:St["a"],VNavigationDrawer:Ot["a"],VSpacer:Rt["a"]});var $t=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fill d-flex"},[n("v-navigation-drawer",{attrs:{permanent:""}},[n("v-list",[n("v-list-item-group",{model:{value:t.chunkIndex,callback:function(e){t.chunkIndex=e},expression:"chunkIndex"}},t._l(t.chunkTitleList,(function(e){return n("v-list-item",{key:e.uid},[t._v(t._s(e.title))])})),1)],1),n("div",{staticClass:"mx-5"},[n("v-btn",{attrs:{block:""},on:{click:t.addChunk}},[n("v-icon",[t._v("mdi-plus")]),t._v(" 新文本段 ")],1)],1)],1),n("div",{staticClass:"content flex-grow-1 d-flex flex-column"},[n("div",{staticClass:"chunk-wrapper flex-grow-1"},[t.chunk?n("Chunk",{staticClass:"chunk",attrs:{chunk:t.chunk,index:t.chunkIndex}}):t._e()],1),t.hasPrevPage?n("div",{staticClass:"page-changer prev-page px-2 d-flex align-center",on:{click:t.toPrevPage}},[n("v-icon",[t._v("mdi-arrow-left")])],1):t._e(),t.hasNextPage?n("div",{staticClass:"page-changer next-page px-2 d-flex align-center",on:{click:t.toNextPage}},[n("v-icon",[t._v("mdi-arrow-right")])],1):t._e()])],1)},Bt=[],Et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chunk fill"},[n("v-img",{staticClass:"background",attrs:{cover:"",width:"100%",gradient:"#ffffffaf 0%, #ffffffaf 50%, #fff 100%",src:t.backgroundUrl}}),n("v-container",{staticClass:"fill pa-0 d-flex flex-column"},[n("v-toolbar",{staticClass:"topbar flex-grow-0",attrs:{dense:""}},[n("v-app-bar-nav-icon",{on:{click:function(e){t.showInfo=!t.showInfo}}}),n("v-toolbar-title",[t._v(t._s(t.chunk.title))]),n("v-spacer"),n("v-btn",{attrs:{icon:""},on:{click:t.deleteSelf}},[n("v-icon",[t._v("mdi-delete")])],1),n("v-slide-y-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showInfo,expression:"showInfo"}],staticClass:"chunkInfo px-15"},[n("v-row",{attrs:{align:"baseline"}},[n("v-col",{attrs:{cols:"2"}},[t._v("标题")]),n("v-col",{attrs:{cols:"10"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.chunk.title,expression:"chunk.title"}],staticClass:"text-h4",attrs:{type:"text",placeholder:"此处输入标题"},domProps:{value:t.chunk.title},on:{input:function(e){e.target.composing||t.$set(t.chunk,"title",e.target.value)}}})])],1),n("v-row",{attrs:{align:"baseline"}},[n("v-col",{attrs:{cols:"2"}},[t._v("副标题")]),n("v-col",{attrs:{cols:"10"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.chunk.subtitle,expression:"chunk.subtitle"}],staticClass:"text-subtitle-1",attrs:{type:"text",placeholder:"此处输入副标题"},domProps:{value:t.chunk.subtitle},on:{input:function(e){e.target.composing||t.$set(t.chunk,"subtitle",e.target.value)}}})])],1),n("v-row",{attrs:{align:"baseline"}},[n("v-col",{attrs:{cols:"2"}},[t._v("背景")]),n("v-col",{attrs:{cols:"10"}},[n("v-autocomplete",{staticClass:"text-subtitle-1",attrs:{dense:"","hide-details":"auto","no-data-text":"无可用资源",items:t.resList,"item-text":"name","item-value":"uid",placeholder:"选择背景"},model:{value:t.chunk.background,callback:function(e){t.$set(t.chunk,"background",e)},expression:"chunk.background"}})],1)],1),n("v-row",{attrs:{align:"baseline"}},[n("v-col",{attrs:{cols:"2"}},[t._v("BGM")]),n("v-col",{attrs:{cols:"10"}},[n("v-autocomplete",{staticClass:"text-subtitle-1",attrs:{dense:"","hide-details":"auto","no-data-text":"无可用资源",items:t.resList,"item-text":"name","item-value":"uid",placeholder:"选择BGM"},model:{value:t.chunk.bgm,callback:function(e){t.$set(t.chunk,"bgm",e)},expression:"chunk.bgm"}})],1)],1),n("v-container",[t._l(t.chunk.exits,(function(e,a){return n("v-row",{key:a},[n("v-col",{attrs:{cols:"1"}},[t._v(t._s(a+1))]),n("v-col",{attrs:{cols:"8"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"exit.text"}],domProps:{value:e.text},on:{input:function(n){n.target.composing||t.$set(e,"text",n.target.value)}}})]),n("v-col",{attrs:{cols:"2"}},[n("v-select",{attrs:{dense:"","hide-details":"",items:t.chunkList,"item-text":"title","item-value":"uid"},model:{value:e.target,callback:function(n){t.$set(e,"target",n)},expression:"exit.target"}})],1),n("v-col",{attrs:{cols:"1"}},[n("v-btn",{on:{click:function(e){return t.deleteExit(a)}}},[t._v("删除")])],1)],1)})),n("v-row",[n("v-btn",{attrs:{block:""},on:{click:t.addExit}},[t._v("新分支")])],1)],2)],1)])],1),n("v-divider"),n("v-virtual-scroll",{staticClass:"content overflow-auto ma-0 px-15 py-2 flex-grow-1",attrs:{"item-height":"35",items:t.chunk.sections},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item,s=e.index;return[n("Section",{ref:"section",attrs:{index:s,section:a,"is-only":1===t.chunk.sections.length},on:{"add-line":t.addLine,"delete-line":t.deleteLine,focus:t.focusOnSection}})]}}])}),n("v-row",{staticClass:"flex-grow-0 pa-2"},[n("v-btn",{ref:"btnAdd",attrs:{block:"",elevation:"0"},on:{click:t.addLine}},[n("v-icon",[t._v("mdi-plus")]),t._v(" 新台词 ")],1)],1)],1)],1)},Nt=[],Lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:"section mt-2 d-flex align-center"+(t.selected?" selected":""),attrs:{align:"start"},on:{mouseenter:function(e){t.showBtnBar=!0},mouseleave:function(e){t.showBtnBar=!1},click:function(e){return e.shiftKey?e.ctrlKey||e.altKey||e.metaKey?null:(e.stopPropagation(),t.handleClick(e)):null}}},[n("span",{staticClass:"line-number text-subtitle-2 mr-3"},[t._v(t._s(t.index+1))]),t.changingSpeaker?n("span",{staticClass:"speaker"},[n("v-select",{staticClass:"ma-0",attrs:{dense:"","hide-details":"auto",height:"1em",items:t.roleList,"item-text":"name","item-value":"uid","no-data-text":"无可用角色"},on:{blur:function(e){t.changingSpeaker=!1},input:function(e){t.changingSpeaker=!1}},model:{value:t.section.speaker,callback:function(e){t.$set(t.section,"speaker",e)},expression:"section.speaker"}})],1):n("span",{staticClass:"speaker d-flex align-center",on:{click:function(e){e.stopPropagation(),t.changingSpeaker=!0}}},[n("RAvatar",{attrs:{size:"2em",contain:"",src:t.speakerPicUrl}}),n("span",[t._v(t._s(t.speakerName))])],1),n("span",[t._v(":")]),n("span",{staticClass:"mx-2 flex-grow-1"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.section.text,expression:"section.text"}],ref:"textInput",staticClass:"text-input py-1",domProps:{value:t.section.text},on:{keyup:t.handleInputKey,input:function(e){e.target.composing||t.$set(t.section,"text",e.target.value)}}})]),n("v-expand-x-transition",[t.showBtnBar?n("v-btn-toggle",{staticClass:"btn-tgl",attrs:{dense:"",rounded:"",borderless:""}},[n("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"2em",color:"green"},on:{click:function(e){return t.$emit("add-line",t.index)}}},[n("v-icon",[t._v("mdi-plus")])],1),t.isOnly?t._e():n("v-btn",{staticClass:"delete-btn",attrs:{icon:"",height:"2em",color:"red"},on:{click:function(e){return t.$emit("delete-line",t.index)}}},[n("v-icon",[t._v("mdi-minus")])],1)],1):t._e()],1)],1)},Mt=[],Tt=p.project,At={name:"Section",components:{RAvatar:_t},props:{index:Number,section:Object,isOnly:Boolean},data:function(){return{changingSpeaker:!1,showBtnBar:!1}},computed:{data:function(){return Tt.data},roleList:function(){return Tt.roles.map((function(t){return Object(vt["a"])({uid:t},Tt.data[t])}))},speakerName:function(){if(this.section.speaker){var t=Tt.data[this.section.speaker];if(t&&t.pic)return t.name}return"      "},speakerPicUrl:function(){if(this.section.speaker){var t=Tt.data[this.section.speaker];if(t){var e=Tt.data[t.avatar||t.pic];if(e)return e.src}}return null},selected:function(){return p.chunkEditorBar.selectState.has(this.index)}},methods:{focus:function(){this.$refs.textInput.focus()},handleClick:function(){"select"===p.chunkEditorBar.clickMode?p.chunkEditorBar.selectState.has(this.index)?p.chunkEditorBar.selectState.delete(this.index):p.chunkEditorBar.selectState.add(this.index):"fill"===p.chunkEditorBar.clickMode&&(this.section.speaker=p.chunkEditorBar.primaryRoleUid||this.section.speaker)},handleInputKey:function(t){var e=!0;switch(t.key){case"Enter":this.$emit("add-line",this.index+1);break;case"ArrowUp":this.$emit("focus",this.index-1);break;case"ArrowDown":this.$emit("focus",this.index+1);break;case"Backspace":/^\s*$/.test(this.section.text)&&this.$emit("delete-line",this.index);break;default:e=!1}e&&t.preventDefault()}}},Dt=At,zt=(n("0b92"),n("a609")),Kt=n("0789"),Ft=n("b974"),Jt=Object(y["a"])(Dt,Lt,Mt,!1,null,"9dd3d4b6",null),Gt=Jt.exports;V()(Jt,{VBtn:z["a"],VBtnToggle:zt["a"],VExpandXTransition:Kt["b"],VIcon:R["a"],VSelect:Ft["a"]});var Ht=p.project,Xt={name:"Chunk",components:{Section:Gt},props:{chunk:Object,index:Number},data:function(){return{showInfo:!1}},computed:{resList:function(){return Ht.resources.map((function(t){return Object(vt["a"])({uid:t},Ht.data[t])}))},chunkList:function(){return Ht.chunks.map((function(t){return{uid:t,title:Ht.data[t].title}}))},backgroundUrl:function(){if(this.chunk.background){var t=Ht.data[this.chunk.background];return t?t.src:null}return null},data:function(){return Ht.data},roles:function(){return Ht.roles}},methods:{addLine:function(t){var e=this;("number"!==typeof t||t<0||t>this.chunk.sections.length)&&(t=this.chunk.sections.length);var n=t?this.chunk.sections[t-1].speaker:null,a={speaker:n,text:""};this.chunk.sections.splice(t,0,a),this.$nextTick((function(){return e.focusOnSection(t)}))},deleteLine:function(t){this.chunk.sections.splice(t,1)},addExit:function(){this.chunk.exits.push({text:"",target:null})},deleteExit:function(t){this.chunk.exits.splice(t,1)},deleteSelf:function(){var t=Ht.chunks[this.index];Ht.chunks.splice(this.index,1),delete Ht.data[t]},focusOnSection:function(t){t=Math.max(0,Math.min(t,this.sections.length-1)),this.$refs.section[t].focus()}}},Yt=Xt,qt=(n("faa3"),n("62ad")),Qt=n("ce7e"),Wt=n("0fd9"),Zt=n("71d9"),te=n("2a7f"),ee=n("0de5"),ne=Object(y["a"])(Yt,Et,Nt,!1,null,"0a9e3b8b",null),ae=ne.exports;V()(ne,{VAppBarNavIcon:D["a"],VAutocomplete:jt["a"],VBtn:z["a"],VCol:qt["a"],VContainer:ct["a"],VDivider:Qt["a"],VIcon:R["a"],VImg:et["a"],VRow:Wt["a"],VSelect:Ft["a"],VSlideYTransition:Kt["f"],VSpacer:Rt["a"],VToolbar:Zt["a"],VToolbarTitle:te["a"],VVirtualScroll:ee["a"]});var se=p.project,ie={name:"ChunkManager",components:{Chunk:ae},data:function(){return{chunkIndex:null,chunk:null,chunks:se.chunks,data:se.data}},watch:{chunkIndex:function(t){if("number"===typeof t){var e=se.chunks[t];if(e)return void(this.chunk=se.data[e])}this.chunk=null}},computed:{chunkTitleList:function(){var t=this;return this.chunks.map((function(e){return{uid:e,title:t.data[e].title}}))},hasPrevPage:function(){return"number"===typeof this.chunkIndex&&this.chunkIndex>0},hasNextPage:function(){return"number"===typeof this.chunkIndex&&this.chunkIndex<se.chunks.length-1}},methods:{addChunk:function(){this.chunks.push(se.addData({title:"文本段标题",subtitle:"",background:null,bgm:null,sections:[{speaker:null,text:""}],exits:[]})),this.$forceUpdate()},toPrevPage:function(){this.chunkIndex--},toNextPage:function(){this.chunkIndex++}}},re=ie,oe=(n("9e48"),Object(y["a"])(re,$t,Bt,!1,null,"62f02815",null)),ce=oe.exports;V()(oe,{VBtn:z["a"],VIcon:R["a"],VList:Vt["a"],VListItem:It["a"],VListItemGroup:St["a"],VNavigationDrawer:Ot["a"]});var le=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"overflow-hidden fill d-flex flex-column"},[n("div",{staticClass:"d-flex align-center pa-5"},[n("v-chip",{staticClass:"mx-2"},[n("span",{staticClass:"text-subtitle-1 mx-2"},[t._v("初选角色")]),n("RoleSelector",{model:{value:t.primaryRoleUid,callback:function(e){t.primaryRoleUid=e},expression:"primaryRoleUid"}})],1),n("v-chip",{staticClass:"mx-2"},[n("span",{staticClass:"text-subtitle-1 mx-2"},[t._v("次选角色")]),n("RoleSelector",{model:{value:t.secondaryRoleUid,callback:function(e){t.secondaryRoleUid=e},expression:"secondaryRoleUid"}})],1),n("v-chip",{staticClass:"mx-2"},[n("span",[t._v("新文本段")]),n("v-switch",{model:{value:t.newChunk,callback:function(e){t.newChunk=e},expression:"newChunk"}})],1),n("v-chip",{staticClass:"mx-2"},[n("span",{staticClass:"text-subtitle-1 mx-2"},[t._v("插入章节")]),n("v-select",{attrs:{items:t.chunkList,"item-text":"title","item-value":"uid","no-data-text":"无可用章节",disabled:t.newChunk},model:{value:t.chunkUid,callback:function(e){t.chunkUid=e},expression:"chunkUid"}})],1),n("v-btn-toggle",{attrs:{dense:"",rounded:""}},[n("v-btn",{on:{click:t.inject}},[t._v("注入")]),n("v-btn",{on:{click:function(e){t.text=""}}},[t._v("清空")])],1)],1),n("div",{staticClass:"overflow-auto flex-grow-1 px-5"},[n("v-textarea",{staticClass:"fill ma-0",attrs:{height:"100%","auto-grow":"","hide-details":"",dense:"","no-resize":""},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1),n("v-snackbar",{attrs:{timeout:2e3},model:{value:t.hasMessage,callback:function(e){t.hasMessage=e},expression:"hasMessage"}},[t._v(t._s(t.message))])],1)},ue=[],de=(n("4de4"),n("ac1f"),n("1276"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.changingRole?n("span",{staticClass:"role",on:{blur:function(e){t.changingRole=!1}}},[n("v-select",{staticClass:"ma-0",attrs:{dense:"","hide-details":"auto",height:"1em",items:t.roleList,"item-text":"name","item-value":"uid","no-data-text":"无可用角色"},on:{input:t.handleInput},model:{value:t.roleUid,callback:function(e){t.roleUid=e},expression:"roleUid"}})],1):n("span",{staticClass:"role d-flex align-center",on:{click:function(e){t.changingRole=!0}}},[n("RAvatar",{attrs:{size:"2em",contain:"",src:t.rolePicUrl}}),n("span",[t._v(t._s(t.roleName))])],1)}),pe=[],fe=p.project,ve={name:"RoleSelector",components:{RAvatar:_t},props:{value:String},data:function(){return{roles:fe.roles,changingRole:!1,roleUid:this.value}},watch:{value:function(t){this.roleUid=t}},computed:{roleList:function(){return fe.roles.map((function(t){return Object(vt["a"])({uid:t},fe.data[t])}))},roleName:function(){if(this.roleUid){var t=fe.data[this.roleUid];return t.name}return"未指定"},rolePicUrl:function(){if(this.roleUid){var t=fe.data[this.roleUid];if(t){var e=fe.data[t.avatar||t.pic];if(e)return e.src}}return null}},methods:{handleInput:function(){this.$emit("input",this.roleUid),this.changingRole=!1}}},he=ve,me=(n("fd2d"),Object(y["a"])(he,de,pe,!1,null,"36b545ec",null)),ge=me.exports;V()(me,{VSelect:Ft["a"]});var xe={name:"InjectPage",components:{RoleSelector:ge},data:function(){return{text:"",hasMessage:!1,message:null,newChunk:!1,chunkUid:null,primaryRoleUid:null,secondaryRoleUid:null}},computed:{chunkList:function(){var t=p.project.data;return p.project.chunks.map((function(e){return{uid:e,title:t[e].title}}))}},methods:{inject:function(){var t=this;if(/^\s*$/g.test(this.text))this.showMessage("输入文本不可为空!");else{var e=this.text.split(/[\n\r](\s*[\n\r])?/).filter((function(t){return t&&t.length})).map((function(e,n){return{speaker:n%2?t.secondaryRoleUid:t.primaryRoleUid,text:e}}));if(this.newChunk)p.project.chunks.push(p.project.addData({title:"注入文本",subtitle:"",background:null,bgm:null,sections:e,exits:[]}));else{var n,a=p.project.data[this.chunkUid];if(!a)return void this.showMessage("不存在指定文本段");(n=a.sections).push.apply(n,Object(f["a"])(e))}this.showMessage("向【".concat(this.newChunk?"新文本段":p.project.data[this.chunkUid].title,"】注入文本").concat(e.length,"条"))}},showMessage:function(t){this.message=t,this.hasMessage=!0}}},be=xe,ke=(n("3456"),n("cc20")),_e=n("2db4"),Ce=n("b73d"),we=n("a844"),ye=Object(y["a"])(be,le,ue,!1,null,"65e8a157",null),je=ye.exports;V()(ye,{VBtn:z["a"],VBtnToggle:zt["a"],VChip:ke["a"],VSelect:Ft["a"],VSnackbar:_e["a"],VSwitch:Ce["a"],VTextarea:we["a"]});var Ve=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"relative fill"},[n("img",{staticClass:"background fill absolute",attrs:{src:t.background}}),n("audio",{ref:"bgm",attrs:{src:t.bgm,loop:""}}),n("img",{staticClass:"speaker fill absolute",attrs:{src:t.speakerPic}}),n("div",{staticClass:"content fill pa-3 d-flex flex-column justify-end"},[n("div",{staticClass:"text oculus mb-3 pa-2"},[t._v(" "+t._s(t.speakerName)+"："+t._s(t.text)+" ")]),n("ul",{staticClass:"options oculus pa-2"},[t._l(t.options,(function(e,a){return n("li",{key:a,staticClass:"option pa-2",on:{click:t.handleClickOption}},[t._v(" "+t._s(e.text)+" ")])})),t.options.length?t._e():n("li",{staticClass:"option",on:{click:t.handleClickDefaultOption}},[t._v("...")])],2)]),n("div",{staticClass:"debug-panel absolute pa-3"},[n("div",{staticClass:"d-flex justify-center"},[n("v-input",{attrs:{label:"指针："}},[n("input",{directives:[{name:"model",rawName:"v-model.number",value:t.pointer,expression:"pointer",modifiers:{number:!0}}],attrs:{type:"number",min:0,max:t.script.instructions.length-1},domProps:{value:t.pointer},on:{input:function(e){e.target.composing||(t.pointer=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),n("v-btn",{on:{click:t.forceRun}},[t._v("执行")])],1),n("ul",t._l(t.logger,(function(e,a){return n("li",{key:a},[t._v(t._s(e))])})),0)])])},Ie=[],Se=(n("a15b"),{name:"Demonstration",data:function(){return{pointer:0,background:null,bgm:null,speakerPic:null,speakerName:"",line:"",options:[],hasSetText:!1,logger:[]}},watch:{bgm:function(t,e){t!==e&&"string"===typeof t&&t.length>0&&this.$refs.bgm.play()}},computed:{script:function(){return p.script}},methods:{run:function(){while(this.pointer<this.script.instructions.length&&this.canStepIn(this.script.instructions[this.pointer]))this.apply(this.script.instructions[this.pointer]),this.pointer++},forceRun:function(){this.hasSetText=!1,this.run()},apply:function(t){switch(this.log(t.join(" ")),t[0]){case"bg":this.background=this.script.resources[t[1]];break;case"bgm":this.bgm=this.script.resources[t[1]];break;case"line":this.text=t[1];var e=this.script.roles[t[2]];this.speakerPic=this.script.resources[e.pic],this.speakerName=e.name,this.options=[],this.hasSetText=!0;break;case"option":this.options.push({text:t[1],target:t[2]});break}},canStepIn:function(t){switch(t[0]){case"bg":return!0;case"bgm":return!0;case"line":return!this.hasSetText;case"option":return this.hasSetText}},jumpTo:function(t){this.pointer=t},handleClickOption:function(t){this.hasSetText=!1;var e=this.options[t];this.jumpTo(e.target),this.run()},handleClickDefaultOption:function(){this.hasSetText=!1,this.run()},log:function(t){this.logger.length>=10&&this.logger.shift(),this.logger.push(t)}},created:function(){this.run()}}),Oe=Se,Re=(n("7c0c"),Object(y["a"])(Oe,Ve,Ie,!1,null,"7d3e8764",null)),Ue=Re.exports;V()(Re,{VBtn:z["a"],VInput:nt["a"]}),a["a"].use(N["a"]);var Pe=[{path:"/",name:"Home",component:G},{path:"/resource-manager",name:"ResourceManager",component:dt},{path:"/role-manager",name:"RoleManager",component:Pt},{path:"/chunk-manager",name:"ChunkManager",component:ce},{path:"/inject-page",name:"InjectPage",component:je},{path:"/demonstration",name:"Demonstration",component:Ue}],$e=new N["a"]({routes:Pe}),Be=$e,Ee=n("f309");a["a"].use(Ee["a"]);var Ne=new Ee["a"]({});a["a"].config.productionTip=!1,new a["a"]({router:Be,vuetify:Ne,render:function(t){return t(E)}}).$mount("#app")},"5ab7":function(t,e,n){},"615a":function(t,e,n){},"6e3d":function(t,e,n){},7456:function(t,e,n){},"7c0c":function(t,e,n){"use strict";var a=n("a654"),s=n.n(a);s.a},"7d9e":function(t,e,n){},"83c7":function(t,e,n){},"85ec":function(t,e,n){},"9e48":function(t,e,n){"use strict";var a=n("d3c1"),s=n.n(a);s.a},a3c3:function(t,e,n){"use strict";var a=n("3271"),s=n.n(a);s.a},a654:function(t,e,n){},d3c1:function(t,e,n){},ed7e:function(t,e,n){"use strict";var a=n("1c73"),s=n.n(a);s.a},faa3:function(t,e,n){"use strict";var a=n("7456"),s=n.n(a);s.a},fd2d:function(t,e,n){"use strict";var a=n("5ab7"),s=n.n(a);s.a}});
//# sourceMappingURL=app.2e8b165c.js.map
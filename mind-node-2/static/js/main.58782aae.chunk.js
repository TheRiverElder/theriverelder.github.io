(this["webpackJsonpmind-node-2"]=this["webpackJsonpmind-node-2"]||[]).push([[0],{18:function(e,t,o){},19:function(e,t,o){},20:function(e,t,o){},21:function(e,t,o){},23:function(e,t,o){"use strict";o.r(t);var n=o(1),i=o.n(n),s=o(12),r=o.n(s),a=(o(18),o(13)),d=o(8),c=o(2),u=o(10),l=o(3),h=o(4),f=o(7),g=o(6);o(19),o(20);function v(e){var t=[];for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=e[o];"string"===typeof n?t.push(n):n&&t.push(o)}return t.join(" ")}function p(e,t,o){var n=e.get(t);n&&o(n,t)}function j(e){var t,o=null===(t=e.current)||void 0===t?void 0:t.getBoundingClientRect();return{x:(null===o||void 0===o?void 0:o.x)||0,y:(null===o||void 0===o?void 0:o.y)||0,width:(null===o||void 0===o?void 0:o.width)||0,height:(null===o||void 0===o?void 0:o.height)||0}}o(21);var N=o(0);var S=function(e){return Object(N.jsx)("div",{className:v({RadioButton:!0,checked:e.value}),onClick:function(){return e.onChange(!e.value)},children:e.children})},b=function(e){Object(f.a)(o,e);var t=Object(g.a)(o);function o(){var e;Object(l.a)(this,o);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).onHandleMouseDown=function(t){0===t.button&&(t.stopPropagation(),e.props.onDragStart(e.props.node.uid,t))},e.selfRef=i.a.createRef(),e}return Object(h.a)(o,[{key:"componentDidMount",value:function(){this.props.onRectUpdate(this.props.node.uid,j(this.selfRef))}},{key:"componentDidUpdate",value:function(){this.props.onRectUpdate(this.props.node.uid,j(this.selfRef))}},{key:"render",value:function(){var e=this,t=this.props,o=t.node,n=Object(c.a)(o.position,2),i=n[0],s=n[1],r=o.text,a=Object(c.a)(t.anchor,2),d=a[0],u=a[1],l=t.dragging,h=t.linking,f=t.choosen,g=i+d,p=s+u;return Object(N.jsxs)("div",{className:v({MindNodeCard:!0,linking:h,dragging:l,choosen:f}),ref:this.selfRef,style:{left:"".concat(g,"px"),top:"".concat(p,"px")},onClick:function(t){return e.props.onClick(e.props.node.uid,t)},children:[Object(N.jsx)("div",{className:"handle",onMouseDown:this.onHandleMouseDown}),Object(N.jsxs)("div",{className:"wrapper",children:[Object(N.jsx)("div",{className:"text",children:r.split("\n").map((function(e,t){return Object(N.jsx)("p",{children:e},t)}))}),Object(N.jsxs)("div",{className:"tool-bar",children:[Object(N.jsx)(S,{value:h,onChange:function(){return e.props.onClickLinkButton(e.props.node.uid)},children:Object(N.jsx)("span",{children:"\ud83d\udd17"})},h?11:10),Object(N.jsx)(S,{value:f,onChange:function(t){return e.props.onClickChooseButton(e.props.node.uid,t)},children:Object(N.jsx)("span",{children:"\u2714"})},f?1:0)]})]})]})}}]),o}(n.Component),O=b,x=function(e){Object(f.a)(o,e);var t=Object(g.a)(o);function o(e){var n;return Object(l.a)(this,o),(n=t.call(this,e)).getBrief=function(e){var t=n.props.nodes.get(e);return t?"#"+e+"\uff1a"+t.text:"#"+e},n.state={inputingText:e.node.text},n}return Object(h.a)(o,[{key:"render",value:function(){var e=this,t=this.props.node,o=t.uid,n=t.position,i=t.outPorts,s=t.inPorts;return Object(N.jsxs)("div",{children:[Object(N.jsxs)("p",{children:["UID\uff1a#",o]}),Object(N.jsxs)("p",{children:["\u4f4d\u7f6e\uff1a(",n.join(", "),")"]}),Object(N.jsx)("textarea",{value:this.state.inputingText,onChange:function(t){return e.setText(t.target.value)}}),Object(N.jsxs)("p",{children:["\u51fa\u7ebf\uff08",i.length,"\uff09\uff1a"]}),Object(N.jsx)("ol",{children:i.map((function(t){return Object(N.jsx)("li",{children:e.getBrief(t)},t)}))}),Object(N.jsxs)("p",{children:["\u5165\u7ebf\uff08",s.length,"\uff09\uff1a"]}),Object(N.jsx)("ol",{children:s.map((function(t){return Object(N.jsx)("li",{children:e.getBrief(t)},t)}))})]})}},{key:"setText",value:function(e){this.setState((function(){return{inputingText:e}}));var t=Object(d.a)(Object(d.a)({},this.props.node),{},{text:e});this.props.onUpdate(t)}}]),o}(n.Component);function k(e,t){return[e[0]+t[0],e[1]+t[1]]}function y(e,t){return[e[0]-t[0],e[1]-t[1]]}var m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(l.a)(this,e),this.uidCounter=0,this.uidCounter=t}return Object(h.a)(e,[{key:"generate",value:function(){return this.uidCounter++}}]),e}(),C=function(e){Object(f.a)(o,e);var t=Object(g.a)(o);function o(e){var n;return Object(l.a)(this,o),(n=t.call(this,e)).nodeCardRects=new Map,n.nodes=new Map,n.origin=[0,0],n.resetView=function(){var e,t=null===(e=n.poolRef.current)||void 0===e?void 0:e.getBoundingClientRect();if(t){n.origin=[t.width/2,t.height/2];var o=n.canvasRef.current;o&&(o.width=t.width,o.height=t.height),n.forceUpdate()}},n.poolRef=i.a.createRef(),n.canvasRef=i.a.createRef(),n.hideNodeInfoView=function(){return n.setState((function(){return{editingNodeUid:null}}))},n.uidGenerator=new m,n.createNode=function(){var e=n.uidGenerator.generate(),t={uid:e,position:y([0,0],n.state.offset),text:"#".concat(e),outPorts:[],inPorts:[]};n.addNode(t)},n.linkingNodeUid=null,n.onClickNode=function(e,t){t.ctrlKey?n.toggleChooseNode(e):n.setState((function(){return{editingNodeUid:e}}))},n.onMouseDown=function(e){n.state.mouseState||(0===e.nativeEvent.button?n.onSectionChooseStart(e):1===e.nativeEvent.button&&n.onDragPoolStart(e))},n.onMouseMove=function(e){n.state.mouseState&&("dragNode"===n.state.mouseState?n.onDragNodeMove(e):"dragPool"===n.state.mouseState?n.onDragPool(e):"chooseNodes"===n.state.mouseState&&n.onSectionChooseMove(e))},n.onMouseUp=function(e){n.state.mouseState&&("dragNode"===n.state.mouseState?(n.onDragNodeMove(e),n.onDragNodeEnd(e)):"dragPool"===n.state.mouseState?n.onDragPoolEnd(e):"chooseNodes"===n.state.mouseState&&n.onSectionChooseEnd(e))},n.onMouseLeave=function(e){n.onMouseUp(e)},n.draggingNodeStartPositions=new Map,n.dragNodeStartMousePosition=[0,0],n.onDragNodeStart=function(e,t){n.setState((function(){return{mouseState:"dragNode"}})),n.dragNodeStartMousePosition=[t.screenX,t.screenY],[e].concat(Object(u.a)(Array.from(n.choosenNodeUids))).forEach((function(e){return p(n.nodes,e,(function(t){return n.draggingNodeStartPositions.set(e,t.position)}))}))},n.onDragNodeMove=function(e){if(n.draggingNodeStartPositions.size){for(var t=y([e.screenX,e.screenY],n.dragNodeStartMousePosition),o=function(){var e=Object(c.a)(s[i],2),o=e[0],r=k(e[1],t);p(n.nodes,o,(function(e){return n.updateNode(Object(d.a)(Object(d.a)({},e),{},{position:r}))}))},i=0,s=Array.from(n.draggingNodeStartPositions.entries());i<s.length;i++)o();n.updateStateNodes()}},n.onDragNodeEnd=function(e){n.draggingNodeStartPositions.size&&(n.draggingNodeStartPositions.clear(),n.updateStateNodes()),n.setState((function(){return{mouseState:null}}))},n.dragPoolStartOffset=[0,0],n.dragPoolStartMousePosition=[0,0],n.load=function(){try{var e=JSON.parse(n.state.dataString);n.nodes.clear(),n.nodeCardRects.clear(),n.draggingNodeStartPositions.clear(),n.choosenNodeUids.clear(),e.nodes.forEach((function(e){return n.nodes.set(e.uid,e)})),n.setState((function(){return{offset:e.offset,nodes:e.nodes}}))}catch(t){alert("\u89e3\u6790\u6570\u636e\u5931\u8d25\uff01")}},n.save=function(){var e=n.buildPool();n.setState((function(){return{dataString:JSON.stringify(e)}})),console.log(e)},n.choosenNodeUids=new Set,n.setNodeChoosen=function(e,t){console.log("setNodeChoosen",e,t),t?n.chooseNode(e):n.unchooseNode(e)},n.unchooseAllNodes=function(){n.choosenNodeUids.clear(),n.forceUpdate()},n.sectionChooseStartMousePosition=[0,0],n.state={nodes:[],offset:[0,0],editingNodeUid:null,mouseState:null,section:null,dataString:""},n}return Object(h.a)(o,[{key:"componentDidMount",value:function(){this.updateStateNodes(),this.drawLines(),window.addEventListener("resize",this.resetView),this.resetView()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resetView)}},{key:"componentDidUpdate",value:function(){this.drawLines()}},{key:"render",value:function(){var e=this;return Object(N.jsxs)("div",{className:"App",children:[this.renderTopBar(),Object(N.jsxs)("div",{className:"node-pool"+(this.draggingNodeStartPositions.size?" dragging":""),ref:this.poolRef,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseLeave,children:[Object(N.jsx)("canvas",{ref:this.canvasRef}),this.state.nodes.map((function(t){return Object(N.jsx)(O,{anchor:e.getAnchor(),node:t,linking:e.linkingNodeUid===t.uid,choosen:e.choosenNodeUids.has(t.uid),dragging:e.draggingNodeStartPositions.has(t.uid),onClick:e.onClickNode,onDragStart:e.onDragNodeStart,onRectUpdate:function(t,o){return e.nodeCardRects.set(t,o)},onClickLinkButton:function(t){return e.linkNode(t)},onClickChooseButton:e.setNodeChoosen},t.uid)})),this.renderSection(),this.renderNodeInfo()]}),this.renderBottomBar()]})}},{key:"getAnchor",value:function(){return k(this.origin,this.state.offset)}},{key:"getPoolFix",value:function(){return[(null===(e=j(this.poolRef))||void 0===e?void 0:e.x)||0,(null===e||void 0===e?void 0:e.y)||0];var e}},{key:"drawLines",value:function(){var e=function(e){var t=e.current;if(!t)return null;var o=t.getContext("2d");return o?[t,o]:null}(this.canvasRef);if(e){var t=Object(c.a)(e,2),o=t[0],n=t[1];n.clearRect(0,0,o.width,o.height),n.strokeStyle="#808080",n.fillStyle="#000000",n.lineWidth=3;for(var i=this.getPoolFix(),s=0,r=Array.from(this.nodes.values());s<r.length;s++){var d,l=r[s],h=j(this.nodeCardRects.get(l.uid)),f=Object(a.a)(l.outPorts);try{for(f.s();!(d=f.n()).done;){var g=d.value,v=this.nodes.get(g);if(v){var p=j(this.nodeCardRects.get(v.uid));n.beginPath(),n.moveTo.apply(n,Object(u.a)(h)),n.lineTo.apply(n,Object(u.a)(p)),n.stroke()}}}catch(N){f.e(N)}finally{f.f()}}}else console.log("Invalid canvas");function j(e){if(e){var t=e.x,o=e.y;return y([t+e.width/2,o+e.height/2],i)}return[0,0]}}},{key:"renderTopBar",value:function(){var e=this;return Object(N.jsxs)("div",{className:"top-bar",children:[Object(N.jsx)("button",{onClick:this.createNode,children:"\u65b0\u589e"}),Object(N.jsx)("button",{onClick:this.save,children:"\u4fdd\u5b58"}),Object(N.jsx)("button",{onClick:this.load,children:"\u8f7d\u5165"}),Object(N.jsx)("button",{onClick:this.unchooseAllNodes,children:"\u53d6\u6d88\u9009\u62e9"}),Object(N.jsx)("textarea",{value:this.state.dataString,placeholder:"\u5728\u6b64\u8f93\u5165/\u8f93\u51fa\u6570\u636e",onChange:function(t){return e.setState((function(){return{dataString:t.target.value}}))}})]})}},{key:"renderBottomBar",value:function(){return Object(N.jsxs)("div",{className:"bottom-bar",children:[Object(N.jsxs)("span",{className:"piece",children:["\u603b\u8282\u70b9\u6570\uff1a",this.state.nodes.length]}),Object(N.jsxs)("span",{className:"piece",children:["\u9009\u4e2d\u8282\u70b9\u6570\uff1a",this.choosenNodeUids.size]})]})}},{key:"renderNodeInfo",value:function(){var e=this,t=null!==this.state.editingNodeUid?this.nodes.get(this.state.editingNodeUid):null;return t?Object(N.jsxs)("div",{className:"node-info",children:[Object(N.jsx)("button",{className:"icon",onClick:this.hideNodeInfoView,children:">"}),Object(N.jsx)(x,{node:t,nodes:this.nodes,onUpdate:function(t){return e.updateNode(t)}},t.uid)]}):null}},{key:"renderSection",value:function(){var e=this.state.section;return e?Object(N.jsx)("div",{className:"section",style:{left:e.x+"px",top:e.y+"px",width:e.width+"px",height:e.height+"px"}}):null}},{key:"addNode",value:function(e){this.nodes.set(e.uid,e),this.updateStateNodes()}},{key:"updateNode",value:function(e){this.nodes.set(e.uid,e),this.updateStateNodes()}},{key:"removeNode",value:function(e){this.nodes.delete(e),this.nodeCardRects.delete(e),this.choosenNodeUids.delete(e),this.draggingNodeStartPositions.delete(e),this.updateStateNodes()}},{key:"updateStateNodes",value:function(){var e=this;this.setState((function(){return{nodes:Array.from(e.nodes.values())}}))}},{key:"linkNode",value:function(e){var t=this.nodes.get(e);if(t)if(null!==this.linkingNodeUid){if(this.linkingNodeUid!==t.uid){var o=this.nodes.get(this.linkingNodeUid);if(o&&t){var n=new Set(o.outPorts),i=new Set(t.inPorts);n.has(t.uid)?(n.delete(t.uid),i.delete(o.uid)):(n.add(t.uid),i.add(o.uid)),o.outPorts=Array.from(n),t.inPorts=Array.from(i),this.updateStateNodes()}}this.linkingNodeUid=null}else this.linkingNodeUid=t.uid}},{key:"onDragPoolStart",value:function(e){this.setState((function(){return{mouseState:"dragPool"}})),this.dragPoolStartOffset=this.state.offset,this.dragPoolStartMousePosition=[e.screenX,e.screenY]}},{key:"onDragPool",value:function(e){var t=this;e.stopPropagation();var o=y([e.screenX,e.screenY],this.dragPoolStartMousePosition);this.setState((function(){return{offset:k(t.dragPoolStartOffset,o)}}))}},{key:"onDragPoolEnd",value:function(e){this.onDragPool(e),this.setState((function(){return{mouseState:null}}))}},{key:"buildPool",value:function(){return{offset:this.state.offset,nodes:Array.from(this.nodes.values())}}},{key:"toggleChooseNode",value:function(e){this.choosenNodeUids.has(e)?this.unchooseNode(e):this.chooseNode(e)}},{key:"chooseNode",value:function(e){this.choosenNodeUids.add(e),this.forceUpdate()}},{key:"unchooseNode",value:function(e){this.choosenNodeUids.delete(e),this.forceUpdate()}},{key:"onSectionChooseStart",value:function(e){this.setState((function(){return{mouseState:"chooseNodes"}})),this.sectionChooseStartMousePosition=[e.clientX,e.clientY]}},{key:"onSectionChooseMove",value:function(e){var t=this.getPoolFix(),o=y([e.clientX,e.clientY],t),n=y(this.sectionChooseStartMousePosition,t),i=Object(c.a)(n,2),s=i[0],r=i[1];this.setState((function(){return{section:{x:s,y:r,width:o[0]-s,height:o[1]-r}}}))}},{key:"onSectionChooseEnd",value:function(e){var t=this,o=[this.sectionChooseStartMousePosition[0],e.clientX].sort(),n=Object(c.a)(o,2),i=n[0],s=n[1],r=[this.sectionChooseStartMousePosition[1],e.clientY].sort(),a=Object(c.a)(r,2),d=a[0],u=a[1],l=Array.from(this.nodeCardRects.entries()).filter((function(e){var t=Object(c.a)(e,2)[1],o=t.x,n=t.y,r=t.width,a=t.height;return o>=i&&n>=d&&o+r<=s&&n+a<=u})).map((function(e){return Object(c.a)(e,1)[0]}));e.ctrlKey||this.choosenNodeUids.clear(),l.forEach((function(e){return t.choosenNodeUids.add(e)})),this.setState((function(){return{mouseState:null,section:null}}))}}]),o}(n.Component),P=function(e){e&&e instanceof Function&&o.e(3).then(o.bind(null,24)).then((function(t){var o=t.getCLS,n=t.getFID,i=t.getFCP,s=t.getLCP,r=t.getTTFB;o(e),n(e),i(e),s(e),r(e)}))};r.a.render(Object(N.jsx)(i.a.StrictMode,{children:Object(N.jsx)(C,{})}),document.getElementById("root")),P()}},[[23,1,2]]]);
//# sourceMappingURL=main.58782aae.chunk.js.map
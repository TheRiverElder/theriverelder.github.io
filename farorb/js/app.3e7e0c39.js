(function(t){function e(e){for(var i,o,u=e[0],s=e[1],c=e[2],h=0,d=[];h<u.length;h++)o=u[h],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i]);l&&l(e);while(d.length)d.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,u=1;u<n.length;u++){var s=n[u];0!==r[s]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={app:0},a=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/farorb/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],s=u.push.bind(u);u.push=e,u=u.slice();for(var c=0;c<u.length;c++)e(u[c]);var l=s;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("85ec"),r=n.n(i);r.a},2871:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Farorb")],1)},a=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"main",staticClass:"game-main"},[n("div",{staticClass:"header shadow"},[n("p",{staticClass:"title"},[t._v(t._s(t.title))])]),n("transition-group",{staticClass:"output",attrs:{tag:"div","enter-active-class":"animated fadeIn"}},t._l(t.output,(function(e){return n("p",{key:e.uid,class:e.fromPlayer?"from-player":"from-other"},[t._v(t._s(e.content))])})),0),n("div",{staticClass:"footer shadow"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],ref:"input",staticClass:"shadow",attrs:{type:"text"},domProps:{value:t.input},on:{keydown:function(e){return t.handleTypeInput(e)},input:function(e){e.target.composing||(t.input=e.target.value)}}}),n("button",{staticClass:"shadow",attrs:{disabled:""===t.input},on:{click:t.finishInput}},[t._v("执行")])])],1)},u=[],s=(n("ac1f"),n("157a"),n("4160"),n("159b"),{TICK_PERIOD:100,EXPLORE_RATE:.2,MINE_RATE:.3,DEBUG:!1,PRECISION:2,LOCAL_STORAGE_KEY:"farorb"}),c=s,l=n("d4ec"),h=n("bee2"),d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Object(l["a"])(this,t),this.task=e,this.period=n,this.pid=null}return Object(h["a"])(t,[{key:"run",value:function(){return null===this.pid&&this.task&&(this.pid=setInterval(this.task,this.period)),this.running}},{key:"stop",value:function(){null!==this.pid&&clearInterval(this.pid)}},{key:"running",get:function(){return null!==this.pid}}]),t}(),p=d,f=(n("a4d3"),n("e01a"),n("d28b"),n("d81d"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("ade3")),g=function(){function t(){Object(l["a"])(this,t),this.items=[]}return Object(h["a"])(t,[{key:"then",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.items.push({name:t,regExp:e,converter:n}),this}},{key:"map",value:function(t){var e={},n=t,i=!0,r=!1,a=void 0;try{for(var o,u=this.items[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var s=o.value,c=s.name,l=s.regExp,h=s.converter,d=l.exec(n);if(!d)return null;e[c]=h?h(d):d[0],n=n.substring(d.index+d[0].length)}}catch(p){r=!0,a=p}finally{try{i||null==u.return||u.return()}finally{if(r)throw a}}return e}}]),t}();Object(f["a"])(g,"REG_STRING",/"([^"]*)"/),Object(f["a"])(g,"REG_INT",/\d+/),Object(f["a"])(g,"REG_FLOAT",/\d*\.\d+/),Object(f["a"])(g,"REG_PERCENT",/((\d*\.)?\d+)%/),Object(f["a"])(g,"REG_NUMBER",/(\d*\.)?\d+/);var m=function(){function t(){Object(l["a"])(this,t),this.commands={},this.headerMatcher=/^[A-Za-z_0-9]+/}return Object(h["a"])(t,[{key:"execute",value:function(t,e){var n=this.headerMatcher.exec(t);if(!n)return!1;var i=n[0],r=t.substring(n.index+i.length),a=this.commands[i];if(!a)return!1;var o=a.argMapper?a.argMapper.map(r):{};return a.action(o,i,e)}},{key:"add",value:function(t,e,n){this.commands[t]={header:t,action:e,argMapper:n}}}]),t}(),v=(n("99af"),n("a15b"),n("b64b"),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(l["a"])(this,t),this.total=0,this.def=e,this.map={}}return Object(h["a"])(t,null,[{key:"from",value:function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new t(r),o=!0,u=!1,s=void 0;try{for(var c,l=e[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value;a.put(h[n],h[i])}}catch(d){u=!0,s=d}finally{try{o||null==l.return||l.return()}finally{if(u)throw s}}return a}}]),Object(h["a"])(t,[{key:"roll",value:function(){for(var t=Math.random()*this.total,e=0,n=0,i=Object.keys(this.map);n<i.length;n++){var r=i[n];if(e+=this.map[r],t<e)return r}return this.def}},{key:"clear",value:function(){this.map={},this.total=0}},{key:"put",value:function(t,e){this.map[t]&&(this.total-=this.map[t]),this.map[t]=e,this.total+=e}},{key:"get",value:function(t){return this.map[t]||0}}]),t}());function y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.random()*(t-e)+e}function b(t){return Math.random()<t}var O=Date.now();function w(){return O++}function _(t,e,n){return t<e?e:Math.min(t,n)}n("a9e3"),n("8ba4"),n("b680"),n("25f0"),n("5319");var k=n("53ca"),x={wood:"木头",metal:"金属",rope:"绳子",stone:"石头",clay:"粘土",worktable:"工作台",storage:"仓库",farm:"农田",health:"健康",hunger:"饥饿",thirsty:"口渴",river:"河流",forest:"森林",cave:"岩洞",initialized:"初始化完成",return_home:"回家咯",return_home_for_hunger:"太饿了，回家了",empty_storage:"你的仓库是空的",you_have:"你有：${list}",start_explore:"开始探索",get_resources:"获得资源：${list}",nothing_found:"什么都没找到",found_terran:"找到：${terran}",item:"${id} * ${amount}",status:"健康：${health}，饥饿：${hunger}",time:"时间：${time}",save_done:"保存完成",load_done:"载入完成",load_failed:"载入失败"},E=/\${\s*(\w+)\s*}/g;function I(t){return function(e,n){var i=t[n];if(!i)return n;switch(Object(k["a"])(i)){case"string":return R(i,t);case"number":return Number.isInteger(i)?i.toString():i.toFixed(c.PRECISION);default:return String(i)}}}function j(t,e){return t.replace(E,I(e))}function R(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=x[t];return n?j(n,e):t}n("4de4"),n("7db0"),n("c975"),n("a434");function H(t,e){var n=e.id,i=e.amount,r=t.find((function(t){return t.id===n}));r||(r={id:n,amount:0},t.push(r)),r.amount+=i}function T(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.forEach((function(e){return H(t,e)}))}function C(t){var e=t.profile;return e.health=100,e.hunger=0,e.inverntory=[],e.storage=[],e.working=null,t.sendOutput("初始化完成！"),"waiting"}function S(t){var e=t.profile;e.health=_(e.health+1,0,100),e.hunger=_(e.hunger-1,0,100)}function M(t){if(t.profile.hunger+=1,b(c.EXPLORE_RATE))return t.profile.working=v.from(t.registry.getData("terran"),"id","weight").roll(),t.sendOutput("found_terran",!1,{terran:t.profile.working}),"mining"}function A(t){var e=t.profile;if(e.hunger+=2,b(c.MINE_RATE)){var n=t.registry.getData("terran",e.working,"resources"),i=[];if(n.forEach((function(t){var e=t.id,n=t.chance,r=t.min,a=t.max;b(n)&&i.push({id:e,amount:y(a,r)})})),0===i.length)return t.sendOutput("nothing_found"),"mining";T.apply(void 0,[e.storage].concat(i));var r=i.map((function(t){return R("item",t)})).join("、");return t.sendOutput("get_resources",!1,{list:r}),t.sendOutput("return_home"),"waiting"}}function P(t){var e=t.profile;e.health=_(e.health,0,100),e.hunger=_(e.hunger,0,100),c.DEBUG&&console.log(e),e.health<=0&&t.sendOutput("你死了"),"waiting"!==e.state&&(e.health<10&&(e.state="waiting",t.sendOutput("你血太少，自动回家了")),e.hunger>90&&(e.state="waiting",t.sendOutput("return_home_for_hunger")))}function $(t){t.title="Farorb";var e=t.registry.register.bind(t.registry),n=t.registry.reg.bind(t.registry);n("listener",{id:"initializing",value:C},{id:"waiting",value:S},{id:"exploring",value:M},{id:"mining",value:A},{id:"post-tick",value:P}),n("command",{header:"list",action:D},{header:"explore",action:G},{header:"debug",action:L},{header:"say",action:B,mapper:(new g).then("text",g.REG_STRING,(function(t){return t[1]}))},{header:"status",action:F},{header:"home",action:N}),e("material","dict",{id:"wood"},{id:"metal"},{id:"rope"},{id:"stone"},{id:"clay"}),e("building","dict",{id:"worktable"},{id:"storage"},{id:"farm"}),e("status","dict",{id:"health",min:0,max:100,def:100},{id:"hunger",min:0,max:100,def:0},{id:"thirsty",min:0,max:100,def:0}),e("struct","dict",{id:"worktable",materials:[{id:"wood",amount:10},{id:"metal",amount:2}]},{id:"storage",materials:[{id:"wood",amount:25}]}),e("terran","dict",{id:"river",weight:10,total:100,resources:[{id:"clay",chance:.35,min:4,max:25}]},{id:"forest",weight:70,total:100,resources:[{id:"wood",chance:.75,min:10,max:20},{id:"rope",chance:.15,min:1,max:5}]},{id:"cave",weight:20,total:100,resources:[{id:"stone",chance:.8,min:5,max:15},{id:"metal",chance:.3,min:2,max:5}]})}function D(t,e,n){if(0===n.profile.storage.length)n.sendOutput("empty_storage");else{var i=n.profile.storage.map((function(t){return R("item",t)})).join("、");n.sendOutput("you_have",!1,{list:i})}}function G(t,e,n){n.profile.state="exploring",n.sendOutput("start_explore")}function N(t,e,n){n.profile.state="waiting",n.sendOutput("return_home")}function L(){c.DEBUG=!c.DEBUG}function B(t,e,n){var i=t.text;n.sendRawOutput(i)}function F(t,e,n){n.sendOutput("status",!1,n.profile)}n("07ac");var U=function(){function t(){Object(l["a"])(this,t),this.registrations={}}return Object(h["a"])(t,[{key:"clear",value:function(){this.registrations={}}},{key:"ensureCatalogExist",value:function(t,e){var n=this.registrations[t];if(!n){var i;switch(e){case"dict":i={};break;case"map":i={};break;case"list":i=[];break}n={type:e,data:i},this.registrations[t]=n}return n}},{key:"register",value:function(t,e){for(var n=this.ensureCatalogExist(t,"dict").data,i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];switch(e){case"dict":r.forEach((function(t){n[t.id]=t}));break;case"map":r.forEach((function(t){n[t.id]=t.value}));break;case"list":n.push.apply(n,r);break}}},{key:"create",value:function(t,e){return this.ensureCatalogExist(t,e)}},{key:"reg",value:function(t){var e=this.registrations[t];if(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.register.apply(this,[t,e.type].concat(i))}}},{key:"getData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.registrations[t];if(!i)return null;var r=i.type,a=i.data;switch(r){case"dict":if(!e)return Object.values(a);var o=a[e];return o&&n?o[n]:o;case"map":return e?a[e]:Object.values(a);case"list":return a}}}]),t}();Object(f["a"])(U,"DICT","dict"),Object(f["a"])(U,"MAP","map"),Object(f["a"])(U,"LIST","list");var K=U,z={title:"",profile:{state:"initializing",time:0},commandManager:new m,ticker:new p,registry:new K,output:[],start:function(){return this.ticker.task=this.tick.bind(this),this.ticker.period=c.TICK_PERIOD,this.ticker.run()},stop:function(){return this.ticker.stop(),!this.ticker.running},exec:function(t){this.commandManager.execute(t,this)},tick:function(){this.profile.time++,this.profile.state=this.trigger(this.profile.state)||this.profile.state,this.trigger("post-tick")},trigger:function(t){var e=this.registry.getData("listener",t);return e?e(this):null},sendOutput:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;this.output.push({uid:w(),fromPlayer:e,content:R(t,n)})},sendRawOutput:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.output.push({uid:w(),fromPlayer:e,content:t})}};z.registry.create("command",K.LIST),z.registry.create("listener",K.MAP),z.registry.reg("command",{header:"save",action:function(t,e,n){localStorage.setItem(c.LOCAL_STORAGE_KEY,JSON.stringify(n.profile)),n.sendOutput("save_done")}},{header:"load",action:function(t,e,n){var i=JSON.parse(localStorage.getItem(c.LOCAL_STORAGE_KEY));i?(Object.assign(n.profile,i),n.sendOutput("load_done")):n.sendOutput("load_failed")}}),$(z),z.registry.getData("command").forEach((function(t){var e=t.header,n=t.action,i=t.mapper;z.commandManager.add(e,n,i)}));var J={name:"Farorb",data:function(){return{output:z.output,input:"",inputHistory:[],inputHistoryIndex:0,inputCache:""}},watch:{output:function(){this.$nextTick(this.scrollToBottom)}},computed:{canFinish:function(){return!/^\s*$/.test(this.input)},title:function(){return z.title}},methods:{handleTypeInput:function(t){"Enter"===t.key&&this.canFinish?this.finishInput():"ArrowUp"===t.key?this.tryReplaceWithHistory(-1):"ArrowDown"===t.key&&this.tryReplaceWithHistory(1)},tryReplaceWithHistory:function(t){var e=this;0!==this.inputHistory.length&&(this.inputHistoryIndex===this.inputHistory.length&&(this.inputCache=this.input),this.inputHistoryIndex+=t,this.inputHistoryIndex===this.inputHistory.length?this.input=this.inputCache:this.inputHistoryIndex>=0&&this.inputHistoryIndex<this.inputHistory.length?this.input=this.inputHistory[this.inputHistoryIndex]:this.inputHistoryIndex<0?(this.input=this.inputCache,this.inputHistoryIndex=this.inputHistory.length):(this.inputHistoryIndex=0,this.input=this.inputHistory[0]),this.$nextTick((function(){return e.$refs.input.setSelectionRange(e.input.length,e.input.length)})))},finishInput:function(){z.sendRawOutput(this.input,!0),z.exec(this.input),this.inputHistory.length&&this.inputHistory[this.inputHistory.length-1]===this.input||this.inputHistory.push(this.input),this.inputHistoryIndex=this.inputHistory.length,this.inputCache="",this.input=""},scrollToBottom:function(){var t=this.$refs.main.getElementsByClassName("output")[0];t.scrollTop=t.scrollHeight}},mounted:function(){z.start()},beforeDestroy:function(){z.stop()}},W=J,Y=(n("a23a"),n("9a61"),n("2877")),X=Object(Y["a"])(W,o,u,!1,null,"597d0f8e",null),Z=X.exports,q={name:"App",components:{Farorb:Z}},Q=q,V=(n("034f"),Object(Y["a"])(Q,r,a,!1,null,null,null)),tt=V.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(tt)}}).$mount("#app")},7743:function(t,e,n){},"85ec":function(t,e,n){},"9a61":function(t,e,n){"use strict";var i=n("7743"),r=n.n(i);r.a},a23a:function(t,e,n){"use strict";var i=n("2871"),r=n.n(i);r.a}});
//# sourceMappingURL=app.3e7e0c39.js.map
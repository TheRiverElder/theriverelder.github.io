{"version":3,"sources":["util/javascript-extension.ts","util/ui.ts","components/RadioButton.tsx","components/Icon.tsx","components/MindNodeCard.tsx","components/MindNodeInfo.tsx","tools/Tool.ts","tools/CreateNodeTool.ts","util/mathematics.ts","tools/DragNodeTool.ts","tools/DragPoolTool.ts","tools/SelectTool.ts","tools/AutoTool.ts","constants.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["toClassName","obj","arr","key","Object","prototype","hasOwnProperty","call","element","push","join","getRect","ref","box","current","getBoundingClientRect","x","y","width","height","STOP_EVENT","e","stopPropagation","RadioButton","props","className","border","checked","value","onMouseDown","onMouseUp","onClick","onChange","children","Icon","rowSize","size","alt","name","src","style","MindNodeCard","selfRef","React","createRef","this","onRectUpdate","node","uid","position","text","anchor","anchorX","anchorY","linking","choosen","fixedX","fixedY","left","top","onMouseMove","split","map","it","i","onClickLinkButton","onClickChooseButton","Component","MindNodeInfo","getBrief","nodes","get","state","inputingText","outPorts","inPorts","toFixed","setText","target","length","setState","onUpdate","ToolBase","env","CreateNodeTool","mousePosition","pixel2pool","genUid","set","Vec2Util","angle","modulo","Number","isNaN","Math","cos","sin","vs","reduce","p","v","v1","v2","atan2","sqrt","getBezierPointAndAngle","t","controlPoints","cps","nextCPs","p0X","p0Y","p1X","p1Y","finalP0X","finalP0Y","finalP1X","finalP1Y","deltaX","deltaY","finalPoint","finalAngle","DragNodeTool","actived","startMousePosition","startNodePositions","Map","clear","selectedNodeUids","Array","from","values","has","Set","delta","forEach","startPosition","DragPoolTool","startPoolOffset","offset","COMPARATOR","a","b","SelectTool","selectionArea","nativeEvent","a1","a2","index","equalsArray","sort","right","bottom","filter","isNodeInRange","ctrlKey","add","rect","getNodeRect","AutoTool","tool","event","button","shiftKey","onStart","onMove","onEnd","TOOL_FLAGS","TOOL_NAMES","App","mounted","onkey","deleteSelectedNodes","poolRef","canvasRef","hideNodeInfoView","editingNodeUid","nodeCardRects","origin","resetView","canvas","notifyUpdate","dirty","update","updateStateNodes","drawLines","requestAnimationFrame","createNode","addNode","linkingNodeUid","onClickNode","getToolEvent","ev","onMouseLeave","load","pool","JSON","parse","dataString","uidCounter","scale","alert","save","buildPool","stringify","console","log","setNodeChoosen","delete","unchooseAllNodes","toolFlag","window","addEventListener","setTool","removeEventListener","renderTopBar","getAnchor","setNodeRect","linkNode","renderSelectionArea","renderNodeInfo","renderBottomBar","canvasAndContext","context","getContext","get2dContext","g","clearRect","strokeStyle","fillStyle","lineWidth","fix","getPoolFix","pointCache","getPoint","cachedPoint","point","angleCache","getAngle","NaN","nodePosition","inRelative","inNodeUid","inNode","outRelative","outNodeUid","outNode","sourcePoint","portUid","targetNode","targetPoint","controlHandleLength","sourceAngle","targetAngle","controlPoint1","controlPoint2","centerPoint","centerAngle","beginPath","moveTo","bezierCurveTo","stroke","lineTo","PI","fill","f","bind","disabled","placeholder","editingNode","updateNode","o","s","sa","flag","sourceNode","clientX","clientY","poolCoord","pixelCoord","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.dc559f5f.chunk.js","sourcesContent":["// 将一个对象转换成className字符串\r\nexport function toClassName(obj: { [key: string]: (boolean | string) }): string {\r\n    const arr: Array<string> = [];\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            const element = obj[key];\r\n            if (typeof element === 'string') {\r\n                arr.push(element);\r\n            } else {\r\n                if (element) {\r\n                    arr.push(key);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return arr.join(' ');\r\n}\r\n\r\nexport function getMapValue<K, V>(map: Map<K, V>, key: K, handler: (value: V, key: K) => void) {\r\n    const value = map.get(key);\r\n    if (value) {\r\n        handler(value, key);\r\n    }\r\n}\r\n\r\nexport function filterSet<T>(set: Set<T>, filterFn: (e: T) => boolean): Set<T> {\r\n    const r: T[] = [];\r\n    set.forEach(it => {\r\n        if (filterFn(it)) {\r\n            r.push(it);\r\n        }\r\n    });\r\n    return new Set(r);\r\n}\r\n\r\nexport function equalsArray<T>(a1: Array<T>, a2: Array<T>): boolean {\r\n    if (a1.length !== a2.length) return false;\r\n    for (let index = 0; index < a1.length; index++) {\r\n        if (a1[index] !== a2[index]) return false;\r\n    }\r\n    return true;\r\n}","import { RefObject } from \"react\";\r\nimport { Rect } from \"../interfaces\";\r\nimport { Vec2 } from \"./mathematics\";\r\n\r\nexport function get2dContext(ref: RefObject<HTMLCanvasElement>): [HTMLCanvasElement, CanvasRenderingContext2D] | null {\r\n    const canvas = ref.current;\r\n    if (!canvas) return null;\r\n    const context = canvas.getContext('2d');\r\n    if (!context) return null;\r\n    return [canvas, context];\r\n}\r\n\r\nexport function getRect<T extends HTMLElement>(ref: RefObject<T>): Rect {\r\n    const box = ref.current?.getBoundingClientRect();\r\n    return {\r\n        x: box?.x || 0,\r\n        y: box?.y || 0,\r\n        width: box?.width || 0,\r\n        height: box?.height || 0,\r\n    };\r\n}\r\n\r\nexport function getPosition(rect?: Rect): Vec2 {\r\n    return [rect?.x || 0, rect?.y || 0];\r\n}","import { MouseEvent, ReactNode } from 'react';\r\nimport '../styles/RadioButton.css';\r\nimport { toClassName } from '../util/javascript-extension';\r\n\r\ninterface RadioButtonProps {\r\n    children?: ReactNode;\r\n    border?: boolean;\r\n    value: boolean;\r\n    onChange: (value: boolean) => void;\r\n}\r\n\r\nconst STOP_EVENT = (e: MouseEvent) => e.stopPropagation();\r\n \r\nfunction RadioButton(props: RadioButtonProps) {\r\n    return (\r\n        <div \r\n            className={ toClassName({ \"RadioButton\": true, border: !!props.border, checked: props.value }) }\r\n            onMouseDown={ STOP_EVENT }\r\n            onMouseUp={ STOP_EVENT }\r\n            onClick={ () => props.onChange(!props.value) }    \r\n        >\r\n            { props.children }\r\n        </div>\r\n    )\r\n}\r\n \r\nexport default RadioButton;","\r\ninterface IconProps {\r\n    name: string;\r\n    size?: number | string;\r\n}\r\n \r\nfunction Icon(props: IconProps) { \r\n    const rowSize = props.size || 'auto';\r\n    const size = typeof rowSize === 'number' ? rowSize + 'px' : rowSize;\r\n    return (\r\n        <img \r\n            alt={ props.name }\r\n            src={ 'icons/' + props.name + '.svg' }\r\n            style={{\r\n                width: size,\r\n                height: size,\r\n            }}\r\n        />\r\n    );\r\n}\r\n \r\nexport default Icon;","import React from \"react\";\r\nimport { Component, MouseEvent, RefObject } from \"react\";\r\nimport { Vec2 } from \"../util/mathematics\";\r\nimport \"../styles/MindNodeCard.css\";\r\nimport { MindNode, Rect } from \"../interfaces\";\r\nimport { toClassName } from \"../util/javascript-extension\";\r\nimport { getRect } from \"../util/ui\";\r\nimport RadioButton from \"./RadioButton\";\r\nimport Icon from \"./Icon\";\r\n\r\ninterface MindNodeCardProps {\r\n    anchor: Vec2;\r\n    node: MindNode;\r\n    linking: boolean;\r\n    choosen: boolean;\r\n    onClick: (e: MouseEvent, uid: number) => void;\r\n    onMouseDown: (e: MouseEvent, uid: number) => void;\r\n    onMouseMove: (e: MouseEvent, uid: number) => void;\r\n    onMouseUp: (e: MouseEvent, uid: number) => void;\r\n    onRectUpdate: (uid: number, rect: Rect) => void;\r\n    onClickLinkButton: (uid: number) => void;\r\n    onClickChooseButton: (uid: number, choosen: boolean) => void;\r\n}\r\n \r\nclass MindNodeCard extends Component<MindNodeCardProps> {\r\n\r\n    componentDidMount() {\r\n        this.props.onRectUpdate(this.props.node.uid, getRect(this.selfRef));\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.props.onRectUpdate(this.props.node.uid, getRect(this.selfRef));\r\n    }\r\n\r\n    render() { \r\n        const { \r\n            node: { \r\n                uid,\r\n                position: [x, y], \r\n                text,\r\n            }, \r\n            anchor: [anchorX, anchorY], \r\n            linking,\r\n            choosen, \r\n        } = this.props;\r\n\r\n        // 实际的坐标\r\n        const fixedX = x + anchorX;\r\n        const fixedY = y + anchorY;\r\n        \r\n        return (\r\n            <div \r\n                className={ toClassName({ \"MindNodeCard\": true, linking, choosen }) } \r\n                ref={ this.selfRef }\r\n                style={{\r\n                    left: `${fixedX}px`,\r\n                    top: `${fixedY}px`,\r\n                }}\r\n                onClick={ e => this.props.onClick(e, uid) }\r\n                onMouseDown={ e => this.props.onMouseDown(e, uid) }\r\n                onMouseMove={ e => this.props.onMouseMove(e, uid) }\r\n                onMouseUp={ e => this.props.onMouseUp(e, uid) }\r\n            >\r\n                <div className=\"frame\" />\r\n\r\n                <div className=\"static\">\r\n                    <div className=\"wrapper\">\r\n                        <div className=\"text\">\r\n                            { text.split(\"\\n\").map((it, i) => (<p key={ i }>{ it }</p>)) }\r\n                        </div>\r\n                        \r\n                        <div className=\"tool-bar\">\r\n                            <RadioButton\r\n                                key={ linking ? 11 : 10 }\r\n                                value={ linking }\r\n                                onChange={ () => this.props.onClickLinkButton(uid) }\r\n                            >\r\n                                <Icon name=\"link\" size=\"80%\"/>\r\n                            </RadioButton>\r\n                            \r\n                            <RadioButton\r\n                                key={ choosen ? 1 : 0 }\r\n                                value={ choosen }\r\n                                onChange={ it => this.props.onClickChooseButton(uid, it) }\r\n                            >\r\n                                <Icon name=\"checked\" size=\"80%\"/>\r\n                            </RadioButton>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    //#region 拖拽相关\r\n\r\n    private selfRef: RefObject<HTMLDivElement> = React.createRef();\r\n\r\n    //#endregion\r\n}\r\n \r\nexport default MindNodeCard;","import { Component } from \"react\";\r\nimport { MindNode } from \"../interfaces\";\r\nimport \"../styles/MindNodeInfo.css\";\r\n\r\ninterface MindNodeInfoProps {\r\n    node: MindNode;\r\n    nodes: Map<number, MindNode>;\r\n    onUpdate: (node: MindNode) => void;\r\n}\r\n \r\ninterface MindNodeInfoState {\r\n    inputingText: string;\r\n}\r\n \r\nclass MindNodeInfo extends Component<MindNodeInfoProps, MindNodeInfoState> {\r\n    constructor(props: MindNodeInfoProps) {\r\n        super(props);\r\n        this.state = {\r\n            inputingText: props.node.text,\r\n        };\r\n    }\r\n    render() { \r\n        const { uid, position, outPorts, inPorts } = this.props.node;\r\n        return (\r\n            <div className=\"MindNodeInfo\">\r\n                <div className=\"top-bar\"></div>\r\n\r\n                <div className=\"content\">\r\n                    <p>\r\n                        <span className=\"title\">UID：</span>\r\n                        <span className=\"text\">#{ uid }</span>\r\n                    </p>\r\n                    <p>\r\n                        <span className=\"title\">位置：</span>\r\n                        <span className=\"text\">({ position.map(it => it.toFixed(1)).join(\", \") })</span>\r\n                    </p>\r\n\r\n                    <p><span className=\"title\">内容：</span></p>\r\n                    <textarea\r\n                        value={ this.state.inputingText }\r\n                        onChange={ e => this.setText(e.target.value) }\r\n                    />\r\n\r\n                    <p className=\"title\">出线（{outPorts.length}个）：</p>\r\n                    <ol className=\"text\">\r\n                        { outPorts.map(uid => (<li key={ uid } className=\"snapshot\">{ this.getBrief(uid) }</li>)) }\r\n                    </ol>\r\n\r\n                    <p className=\"title\">入线（{inPorts.length}个）：</p>\r\n                    <ol className=\"text\">\r\n                        { inPorts.map(uid => (<li key={ uid } className=\"snapshot\">{ this.getBrief(uid) }</li>)) }\r\n                    </ol>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    setText(text: string) {\r\n        this.setState(() => ({ inputingText: text }));\r\n        const node: MindNode = {\r\n            ...this.props.node,\r\n            text,\r\n        };\r\n        this.props.onUpdate(node);\r\n    }\r\n\r\n    getBrief = (uid: number) => {\r\n        const node = this.props.nodes.get(uid);\r\n        if (node) {\r\n            return '#' + uid + '：' + node.text;\r\n        } else {\r\n            return '#' + uid;\r\n        }\r\n    }\r\n}\r\n \r\nexport default MindNodeInfo;","import { MindNode, Rect } from \"../interfaces\";\r\nimport { Vec2 } from \"../util/mathematics\";\r\nimport { MouseEvent } from \"react\";\r\n\r\nexport interface ToolEvent {\r\n    mousePosition: Vec2;\r\n    node: MindNode | null;\r\n    nativeEvent: MouseEvent;\r\n}\r\n\r\nexport interface Tool {\r\n    onStart(event: ToolEvent): void;\r\n    onMove(event: ToolEvent): void;\r\n    onEnd(event: ToolEvent): void;\r\n}\r\n\r\nexport interface ToolEnv {\r\n    offset: Vec2;\r\n    scale: number;\r\n    // MindNode 实例可能会改变，所以在其它位置引用其uid较为妥当\r\n    nodes: Map<number, MindNode>;\r\n    getNodeRect(uid: number): Rect | null;\r\n\r\n    selectedNodeUids: Set<number>;\r\n    selectionArea: Rect | null;\r\n    pixel2pool(vec: Vec2): Vec2;\r\n    genUid(): number;\r\n}\r\n\r\nexport abstract class ToolBase implements Tool {\r\n\r\n    protected env: ToolEnv;\r\n    constructor(env: ToolEnv) {\r\n        this.env = env;\r\n    }\r\n\r\n    abstract onStart(event: ToolEvent): void;\r\n\r\n    abstract onMove(event: ToolEvent): void;\r\n\r\n    abstract onEnd(event: ToolEvent): void;\r\n\r\n}","import { MindNode } from \"../interfaces\";\r\nimport { ToolBase, ToolEvent } from \"./Tool\";\r\n\r\n// 拖动整个节点池\r\nexport class CreateNodeTool extends ToolBase {\r\n\r\n    onStart(): void { }\r\n\r\n    onMove(): void { }\r\n    \r\n    onEnd({ mousePosition }: ToolEvent): void {\r\n        const position = this.env.pixel2pool(mousePosition);\r\n        const uid = this.env.genUid();\r\n        const node: MindNode = {\r\n            uid,\r\n            position,\r\n            text: `#${uid}`,\r\n            outPorts: [],\r\n            inPorts: [],\r\n        };\r\n        this.env.nodes.set(uid, node);\r\n    }\r\n\r\n}","\r\nexport type Vec2 = [number, number];\r\nexport const X = 0;\r\nexport const Y = 1;\r\n\r\nexport function vec2FromAngle(angle: number, modulo: number = 1): Vec2 {\r\n    if (Number.isNaN(angle)) return [0, 0];\r\n    return [Math.cos(angle) * modulo, Math.sin(angle) * modulo]; \r\n}\r\n\r\nexport function vec2Add(...vs: Vec2[]): Vec2 {\r\n    return [vs.reduce((p, v) => p + v[0], 0), vs.reduce((p, v) => p + v[1], 0)];\r\n}\r\n\r\nexport function vec2Minus(v1: Vec2, v2: Vec2): Vec2 {\r\n    return [v1[X] - v2[X], v1[Y] - v2[Y]];\r\n}\r\n\r\nexport function vec2Normalize(v: Vec2): Vec2 {\r\n    if (v[0] === 0 && v[1] === 0) return [0, 0];\r\n    const angle = Math.atan2(v[1], v[0]);\r\n    return [Math.cos(angle), Math.sin(angle)];\r\n}\r\n\r\nexport function vec2Modulo(v: Vec2): number {\r\n    return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\r\n}\r\n\r\nexport function vec2Angle(v: Vec2): number {\r\n    return Math.atan2(v[1], v[0]);\r\n}\r\n\r\nexport function vec2Multiply(v: Vec2, n: number): Vec2 {\r\n    return [v[0] * n, v[1] * n];\r\n}\r\n\r\nexport const Vec2Util =  {\r\n    zero(): Vec2 {\r\n        return [0, 0]; \r\n    },\r\n\r\n    unit(): Vec2 {\r\n        return [1, 1]; \r\n    },\r\n\r\n    of(x: number = 0, y: number = 0): Vec2 {\r\n        return [x, y]; \r\n    },\r\n\r\n    fromAngle(angle: number, modulo: number = 1): Vec2 {\r\n        if (Number.isNaN(angle)) return [0, 0];\r\n        return [Math.cos(angle) * modulo, Math.sin(angle) * modulo]; \r\n    },\r\n\r\n    add(...vs: Vec2[]): Vec2 {\r\n        return [vs.reduce((p, v) => p + v[0], 0), vs.reduce((p, v) => p + v[1], 0)];\r\n    },\r\n\r\n    minus(v1: Vec2, v2: Vec2): Vec2 {\r\n        return [v1[X] - v2[X], v1[Y] - v2[Y]];\r\n    },\r\n    \r\n    normalize(v: Vec2): Vec2 {\r\n        if (v[0] === 0 && v[1] === 0) return [0, 0];\r\n        const angle = Math.atan2(v[1], v[0]);\r\n        return [Math.cos(angle), Math.sin(angle)];\r\n    },\r\n    \r\n    modulo(v: Vec2): number {\r\n        return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\r\n    },\r\n    \r\n    angle(v: Vec2): number {\r\n        return Math.atan2(v[1], v[0]);\r\n    },\r\n    \r\n    multiply(v: Vec2, n: number): Vec2 {\r\n        return [v[0] * n, v[1] * n];\r\n    },\r\n};\r\n\r\n\r\nexport class UidGenerator {\r\n\r\n    public uidCounter: number = 0;\r\n\r\n    constructor(uidCounter: number = 0) {\r\n        this.uidCounter = uidCounter;\r\n    }\r\n\r\n    generate() {\r\n        return this.uidCounter++;\r\n    }\r\n\r\n}\r\n\r\n// return [pointPosition, angle]\r\nexport function getBezierPointAndAngle(t: number, ...controlPoints: Vec2[]): [Vec2, number] {\r\n    if (controlPoints.length <= 1) return [controlPoints[0], 0];\r\n\r\n    let cps: Vec2[] = controlPoints;\r\n    while (cps.length > 2) {\r\n        const nextCPs: Vec2[] = [];\r\n        for (let i = 1; i < cps.length; i++) {\r\n            const [p0X, p0Y] = cps[i - 1];\r\n            const [p1X, p1Y] = cps[i];\r\n            nextCPs.push([p0X + (p1X - p0X) * t, p0Y + (p1Y - p0Y) * t]);\r\n        }\r\n        cps = nextCPs;\r\n    }\r\n    const [finalP0X, finalP0Y] = cps[0];\r\n    const [finalP1X, finalP1Y] = cps[1];\r\n    const deltaX = finalP1X - finalP0X;\r\n    const deltaY = finalP1Y - finalP0Y;\r\n    const finalPoint: Vec2 = [finalP0X + deltaX * t, finalP0Y + deltaY * t];\r\n    const finalAngle = Math.atan2(deltaY, deltaX);\r\n    return [finalPoint, finalAngle];\r\n}","import { Vec2Util, Vec2 } from \"../util/mathematics\";\r\nimport { ToolBase, ToolEvent } from \"./Tool\";\r\n\r\n// 拖动整个节点池\r\nexport class DragNodeTool extends ToolBase {\r\n\r\n    private actived: boolean = false;\r\n    private startMousePosition: Vec2 = Vec2Util.zero();\r\n    private startNodePositions: Map<number, Vec2> = new Map();\r\n\r\n    onStart({ mousePosition, node }: ToolEvent): void {\r\n        this.startNodePositions.clear();\r\n        this.startMousePosition = mousePosition;\r\n        this.actived = true;\r\n\r\n        let selectedNodeUids: Array<number> = Array.from(this.env.selectedNodeUids.values());\r\n        // 如果按下去的节点是被选中的，则改为选择当前节点\r\n        if (node && !this.env.selectedNodeUids.has(node.uid)) { \r\n            selectedNodeUids = [node.uid];\r\n            this.env.selectedNodeUids = new Set(selectedNodeUids);\r\n        }\r\n        // 拖动所有选择节点一起移动\r\n        for (const uid of selectedNodeUids) {\r\n            const node = this.env.nodes.get(uid);\r\n            if (!node) continue;\r\n            this.startNodePositions.set(uid, node.position);\r\n        }\r\n    }\r\n\r\n    onMove({ mousePosition }: ToolEvent): void {\r\n        if (!this.actived) return;\r\n        \r\n        \r\n        const delta = Vec2Util.minus(mousePosition, this.startMousePosition);\r\n        this.startNodePositions.forEach((startPosition, uid) => {\r\n            const node = this.env.nodes.get(uid);\r\n            if (!node) return;\r\n            node.position = Vec2Util.add(startPosition, delta);\r\n        });\r\n    }\r\n    \r\n    onEnd(): void {\r\n        if (!this.actived) return;\r\n        \r\n        this.startNodePositions.clear();\r\n        this.startMousePosition = Vec2Util.zero();\r\n        this.actived = false;\r\n    }\r\n\r\n}","import { Vec2Util, Vec2 } from \"../util/mathematics\";\r\nimport { ToolBase, ToolEvent } from \"./Tool\";\r\n\r\n// 拖动整个节点池\r\nexport class DragPoolTool extends ToolBase {\r\n\r\n    private actived: boolean = false;\r\n    private startPoolOffset: Vec2 = Vec2Util.zero();\r\n    private startMousePosition: Vec2 = Vec2Util.zero();\r\n\r\n    onStart({ mousePosition }: ToolEvent): void {\r\n        this.startPoolOffset = this.env.offset;\r\n        this.startMousePosition = mousePosition;\r\n        this.actived = true;\r\n    }\r\n\r\n    onMove({ mousePosition }: ToolEvent): void {\r\n        if (!this.actived) return;\r\n        \r\n        this.env.offset = Vec2Util.add(this.startPoolOffset, Vec2Util.minus(mousePosition, this.startMousePosition));\r\n    }\r\n    \r\n    onEnd(): void {\r\n        if (!this.actived) return;\r\n        \r\n        this.startPoolOffset = Vec2Util.zero();\r\n        this.startMousePosition = Vec2Util.zero();\r\n        this.actived = false;\r\n    }\r\n\r\n}","import { MindNode } from \"../interfaces\";\r\nimport { equalsArray } from \"../util/javascript-extension\";\r\nimport { Vec2, Vec2Util, X, Y } from \"../util/mathematics\";\r\nimport { ToolBase, ToolEvent } from \"./Tool\";\r\n\r\n\r\nconst COMPARATOR = (a: number, b: number) => a - b;\r\n\r\n// 拖动整个节点池\r\nexport class SelectTool extends ToolBase {\r\n\r\n    private actived: boolean = false;\r\n    private startMousePosition: Vec2 = Vec2Util.zero();\r\n\r\n    onStart({ mousePosition }: ToolEvent): void {\r\n        this.startMousePosition = mousePosition;\r\n        this.actived = true;\r\n    }\r\n\r\n    onMove({ mousePosition }: ToolEvent): void {\r\n        if (!this.actived) return;\r\n\r\n        const [width, height] = Vec2Util.minus(mousePosition, this.startMousePosition);\r\n        this.env.selectionArea = {\r\n            x: this.startMousePosition[X],\r\n            y: this.startMousePosition[Y],\r\n            width,\r\n            height,\r\n        };\r\n    }\r\n    \r\n    onEnd({ mousePosition, node, nativeEvent }: ToolEvent): void {\r\n        if (!this.actived) return;\r\n\r\n        let selectedNodeUids: Array<number> = [];\r\n        if (equalsArray(this.startMousePosition, mousePosition)) { // 没有移动，那么就选中当前这个节点\r\n            if (node) {\r\n                selectedNodeUids = [node.uid];\r\n            }\r\n        } else { // 有移动，那么范围选取\r\n            const [left, right] = [this.startMousePosition[X], mousePosition[X]].sort(COMPARATOR);\r\n            const [top, bottom] = [this.startMousePosition[Y], mousePosition[Y]].sort(COMPARATOR);\r\n            selectedNodeUids = Array.from(this.env.nodes.values())\r\n                .filter(node => this.isNodeInRange(node, left, right, top, bottom))\r\n                .map(node => node.uid);\r\n        }\r\n\r\n        if (nativeEvent.ctrlKey) {\r\n            selectedNodeUids.forEach(it => this.env.selectedNodeUids.add(it));\r\n        } else {\r\n            this.env.selectedNodeUids = new Set(selectedNodeUids);\r\n        }\r\n        \r\n        this.startMousePosition = Vec2Util.zero();\r\n        this.env.selectionArea = null;\r\n        this.actived = false;\r\n    }\r\n\r\n    isNodeInRange(node: MindNode, left: number, right: number, top: number, bottom: number) {\r\n        const rect = this.env.getNodeRect(node.uid);\r\n        if (!rect) return false;\r\n        const { x, y, width, height } = rect;\r\n        return (x >= left && y >= top && x + width < right && y + height < bottom);\r\n    }\r\n\r\n}","import { MOUSE_BUTTON_MIDDLE } from \"../constants\";\r\nimport { CreateNodeTool } from \"./CreateNodeTool\";\r\nimport { DragNodeTool } from \"./DragNodeTool\";\r\nimport { DragPoolTool } from \"./DragPoolTool\";\r\nimport { SelectTool } from \"./SelectTool\";\r\nimport { Tool, ToolBase, ToolEvent } from \"./Tool\";\r\n\r\n// 拖动整个节点池\r\nexport class AutoTool extends ToolBase {\r\n\r\n    private tool: Tool | null = null;\r\n\r\n    onStart(event: ToolEvent): void {\r\n        const { node, nativeEvent } = event;\r\n        if (nativeEvent.button === MOUSE_BUTTON_MIDDLE) {\r\n            this.tool = new DragPoolTool(this.env);\r\n        } else if (nativeEvent.ctrlKey) {\r\n            this.tool = new SelectTool(this.env);\r\n        } else if (nativeEvent.shiftKey) {\r\n            this.tool = new CreateNodeTool(this.env);\r\n        } else if (node) {\r\n            this.tool = new DragNodeTool(this.env);\r\n        } else {\r\n            this.tool = new SelectTool(this.env);\r\n        }\r\n        this.tool.onStart(event);\r\n    }\r\n\r\n    onMove(event: ToolEvent): void {\r\n        this.tool?.onMove(event);\r\n    }\r\n    \r\n    onEnd(event: ToolEvent): void {\r\n        this.tool?.onEnd(event);\r\n    }\r\n\r\n}","export const MOUSE_BUTTON_LEFT = 0;\r\nexport const MOUSE_BUTTON_MIDDLE = 1;\r\nexport const MOUSE_BUTTON_RIGHT = 2;","import React, { Component, MouseEvent, RefObject } from 'react';\nimport './App.css';\nimport MindNodeCard from './components/MindNodeCard';\nimport MindNodeInfo from './components/MindNodeInfo';\nimport { MindNode, MindNodePool, Rect } from './interfaces';\nimport { AutoTool } from './tools/AutoTool';\nimport { CreateNodeTool } from './tools/CreateNodeTool';\nimport { DragNodeTool } from './tools/DragNodeTool';\nimport { DragPoolTool } from './tools/DragPoolTool';\nimport { SelectTool } from './tools/SelectTool';\nimport { Tool, ToolEnv, ToolEvent } from './tools/Tool';\nimport { getBezierPointAndAngle, Vec2Util, Vec2 } from './util/mathematics';\nimport { get2dContext, getPosition, getRect } from './util/ui';\n\ntype ToolFlag = 'createNode' | 'dragNode' | 'dragPool' | 'select' | 'auto';\n\nconst TOOL_FLAGS: ToolFlag[] = ['createNode', 'dragNode', 'dragPool', 'select', 'auto'];\nconst TOOL_NAMES = {\n    'createNode': \"增加\", \n    'dragNode': \"移动\", \n    'dragPool': \"拖动\", \n    'select': \"选择\", \n    'auto': \"自动\",\n};\n\nexport interface AppProps {\n\n}\n\nexport interface AppState {\n    uidCounter: number;\n    nodes: Array<MindNode>;\n    offset: Vec2;\n    scale: number;\n    editingNodeUid: number | null;\n    toolFlag: ToolFlag | null; \n    selectionArea: Rect | null;\n    dataString: string;\n}\n\n\nclass App extends Component<AppProps, AppState> implements ToolEnv {\n\n    constructor(props: AppProps) {\n        super(props);\n        this.state = {\n            uidCounter: 0,\n            nodes: [],\n            offset: [0, 0],\n            scale: 1,\n            editingNodeUid: null,\n            toolFlag: null,\n            selectionArea: null,\n            dataString: '',\n        };\n    }\n\n    private mounted = false;\n\n    componentDidMount() {\n        this.mounted = true;\n        this.updateStateNodes();\n        this.drawLines();\n        window.addEventListener('resize', this.resetView);\n        window.addEventListener('keyup', this.onkey);\n        this.resetView();\n        this.setTool('auto');\n        requestAnimationFrame(this.update);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.resetView);\n        window.removeEventListener('keyup', this.onkey);\n        this.mounted = false;\n    }\n\n    render() {\n        return (\n            <div className=\"App\" >\n                {/* 顶部工具栏 */}\n                { this.renderTopBar() }\n\n                {/* 实际池子 */}\n                <div \n                    className={ \"node-pool\" }\n                    ref={ this.poolRef }\n                    onMouseDown={ this.onMouseDown }\n                    onMouseMove={ this.onMouseMove }\n                    onMouseUp={ this.onMouseUp }\n                    onMouseLeave={ this.onMouseLeave }\n                >\n                    <canvas ref={ this.canvasRef } />\n\n                    {\n                        this.state.nodes.map(it => (\n                            <MindNodeCard\n                                key={ it.uid }\n                                anchor={ this.getAnchor() }\n                                node={ it }\n                                linking={ this.linkingNodeUid === it.uid }\n                                choosen={ this.selectedNodeUids.has(it.uid) }\n                                onClick={ this.onClickNode }\n                                onMouseDown={ this.onMouseDown }\n                                onMouseMove={ this.onMouseMove }\n                                onMouseUp={ this.onMouseUp }\n                                onRectUpdate={ (uid, rect) => this.setNodeRect(uid, rect) }\n                                onClickLinkButton={ (uid) => this.linkNode(uid) }\n                                onClickChooseButton={ this.setNodeChoosen }\n                            />\n                        ))\n                    }\n\n                    { this.renderSelectionArea() }\n                    \n                    { this.renderNodeInfo() }\n                </div>\n\n                {/* 底部状态栏 */}\n                { this.renderBottomBar() }\n            </div>\n        );\n    }\n\n    onkey = (e: KeyboardEvent) => {\n        if (e.key === 'Delete') {\n            this.deleteSelectedNodes();\n        }\n\n    }\n\n    //#region 渲染\n    \n    // 池子UI组件\n    private poolRef: RefObject<HTMLDivElement> = React.createRef();\n    // 连接线的画板UI组件\n    private canvasRef: RefObject<HTMLCanvasElement> = React.createRef();\n\n    hideNodeInfoView = () => this.setState(() => ({ editingNodeUid: null }));\n\n    drawLines() {\n        // console.log(\"drawLines\");\n        const canvasAndContext = get2dContext(this.canvasRef);\n        if (!canvasAndContext) {\n            console.log(\"Invalid canvas\");\n            return;\n        }\n        const [canvas, g] = canvasAndContext;\n\n        g.clearRect(0, 0, canvas.width, canvas.height);\n        // 开始画线\n        g.strokeStyle = \"#808080\";\n        g.fillStyle = \"#808080\";\n        g.lineWidth = 1.5;\n        // const anchor = this.getAnchor();\n        // 修正量，是画布的client位置\n        const fix: Vec2 = this.getPoolFix();\n\n        const pointCache = new Map<number, Vec2>();\n        const getPoint: (node: MindNode) => Vec2 = (node: MindNode) => {\n            const cachedPoint = pointCache.get(node.uid);\n            if (cachedPoint) return cachedPoint;\n\n            const rect = this.nodeCardRects.get(node.uid);\n            if (rect) {\n                const point = Vec2Util.add(Vec2Util.minus([rect.x, rect.y], fix), [rect.width / 2, rect.height / 2]);\n                pointCache.set(node.uid, point);\n                return point;\n            }\n            return [0, 0];\n        };\n\n        const nodes = this.nodes;\n        const angleCache = new Map<number, number>();\n        const getAngle: (node: MindNode) => number = (node: MindNode) => {\n            if (angleCache.has(node.uid)) return angleCache.get(node.uid) || NaN;\n\n            const nodePosition = getPoint(node);\n\n            let inRelative: Vec2 = [0, 0];\n            for (const inNodeUid of node.inPorts) {\n                const inNode = nodes.get(inNodeUid);\n                if (!inNode) continue;\n                inRelative = Vec2Util.add(inRelative, Vec2Util.normalize(Vec2Util.minus(nodePosition, getPoint(inNode))));\n            }\n            inRelative = Vec2Util.normalize(inRelative);\n\n            let outRelative: Vec2 = [0, 0];\n            for (const outNodeUid of node.outPorts) {\n                const outNode = nodes.get(outNodeUid);\n                if (!outNode) continue;\n                outRelative = Vec2Util.add(outRelative, Vec2Util.normalize(Vec2Util.minus(getPoint(outNode), nodePosition)));\n            }\n            outRelative = Vec2Util.normalize(outRelative);\n\n            // console.log(\"uid\", node.uid);\n            // console.log(\"inRelative\", inRelative);\n            // console.log(\"outRelative\", outRelative);\n\n            const finalPoint = Vec2Util.add(inRelative, outRelative);\n            const angle = Math.atan2(finalPoint[1], finalPoint[0]);\n\n            angleCache.set(node.uid, angle);\n            return angle;\n        };\n\n        for (const node of Array.from(this.nodes.values())) {\n            const sourcePoint = getPoint(node);\n            for (const portUid of node.outPorts) {\n                const targetNode = this.nodes.get(portUid);\n                if (!targetNode) continue;\n\n                const targetPoint = getPoint(targetNode);\n                const controlHandleLength = Vec2Util.modulo(Vec2Util.minus(targetPoint, sourcePoint))/ 3;\n                const sourceAngle = getAngle(node);\n                const targetAngle = getAngle(targetNode);\n\n                const controlPoint1 = Vec2Util.add(sourcePoint, Vec2Util.fromAngle(sourceAngle, controlHandleLength));\n                const controlPoint2 = Vec2Util.minus(targetPoint, Vec2Util.fromAngle(targetAngle, controlHandleLength));\n\n                const controlPoints: Vec2[] = [sourcePoint, controlPoint1, controlPoint2, targetPoint];\n\n                const [centerPoint, centerAngle] = getBezierPointAndAngle(0.55, ...controlPoints);\n\n\n                g.beginPath();\n                g.moveTo(...sourcePoint);\n                g.bezierCurveTo(...controlPoint1, ...controlPoint2, ...targetPoint);\n                g.stroke();\n                g.beginPath();\n                g.moveTo(...Vec2Util.add(centerPoint, Vec2Util.fromAngle(centerAngle, g.lineWidth * 3)));\n                g.lineTo(...Vec2Util.add(centerPoint, Vec2Util.fromAngle(centerAngle + 0.8 * Math.PI, g.lineWidth * 3)));\n                g.lineTo(...Vec2Util.add(centerPoint, Vec2Util.fromAngle(centerAngle - 0.8 * Math.PI, g.lineWidth * 3)));\n                g.fill();\n\n                // g.beginPath();\n                // g.moveTo(...sourcePoint);\n                // g.lineTo(...targetPoint);\n                // g.stroke();\n            }\n        }\n    }\n\n    renderTopBar() {\n        return (\n            <div className=\"top-bar\">\n                <button onClick={ this.createNode }>新增</button>\n                <button onClick={ this.save }>保存</button>\n                <button onClick={ this.load }>载入</button>\n                <button onClick={ this.unchooseAllNodes }>取消选择</button>\n                <button onClick={ this.deleteSelectedNodes }>删除所选</button>\n                { TOOL_FLAGS.map(f => (\n                    <button \n                        onClick={ this.setTool.bind(this, f) } \n                        disabled={ this.state.toolFlag === f }\n                    >{ TOOL_NAMES[f] }</button>\n                )) }\n                <textarea\n                    value={ this.state.dataString }\n                    placeholder=\"在此输入/输出数据\"\n                    onChange={ e => this.setState(() => ({ dataString: e.target.value })) }\n                />\n            </div>\n        )\n    }\n\n    renderBottomBar() {\n        return (\n            <div className=\"bottom-bar\">\n                <span className=\"piece\">总节点数：{ this.state.nodes.length }</span>\n                <span className=\"piece\">选中节点数：{ this.selectedNodeUids.size }</span>\n            </div>\n        )\n    }\n\n    renderNodeInfo() {\n        const editingNode = (this.state.editingNodeUid !== null) ? (this.nodes.get(this.state.editingNodeUid)) : null;\n        if (!editingNode) return null;\n\n        return (\n            <div className=\"node-info\">\n                <button className=\"icon\" onClick={ this.hideNodeInfoView }>&gt;</button>\n                <MindNodeInfo\n                    key={ editingNode.uid }\n                    node={ editingNode }\n                    nodes={ this.nodes }\n                    onUpdate={ node => this.updateNode(node) }\n                />\n            </div>\n        );\n    }\n\n    renderSelectionArea() {\n        const { selectionArea } = this.state;\n        if (!selectionArea) return null;\n        let { x, y, width, height } = selectionArea;\n        let [left, top] = Vec2Util.minus([x, y], this.getPoolFix());\n        if (width < 0) {\n            width = -width;\n            left = left - width;\n        }\n        if (height < 0) {\n            height = -height;\n            top = top - height;\n        }\n        return (\n            <div \n                className=\"section\"\n                style={{\n                    left: left + 'px',\n                    top: top + 'px',\n                    width: width + 'px',\n                    height: height + 'px',\n                }}\n            />\n        );\n    }\n\n    //#endregion\n\n    //#region 工具\n\n    get offset() { return this.state.offset; }\n    set offset(o) { this.setState(() => ({ offset: o })) }\n\n    get scale() { return this.state.scale; }\n    set scale(s) { this.setState(() => ({ scale: s })) }\n\n    get selectionArea() { return this.state.selectionArea; }\n    set selectionArea(sa) { this.setState(() => ({ selectionArea: sa })) }\n\n    private nodeCardRects: Map<number, Rect> = new Map();\n    public selectedNodeUids: Set<number> = new Set();\n\n    getNodeRect(uid: number): Rect | null {\n        return this.nodeCardRects.get(uid) || null;\n    }\n\n    setNodeRect(uid: number, rect: Rect) {\n        this.nodeCardRects.set(uid, rect);\n    }\n\n    private tool: Tool | null = null;\n\n    setTool(flag: ToolFlag | null) {\n        switch (flag) {\n            case 'createNode': this.tool = new CreateNodeTool(this); break;\n            case 'dragNode': this.tool = new DragNodeTool(this); break;\n            case 'dragPool': this.tool = new DragPoolTool(this); break;\n            case 'select': this.tool = new SelectTool(this); break;\n            case 'auto': this.tool = new AutoTool(this); break;\n            default: this.tool = null; break;\n        }\n        this.setState(() => ({ toolFlag: flag }));\n    }\n\n    //#endregion\n\n    //#region UI相关\n\n    /*\n     * O->A->N\n     * ----    :Origin to Anchor: Offset\n     *    ---- :Anchor to Node: Position (of node)\n     */\n\n    // 原点，应该是pool组件的中心点\n    private origin: Vec2 = [0, 0];\n\n    resetView = () => {\n        const box = this.poolRef.current?.getBoundingClientRect();\n        if (!box) return;\n        \n\n        this.origin = [box.width / 2, box.height / 2];\n        const canvas = this.canvasRef.current;\n        if (canvas) {\n            canvas.width = box.width;\n            canvas.height = box.height;\n        }\n        this.notifyUpdate();\n    }\n\n    getAnchor(): Vec2 {\n        return Vec2Util.add(this.origin, this.state.offset);\n    }\n\n    getPoolFix(): Vec2 {\n        return getPosition(getRect(this.poolRef));\n    }\n\n    // 是否需要更新\n    private dirty: boolean = true;\n    \n    notifyUpdate() {\n        this.dirty = true;\n    }\n\n    update = () => {\n        if (!this.mounted) return;\n        if (this.dirty) {\n            this.updateStateNodes();\n            this.drawLines();\n            this.dirty = false;\n        }\n        requestAnimationFrame(this.update);\n    }\n\n    //#endregion\n\n    //#region 数据控制\n\n    // 所有节点列表，是实际的数据\n    public readonly nodes: Map<number, MindNode> = new Map();\n\n    genUid() {\n        const uid = this.state.uidCounter;\n        this.setState(s => ({ uidCounter: s.uidCounter + 1 }));\n        return uid;\n    }\n\n    createNode = () => {\n        const uid = this.genUid();\n        const node: MindNode = {\n            uid,\n            position: Vec2Util.minus([0, 0], this.state.offset),\n            text: `#${uid}`,\n            outPorts: [],\n            inPorts: [],\n        };\n\n        this.addNode(node);\n    }\n\n    addNode(node: MindNode) {\n        this.nodes.set(node.uid, node);\n        this.updateStateNodes();\n    }\n\n    updateNode(node: MindNode) {\n        this.nodes.set(node.uid, node);\n        this.updateStateNodes();\n    }\n\n    removeNode(uid: number) {\n        this.nodes.delete(uid);\n        this.nodeCardRects.delete(uid);\n        this.selectedNodeUids.delete(uid);\n        this.updateStateNodes();\n    }\n\n    updateStateNodes() {\n        this.setState(() => ({ nodes: Array.from(this.nodes.values()) }));\n    }\n\n    // 正在连接的节点UID\n    private linkingNodeUid: number | null = null;\n\n    linkNode(uid: number) {\n        const targetNode = this.nodes.get(uid);\n        if (!targetNode) return;\n        if (this.linkingNodeUid !== null) {\n            if (this.linkingNodeUid !== targetNode.uid) {\n                const sourceNode = this.nodes.get(this.linkingNodeUid);\n                if (sourceNode && targetNode) {\n                    const outPorts = new Set(sourceNode.outPorts);\n                    const inPorts = new Set(targetNode.inPorts);\n                    if (outPorts.has(targetNode.uid)) {\n                        outPorts.delete(targetNode.uid);\n                        inPorts.delete(sourceNode.uid);\n                    } else {\n                        outPorts.add(targetNode.uid);\n                        inPorts.add(sourceNode.uid);\n                    }\n                    sourceNode.outPorts = Array.from(outPorts);\n                    targetNode.inPorts = Array.from(inPorts);\n                    this.updateStateNodes();\n                }\n            }\n            this.linkingNodeUid = null;\n        } else {\n            this.linkingNodeUid = targetNode.uid;\n        }\n    }\n\n    //#endregion\n\n    //#region 鼠标事件\n\n    onClickNode = (event: MouseEvent, uid: number) => {\n        this.setState(() => ({ editingNodeUid: uid }));\n    }\n\n    private getToolEvent(e: MouseEvent, uid?: number): ToolEvent {\n        if (typeof uid === 'number') {\n            e.stopPropagation();\n        }\n        const node = typeof uid === 'number' ? (this.nodes.get(uid) || null) : null;\n        // const mousePosition = Vec2.minus([e.clientX, e.clientY], this.getPoolFix());\n        const mousePosition: Vec2 = [e.clientX, e.clientY];\n        return {\n            mousePosition,\n            node,\n            nativeEvent: e,\n        };\n    }\n\n    onMouseDown = (e: MouseEvent, uid?: number) => {\n        this.tool?.onStart(this.getToolEvent(e, uid));\n        this.notifyUpdate();\n    }\n\n    onMouseMove = (e: MouseEvent, uid?: number) => {\n        this.tool?.onMove(this.getToolEvent(e, uid));\n        this.notifyUpdate();\n    }\n\n    onMouseUp = (e: MouseEvent, uid?: number) => {\n        const ev = this.getToolEvent(e, uid);\n        this.tool?.onMove(ev);\n        this.tool?.onEnd(ev);\n        this.notifyUpdate();\n    }\n\n    onMouseLeave = (e: MouseEvent, uid?: number) => {\n        this.onMouseUp(e, uid);\n    }\n\n    //#endregion\n\n    //#region 坐标变换\n\n    // 把数据里的坐标转换为在.pool DOM元素种像素为单位的坐标\n    pool2pixel(poolCoord: Vec2): Vec2 {\n        return Vec2Util.add(poolCoord, this.getAnchor());\n    }\n    \n    // 在.pool DOM元素种像素为单位的坐标转换为把数据里的坐标\n    pixel2pool(pixelCoord: Vec2): Vec2 {\n        return Vec2Util.minus(Vec2Util.minus(pixelCoord, this.getAnchor()), this.getPoolFix());\n    }\n\n    //#endregion\n\n    //#region 持久化\n\n    buildPool(): MindNodePool {\n        return {\n            uidCounter: this.state.uidCounter,\n            offset: this.state.offset,\n            scale: this.state.scale,\n            nodes: Array.from(this.nodes.values()),\n        };\n    }\n\n    load = () => {\n        try {\n            const pool: MindNodePool = JSON.parse(this.state.dataString);\n\n            this.nodes.clear();\n            this.nodeCardRects.clear();\n            this.selectedNodeUids.clear();\n            pool.nodes.forEach(it => this.nodes.set(it.uid, it));\n\n            this.setState(() => ({\n                uidCounter: pool.uidCounter || 0,\n                offset: pool.offset || [0, 0],\n                nodes: pool.nodes || [],\n                scale: pool.scale || 0,\n            }));\n        } catch (e) {\n            alert('解析数据失败！');\n        }\n    }\n\n    save = () => {\n        const pool: MindNodePool = this.buildPool();\n        this.setState(() => ({ dataString: JSON.stringify(pool) }));\n        console.log(pool);\n    }\n\n    //#endregion\n\n    //#region 节点选择相关\n\n    setNodeChoosen = (uid: number, value: boolean) => {\n        if (value) {\n            this.selectedNodeUids.add(uid);\n        } else {\n            this.selectedNodeUids.delete(uid);\n        }\n        this.notifyUpdate();\n    }\n\n    unchooseAllNodes = () => {\n        this.selectedNodeUids.clear();\n        this.notifyUpdate();\n    }\n\n    deleteSelectedNodes = () => {\n        this.selectedNodeUids.forEach(uid => {\n            this.nodes.delete(uid);\n            this.nodeCardRects.delete(uid);\n        });\n        this.selectedNodeUids.clear();\n        this.notifyUpdate();\n    }\n\n    //#endregion\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}
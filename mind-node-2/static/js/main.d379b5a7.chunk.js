(this["webpackJsonpmind-node-2"]=this["webpackJsonpmind-node-2"]||[]).push([[0],{18:function(t,e,n){},19:function(t,e,n){},20:function(t,e,n){},22:function(t,e,n){},23:function(t,e,n){"use strict";n.r(e);var o=n(6),i=n.n(o),s=n(13),a=n.n(s),r=(n(18),n(7)),c=n(9),u=n(5),d=n(1),l=n(2),h=n(4),v=n(3);n(19),n(20);function f(t){var e=[];for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=t[n];"string"===typeof o?e.push(o):o&&e.push(n)}return e.join(" ")}function p(t){return t.filter((function(t){return t||null!==t&&void 0!==t}))}var j=function(){};function b(t){var e,n=null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect();return{x:(null===n||void 0===n?void 0:n.x)||0,y:(null===n||void 0===n?void 0:n.y)||0,width:(null===n||void 0===n?void 0:n.width)||0,height:(null===n||void 0===n?void 0:n.height)||0}}var g=n(0),y=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return(t=e.call.apply(e,[this].concat(s))).selfRef=i.a.createRef(),t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.props.onRectUpdate(this.props.node.uid,b(this.selfRef))}},{key:"componentDidUpdate",value:function(){this.props.onRectUpdate(this.props.node.uid,b(this.selfRef))}},{key:"render",value:function(){var t=this,e=this.props,n=e.node,o=n.uid,i=Object(u.a)(n.position,2),s=i[0],a=i[1],r=n.text,c=n.background,d=n.color,l=Object(u.a)(e.anchor,2),h=l[0],v=l[1],p=e.linking,j=e.choosen,b=s+h,y=a+v;return Object(g.jsxs)("div",{className:f({MindNodeCard:!0,linking:p,choosen:j}),ref:this.selfRef,style:{left:"".concat(b,"px"),top:"".concat(y,"px")},onClick:function(e){return t.props.onClick(e,o)},onMouseDown:function(e){return t.props.onMouseDown(e,o)},onMouseMove:function(e){return t.props.onMouseMove(e,o)},onMouseUp:function(e){return t.props.onMouseUp(e,o)},children:[Object(g.jsx)("div",{className:"frame"}),Object(g.jsx)("div",{className:"static",style:{background:c},children:Object(g.jsx)("div",{className:"wrapper",children:Object(g.jsx)("div",{className:"text",style:{color:d},children:r.split("\n").map((function(t,e){return Object(g.jsx)("p",{children:t},e)}))})})})]})}}]),n}(o.Component),N=y,O=n(8),k=(n(22),function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).getBrief=function(t){var e=o.props.nodes.get(t);return e?"#"+t+"\uff1a"+e.text:"#"+t},o.state={inputingBackground:t.node.background,inputingColor:t.node.color,inputingText:t.node.text},o}return Object(l.a)(n,[{key:"render",value:function(){var t=this,e=this.props.node,n=e.uid,o=e.position,i=e.outPorts,s=e.inPorts;return Object(g.jsxs)("div",{className:"MindNodeInfo",children:[Object(g.jsx)("div",{className:"top-bar"}),Object(g.jsxs)("div",{className:"content",children:[Object(g.jsxs)("p",{children:[Object(g.jsx)("span",{className:"title",children:"UID\uff1a"}),Object(g.jsxs)("span",{className:"text",children:["#",n]})]}),Object(g.jsxs)("p",{children:[Object(g.jsx)("span",{className:"title",children:"\u4f4d\u7f6e\uff1a"}),Object(g.jsxs)("span",{className:"text",children:["(",o.map((function(t){return t.toFixed(1)})).join(", "),")"]})]}),Object(g.jsxs)("p",{className:"field-color",children:[Object(g.jsx)("span",{className:"title",children:"\u80cc\u666f\u6837\u5f0f\uff1a"}),Object(g.jsx)("input",{className:"color-input",value:this.state.inputingBackground,onChange:function(e){return t.setBackground(e.target.value)}}),Object(g.jsx)("div",{className:"color-input-preview",style:{background:this.state.inputingBackground}})]}),Object(g.jsxs)("p",{className:"field-color",children:[Object(g.jsx)("span",{className:"title",children:"\u6587\u5b57\u6837\u5f0f\uff1a"}),Object(g.jsx)("input",{className:"color-input",value:this.state.inputingColor,onChange:function(e){return t.setColor(e.target.value)}}),Object(g.jsx)("div",{className:"color-input-preview",style:{background:this.state.inputingColor}})]}),Object(g.jsxs)("p",{children:[Object(g.jsx)("span",{className:"title",children:"\u5185\u5bb9\uff1a"}),Object(g.jsx)("textarea",{className:"text-input",value:this.state.inputingText,onChange:function(e){return t.setText(e.target.value)}})]}),Object(g.jsxs)("p",{className:"title",children:["\u51fa\u7ebf\uff08",i.length,"\u4e2a\uff09\uff1a"]}),Object(g.jsx)("ol",{className:"text",children:i.map((function(e){return Object(g.jsx)("li",{className:"snapshot",children:t.getBrief(e)},e)}))}),Object(g.jsxs)("p",{className:"title",children:["\u5165\u7ebf\uff08",s.length,"\u4e2a\uff09\uff1a"]}),Object(g.jsx)("ol",{className:"text",children:s.map((function(e){return Object(g.jsx)("li",{className:"snapshot",children:t.getBrief(e)},e)}))})]})]})}},{key:"setText",value:function(t){this.setState((function(){return{inputingText:t}}));var e=Object(O.a)(Object(O.a)({},this.props.node),{},{text:t});this.props.onUpdate(e)}},{key:"setBackground",value:function(t){this.setState((function(){return{inputingBackground:t}}));var e=Object(O.a)(Object(O.a)({},this.props.node),{},{background:t});this.props.onUpdate(e)}},{key:"setColor",value:function(t){this.setState((function(){return{inputingColor:t}}));var e=Object(O.a)(Object(O.a)({},this.props.node),{},{color:t});this.props.onUpdate(e)}}]),n}(o.Component));function m(t){var e=t.uid;return{uid:e,position:t.position,text:"#".concat(e),background:"#223344",color:"#ffffff",outPorts:[],inPorts:[]}}function x(t,e){if(t&&e){var n=new Set(t.outPorts),o=new Set(e.inPorts);n.has(e.uid)&&n.delete(e.uid),o.has(t.uid)&&o.delete(t.uid),t.outPorts=Array.from(n),e.inPorts=Array.from(o)}}var P=function(){return[0,0]},M=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Number.isNaN(t)?[0,0]:[Math.cos(t)*e,Math.sin(t)*e]},w=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return[e.reduce((function(t,e){return t+e[0]}),0),e.reduce((function(t,e){return t+e[1]}),0)]},U=function(t,e){return[t[0]-e[0],t[1]-e[1]]},C=function(t){if(0===t[0]&&0===t[1])return[0,0];var e=Math.atan2(t[1],t[0]);return[Math.cos(e),Math.sin(e)]},S=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])};function A(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];if(n.length<=1)return[n[0],0];for(var i=n;i.length>2;){for(var s=[],a=1;a<i.length;a++){var r=Object(u.a)(i[a-1],2),c=r[0],d=r[1],l=Object(u.a)(i[a],2),h=l[0],v=l[1];s.push([c+(h-c)*t,d+(v-d)*t])}i=s}var f=Object(u.a)(i[0],2),p=f[0],j=f[1],b=Object(u.a)(i[1],2),g=b[0],y=b[1],N=g-p,O=y-j,k=[p+N*t,j+O*t],m=Math.atan2(O,N);return[k,m]}var R=function t(e){Object(d.a)(this,t),this.env=void 0,this.env=e},E=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).actived=!1,t.startMousePosition=P(),t.startNodePositions=new Map,t}return Object(l.a)(n,[{key:"onStart",value:function(t){var e=this,n=t.mousePosition,o=t.node;this.startNodePositions.clear(),this.startMousePosition=n,this.actived=!0;var i=Array.from(this.env.selectedNodeUids.values());o&&!this.env.selectedNodeUids.has(o.uid)&&(i=[o.uid],this.env.selectedNodeUids=new Set(i));var s=p(Array.from(i.values()).map((function(t){return e.env.nodes.get(t)}))).map((function(t){return function(t,e){var n=e.uid,o=e.position;return Object(O.a)(Object(O.a)({},t),{},{uid:n,position:o,inPorts:[],outPorts:[]})}(t,{uid:e.env.genUid(),position:(n=t.position,Object(r.a)(n))});var n}));console.log("copiedNodes",s),this.env.selectedNodeUids.clear(),s.forEach((function(t){e.env.nodes.set(t.uid,t),e.env.selectedNodeUids.add(t.uid)})),this.startNodePositions.clear();var a,u=Object(c.a)(s);try{for(u.s();!(a=u.n()).done;){var d=a.value;d&&this.startNodePositions.set(d.uid,d.position)}}catch(l){u.e(l)}finally{u.f()}}},{key:"onMove",value:function(t){var e=this,n=t.mousePosition;if(this.actived){var o=U(n,this.startMousePosition);this.startNodePositions.forEach((function(t,n){var i=e.env.nodes.get(n);i&&(i.position=w(t,o))}))}}},{key:"onEnd",value:function(){this.actived&&(this.startNodePositions.clear(),this.startMousePosition=P(),this.actived=!1)}}]),n}(R),D=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){return Object(d.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"onStart",value:function(){}},{key:"onMove",value:function(){}},{key:"onEnd",value:function(t){var e=t.mousePosition,n=this.env.pixel2pool(e),o=this.env.genUid(),i=m({uid:o,position:n});this.env.nodes.set(o,i)}}]),n}(R),B=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).actived=!1,t.startMousePosition=P(),t.startNodePositions=new Map,t}return Object(l.a)(n,[{key:"onStart",value:function(t){var e=t.mousePosition,n=t.node;this.startNodePositions.clear(),this.startMousePosition=e,this.actived=!0;var o=Array.from(this.env.selectedNodeUids.values());n&&!this.env.selectedNodeUids.has(n.uid)&&(o=[n.uid],this.env.selectedNodeUids=new Set(o)),this.startNodePositions.clear();var i,s=Object(c.a)(o);try{for(s.s();!(i=s.n()).done;){var a=i.value,r=this.env.nodes.get(a);r&&this.startNodePositions.set(a,r.position)}}catch(u){s.e(u)}finally{s.f()}}},{key:"onMove",value:function(t){var e=this,n=t.mousePosition;if(this.actived){var o=U(n,this.startMousePosition);this.startNodePositions.forEach((function(t,n){var i=e.env.nodes.get(n);i&&(i.position=w(t,o))}))}}},{key:"onEnd",value:function(){this.actived&&(this.startNodePositions.clear(),this.startMousePosition=P(),this.actived=!1)}}]),n}(R),T=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).actived=!1,t.startPoolOffset=P(),t.startMousePosition=P(),t}return Object(l.a)(n,[{key:"onStart",value:function(t){var e=t.mousePosition;this.startPoolOffset=this.env.offset,this.startMousePosition=e,this.actived=!0}},{key:"onMove",value:function(t){var e=t.mousePosition;this.actived&&(this.env.offset=w(this.startPoolOffset,U(e,this.startMousePosition)))}},{key:"onEnd",value:function(){this.actived&&(this.startPoolOffset=P(),this.startMousePosition=P(),this.actived=!1)}}]),n}(R),F=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).actived=!1,t}return Object(l.a)(n,[{key:"onStart",value:function(t){var e=t.node;e&&(this.actived=!0,e&&!this.env.selectedNodeUids.has(e.uid)&&(this.env.selectedNodeUids=new Set([e.uid])))}},{key:"onMove",value:function(t){var e=t.mousePosition;this.actived&&(this.env.virtualDstPos=e)}},{key:"onEnd",value:function(t){var e=this,n=t.node;if(this.actived){if(this.env.virtualDstPos=null,n){var o=n;this.env.selectedNodeUids.forEach((function(t){var n=e.env.nodes.get(t);n&&function(t,e){if(t&&e&&t.uid!==e.uid){var n=new Set(t.outPorts),o=new Set(e.inPorts);return n.has(e.uid)?(n.delete(e.uid),o.delete(t.uid)):(n.add(e.uid),o.add(t.uid)),t.outPorts=Array.from(n),e.inPorts=Array.from(o),!0}}(n,o)}))}this.actived=!1}}}]),n}(R),I=function(t,e){return t-e},L=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).actived=!1,t.startMousePosition=P(),t}return Object(l.a)(n,[{key:"onStart",value:function(t){var e=t.mousePosition;this.startMousePosition=e,this.actived=!0}},{key:"onMove",value:function(t){var e=t.mousePosition;if(this.actived){var n=U(e,this.startMousePosition),o=Object(u.a)(n,2),i=o[0],s=o[1];this.env.selectionArea={x:this.startMousePosition[0],y:this.startMousePosition[1],width:i,height:s}}}},{key:"onEnd",value:function(t){var e=this,n=t.mousePosition,o=t.node,i=t.nativeEvent;if(this.actived){var s=[];if(function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(this.startMousePosition,n))o&&(s=[o.uid]);else{var a=[this.startMousePosition[0],n[0]].sort(I),r=Object(u.a)(a,2),c=r[0],d=r[1],l=[this.startMousePosition[1],n[1]].sort(I),h=Object(u.a)(l,2),v=h[0],f=h[1];s=Array.from(this.env.nodes.values()).filter((function(t){return e.isNodeInRange(t,c,d,v,f)})).map((function(t){return t.uid}))}i.ctrlKey?s.forEach((function(t){return e.env.selectedNodeUids.add(t)})):this.env.selectedNodeUids=new Set(s),this.startMousePosition=P(),this.env.selectionArea=null,this.actived=!1}}},{key:"isNodeInRange",value:function(t,e,n,o,i){var s=this.env.getNodeRect(t.uid);if(!s)return!1;var a=s.x,r=s.y,c=s.width,u=s.height;return a>=e&&r>=o&&a+c<n&&r+u<i}}]),n}(R),V=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(){var t;Object(d.a)(this,n);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))).tool=null,t}return Object(l.a)(n,[{key:"onStart",value:function(t){var e=t.node,n=t.nativeEvent;1===n.button?this.tool=new T(this.env):2===n.button?this.tool=new F(this.env):n.ctrlKey?this.tool=new L(this.env):n.shiftKey?(this.tool=new D(this.env),n.preventDefault()):n.altKey?this.tool=new E(this.env):this.tool=e?new B(this.env):new L(this.env),this.tool.onStart(t)}},{key:"onMove",value:function(t){var e;null===(e=this.tool)||void 0===e||e.onMove(t)}},{key:"onEnd",value:function(t){var e;null===(e=this.tool)||void 0===e||e.onEnd(t),this.tool=new L(this.env)}}]),n}(R),W=["createNode","linkNode","copyNode","dragNode","dragPool","select","auto"],z={createNode:"\u589e\u52a0",linkNode:"\u94fe\u63a5",copyNode:"\u590d\u5236",dragNode:"\u79fb\u52a8",dragPool:"\u62d6\u52a8",select:"\u9009\u62e9",auto:"\u81ea\u52a8"},J=function(t){Object(h.a)(n,t);var e=Object(v.a)(n);function n(t){var o;return Object(d.a)(this,n),(o=e.call(this,t)).mounted=!1,o.onkey=function(t){"Delete"===t.key&&o.deleteSelectedNodes()},o.poolRef=i.a.createRef(),o.canvasRef=i.a.createRef(),o.virtualDstPos=null,o.hideNodeInfoView=function(){return o.setState((function(){return{editingNodeUid:null}}))},o.nodeCardRects=new Map,o.selectedNodeUids=new Set,o.tool=null,o.origin=[0,0],o.resetView=function(){var t,e=null===(t=o.poolRef.current)||void 0===t?void 0:t.getBoundingClientRect();if(e){o.origin=[e.width/2,e.height/2];var n=o.canvasRef.current;n&&(n.width=e.width,n.height=e.height),o.notifyUpdate()}},o.dirty=!0,o.update=function(){o.mounted&&(o.dirty&&(o.updateStateNodes(),o.drawLines(),o.dirty=!1),requestAnimationFrame(o.update))},o.nodes=new Map,o.uidCounter=0,o.createNode=function(){var t=m({uid:o.genUid(),position:U([0,0],o.state.offset)});o.addNode(t)},o.onClickNode=function(t,e){o.setState((function(){return{editingNodeUid:e}}))},o.onMouseDown=function(t,e){var n;null===(n=o.tool)||void 0===n||n.onStart(o.getToolEvent(t,e)),o.notifyUpdate()},o.onMouseMove=function(t,e){var n;null===(n=o.tool)||void 0===n||n.onMove(o.getToolEvent(t,e)),o.notifyUpdate()},o.onMouseUp=function(t,e){var n,i,s=o.getToolEvent(t,e);null===(n=o.tool)||void 0===n||n.onMove(s),null===(i=o.tool)||void 0===i||i.onEnd(s),o.notifyUpdate()},o.onMouseLeave=function(t,e){o.onMouseUp(t,e)},o.load=function(){try{var t=function(t){return{uidCounter:t.uidCounter||0,offset:t.offset||[0,0],scale:t.scale||1,nodes:t.nodes?t.nodes.map((function(t){return Object.assign(m(t),t)})):[]}}(JSON.parse(o.state.dataString));o.nodes.clear(),o.nodeCardRects.clear(),o.selectedNodeUids.clear(),t.nodes.forEach((function(t){return o.nodes.set(t.uid,t)})),o.setState((function(){return{uidCounter:t.uidCounter,offset:t.offset,nodes:t.nodes,scale:t.scale}})),o.uidCounter=t.uidCounter}catch(e){alert("\u89e3\u6790\u6570\u636e\u5931\u8d25\uff01")}},o.save=function(){var t=o.buildPool();o.setState((function(){return{dataString:JSON.stringify(t)}})),console.log(t)},o.setNodeChoosen=function(t,e){e?o.selectedNodeUids.add(t):o.selectedNodeUids.delete(t),o.notifyUpdate()},o.unchooseAllNodes=function(){o.selectedNodeUids.clear(),o.notifyUpdate()},o.deleteSelectedNodes=function(){o.selectedNodeUids.forEach((function(t){o.nodeCardRects.delete(t);var e=o.nodes.get(t);e&&(o.nodes.delete(t),p(e.outPorts.map((function(t){return o.nodes.get(t)}))).forEach((function(t){return x(e,t)})),p(e.inPorts.map((function(t){return o.nodes.get(t)}))).forEach((function(t){return x(t,e)})))})),o.selectedNodeUids.clear(),o.notifyUpdate()},o.state={uidCounter:0,nodes:[],offset:[0,0],scale:1,editingNodeUid:null,toolFlag:null,selectionArea:null,dataString:""},o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.mounted=!0,this.updateStateNodes(),this.drawLines(),window.addEventListener("resize",this.resetView),window.addEventListener("keyup",this.onkey),this.resetView(),this.setTool("auto"),requestAnimationFrame(this.update)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resetView),window.removeEventListener("keyup",this.onkey),this.mounted=!1}},{key:"render",value:function(){var t=this;return Object(g.jsxs)("div",{className:"App",onContextMenu:function(t){return t.preventDefault()},children:[this.renderTopBar(),Object(g.jsxs)("div",{className:"node-pool",ref:this.poolRef,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseLeave,children:[Object(g.jsx)("canvas",{ref:this.canvasRef}),this.state.nodes.map((function(e){return Object(g.jsx)(N,{anchor:t.getAnchor(),node:e,linking:!1,choosen:t.selectedNodeUids.has(e.uid),onClick:t.onClickNode,onMouseDown:t.onMouseDown,onMouseMove:t.onMouseMove,onMouseUp:t.onMouseUp,onRectUpdate:function(e,n){return t.setNodeRect(e,n)},onClickLinkButton:j,onClickChooseButton:j},e.uid)})),this.renderSelectionArea(),this.renderNodeInfo()]}),this.renderBottomBar()]})}},{key:"drawLines",value:function(){var t=this,e=function(t){var e=t.current;if(!e)return null;var n=e.getContext("2d");return n?[e,n]:null}(this.canvasRef);if(e){var n=Object(u.a)(e,2),o=n[0],i=n[1];i.clearRect(0,0,o.width,o.height),i.strokeStyle="#808080",i.fillStyle="#808080",i.lineWidth=1.5;for(var s=this.getPoolFix(),a=new Map,d=function(e){var n=a.get(e);if(n)return n;if(-1===e){var o=U(t.virtualDstPos||[0,0],s);return a.set(e,o),o}var i=t.nodeCardRects.get(e);if(i){var r=w(U([i.x,i.y],s),[i.width/2,i.height/2]);return a.set(e,r),r}return[0,0]},l=this.nodes,h=new Map,v=function(e){if(h.has(e))return h.get(e)||NaN;var n=d(e);if(-1===e){for(var o=[0,0],i=0,s=Array.from(t.selectedNodeUids.values());i<s.length;i++){var a=s[i];o=w(o,C(U(n,d(a))))}o=C(o);var r=Math.atan2(o[1],o[0]);return h.set(e,r),r}var u=l.get(e);if(!u)return NaN;var v,f=[0,0],p=Object(c.a)(u.inPorts);try{for(p.s();!(v=p.n()).done;){var j=v.value;f=w(f,C(U(n,d(j))))}}catch(m){p.e(m)}finally{p.f()}f=C(f);var b,g=[0,0],y=Object(c.a)(u.outPorts);try{for(y.s();!(b=y.n()).done;){var N=b.value;g=w(g,C(U(d(N),n)))}}catch(m){y.e(m)}finally{y.f()}t.selectedNodeUids.has(u.uid)&&t.virtualDstPos&&(g=w(g,C(U(t.virtualDstPos,n)))),g=C(g);var O=w(f,g),k=Math.atan2(O[1],O[0]);return h.set(u.uid,k),k},f=0,p=Array.from(this.nodes.values());f<p.length;f++){var j=p[f],b=d(j.uid),g=j.outPorts.slice();this.selectedNodeUids.has(j.uid)&&this.virtualDstPos&&g.push(-1);var y,N=Object(c.a)(g);try{for(N.s();!(y=N.n()).done;){var O=y.value,k=d(O),m=v(j.uid),x=v(O);if(!isNaN(m)&&!isNaN(x)){var P=S(U(k,b))/3,R=w(b,M(m,P)),E=U(k,M(x,P)),D=[b,R,E,k],B=A.apply(void 0,[.55].concat(D)),T=Object(u.a)(B,2),F=T[0],I=T[1];i.beginPath(),i.moveTo.apply(i,Object(r.a)(b)),i.bezierCurveTo.apply(i,Object(r.a)(R).concat(Object(r.a)(E),Object(r.a)(k))),i.stroke(),i.beginPath(),i.moveTo.apply(i,Object(r.a)(w(F,M(I,3*i.lineWidth)))),i.lineTo.apply(i,Object(r.a)(w(F,M(I+.8*Math.PI,3*i.lineWidth)))),i.lineTo.apply(i,Object(r.a)(w(F,M(I-.8*Math.PI,3*i.lineWidth)))),i.fill()}}}catch(L){N.e(L)}finally{N.f()}}}else console.log("Invalid canvas")}},{key:"renderTopBar",value:function(){var t=this;return Object(g.jsxs)("div",{className:"top-bar",children:[Object(g.jsx)("button",{onClick:this.createNode,children:"\u65b0\u589e"}),Object(g.jsx)("button",{onClick:this.save,children:"\u4fdd\u5b58"}),Object(g.jsx)("button",{onClick:this.load,children:"\u8f7d\u5165"}),Object(g.jsx)("button",{onClick:this.unchooseAllNodes,children:"\u53d6\u6d88\u9009\u62e9"}),Object(g.jsx)("button",{onClick:this.deleteSelectedNodes,children:"\u5220\u9664\u6240\u9009"}),W.map((function(e){return Object(g.jsx)("button",{onClick:t.setTool.bind(t,e),disabled:t.state.toolFlag===e,children:z[e]},e)})),Object(g.jsx)("textarea",{value:this.state.dataString,placeholder:"\u5728\u6b64\u8f93\u5165/\u8f93\u51fa\u6570\u636e",onChange:function(e){return t.setState((function(){return{dataString:e.target.value}}))}})]})}},{key:"renderBottomBar",value:function(){return Object(g.jsxs)("div",{className:"bottom-bar",children:[Object(g.jsxs)("span",{className:"piece",children:["\u603b\u8282\u70b9\u6570\uff1a",this.state.nodes.length]}),Object(g.jsxs)("span",{className:"piece",children:["\u9009\u4e2d\u8282\u70b9\u6570\uff1a",this.selectedNodeUids.size]})]})}},{key:"renderNodeInfo",value:function(){var t=this,e=null!==this.state.editingNodeUid?this.nodes.get(this.state.editingNodeUid):null;return e?Object(g.jsxs)("div",{className:"node-info",children:[Object(g.jsx)("button",{className:"icon",onClick:this.hideNodeInfoView,children:">"}),Object(g.jsx)(k,{node:e,nodes:this.nodes,onUpdate:function(e){return t.updateNode(e)}},e.uid)]}):null}},{key:"renderSelectionArea",value:function(){var t=this.state.selectionArea;if(!t)return null;var e=t.x,n=t.y,o=t.width,i=t.height,s=U([e,n],this.getPoolFix()),a=Object(u.a)(s,2),r=a[0],c=a[1];return o<0&&(r-=o=-o),i<0&&(c-=i=-i),Object(g.jsx)("div",{className:"section",style:{left:r+"px",top:c+"px",width:o+"px",height:i+"px"}})}},{key:"offset",get:function(){return this.state.offset},set:function(t){this.setState((function(){return{offset:t}}))}},{key:"scale",get:function(){return this.state.scale},set:function(t){this.setState((function(){return{scale:t}}))}},{key:"selectionArea",get:function(){return this.state.selectionArea},set:function(t){this.setState((function(){return{selectionArea:t}}))}},{key:"getNodeRect",value:function(t){return this.nodeCardRects.get(t)||null}},{key:"setNodeRect",value:function(t,e){this.nodeCardRects.set(t,e)}},{key:"setTool",value:function(t){switch(t){case"createNode":this.tool=new D(this);break;case"linkNode":this.tool=new F(this);break;case"copyNode":this.tool=new E(this);break;case"dragNode":this.tool=new B(this);break;case"dragPool":this.tool=new T(this);break;case"select":this.tool=new L(this);break;case"auto":this.tool=new V(this);break;default:this.tool=null}this.setState((function(){return{toolFlag:t}}))}},{key:"getAnchor",value:function(){return w(this.origin,this.state.offset)}},{key:"getPoolFix",value:function(){return[(null===(t=b(this.poolRef))||void 0===t?void 0:t.x)||0,(null===t||void 0===t?void 0:t.y)||0];var t}},{key:"notifyUpdate",value:function(){this.dirty=!0}},{key:"genUid",value:function(){var t=this,e=this.uidCounter++;return this.setState((function(){return{uidCounter:t.uidCounter}})),e}},{key:"addNode",value:function(t){this.nodes.set(t.uid,t),this.updateStateNodes()}},{key:"updateNode",value:function(t){this.nodes.set(t.uid,t),this.updateStateNodes()}},{key:"removeNode",value:function(t){this.nodes.delete(t),this.nodeCardRects.delete(t),this.selectedNodeUids.delete(t),this.updateStateNodes()}},{key:"updateStateNodes",value:function(){var t=this;this.setState((function(){return{nodes:Array.from(t.nodes.values())}}))}},{key:"getToolEvent",value:function(t,e){"number"===typeof e&&t.stopPropagation();var n="number"===typeof e&&this.nodes.get(e)||null;return{mousePosition:[t.clientX,t.clientY],node:n,nativeEvent:t}}},{key:"pool2pixel",value:function(t){return w(t,this.getAnchor())}},{key:"pixel2pool",value:function(t){return U(U(t,this.getAnchor()),this.getPoolFix())}},{key:"buildPool",value:function(){return{uidCounter:this.state.uidCounter,offset:this.state.offset,scale:this.state.scale,nodes:Array.from(this.nodes.values())}}}]),n}(o.Component),K=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,24)).then((function(e){var n=e.getCLS,o=e.getFID,i=e.getFCP,s=e.getLCP,a=e.getTTFB;n(t),o(t),i(t),s(t),a(t)}))};a.a.render(Object(g.jsx)(i.a.StrictMode,{children:Object(g.jsx)(J,{})}),document.getElementById("root")),K()}},[[23,1,2]]]);
//# sourceMappingURL=main.d379b5a7.chunk.js.map